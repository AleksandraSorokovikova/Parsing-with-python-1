<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Микрофреймворк slim / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.c0af73e7.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.85eb77f0b17c8235e7b64b9f81ea5ec2.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/post\/452834\/"},"headline":"Микрофреймворк slim","datePublished":"2019-05-28T19:55:09+03:00","dateModified":"2020-04-23T20:10:42+03:00","author":{"@type":"Person","name":"Ivan Dudarev"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"25 апреля 2019 года свет увидела новая мажорная alpha-версия микрофреймворка Slim, а 18 мая она выросла до beta. Предлагаю по этому поводу ознакомиться с новой в...","url":"https:\/\/habr.com\/ru\/post\/452834\/#post-content-body","about":["h_webdev","h_php","f_develop"],"image":["https:\/\/habr.com\/share\/publication\/452834\/518a79f832078a069eac95a51b8c4576\/"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.49.0">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="Микрофреймворк slim" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Микрофреймворк slim" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Микрофреймворк slim" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="25 апреля 2019 года свет увидела новая мажорная alpha-версия микрофреймворка Slim, а 18 мая она выросла до beta. Предлагаю по этому поводу ознакомиться с новой версией.
Под катом:

О новшествах..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="25 апреля 2019 года свет увидела новая мажорная alpha-версия микрофреймворка Slim, а 18 мая она выросла до beta. Предлагаю по этому поводу ознакомиться с новой версией.
Под катом:

О новшествах..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="25 апреля 2019 года свет увидела новая мажорная alpha-версия микрофреймворка Slim, а 18 мая она выросла до beta. Предлагаю по этому поводу ознакомиться с новой версией.
Под катом:

О новшествах..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="25 апреля 2019 года свет увидела новая мажорная alpha-версия микрофреймворка Slim, а 18 мая она выросла до beta. Предлагаю по этому поводу ознакомиться с новой версией.
Под катом:

О новшествах..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="25 апреля 2019 года свет увидела новая мажорная alpha-версия микрофреймворка Slim, а 18 мая она выросла до beta. Предлагаю по этому поводу ознакомиться с новой версией.
Под катом:

О новшествах..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habr.com/share/publication/452834/518a79f832078a069eac95a51b8c4576/" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habr.com/share/publication/452834/518a79f832078a069eac95a51b8c4576/" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habr.com/share/publication/452834/518a79f832078a069eac95a51b8c4576/" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habr.com/share/publication/452834/518a79f832078a069eac95a51b8c4576/" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habr.com/share/publication/452834/518a79f832078a069eac95a51b8c4576/" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="452834" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2019-05-28T16:55:09.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/452834/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/post/452834/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habr.com/share/publication/452834/518a79f832078a069eac95a51b8c4576/" data-vmid="image:href">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
            Как стать автором
          </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" data-async-called="true" class="tm-page"><div class="tm-page-width"><!----> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/trawl/" title="trawl" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="" height="24" loading="lazy" src="//habrastorage.org/r/w32/getpro/habr/avatars/f8f/e1c/5a9/f8fe1c5a98aa8e6b20eb12846a23ec71.png" width="24" class="tm-entity-image__pic"></div></a> <span class="tm-user-info__user"><a href="/ru/users/trawl/" class="tm-user-info__username">
      trawl
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2019-05-28T16:55:09.000Z" title="2019-05-28, 19:55">28  мая  2019 в 19:55</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>Микрофреймворк slim</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/webdev/" class="tm-article-snippet__hubs-item-link"><span>Разработка веб-сайтов</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/php/" class="tm-article-snippet__hubs-item-link"><span>PHP</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <div class="tm-article-snippet__labels"><div class="tm-article-snippet__label"><span>
        Tutorial
      </span></div></div> <!----> <!----></div></div> <!----> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-1"><div xmlns="http://www.w3.org/1999/xhtml"><p>25 апреля 2019 года свет увидела новая мажорная <code>alpha</code>-версия микрофреймворка <a href="https://www.slimframework.com" rel="nofollow">Slim</a>, а 18 мая она выросла до <code>beta</code>. Предлагаю по этому поводу ознакомиться с новой версией.</p><br/>
<p>Под катом:</p><br/>
<ul>
<li>О новшествах фреймворка</li>
<li>Написание простого приложения на Slim-4</li>
<li>О дружбе Slim и <a href="https://www.jetbrains.com/phpstorm/" rel="nofollow">PhpStorm</a><a name="habracut"></a></li>
</ul><br/>
<h2 id="novoe-v-slim-4">Новое в Slim 4</h2><br/>
<p>Основные нововведения по сравнению с версией 3:</p><br/>
<ul>
<li>Минимальная версия PHP — 7.1;</li>
<li>Поддержка PSR-15 (Middleware);</li>
<li>Удалена реализация http-сообщений. Устанавливаем любую PSR-7 совместимую библиотеку и пользуемся;</li>
<li>Удалена зависимость <a href="https://packagist.org/packages/pimple/pimple" rel="nofollow">Pimple</a>. Устанавливаем свой любимый PSR-11 совместимый контейнер и пользуемся;</li>
<li>Возможность использования своего роутера (Раньше не было возможности отказаться от <a href="https://packagist.org/packages/nikic/fast-route" rel="nofollow">FastRoute</a>);</li>
<li>Изменена реализация обработки ошибок;</li>
<li>Изменена реализация вывода ответа;</li>
<li>Добавлена фабрика для создания экземпляра приложения;</li>
<li>Удалены настройки;</li>
<li>Slim больше не устанавливает <code>default_mimetype</code> в пустую строку, поэтому нужно установить его самостоятельно в <code>php.ini</code> или в вашем приложении, используя <code>ini_set('default_mimetype', '')</code>;</li>
<li>Обработчик запроса приложения теперь принимает только объект запроса (в старой версии принимал объекты запроса и ответа).</li>
</ul><br/>
<h3 id="kak-teper-sozdat-prilozhenie">Как теперь создать приложение?</h3><br/>
<p>В третьей версии создание приложения выглядело примерно так:</p><br/>
<pre><code class="php">&lt;?php

use Psr\Http\Message\ServerRequestInterface;
use Psr\Http\Message\ResponseInterface;
use Slim\App;

require 'vendor/autoload.php';

$settings = [
    'addContentLengthHeader' => false,
];

$app = new App(['settings' => $settings]);
$app->get('/hello/{name}', function (ServerRequestInterface $request, ResponseInterface $response, array $args) {
    $name = $args['name'];
    $response->getBody()->write("Hello, $name");

    return $response;
});
$app->run();</code></pre><br/>
<p>Теперь конструктор приложения принимает следующие параметры:</p><br/>
<div class="scrollable-table"><table>
<thead>
<tr>
<th>Параметр</th>
<th>Тип</th>
<th>Обязательный</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>$responseFactory</td>
<td><code>Psr\Http\Message\ResponseFactoryInterface</code></td>
<td>да</td>
<td>PSR-17 совместимая фабрика серверного http-запроса</td>
</tr>
<tr>
<td>$container</td>
<td><code>\Psr\Container\ContainerInterface</code></td>
<td>нет</td>
<td>Контейнер зависимостей</td>
</tr>
<tr>
<td>$callableResolver</td>
<td><code>\Slim\Interfaces\CallableResolverInterface</code></td>
<td>нет</td>
<td>Обработчик вызываемых методов</td>
</tr>
<tr>
<td>$routeCollector</td>
<td><code>\Slim\Interfaces\RouteCollectorInterface</code></td>
<td>нет</td>
<td>Роутер</td>
</tr>
<tr>
<td>$routeResolver</td>
<td><code>\Slim\Interfaces\RouteResolverInterface</code></td>
<td>нет</td>
<td>Обработчик результатов роутинга</td>
</tr>
</tbody>
</table></div><br/>
<p>Так же теперь можно воспользоваться статическим методом <code>create</code> фабрики приложения <code>\Slim\Factory\AppFactory</code>.<br/>
Этот метод принимает на вход такие же параметры, только все они опциональные.</p><br/>
<pre><code class="php">&lt;?php

use Psr\Http\Message\ServerRequestInterface;
use Psr\Http\Message\ResponseInterface;
use Slim\Factory\AppFactory;

require 'vendor/autoload.php';

$app = AppFactory::create();
$app->get('/hello/{name}', function (ServerRequestInterface $request, ResponseInterface $response) {
    $name = $request->getAttribute('name');
    $response->getBody()->write("Hello, $name");
    return $response;
});
$app->run();</code></pre><br/>
<h3 id="vernite-mne-404-oshibku">Верните мне 404 ошибку!</h3><br/>
<p>Если мы попробуем открыть несуществующую страницу, получим код ответа <code>500</code>, а не <code>404</code>. Чтобы ошибки обрабатывались корректно, нужно подключить <code>\Slim\Middleware\ErrorMiddleware</code></p><br/>
<pre><code class="php">&lt;?php

use Psr\Http\Message\ServerRequestInterface;
use Psr\Http\Message\ResponseInterface;
use Slim\Factory\AppFactory;
use Slim\Middleware\ErrorMiddleware;

require 'vendor/autoload.php';

$app = AppFactory::create();
$middleware = new ErrorMiddleware(
    $app->getCallableResolver(),
    $app->getResponseFactory(),
    false,
    false,
    false
);
$app->add($middleware);
$app->get('/hello/{name}', function (ServerRequestInterface $request, ResponseInterface $response) {
    $name = $request->getAttribute('name');
    $response->getBody()->write("Hello, $name");
    return $response;
});
$app->run();</code></pre><br/>
<h3 id="middleware">Middleware</h3><br/>
<p>Промежуточное ПО теперь должно быть реализацией PSR-15. В качестве исключения, можно передавать функции, но сигнатура должна соответствовать методу <code>process()</code> интерфейса <code>\Psr\Http\Server\MiddlewareInterface</code></p><br/>
<pre><code class="php">&lt;?php

use Psr\Http\Message\ServerRequestInterface;
use Psr\Http\Message\ResponseInterface;
use Psr\Http\Server\RequestHandlerInterface;
use Slim\Factory\AppFactory;

require 'vendor/autoload.php';

$app = AppFactory::create();
$app->add(function (ServerRequestInterface $request, RequestHandlerInterface $handler): ResponseInterface {
    $response = $handler->handle($request);
    return $response->withHeader('Content-Type', 'application/json');
});
// ... Описание роутов и прочее
$app->run();</code></pre><br/>
<p>Сигнатура <code>($request, $response, $next)</code> больше не поддерживается</p><br/>
<h3 id="kak-zhit-bez-nastroek">Как жить без настроек?</h3><br/>
<p>Без настроек жить можно. Предоставленные инструменты нам в этом помогут.</p><br/>
<p><strong><code>httpVersion</code></strong> и <strong><code>responseChunkSize</code></strong></p><br/>
<p>Настройка <code>httpVersion</code> отвечала за вывод версии протокола в ответе.<br/>
Настройка <code>responseChunkSize</code> определяла размер каждого чанка, читаемого из тела ответа при отправке в браузер.</p><br/>
<p>Сейчас эти функции можно возложить на эмиттер ответа.</p><br/>
<p>Пишем эмиттер</p><br/>
<pre><code class="php">&lt;?php
// /src/ResponseEmitter.php

namespace App;

use Psr\Http\Message\ResponseInterface;
use Slim\ResponseEmitter as SlimResponseEmitter;

class ResponseEmitter extends SlimResponseEmitter
{
    private $protocolVersion;

    public function __construct(string $protocolVersion = '1.1', int $responseChunkSize = 4096)
    {
        $this->protocolVersion = $protocolVersion;
        parent::__construct($responseChunkSize);
    }

    public function emit(ResponseInterface $response) : void{
        parent::emit($response->withProtocolVersion($this->protocolVersion));
    }
}</code></pre><br/>
<p>Подключаем к приложению</p><br/>
<pre><code class="php">&lt;?php

use App\ResponseEmitter;
use Slim\Factory\AppFactory;

require 'vendor/autoload.php';

$app = AppFactory::create();
$serverRequestFactory = \Slim\Factory\ServerRequestCreatorFactory::create();
$request = $serverRequestFactory->createServerRequestFromGlobals();
// ... Описание роутов и прочее
$response = $app->handle($request);
$emitter = new ResponseEmitter('2.0', 4096);
$emitter->emit($response);</code></pre><br/>
<p><strong><code>outputBuffering</code></strong></p><br/>
<p>Данная настройка позволяла включать/выключать буфферизацию вывода. Значения настройки:</p><br/>
<ul>
<li><code>false</code> — буфферизация выключена (все вызовы операторов <code>echo</code>, <code>print</code> игнорируются).</li>
<li><code>'append'</code> — все вызовы операторов <code>echo</code>, <code>print</code> добавляются после тела ответа</li>
<li><code>'prepend'</code> — все вызовы операторов <code>echo</code>, <code>print</code> добавляются перед телом ответа</li>
</ul><br/>
<p>Разработчики фреймворка предлагают заменить эту опцию промежуточным ПО <code>\Slim\Middleware\OutputBufferingMiddleware</code>, в конструктор которого передается PSR-17 совместимая фабрика потока и режим, который может быть равен <code>append</code> или <code>prepend</code></p><br/>
<pre><code class="php">&lt;?php

use Slim\Factory\AppFactory;
use Slim\Factory\Psr17\SlimPsr17Factory;
use Slim\Middleware\OutputBufferingMiddleware;

require 'vendor/autoload.php';

$app = AppFactory::create();

$middleware = new OutputBufferingMiddleware(SlimPsr17Factory::getStreamFactory(), OutputBufferingMiddleware::APPEND);
$app->add($middleware);
// ... Описание роутов и прочее
$app->run();</code></pre><br/>
<p><strong><code>determineRouteBeforeAppMiddleware</code></strong></p><br/>
<p>Эта настройка позволяла получить текущий маршрут из объекта запроса в промежуточном ПО</p><br/>
<p>На замену предоставляется <code>\Slim\Middleware\RoutingMiddleware</code></p><br/>
<pre><code class="php">&lt;?php
use Slim\Factory\AppFactory;
use Slim\Middleware\RoutingMiddleware;

require 'vendor/autoload.php';

$app = AppFactory::create();

$middleware = new RoutingMiddleware($app->getRouteResolver());
$app->add($middleware);
// ... Описание роутов и прочее
$app->run();</code></pre><br/>
<p><strong><code>displayErrorDetails</code></strong></p><br/>
<p>Настройка позволяла выводить подробности ошибок. При отладке это неплохо упрощает жизнь.</p><br/>
<p>Помните <code>\Slim\Middleware\ErrorMiddleware</code>? Оно и здесь нас выручит!</p><br/>
<pre><code class="php">&lt;?php

use Slim\Factory\AppFactory;
use Slim\Middleware\ErrorMiddleware;

require 'vendor/autoload.php';

$app = AppFactory::create();
$middleware = new ErrorMiddleware(
    $app->getCallableResolver(),
    $app->getResponseFactory(),
    true, // Этот параметр отвечает за подробный вывод ошибок
    false, // Логирование ошибок
    false // Логирование подробностей ошибок
);
$app->add($middleware);
// ... Описание роутов и прочее
$app->run();</code></pre><br/>
<p><strong><code>addContentLengthHeader</code></strong></p><br/>
<p>Данная настройка позволяла включать/отключать автодобавление заголовка <code>Content-Length</code> со значением объема данных в теле ответа</p><br/>
<p>Заменяет опцию промежуточное ПО <code>\Slim\Middleware\ContentLengthMiddleware</code></p><br/>
<pre><code class="php">&lt;?php

use Slim\Factory\AppFactory;
use Slim\Middleware\ContentLengthMiddleware;

require 'vendor/autoload.php';

$app = AppFactory::create();

$middleware = new ContentLengthMiddleware();
$app->add($middleware);
// ... Описание роутов и прочее
$app->run();</code></pre><br/>
<p><strong><code>routerCacheFile</code></strong></p><br/>
<p>Теперь вы можете напрямую установить файл кеша роутера</p><br/>
<pre><code class="php">&lt;?php

use Slim\Factory\AppFactory;

require 'vendor/autoload.php';

$app = AppFactory::create();
$app->getRouteCollector()->setCacheFile('/path/to/cache/router.php');
// ... Описание роутов и прочее
$app->run();</code></pre><br/>
<h2 id="sozdanie-prilozheniya-na-slim-4">Создание приложения на Slim-4</h2><br/>
<p>Чтобы более подробно рассмотреть фреймворк, напишем небольшое приложение.</p><br/>
<p>Приложение будет иметь следующие роуты:</p><br/>
<ul>
<li><code>/hello/{name}</code> — страница приветствия;</li>
<li><code>/</code> — редирект на страницу <code>/hello/world</code></li>
<li>Остальные роуты будут возвращать кастомизированную страницу с 404 ошибкой.</li>
</ul><br/>
<p>Логика будет в контроллерах, рендерить страницу будем через шаблонизатор <a href="https://packagist.org/packages/twig/twig" rel="nofollow">Twig</a><br/>
Бонусом добавим консольное приложение на базе компонента Symfony <a href="https://packagist.org/packages/symfony/console" rel="nofollow">Console</a> с командой, отображающей список роутов</p><br/>
<h3 id="shag-0-ustanovka-zavisimostey">Шаг 0. Установка зависимостей</h3><br/>
<p>Нам понадобится:</p><br/>
<ul>
<li>микрофреймворк, <a href="https://packagist.org/packages/slim/slim" rel="nofollow">slim/slim</a>;</li>
<li>реализация интерфейса контейнера (PSR-11) <a href="https://packagist.org/packages/psr/container" rel="nofollow">psr/container</a>;</li>
<li>реализация интерфейсов http-сообщений (PSR-7) <a href="https://packagist.org/packages/psr/http-message" rel="nofollow">psr/http-message</a>;</li>
<li>реализация интерфейсов фабрик http-сообщений (PSR-17) <a href="https://packagist.org/packages/psr/http-factory" rel="nofollow">psr/http-factory</a>;</li>
<li>шаблонизатор <a href="https://packagist.org/packages/twig/twig" rel="nofollow">twig/twig</a>;</li>
<li>консольное приложение <a href="https://packagist.org/packages/symfony/console" rel="nofollow">symfony/console</a>.</li>
</ul><br/>
<p>В качестве контенера зависимостей я выбрал <a href="https://packagist.org/packages/ultra-lite/container" rel="nofollow">ultra-lite/container</a>, как легкий, лаконичный и соответствующий стандарту.<br/>
PSR-7 и PSR-17 разработчики Slim предоставляют в одном пакете <a href="https://packagist.org/packages/slim/psr7" rel="nofollow">slim/psr7</a>. Им и воспользуемся</p><br/>
<blockquote>Предполагается, что пакетный менеджер <a href="https://getcomposer.org/" rel="nofollow">Composer</a> уже установлен.</blockquote><p>Создаём папку под проект (в качестве примера будет использоваться <code>/path/to/project</code>) и переходим в неё.</p><br/>
<p>Добавим в проект файл <code>composer.json</code> со следующим содержимым:</p><br/>
<pre><code class="json">{
  "require": {
    "php": ">=7.1",
    "slim/slim": "4.0.0-beta",
    "slim/psr7": "~0.3",
    "ultra-lite/container": "^6.2",
    "symfony/console": "^4.2",
    "twig/twig": "^2.10"
  },
  "autoload": {
    "psr-4": {
      "App\\": "app"
    }
  }
}</code></pre><br/>
<p>и выполним команду </p><br/>
<pre><code class="plaintext">composer install</code></pre><br/>
<p>Теперь у нас есть все необходимые пакеты и настроен автозагрузчик классов.</p><br/>
<p>Если работаем с <a href="https://git-scm.com/" rel="nofollow">git</a>, добавим файл <code>.gitignore</code> и внесем туда директорию <code>vendor</code> (и диреткорию своей IDE при необходимости)</p><br/>
<pre><code class="plaintext">/.idea/*
/vendor/*</code></pre><br/>
<p>Я использую IDE <a href="https://www.jetbrains.com/phpstorm/" rel="nofollow">PhpStorm</a> <del>и горжусь этим</del>. Для комфортной разработки самое время подружить контейнер и IDE.<br/>
В корне проекта создадим файл <code>.phpstorm.meta.php</code> и напишем там такой код:</p><br/>
<pre><code class="php">&lt;?php
// .phpstorm.meta.php

namespace PHPSTORM_META {

    override(
        \Psr\Container\ContainerInterface::get(0),
        map([
            '' => '@',
        ])
    );
}</code></pre><br/>
<p>Этот код подскажет IDE, что у объекта, реализующего интерфейс <code>\Psr\Container\ContainerInterface</code>, метод <code>get()</code> вернёт объект класса или реализацию интерфейса, имя которого передано в параметре.</p><br/>
<h3 id="shag-1-karkas-prilozheniya">Шаг 1. Каркас приложения</h3><br/>
<p>Добавим каталоги:</p><br/>
<ul>
<li><code>app</code> — код приложения. К нему мы подключим наше пространство имен для автозагрузчика классов;</li>
<li><code>bin</code> — директория для консольной утилиты;</li>
<li><code>config</code> — здесь будут файлы конфигурации приложения;</li>
<li><code>public</code> — директория, открытая в веб (точка входа приложения, стили, js, картинки и т.д.);</li>
<li><code>template</code> — директория шаблонов;</li>
<li><code>var</code> — директория для различных файлов. Логи, кэш, локальное хранилище и т.д.</li>
</ul><br/>
<p>И файлы:</p><br/>
<ul>
<li><code>config/app.ini</code> — основной конфиг приложения;</li>
<li><code>config/app.local.ini</code> — конфиг для окружения <code>local</code>;</li>
<li><code>app/Support/CommandMap.php</code> — маппинг команд консольного приложения для ленивой загрузки.</li>
<li><code>app/Support/Config.php</code> — Класс конфигурации (Чтобы IDE знала, какие конфиги у нас имеются).</li>
<li><code>app/Support/NotFoundHandler.php</code> — Класс обработчика 404й ошибки.</li>
<li><code>app/Support/ServiceProviderInterface.php</code> — Интерфейс сервис-провайдера.</li>
<li><code>app/Provider/AppProvider.php</code> — Основной провайдер приложения.</li>
<li><code>bootstrap.php</code> — сборка контейнера;</li>
<li><code>bin/console</code> — точка входа консольного приложения;</li>
<li><code>public/index.php</code> — точка входа веб приложения.</li>
</ul><br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">config/app.ini</b>
                        <div class="spoiler_text"><pre><code class="plaintext">; режим отладки
slim.debug=Off

; директория шаблонов
templates.dir=template

; кэш шаблонов
templates.cache=var/cache/template</code></pre></div>
                    </div><br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">config/app.local.ini</b>
                        <div class="spoiler_text"><pre><code class="plaintext">; В этом файле мы только переопределим некоторые параметры. Остальные значения подставятся из основного конфига
; В локальном окружении полезно видеть подробности ошибок
slim.debug=On

; кэш шаблонов для разработки не нужен
templates.cache=</code></pre></div>
                    </div><br/>
<p>Ах да, ещё неплохо исключить конфиги окружения из репозитория. Ведь там могут быть явки/пароли. Кэш тоже исключим.</p><br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">.gitignore</b>
                        <div class="spoiler_text"><pre><code class="plaintext">/.idea/*
/config/*
/vendor/*
/var/cache/*
!/config/app.ini
!/var/cache/.gitkeep</code></pre></div>
                    </div><br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">app/Support/CommandMap.php</b>
                        <div class="spoiler_text"><pre><code class="php">&lt;?php
// app/Support/CommandMap.php

namespace App\Support;

class CommandMap
{

    /**
     * Маппинг команд. Имя команды => Ключ в контейнере
     * @var string[]
     */
    private  $map = [];

    public function set(string $name, string $value)
    {
        $this->map[$name] = $value;
    }

    /**
     * @return string[]
     */
    public function getMap()
    {
        return $this->map;
    }
}</code></pre></div>
                    </div><br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">app/Support/Config.php</b>
                        <div class="spoiler_text"><pre><code class="php">&lt;?php
// app/Support/Config.php

namespace App\Support;

class Config
{

    /**
     * @var string[]
     */
    private $config = [];

    public function __construct(string $dir, string $env, string $root)
    {
        if (!is_dir($dir)) return;

        /*
         * Парсим основной конфиг
         */
        $config = (array)parse_ini_file($dir . DIRECTORY_SEPARATOR . 'app.ini', false);

        /*
         * Переопределяем параметры из конфига окружения
         */
        $environmentConfigFile = $dir . DIRECTORY_SEPARATOR . 'app.' . $env . '.ini';
        if (is_readable($environmentConfigFile)) {
            $config = array_replace_recursive($config, (array)parse_ini_file($environmentConfigFile, false));
        }

        /*
         * Указываем, какие параметры конфига являются путями
         */
        $dirs = ['templates.dir', 'templates.cache'];

        foreach ($config as $name=>$value) {
            $this->config[$name] = $value;
        }

        /*
         * Устанавливаем абсолютные пути в конфигурации
         */
        foreach ($dirs as $parameter) {
            $value = $config[$parameter];
            if (mb_strpos($value, '/') === 0) {
                continue;
            }
            if (empty($value)) {
                $this->config[$parameter] = null;
                continue;
            }
            $this->config[$parameter] = $root . DIRECTORY_SEPARATOR . $value;
        }
    }

    public function get(string $name)
    {
        return array_key_exists($name, $this->config) ? $this->config[$name] : null;
    }
}</code></pre></div>
                    </div><br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">app/Support/NotFoundHandler.php</b>
                        <div class="spoiler_text"><pre><code class="php">&lt;?php
// app/Support/NotFoundHandler.php

namespace App\Support;

use Psr\Http\Message\ResponseFactoryInterface;
use Psr\Http\Message\ResponseInterface;
use Psr\Http\Message\ServerRequestInterface;
use Slim\Interfaces\ErrorHandlerInterface;
use Throwable;

class NotFoundHandler implements ErrorHandlerInterface
{

    private $factory;

    public function __construct(ResponseFactoryInterface $factory)
    {
        $this->factory = $factory;
    }

    /**
     * @param ServerRequestInterface $request
     * @param Throwable $exception
     * @param bool $displayErrorDetails
     * @param bool $logErrors
     * @param bool $logErrorDetails
     * @return ResponseInterface
     */
    public function __invoke(ServerRequestInterface $request, Throwable $exception, bool $displayErrorDetails, bool $logErrors, bool $logErrorDetails): ResponseInterface
    {
        $response = $this->factory->createResponse(404);
        return $response;
    }
}</code></pre></div>
                    </div><br/>
<p>Теперь можно научить PhpStorm понимать, какие у конфига есть ключи и какого они типа</p><br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">.phpstorm.meta.php</b>
                        <div class="spoiler_text"><pre><code class="php">&lt;?php
// .phpstorm.meta.php

namespace PHPSTORM_META {

    override(
        \Psr\Container\ContainerInterface::get(0),
        map([
            '' => '@',
        ])
    );

    override(
        \App\Support\Config::get(0),
        map([
            'slim.debug'      => 'bool',
            'templates.dir'   => 'string|false',
            'templates.cache' => 'string|false',
        ])
    );
}</code></pre></div>
                    </div><br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">app/Support/ServiceProviderInterface.php</b>
                        <div class="spoiler_text"><pre><code class="php">&lt;?php
// app/Support/ServiceProviderInterface.php

namespace App\Support;

use UltraLite\Container\Container;

interface ServiceProviderInterface
{

    public function register(Container $container);
}</code></pre></div>
                    </div><br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">app/Provider/AppProvider.php</b>
                        <div class="spoiler_text"><pre><code class="php">&lt;?php
// app/Provider/AppProvider.php

namespace App\Provider;

use App\Support\CommandMap;
use App\Support\Config;
use App\Support\NotFoundHandler;
use App\Support\ServiceProviderInterface;
use Psr\Container\ContainerInterface;
use Psr\Http\Message\ResponseFactoryInterface;
use Slim\CallableResolver;
use Slim\Exception\HttpNotFoundException;
use Slim\Interfaces\CallableResolverInterface;
use Slim\Interfaces\RouteCollectorInterface;
use Slim\Interfaces\RouteResolverInterface;
use Slim\Middleware\ErrorMiddleware;
use Slim\Middleware\RoutingMiddleware;
use Slim\Psr7\Factory\ResponseFactory;
use Slim\Routing\RouteCollector;
use Slim\Routing\RouteResolver;
use UltraLite\Container\Container;

class AppProvider implements ServiceProviderInterface
{

    public function register(Container $container)
    {

        /*
         * Регистрируем маппинг консольных команд
         */
        $container->set(CommandMap::class, function () {
            return new CommandMap();
        });

        /*
         * Регистрируем фабрику http-запроса
         */
        $container->set(ResponseFactory::class, function () {
            return new ResponseFactory();
        });

        /*
         * Связываем интерфейс фабрики http-запроса с реализацией
         */
        $container->set(ResponseFactoryInterface::class, function (ContainerInterface $container) {
            return $container->get(ResponseFactory::class);
        });

        /*
         * Регистрируем обработчик вызываемых методов
         */
        $container->set(CallableResolver::class, function (ContainerInterface $container) {
            return new CallableResolver($container);
        });

        /*
         * Связываем интерфейс обработчика вызываемых методов с реализацией
         */
        $container->set(CallableResolverInterface::class, function (ContainerInterface $container) {
            return $container->get(CallableResolver::class);
        });

        /*
         * Регистрируем роутер
         */
        $container->set(RouteCollector::class, function (ContainerInterface $container) {
            $router = new RouteCollector(
                $container->get(ResponseFactoryInterface::class),
                $container->get(CallableResolverInterface::class),
                $container
            );
            return $router;
        });

        /*
         * Связываем интерфес роутера с реализацией
         */
        $container->set(RouteCollectorInterface::class, function (ContainerInterface $container) {
            return $container->get(RouteCollector::class);
        });

        /*
         * Регистрируем обработчик результатов роутера
         */
        $container->set(RouteResolver::class, function (ContainerInterface $container) {
            return new RouteResolver($container->get(RouteCollectorInterface::class));
        });

        /*
         * Связываем интерфес обработчика результатов роутера с реализацией
         */
        $container->set(RouteResolverInterface::class, function (ContainerInterface $container) {
            return $container->get(RouteResolver::class);
        });

        /*
         * Регистрируем обработчика ошибки 404
         */
        $container->set(NotFoundHandler::class, function (ContainerInterface $container) {
            return new NotFoundHandler($container->get(ResponseFactoryInterface::class));
        });

        /*
         * Регистрируем middleware обработки ошибок
         */
        $container->set(ErrorMiddleware::class, function (ContainerInterface $container) {
            $middleware = new ErrorMiddleware(
                $container->get(CallableResolverInterface::class),
                $container->get(ResponseFactoryInterface::class),
                $container->get(Config::class)->get('slim.debug'),
                true,
                true);
            $middleware->setErrorHandler(HttpNotFoundException::class, $container->get(NotFoundHandler::class));
            return $middleware;
        });

        /*
         * Регистрируем middleware роутера
         */
        $container->set(RoutingMiddleware::class, function (ContainerInterface $container) {
            return new RoutingMiddleware($container->get(RouteResolverInterface::class));
        });
    }
}</code></pre></div>
                    </div><br/>
<p>Мы вынесли роутинг в контейнер для того, чтобы можно было с ним работать без инициализации объекта <code>\Slim\App</code>.</p><br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">bootstrap.php</b>
                        <div class="spoiler_text"><pre><code class="php">&lt;?php
// bootstrap.php

require_once __DIR__ . DIRECTORY_SEPARATOR . 'vendor' . DIRECTORY_SEPARATOR . 'autoload.php';

use App\Support\ServiceProviderInterface;
use App\Provider\AppProvider;
use App\Support\Config;
use UltraLite\Container\Container;

/*
 * Определяем окружение
 */
$env = getenv('APP_ENV');
if (!$env) $env = 'local';

/*
 * Строим конфиг
 */
$config = new Config(__DIR__ . DIRECTORY_SEPARATOR . 'config', $env, __DIR__);

/*
 * Определяем сервис-провайдеры
 */
$providers = [
    AppProvider::class,
];

/*
 * Создаем экземпляр контейнера
 */
$container = new Container([
    Config::class => function () use ($config) { return $config;},
]);

/*
 * Регистрируем сервисы
 */
foreach ($providers as $className) {
    if (!class_exists($className)) {
        /** @noinspection PhpUnhandledExceptionInspection */
        throw new Exception('Provider ' . $className . ' not found');
    }
    $provider = new $className;
    if (!$provider instanceof ServiceProviderInterface) {
        /** @noinspection PhpUnhandledExceptionInspection */
        throw new Exception($className . ' has not provider');
    }
    $provider->register($container);
}

/*
 * Возвращаем контейнер
 */
return $container;</code></pre></div>
                    </div><br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">bin/console</b>
                        <div class="spoiler_text"><pre><code class="php">#!/usr/bin/env php
&lt;?php
// bin/console

use App\Support\CommandMap;
use Psr\Container\ContainerInterface;
use Symfony\Component\Console\Application;
use Symfony\Component\Console\CommandLoader\ContainerCommandLoader;
use Symfony\Component\Console\Input\ArgvInput;
use Symfony\Component\Console\Output\ConsoleOutput;

/** @var ContainerInterface $container */
$container = require dirname(__DIR__) . DIRECTORY_SEPARATOR . 'bootstrap.php';

$loader = new ContainerCommandLoader($container, $container->get(CommandMap::class)->getMap());
$app = new Application();
$app->setCommandLoader($loader);
/** @noinspection PhpUnhandledExceptionInspection */
$app->run(new ArgvInput(), new ConsoleOutput());</code></pre></div>
                    </div><br/>
<p>Желательно дать этому файлу права на выполнение</p><br/>
<pre><code class="plaintext">chmod +x ./bin/console</code></pre><br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">public/index.php</b>
                        <div class="spoiler_text"><pre><code class="php">&lt;?php
// public/index.php

use Psr\Container\ContainerInterface;
use Psr\Http\Message\ResponseFactoryInterface;
use Slim\App;
use Slim\Interfaces\CallableResolverInterface;
use Slim\Interfaces\RouteCollectorInterface;
use Slim\Interfaces\RouteResolverInterface;
use Slim\Middleware\ErrorMiddleware;
use Slim\Middleware\RoutingMiddleware;
use Slim\Psr7\Factory\ServerRequestFactory;

/** @var ContainerInterface $container */
$container = require dirname(__DIR__) . DIRECTORY_SEPARATOR . 'bootstrap.php';
$request = ServerRequestFactory::createFromGlobals();

Slim\Factory\AppFactory::create();
$app = new App(
    $container->get(ResponseFactoryInterface::class),
    $container,
    $container->get(CallableResolverInterface::class),
    $container->get(RouteCollectorInterface::class),
    $container->get(RouteResolverInterface::class)
);

$app->add($container->get(RoutingMiddleware::class));
$app->add($container->get(ErrorMiddleware::class));
$app->run($request);</code></pre></div>
                    </div><br/>
<p>Проверка.<br/>
Запустим консольное приложение:</p><br/>
<pre><code class="plaintext">./bin/console</code></pre><br/>
<p>В ответ должно отобразиться окно приветсвия компонета <code>symfony/console</code> с двумя доступными командами — <code>help</code> и <code>list</code>.</p><br/>
<pre><code class="plaintext">Console Tool

Usage:
  command [options] [arguments]

Options:
  -h, --help            Display this help message
  -q, --quiet           Do not output any message
  -V, --version         Display this application version
      --ansi            Force ANSI output
      --no-ansi         Disable ANSI output
  -n, --no-interaction  Do not ask any interactive question
  -v|vv|vvv, --verbose  Increase the verbosity of messages: 1 for normal output, 2 for more verbose output and 3 for debug

Available commands:
  help  Displays help for a command
  list  Lists commands</code></pre><br/>
<p>Теперь запустим веб-сервер.</p><br/>
<pre><code class="plaintext">php -S localhost:8080 -t public public/index.php</code></pre><br/>
<p>И откроем любой урл на localhost:8080.<br/>
Все запросы должны возвращать ответ с кодом <code>404</code> и пустым телом.<br/>
Это происходит, потому что у нас не указан ни один маршрут.</p><br/>
<p>Нам осталось подключить рендер, написать шаблоны, контроллеры и задать маршруты.</p><br/>
<h3 id="shag-2-render">Шаг 2. Рендер</h3><br/>
<p>Добавим шаблон <code>template/layout.twig</code>. Это базовый шаблон для всех страниц</p><br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">template/layout.twig</b>
                        <div class="spoiler_text"><pre><code class="plaintext">{# template/layout.twig #}
&lt;!DOCTYPE html>
&lt;html lang="en">
&lt;head>
    &lt;title>{% block title %}Slim demo{% endblock %}&lt;/title>
&lt;/head>
&lt;body>
{% block content %}{% endblock %}
&lt;/body>
&lt;/html></code></pre></div>
                    </div><br/>
<p>Добавим шаблон страницы приветствия <code>template/hello.twig</code></p><br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">template/hello.twig</b>
                        <div class="spoiler_text"><pre><code class="plaintext">{# template/hello.twig #}
{% extends 'layout.twig' %}
{% block title %}Slim demo::hello, {{ name }}{% endblock %}
{% block content %}
&lt;h1>Welcome!&lt;/h1>
&lt;p>Hello, {{ name }}!&lt;/p>
{% endblock %}</code></pre></div>
                    </div><br/>
<p>И шаблон страницы ошибки <code>template/err404.twig</code></p><br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">template/err404.twig</b>
                        <div class="spoiler_text"><pre><code class="plaintext">{# template/err404.twig #}
{% extends 'layout.twig' %}
{% block title %}Slim demo::not found{% endblock %}
{% block content %}
&lt;h1>Error!&lt;/h1>
&lt;p>Page not found =(&lt;/p>
{% endblock %}</code></pre></div>
                    </div><br/>
<p>Добавим провайдер рендеринга <code>app/Provider/RenderProvider.php</code></p><br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">app/Provider/RenderProvider.php</b>
                        <div class="spoiler_text"><pre><code class="php">&lt;?php
// app/Provider/RenderProvider.php

namespace App\Provider;

use App\Support\Config;
use App\Support\ServiceProviderInterface;
use Psr\Container\ContainerInterface;
use Twig\Environment;
use Twig\Loader\FilesystemLoader;
use UltraLite\Container\Container;

class RenderProvider implements ServiceProviderInterface
{
    public function register(Container $container)
    {
        $container->set(Environment::class, function (ContainerInterface $container) {
            $config = $container->get(Config::class);
            $loader = new FilesystemLoader($config->get('templates.dir'));
            $cache = $config->get('templates.cache');
            $options = [
                'cache' => empty($cache) ? false : $cache,
            ];
            $twig = new Environment($loader, $options);
            return $twig;
        });
    }
}</code></pre></div>
                    </div><br/>
<p>Включим провайдер в бутстрап</p><br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">bootstrap.php</b>
                        <div class="spoiler_text"><pre><code class="php">&lt;?php
// bootstrap.php
// ...
use App\Provider\RenderProvider;
// ...
$providers = [
// ...
    RenderProvider::class,
// ...
];
// ...</code></pre></div>
                    </div><br/>
<p>Добавим рендер в обработчик 404 ошибки</p><br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">app/Support/NotFoundHandler.php (DIFF)</b>
                        <div class="spoiler_text"><pre><code class="diff">--- a/app/Support/NotFoundHandler.php
+++ b/app/Support/NotFoundHandler.php
@@ -8,15 +8,22 @@ use Psr\Http\Message\ResponseInterface;
 use Psr\Http\Message\ServerRequestInterface;
 use Slim\Interfaces\ErrorHandlerInterface;
 use Throwable;
+use Twig\Environment;
+use Twig\Error\LoaderError;
+use Twig\Error\RuntimeError;
+use Twig\Error\SyntaxError;

 class NotFoundHandler implements ErrorHandlerInterface
 {

     private $factory;

-    public function __construct(ResponseFactoryInterface $factory)
+    private $render;
+
+    public function __construct(ResponseFactoryInterface $factory, Environment $render)
     {
         $this->factory = $factory;
+        $this->render = $render;
     }

     /**
@@ -26,10 +33,14 @@ class NotFoundHandler implements ErrorHandlerInterface
      * @param bool $logErrors
      * @param bool $logErrorDetails
      * @return ResponseInterface
+     * @throws LoaderError
+     * @throws RuntimeError
+     * @throws SyntaxError
      */
     public function __invoke(ServerRequestInterface $request, Throwable $exception, bool $displayErrorDetails, bool $logErrors, bool $logErrorDetails): ResponseInterface
     {
         $response = $this->factory->createResponse(404);
+        $response->getBody()->write($this->render->render('err404.twig'));
         return $response;
     }
 }</code></pre></div>
                    </div><br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">app/Provider/AppProvider.php (DIFF)</b>
                        <div class="spoiler_text"><pre><code class="diff">--- a/app/Provider/AppProvider.php
+++ b/app/Provider/AppProvider.php
@@ -19,6 +19,7 @@ use Slim\Middleware\RoutingMiddleware;
 use Slim\Psr7\Factory\ResponseFactory;
 use Slim\Routing\RouteCollector;
 use Slim\Routing\RouteResolver;
+use Twig\Environment;
 use UltraLite\Container\Container;

 class AppProvider implements ServiceProviderInterface
@@ -99,7 +100,7 @@ class AppProvider implements ServiceProviderInterface
          * Регистрируем обработчика ошибки 404
          */
         $container->set(NotFoundHandler::class, function (ContainerInterface $container) {
-            return new NotFoundHandler($container->get(ResponseFactoryInterface::class));
+            return new NotFoundHandler($container->get(ResponseFactoryInterface::class), $container->get(Environment::class));
         });

         /*</code></pre></div>
                    </div><br/>
<p>Теперь наша 404 ошибка приобрела тело.</p><br/>
<h3 id="shag-3-kontrollery">Шаг 3. Контроллеры</h3><br/>
<p>Теперь можно браться за контроллеры<br/>
У нас их будет 2:</p><br/>
<ul>
<li><code>app/Controller/HomeController.php</code> — главная страница</li>
<li><code>app/Controller/HelloController.php</code> — страница приветствия</li>
</ul><br/>
<p>Контроллеру главной страницы из зависимостей необходим роутер (для построения URL редиректа), а контроллеру страницы приветствия — рендер (для рендегинга html)</p><br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">app/Controller/HomeController.php</b>
                        <div class="spoiler_text"><pre><code class="php">&lt;?php
// app/Controller/HomeController.php

namespace App\Controller;

use Psr\Http\Message\ResponseInterface;
use Psr\Http\Message\ServerRequestInterface;
use Slim\Interfaces\RouteParserInterface;

class HomeController
{

    /**
     * @var RouteParserInterface
     */
    private $router;

    public function __construct(RouteParserInterface $router)
    {
        $this->router = $router;
    }

    public function index(ServerRequestInterface $request, ResponseInterface $response)
    {
        $uri = $this->router->fullUrlFor($request->getUri(), 'hello', ['name' => 'world']);
        return $response
            ->withStatus(301)
            ->withHeader('location', $uri);
    }
}</code></pre></div>
                    </div><br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">app/Controller/HelloController.php</b>
                        <div class="spoiler_text"><pre><code class="php">&lt;?php
// app/Controller/HelloController.php

namespace App\Controller;

use Psr\Http\Message\ResponseInterface;
use Psr\Http\Message\ServerRequestInterface;
use Twig\Environment as Render;
use Twig\Error\LoaderError;
use Twig\Error\RuntimeError;
use Twig\Error\SyntaxError;

class HelloController
{

    /**
     * @var Render
     */
    private $render;

    public function __construct(Render $render)
    {
        $this->render = $render;
    }

    /**
     * @param ServerRequestInterface $request
     * @param ResponseInterface $response
     * @return ResponseInterface
     * @throws LoaderError
     * @throws RuntimeError
     * @throws SyntaxError
     */
    public function show(ServerRequestInterface $request, ResponseInterface $response)
    {
        $response->getBody()->write($this->render->render('hello.twig', ['name' => $request->getAttribute('name')]));
        return $response;
    }
}</code></pre></div>
                    </div><br/>
<p>Добавим провайдер, регистрирующий контроллеры</p><br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">app/Provider/WebProvider.php</b>
                        <div class="spoiler_text"><pre><code class="php">&lt;?php
// app/Provider/WebProvider.php

namespace App\Provider;

use App\Controller\HelloController;
use App\Controller\HomeController;
use App\Support\ServiceProviderInterface;
use Psr\Container\ContainerInterface;
use Slim\Interfaces\RouteCollectorInterface;
use Slim\Interfaces\RouteCollectorProxyInterface;
use Twig\Environment;
use UltraLite\Container\Container;

class WebProvider implements ServiceProviderInterface
{
    public function register(Container $container)
    {
        /*
         * Зарегистрируем контроллеры
         */
        $container->set(HomeController::class, function (ContainerInterface $container) {
            return new HomeController($container->get(RouteCollectorInterface::class)->getRouteParser());
        });

        $container->set(HelloController::class, function (ContainerInterface $container) {
            return new HelloController($container->get(Environment::class));
        });

        /*
         * Зарегистрируем маршруты
         */
        $router = $container->get(RouteCollectorInterface::class);
        $router->group('/', function(RouteCollectorProxyInterface $router) {
            $router->get('', HomeController::class . ':index')->setName('index');
            $router->get('hello/{name}', HelloController::class . ':show')->setName('hello');
        });
    }
}</code></pre></div>
                    </div><br/>
<p>Не забудем добавить провайдер в бутстрап</p><br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">bootstrap.php</b>
                        <div class="spoiler_text"><pre><code class="php">&lt;?php
// bootstrap.php
// ...
use App\Provider\WebProvider;
// ...
$providers = [
// ...
    WebProvider::class,
// ...
];
// ...</code></pre></div>
                    </div><br/>
<p>Мы можем запустить веб-сервер (если останавливали)...</p><br/>
<pre><code class="plaintext">php -S localhost:8080 -t public public/index.php</code></pre><br/>
<p>… открыть в браузере <a href="http://localhost:8080" rel="nofollow">http://localhost:8080</a> и увидеть, что браузер нас перенаправил на <a href="http://localhost:8080/hello/world" rel="nofollow">http://localhost:8080/hello/world</a></p><br/>
<p>Мы видим теперь приветствие world'а.<br/>
Мы можем открыть <a href="http://localhost:8080/hello/ivan" rel="nofollow">http://localhost:8080/hello/ivan</a> и бразуер поприветствует ivan'а.</p><br/>
<p>Несуществующая страница, например, <a href="http://localhost:8080/helo/world" rel="nofollow">http://localhost:8080/helo/world</a> отображает наш кастомный текст и отдаёт 404 статус.</p><br/>
<h3 id="shag-4-konsolnaya-komanda">Шаг 4. Консольная команда</h3><br/>
<p>Напишем команду <code>route:list</code></p><br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">app/Command/RouteListCommand.php</b>
                        <div class="spoiler_text"><pre><code class="php">&lt;?php
// app/Command/RouteListCommand.php

namespace App\Command;

use Slim\Interfaces\RouteCollectorInterface;
use Symfony\Component\Console\Command\Command;
use Symfony\Component\Console\Input\InputInterface;
use Symfony\Component\Console\Output\OutputInterface;
use Symfony\Component\Console\Style\SymfonyStyle;

class RouteListCommand extends Command
{

    /*
     * Имя вынесено в константу, чтобы было меньше ошибок при маппинге команд
     */
    const NAME = 'route:list';

    /**
     * @var RouteCollectorInterface
     */
    private $router;

    public function __construct(RouteCollectorInterface $router)
    {
        $this->router = $router;
        parent::__construct();
    }

    protected function configure()
    {
        $this->setName(self::NAME)
            ->setDescription('List of routes.')
            ->setHelp('List of routes.')
        ;
    }

    protected function execute(InputInterface $input, OutputInterface $output)
    {
        $io = new SymfonyStyle($input, $output);
        $io->title('Routes');
        $rows = [];
        $routes = $this->router->getRoutes();
        if (!$routes) {
            $io->text('Routes list is empty');
            return 0;
        }
        foreach ($routes as $route) {
            $rows[] = [
                'path' => $route->getPattern(),
                'methods' => implode(', ', $route->getMethods()),
                'name' => $route->getName(),
                'handler' => $route->getCallable(),
            ];
        }
        $io->table(
            ['Route', 'Methods', 'Name', 'Handler'],
            $rows
        );
        return 0;
    }
}</code></pre></div>
                    </div><br/>
<p>Теперь нужен провайдер, который зарегистрирует команду в контейнере и добавит её в маппинг</p><br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">app/Provider/CommandProvider.php</b>
                        <div class="spoiler_text"><pre><code class="php">&lt;?php
// app/Provider/CommandProvider.php

namespace App\Provider;

use App\Command\RouteListCommand;
use App\Support\CommandMap;
use App\Support\ServiceProviderInterface;
use Psr\Container\ContainerInterface;
use Slim\Interfaces\RouteCollectorInterface;
use UltraLite\Container\Container;

class CommandProvider implements ServiceProviderInterface
{
    public function register(Container $container)
    {
        /*
         * Добавим команду списка маршрутов в контейнер
         */
        $container->set(RouteListCommand::class, function (ContainerInterface $container) {
            return new RouteListCommand($container->get(RouteCollectorInterface::class));
        });

        /*
         * Добавим команду списка маршрутов в маппинг команд
         */
        $container->get(CommandMap::class)->set(RouteListCommand::NAME, RouteListCommand::class);
    }
}</code></pre></div>
                    </div><br/>
<p>Помним про бутстрап</p><br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">bootstrap.php</b>
                        <div class="spoiler_text"><pre><code class="php">&lt;?php
// bootstrap.php
// ...
use App\Provider\CommandProvider;
// ...
$providers = [
// ...
    CommandProvider::class,
// ...
];
// ...</code></pre></div>
                    </div><br/>
<p>Теперь мы можем ввести команду...</p><br/>
<pre><code class="plaintext">./bin/console route:list</code></pre><br/>
<p>… и увидеть список роутов:</p><br/>
<pre><code class="plaintext">Routes
======

 --------------- --------- ------- ------------------------------------- 
  Route           Methods   Name    Handler                              
 --------------- --------- ------- ------------------------------------- 
  /               GET       index   App\Controller\HomeController:index  
  /hello/{name}   GET       hello   App\Controller\HelloController:show  
 --------------- --------- ------- ------------------------------------- </code></pre><br/>
<p>Вот, собственно, и всё!</p><br/>
<p>Как видно из туториала, Slim — это не обязательно вся логика приложения в файле <code>routes.php</code> (как во многочисленных примерах), на нём можно писать качественные и поддерживаемые приложения. Главное — не испугаться в начале пути, когда контейнер пуст, а зависимотсти нужны.</p><br/>
<p><a href="https://github.com/ddrv-habrapost/slim-4-intro" rel="nofollow">Ссылка на исходники проекта из статьи</a></p></div></div> <!----> <!----></div> <div class="tm-article-presenter__meta"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bslim%20framework%5D" class="tm-tags-list__link">slim framework</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bsymfony%20console%5D" class="tm-tags-list__link">symfony console</a></li></ul></div> <div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/hub/webdev/" class="tm-hubs-list__link">
    Разработка веб-сайтов
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/php/" class="tm-hubs-list__link">
    PHP
  </a></li></ul></div></div></article></div> <!----></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 29: ↑28 и ↓1</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-rating"></use></svg> <span title="Всего голосов 29: ↑28 и ↓1" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_medium">+27</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">23K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    79
  </span></button> <!----> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> </div></div> <!----> <!----> <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/trawl/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><img alt="" src="//habrastorage.org/getpro/habr/avatars/f8f/e1c/5a9/f8fe1c5a98aa8e6b20eb12846a23ec71.png" class="tm-entity-image__pic"></div></a> <div class="tm-user-card__meta"><div title=" 37 голосов " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    21.5
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">0</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title_variant-article"><span class="tm-user-card__name tm-user-card__name_variant-article">Ivan Dudarev</span> <a href="/ru/users/trawl/" class="tm-user-card__nickname tm-user-card__nickname_variant-article">
          @trawl
        </a> <!----></div> <p class="tm-user-card__short-info tm-user-card__short-info_variant-article">Дилетант</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-article"><!----> <!----> <button type="submit" class="tm-user-card__button btn btn_transparent btn_small">
      Задонатить
    </button> <!----> <!----></div></div> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----></section> <div class="tm-article-blocks__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/post/452834/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 29 
    </span></a> <!----></div></div></div> <div class="tm-ad-banner__container tm-page-article__banner"><!----> <div id="articleBottomBanner" class="tm-ad-banner"></div></div> <!----> <!----> <!----> <!----> </div></div></div></div></div> <div class="tm-page__sidebar"><div class="tm-layout-sidebar"><div class="tm-layout-sidebar__ads tm-layout-sidebar__ads_initial"><div class="tm-ad-banner__container tm-layout-sidebar__banner"><!----> <div id="sidebarBanner" class="tm-ad-banner"></div></div></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----> <section data-async-called="true" class="tm-block tm-block_spacing-bottom"><header class="tm-block__header"><h2 class="tm-block__title">Работа</h2> <!----></header> <div class="tm-block__body"><div class="tm-vacancies-block__item"><a href="https://career.habr.com/vacancies/programmist_laravel" target="_blank" class="tm-vacancies-block__vacancy-title">
        Разработчик Laravel
      </a> <div class="tm-vacancies-block__vacancies-count">
        105
    вакансий
      </div></div><div class="tm-vacancies-block__item"><a href="https://career.habr.com/vacancies/php_programmist" target="_blank" class="tm-vacancies-block__vacancy-title">
        PHP программист
      </a> <div class="tm-vacancies-block__vacancies-count">
        287
    вакансий
      </div></div></div> <footer class="tm-block__footer"><a href="https://career.habr.com/vacancies" class="tm-block-extralink">
      Все вакансии
    </a></footer></section></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/post/452834/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/post/452834/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"452834":{"id":"452834","timePublished":"2019-05-28T16:55:09+00:00","isCorporative":false,"lang":"ru","titleHtml":"Микрофреймворк slim","leadData":{"textHtml":"\u003Cp\u003E25 апреля 2019 года свет увидела новая мажорная \u003Ccode\u003Ealpha\u003C\u002Fcode\u003E-версия микрофреймворка \u003Ca href=\"https:\u002F\u002Fwww.slimframework.com\" rel=\"nofollow\"\u003ESlim\u003C\u002Fa\u003E, а 18 мая она выросла до \u003Ccode\u003Ebeta\u003C\u002Fcode\u003E. Предлагаю по этому поводу ознакомиться с новой версией.\u003C\u002Fp\u003E\u003Cbr\u003E\r\n\u003Cp\u003EПод катом:\u003C\u002Fp\u003E\u003Cbr\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EО новшествах фреймворка\u003C\u002Fli\u003E\r\n\u003Cli\u003EНаписание простого приложения на Slim-4\u003C\u002Fli\u003E\r\n\u003Cli\u003EО дружбе Slim и \u003Ca href=\"https:\u002F\u002Fwww.jetbrains.com\u002Fphpstorm\u002F\" rel=\"nofollow\"\u003EPhpStorm\u003C\u002Fa\u003E\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"editorVersion":"1.0","postType":"article","postLabels":[{"type":"tutorial","data":null}],"author":{"scoreStats":{"score":21.5,"votesCount":37},"rating":0,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":"41001737039880","paymentPayPalMe":"ddrv","paymentWebmoney":"220081749682"},"id":"136506","alias":"trawl","fullname":"Ivan Dudarev","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Ff8f\u002Fe1c\u002F5a9\u002Ff8fe1c5a98aa8e6b20eb12846a23ec71.png","speciality":"Дилетант"},"statistics":{"commentsCount":29,"favoritesCount":79,"readingCount":22955,"score":27,"votesCount":29},"hubs":[{"relatedData":null,"id":"91","alias":"webdev","type":"collective","title":"Разработка веб-сайтов","titleHtml":"Разработка веб-сайтов","isProfiled":true},{"relatedData":null,"id":"260","alias":"php","type":"collective","title":"PHP","titleHtml":"PHP","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003E25 апреля 2019 года свет увидела новая мажорная \u003Ccode\u003Ealpha\u003C\u002Fcode\u003E-версия микрофреймворка \u003Ca href=\"https:\u002F\u002Fwww.slimframework.com\" rel=\"nofollow\"\u003ESlim\u003C\u002Fa\u003E, а 18 мая она выросла до \u003Ccode\u003Ebeta\u003C\u002Fcode\u003E. Предлагаю по этому поводу ознакомиться с новой версией.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПод катом:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EО новшествах фреймворка\u003C\u002Fli\u003E\r\n\u003Cli\u003EНаписание простого приложения на Slim-4\u003C\u002Fli\u003E\r\n\u003Cli\u003EО дружбе Slim и \u003Ca href=\"https:\u002F\u002Fwww.jetbrains.com\u002Fphpstorm\u002F\" rel=\"nofollow\"\u003EPhpStorm\u003C\u002Fa\u003E\u003Ca name=\"habracut\"\u003E\u003C\u002Fa\u003E\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2 id=\"novoe-v-slim-4\"\u003EНовое в Slim 4\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EОсновные нововведения по сравнению с версией 3:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EМинимальная версия PHP — 7.1;\u003C\u002Fli\u003E\r\n\u003Cli\u003EПоддержка PSR-15 (Middleware);\u003C\u002Fli\u003E\r\n\u003Cli\u003EУдалена реализация http-сообщений. Устанавливаем любую PSR-7 совместимую библиотеку и пользуемся;\u003C\u002Fli\u003E\r\n\u003Cli\u003EУдалена зависимость \u003Ca href=\"https:\u002F\u002Fpackagist.org\u002Fpackages\u002Fpimple\u002Fpimple\" rel=\"nofollow\"\u003EPimple\u003C\u002Fa\u003E. Устанавливаем свой любимый PSR-11 совместимый контейнер и пользуемся;\u003C\u002Fli\u003E\r\n\u003Cli\u003EВозможность использования своего роутера (Раньше не было возможности отказаться от \u003Ca href=\"https:\u002F\u002Fpackagist.org\u002Fpackages\u002Fnikic\u002Ffast-route\" rel=\"nofollow\"\u003EFastRoute\u003C\u002Fa\u003E);\u003C\u002Fli\u003E\r\n\u003Cli\u003EИзменена реализация обработки ошибок;\u003C\u002Fli\u003E\r\n\u003Cli\u003EИзменена реализация вывода ответа;\u003C\u002Fli\u003E\r\n\u003Cli\u003EДобавлена фабрика для создания экземпляра приложения;\u003C\u002Fli\u003E\r\n\u003Cli\u003EУдалены настройки;\u003C\u002Fli\u003E\r\n\u003Cli\u003ESlim больше не устанавливает \u003Ccode\u003Edefault_mimetype\u003C\u002Fcode\u003E в пустую строку, поэтому нужно установить его самостоятельно в \u003Ccode\u003Ephp.ini\u003C\u002Fcode\u003E или в вашем приложении, используя \u003Ccode\u003Eini_set('default_mimetype', '')\u003C\u002Fcode\u003E;\u003C\u002Fli\u003E\r\n\u003Cli\u003EОбработчик запроса приложения теперь принимает только объект запроса (в старой версии принимал объекты запроса и ответа).\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Ch3 id=\"kak-teper-sozdat-prilozhenie\"\u003EКак теперь создать приложение?\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВ третьей версии создание приложения выглядело примерно так:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"php\"\u003E&lt;?php\n\nuse Psr\\Http\\Message\\ServerRequestInterface;\nuse Psr\\Http\\Message\\ResponseInterface;\nuse Slim\\App;\n\nrequire 'vendor\u002Fautoload.php';\n\n$settings = [\n    'addContentLengthHeader' =\u003E false,\n];\n\n$app = new App(['settings' =\u003E $settings]);\n$app-\u003Eget('\u002Fhello\u002F{name}', function (ServerRequestInterface $request, ResponseInterface $response, array $args) {\n    $name = $args['name'];\n    $response-\u003EgetBody()-\u003Ewrite(\"Hello, $name\");\n\n    return $response;\n});\n$app-\u003Erun();\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EТеперь конструктор приложения принимает следующие параметры:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"scrollable-table\"\u003E\u003Ctable\u003E\r\n\u003Cthead\u003E\r\n\u003Ctr\u003E\r\n\u003Cth\u003EПараметр\u003C\u002Fth\u003E\r\n\u003Cth\u003EТип\u003C\u002Fth\u003E\r\n\u003Cth\u003EОбязательный\u003C\u002Fth\u003E\r\n\u003Cth\u003EОписание\u003C\u002Fth\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003C\u002Fthead\u003E\r\n\u003Ctbody\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003E$responseFactory\u003C\u002Ftd\u003E\r\n\u003Ctd\u003E\u003Ccode\u003EPsr\\Http\\Message\\ResponseFactoryInterface\u003C\u002Fcode\u003E\u003C\u002Ftd\u003E\r\n\u003Ctd\u003Eда\u003C\u002Ftd\u003E\r\n\u003Ctd\u003EPSR-17 совместимая фабрика серверного http-запроса\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003E$container\u003C\u002Ftd\u003E\r\n\u003Ctd\u003E\u003Ccode\u003E\\Psr\\Container\\ContainerInterface\u003C\u002Fcode\u003E\u003C\u002Ftd\u003E\r\n\u003Ctd\u003Eнет\u003C\u002Ftd\u003E\r\n\u003Ctd\u003EКонтейнер зависимостей\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003E$callableResolver\u003C\u002Ftd\u003E\r\n\u003Ctd\u003E\u003Ccode\u003E\\Slim\\Interfaces\\CallableResolverInterface\u003C\u002Fcode\u003E\u003C\u002Ftd\u003E\r\n\u003Ctd\u003Eнет\u003C\u002Ftd\u003E\r\n\u003Ctd\u003EОбработчик вызываемых методов\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003E$routeCollector\u003C\u002Ftd\u003E\r\n\u003Ctd\u003E\u003Ccode\u003E\\Slim\\Interfaces\\RouteCollectorInterface\u003C\u002Fcode\u003E\u003C\u002Ftd\u003E\r\n\u003Ctd\u003Eнет\u003C\u002Ftd\u003E\r\n\u003Ctd\u003EРоутер\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003E$routeResolver\u003C\u002Ftd\u003E\r\n\u003Ctd\u003E\u003Ccode\u003E\\Slim\\Interfaces\\RouteResolverInterface\u003C\u002Fcode\u003E\u003C\u002Ftd\u003E\r\n\u003Ctd\u003Eнет\u003C\u002Ftd\u003E\r\n\u003Ctd\u003EОбработчик результатов роутинга\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003C\u002Ftbody\u003E\r\n\u003C\u002Ftable\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EТак же теперь можно воспользоваться статическим методом \u003Ccode\u003Ecreate\u003C\u002Fcode\u003E фабрики приложения \u003Ccode\u003E\\Slim\\Factory\\AppFactory\u003C\u002Fcode\u003E.\u003Cbr\u002F\u003E\r\nЭтот метод принимает на вход такие же параметры, только все они опциональные.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"php\"\u003E&lt;?php\n\nuse Psr\\Http\\Message\\ServerRequestInterface;\nuse Psr\\Http\\Message\\ResponseInterface;\nuse Slim\\Factory\\AppFactory;\n\nrequire 'vendor\u002Fautoload.php';\n\n$app = AppFactory::create();\n$app-\u003Eget('\u002Fhello\u002F{name}', function (ServerRequestInterface $request, ResponseInterface $response) {\n    $name = $request-\u003EgetAttribute('name');\n    $response-\u003EgetBody()-\u003Ewrite(\"Hello, $name\");\n    return $response;\n});\n$app-\u003Erun();\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Ch3 id=\"vernite-mne-404-oshibku\"\u003EВерните мне 404 ошибку!\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли мы попробуем открыть несуществующую страницу, получим код ответа \u003Ccode\u003E500\u003C\u002Fcode\u003E, а не \u003Ccode\u003E404\u003C\u002Fcode\u003E. Чтобы ошибки обрабатывались корректно, нужно подключить \u003Ccode\u003E\\Slim\\Middleware\\ErrorMiddleware\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"php\"\u003E&lt;?php\n\nuse Psr\\Http\\Message\\ServerRequestInterface;\nuse Psr\\Http\\Message\\ResponseInterface;\nuse Slim\\Factory\\AppFactory;\nuse Slim\\Middleware\\ErrorMiddleware;\n\nrequire 'vendor\u002Fautoload.php';\n\n$app = AppFactory::create();\n$middleware = new ErrorMiddleware(\n    $app-\u003EgetCallableResolver(),\n    $app-\u003EgetResponseFactory(),\n    false,\n    false,\n    false\n);\n$app-\u003Eadd($middleware);\n$app-\u003Eget('\u002Fhello\u002F{name}', function (ServerRequestInterface $request, ResponseInterface $response) {\n    $name = $request-\u003EgetAttribute('name');\n    $response-\u003EgetBody()-\u003Ewrite(\"Hello, $name\");\n    return $response;\n});\n$app-\u003Erun();\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Ch3 id=\"middleware\"\u003EMiddleware\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПромежуточное ПО теперь должно быть реализацией PSR-15. В качестве исключения, можно передавать функции, но сигнатура должна соответствовать методу \u003Ccode\u003Eprocess()\u003C\u002Fcode\u003E интерфейса \u003Ccode\u003E\\Psr\\Http\\Server\\MiddlewareInterface\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"php\"\u003E&lt;?php\n\nuse Psr\\Http\\Message\\ServerRequestInterface;\nuse Psr\\Http\\Message\\ResponseInterface;\nuse Psr\\Http\\Server\\RequestHandlerInterface;\nuse Slim\\Factory\\AppFactory;\n\nrequire 'vendor\u002Fautoload.php';\n\n$app = AppFactory::create();\n$app-\u003Eadd(function (ServerRequestInterface $request, RequestHandlerInterface $handler): ResponseInterface {\n    $response = $handler-\u003Ehandle($request);\n    return $response-\u003EwithHeader('Content-Type', 'application\u002Fjson');\n});\n\u002F\u002F ... Описание роутов и прочее\n$app-\u003Erun();\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EСигнатура \u003Ccode\u003E($request, $response, $next)\u003C\u002Fcode\u003E больше не поддерживается\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Ch3 id=\"kak-zhit-bez-nastroek\"\u003EКак жить без настроек?\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EБез настроек жить можно. Предоставленные инструменты нам в этом помогут.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cstrong\u003E\u003Ccode\u003EhttpVersion\u003C\u002Fcode\u003E\u003C\u002Fstrong\u003E и \u003Cstrong\u003E\u003Ccode\u003EresponseChunkSize\u003C\u002Fcode\u003E\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНастройка \u003Ccode\u003EhttpVersion\u003C\u002Fcode\u003E отвечала за вывод версии протокола в ответе.\u003Cbr\u002F\u003E\r\nНастройка \u003Ccode\u003EresponseChunkSize\u003C\u002Fcode\u003E определяла размер каждого чанка, читаемого из тела ответа при отправке в браузер.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EСейчас эти функции можно возложить на эмиттер ответа.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПишем эмиттер\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"php\"\u003E&lt;?php\n\u002F\u002F \u002Fsrc\u002FResponseEmitter.php\n\nnamespace App;\n\nuse Psr\\Http\\Message\\ResponseInterface;\nuse Slim\\ResponseEmitter as SlimResponseEmitter;\n\nclass ResponseEmitter extends SlimResponseEmitter\n{\n    private $protocolVersion;\n\n    public function __construct(string $protocolVersion = '1.1', int $responseChunkSize = 4096)\n    {\n        $this-\u003EprotocolVersion = $protocolVersion;\n        parent::__construct($responseChunkSize);\n    }\n\n    public function emit(ResponseInterface $response) : void{\n        parent::emit($response-\u003EwithProtocolVersion($this-\u003EprotocolVersion));\n    }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПодключаем к приложению\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"php\"\u003E&lt;?php\n\nuse App\\ResponseEmitter;\nuse Slim\\Factory\\AppFactory;\n\nrequire 'vendor\u002Fautoload.php';\n\n$app = AppFactory::create();\n$serverRequestFactory = \\Slim\\Factory\\ServerRequestCreatorFactory::create();\n$request = $serverRequestFactory-\u003EcreateServerRequestFromGlobals();\n\u002F\u002F ... Описание роутов и прочее\n$response = $app-\u003Ehandle($request);\n$emitter = new ResponseEmitter('2.0', 4096);\n$emitter-\u003Eemit($response);\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cstrong\u003E\u003Ccode\u003EoutputBuffering\u003C\u002Fcode\u003E\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EДанная настройка позволяла включать\u002Fвыключать буфферизацию вывода. Значения настройки:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003E\u003Ccode\u003Efalse\u003C\u002Fcode\u003E — буфферизация выключена (все вызовы операторов \u003Ccode\u003Eecho\u003C\u002Fcode\u003E, \u003Ccode\u003Eprint\u003C\u002Fcode\u003E игнорируются).\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ccode\u003E'append'\u003C\u002Fcode\u003E — все вызовы операторов \u003Ccode\u003Eecho\u003C\u002Fcode\u003E, \u003Ccode\u003Eprint\u003C\u002Fcode\u003E добавляются после тела ответа\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ccode\u003E'prepend'\u003C\u002Fcode\u003E — все вызовы операторов \u003Ccode\u003Eecho\u003C\u002Fcode\u003E, \u003Ccode\u003Eprint\u003C\u002Fcode\u003E добавляются перед телом ответа\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EРазработчики фреймворка предлагают заменить эту опцию промежуточным ПО \u003Ccode\u003E\\Slim\\Middleware\\OutputBufferingMiddleware\u003C\u002Fcode\u003E, в конструктор которого передается PSR-17 совместимая фабрика потока и режим, который может быть равен \u003Ccode\u003Eappend\u003C\u002Fcode\u003E или \u003Ccode\u003Eprepend\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"php\"\u003E&lt;?php\n\nuse Slim\\Factory\\AppFactory;\nuse Slim\\Factory\\Psr17\\SlimPsr17Factory;\nuse Slim\\Middleware\\OutputBufferingMiddleware;\n\nrequire 'vendor\u002Fautoload.php';\n\n$app = AppFactory::create();\n\n$middleware = new OutputBufferingMiddleware(SlimPsr17Factory::getStreamFactory(), OutputBufferingMiddleware::APPEND);\n$app-\u003Eadd($middleware);\n\u002F\u002F ... Описание роутов и прочее\n$app-\u003Erun();\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cstrong\u003E\u003Ccode\u003EdetermineRouteBeforeAppMiddleware\u003C\u002Fcode\u003E\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЭта настройка позволяла получить текущий маршрут из объекта запроса в промежуточном ПО\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНа замену предоставляется \u003Ccode\u003E\\Slim\\Middleware\\RoutingMiddleware\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"php\"\u003E&lt;?php\nuse Slim\\Factory\\AppFactory;\nuse Slim\\Middleware\\RoutingMiddleware;\n\nrequire 'vendor\u002Fautoload.php';\n\n$app = AppFactory::create();\n\n$middleware = new RoutingMiddleware($app-\u003EgetRouteResolver());\n$app-\u003Eadd($middleware);\n\u002F\u002F ... Описание роутов и прочее\n$app-\u003Erun();\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cstrong\u003E\u003Ccode\u003EdisplayErrorDetails\u003C\u002Fcode\u003E\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНастройка позволяла выводить подробности ошибок. При отладке это неплохо упрощает жизнь.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПомните \u003Ccode\u003E\\Slim\\Middleware\\ErrorMiddleware\u003C\u002Fcode\u003E? Оно и здесь нас выручит!\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"php\"\u003E&lt;?php\n\nuse Slim\\Factory\\AppFactory;\nuse Slim\\Middleware\\ErrorMiddleware;\n\nrequire 'vendor\u002Fautoload.php';\n\n$app = AppFactory::create();\n$middleware = new ErrorMiddleware(\n    $app-\u003EgetCallableResolver(),\n    $app-\u003EgetResponseFactory(),\n    true, \u002F\u002F Этот параметр отвечает за подробный вывод ошибок\n    false, \u002F\u002F Логирование ошибок\n    false \u002F\u002F Логирование подробностей ошибок\n);\n$app-\u003Eadd($middleware);\n\u002F\u002F ... Описание роутов и прочее\n$app-\u003Erun();\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cstrong\u003E\u003Ccode\u003EaddContentLengthHeader\u003C\u002Fcode\u003E\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EДанная настройка позволяла включать\u002Fотключать автодобавление заголовка \u003Ccode\u003EContent-Length\u003C\u002Fcode\u003E со значением объема данных в теле ответа\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЗаменяет опцию промежуточное ПО \u003Ccode\u003E\\Slim\\Middleware\\ContentLengthMiddleware\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"php\"\u003E&lt;?php\n\nuse Slim\\Factory\\AppFactory;\nuse Slim\\Middleware\\ContentLengthMiddleware;\n\nrequire 'vendor\u002Fautoload.php';\n\n$app = AppFactory::create();\n\n$middleware = new ContentLengthMiddleware();\n$app-\u003Eadd($middleware);\n\u002F\u002F ... Описание роутов и прочее\n$app-\u003Erun();\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cstrong\u003E\u003Ccode\u003ErouterCacheFile\u003C\u002Fcode\u003E\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EТеперь вы можете напрямую установить файл кеша роутера\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"php\"\u003E&lt;?php\n\nuse Slim\\Factory\\AppFactory;\n\nrequire 'vendor\u002Fautoload.php';\n\n$app = AppFactory::create();\n$app-\u003EgetRouteCollector()-\u003EsetCacheFile('\u002Fpath\u002Fto\u002Fcache\u002Frouter.php');\n\u002F\u002F ... Описание роутов и прочее\n$app-\u003Erun();\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2 id=\"sozdanie-prilozheniya-na-slim-4\"\u003EСоздание приложения на Slim-4\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЧтобы более подробно рассмотреть фреймворк, напишем небольшое приложение.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПриложение будет иметь следующие роуты:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003E\u003Ccode\u003E\u002Fhello\u002F{name}\u003C\u002Fcode\u003E — страница приветствия;\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ccode\u003E\u002F\u003C\u002Fcode\u003E — редирект на страницу \u003Ccode\u003E\u002Fhello\u002Fworld\u003C\u002Fcode\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003EОстальные роуты будут возвращать кастомизированную страницу с 404 ошибкой.\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЛогика будет в контроллерах, рендерить страницу будем через шаблонизатор \u003Ca href=\"https:\u002F\u002Fpackagist.org\u002Fpackages\u002Ftwig\u002Ftwig\" rel=\"nofollow\"\u003ETwig\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\nБонусом добавим консольное приложение на базе компонента Symfony \u003Ca href=\"https:\u002F\u002Fpackagist.org\u002Fpackages\u002Fsymfony\u002Fconsole\" rel=\"nofollow\"\u003EConsole\u003C\u002Fa\u003E с командой, отображающей список роутов\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Ch3 id=\"shag-0-ustanovka-zavisimostey\"\u003EШаг 0. Установка зависимостей\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНам понадобится:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003Eмикрофреймворк, \u003Ca href=\"https:\u002F\u002Fpackagist.org\u002Fpackages\u002Fslim\u002Fslim\" rel=\"nofollow\"\u003Eslim\u002Fslim\u003C\u002Fa\u003E;\u003C\u002Fli\u003E\r\n\u003Cli\u003Eреализация интерфейса контейнера (PSR-11) \u003Ca href=\"https:\u002F\u002Fpackagist.org\u002Fpackages\u002Fpsr\u002Fcontainer\" rel=\"nofollow\"\u003Epsr\u002Fcontainer\u003C\u002Fa\u003E;\u003C\u002Fli\u003E\r\n\u003Cli\u003Eреализация интерфейсов http-сообщений (PSR-7) \u003Ca href=\"https:\u002F\u002Fpackagist.org\u002Fpackages\u002Fpsr\u002Fhttp-message\" rel=\"nofollow\"\u003Epsr\u002Fhttp-message\u003C\u002Fa\u003E;\u003C\u002Fli\u003E\r\n\u003Cli\u003Eреализация интерфейсов фабрик http-сообщений (PSR-17) \u003Ca href=\"https:\u002F\u002Fpackagist.org\u002Fpackages\u002Fpsr\u002Fhttp-factory\" rel=\"nofollow\"\u003Epsr\u002Fhttp-factory\u003C\u002Fa\u003E;\u003C\u002Fli\u003E\r\n\u003Cli\u003Eшаблонизатор \u003Ca href=\"https:\u002F\u002Fpackagist.org\u002Fpackages\u002Ftwig\u002Ftwig\" rel=\"nofollow\"\u003Etwig\u002Ftwig\u003C\u002Fa\u003E;\u003C\u002Fli\u003E\r\n\u003Cli\u003Eконсольное приложение \u003Ca href=\"https:\u002F\u002Fpackagist.org\u002Fpackages\u002Fsymfony\u002Fconsole\" rel=\"nofollow\"\u003Esymfony\u002Fconsole\u003C\u002Fa\u003E.\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВ качестве контенера зависимостей я выбрал \u003Ca href=\"https:\u002F\u002Fpackagist.org\u002Fpackages\u002Fultra-lite\u002Fcontainer\" rel=\"nofollow\"\u003Eultra-lite\u002Fcontainer\u003C\u002Fa\u003E, как легкий, лаконичный и соответствующий стандарту.\u003Cbr\u002F\u003E\r\nPSR-7 и PSR-17 разработчики Slim предоставляют в одном пакете \u003Ca href=\"https:\u002F\u002Fpackagist.org\u002Fpackages\u002Fslim\u002Fpsr7\" rel=\"nofollow\"\u003Eslim\u002Fpsr7\u003C\u002Fa\u003E. Им и воспользуемся\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003EПредполагается, что пакетный менеджер \u003Ca href=\"https:\u002F\u002Fgetcomposer.org\u002F\" rel=\"nofollow\"\u003EComposer\u003C\u002Fa\u003E уже установлен.\u003C\u002Fblockquote\u003E\u003Cp\u003EСоздаём папку под проект (в качестве примера будет использоваться \u003Ccode\u003E\u002Fpath\u002Fto\u002Fproject\u003C\u002Fcode\u003E) и переходим в неё.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EДобавим в проект файл \u003Ccode\u003Ecomposer.json\u003C\u002Fcode\u003E со следующим содержимым:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"json\"\u003E{\n  \"require\": {\n    \"php\": \"\u003E=7.1\",\n    \"slim\u002Fslim\": \"4.0.0-beta\",\n    \"slim\u002Fpsr7\": \"~0.3\",\n    \"ultra-lite\u002Fcontainer\": \"^6.2\",\n    \"symfony\u002Fconsole\": \"^4.2\",\n    \"twig\u002Ftwig\": \"^2.10\"\n  },\n  \"autoload\": {\n    \"psr-4\": {\n      \"App\\\\\": \"app\"\n    }\n  }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003Eи выполним команду \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003Ecomposer install\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EТеперь у нас есть все необходимые пакеты и настроен автозагрузчик классов.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли работаем с \u003Ca href=\"https:\u002F\u002Fgit-scm.com\u002F\" rel=\"nofollow\"\u003Egit\u003C\u002Fa\u003E, добавим файл \u003Ccode\u003E.gitignore\u003C\u002Fcode\u003E и внесем туда директорию \u003Ccode\u003Evendor\u003C\u002Fcode\u003E (и диреткорию своей IDE при необходимости)\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003E\u002F.idea\u002F*\n\u002Fvendor\u002F*\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЯ использую IDE \u003Ca href=\"https:\u002F\u002Fwww.jetbrains.com\u002Fphpstorm\u002F\" rel=\"nofollow\"\u003EPhpStorm\u003C\u002Fa\u003E \u003Cdel\u003Eи горжусь этим\u003C\u002Fdel\u003E. Для комфортной разработки самое время подружить контейнер и IDE.\u003Cbr\u002F\u003E\r\nВ корне проекта создадим файл \u003Ccode\u003E.phpstorm.meta.php\u003C\u002Fcode\u003E и напишем там такой код:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"php\"\u003E&lt;?php\n\u002F\u002F .phpstorm.meta.php\n\nnamespace PHPSTORM_META {\n\n    override(\n        \\Psr\\Container\\ContainerInterface::get(0),\n        map([\n            '' =\u003E '@',\n        ])\n    );\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЭтот код подскажет IDE, что у объекта, реализующего интерфейс \u003Ccode\u003E\\Psr\\Container\\ContainerInterface\u003C\u002Fcode\u003E, метод \u003Ccode\u003Eget()\u003C\u002Fcode\u003E вернёт объект класса или реализацию интерфейса, имя которого передано в параметре.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Ch3 id=\"shag-1-karkas-prilozheniya\"\u003EШаг 1. Каркас приложения\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EДобавим каталоги:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003E\u003Ccode\u003Eapp\u003C\u002Fcode\u003E — код приложения. К нему мы подключим наше пространство имен для автозагрузчика классов;\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ccode\u003Ebin\u003C\u002Fcode\u003E — директория для консольной утилиты;\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ccode\u003Econfig\u003C\u002Fcode\u003E — здесь будут файлы конфигурации приложения;\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ccode\u003Epublic\u003C\u002Fcode\u003E — директория, открытая в веб (точка входа приложения, стили, js, картинки и т.д.);\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ccode\u003Etemplate\u003C\u002Fcode\u003E — директория шаблонов;\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ccode\u003Evar\u003C\u002Fcode\u003E — директория для различных файлов. Логи, кэш, локальное хранилище и т.д.\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ файлы:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003E\u003Ccode\u003Econfig\u002Fapp.ini\u003C\u002Fcode\u003E — основной конфиг приложения;\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ccode\u003Econfig\u002Fapp.local.ini\u003C\u002Fcode\u003E — конфиг для окружения \u003Ccode\u003Elocal\u003C\u002Fcode\u003E;\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ccode\u003Eapp\u002FSupport\u002FCommandMap.php\u003C\u002Fcode\u003E — маппинг команд консольного приложения для ленивой загрузки.\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ccode\u003Eapp\u002FSupport\u002FConfig.php\u003C\u002Fcode\u003E — Класс конфигурации (Чтобы IDE знала, какие конфиги у нас имеются).\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ccode\u003Eapp\u002FSupport\u002FNotFoundHandler.php\u003C\u002Fcode\u003E — Класс обработчика 404й ошибки.\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ccode\u003Eapp\u002FSupport\u002FServiceProviderInterface.php\u003C\u002Fcode\u003E — Интерфейс сервис-провайдера.\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ccode\u003Eapp\u002FProvider\u002FAppProvider.php\u003C\u002Fcode\u003E — Основной провайдер приложения.\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ccode\u003Ebootstrap.php\u003C\u002Fcode\u003E — сборка контейнера;\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ccode\u003Ebin\u002Fconsole\u003C\u002Fcode\u003E — точка входа консольного приложения;\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ccode\u003Epublic\u002Findex.php\u003C\u002Fcode\u003E — точка входа веб приложения.\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003Econfig\u002Fapp.ini\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003E; режим отладки\nslim.debug=Off\n\n; директория шаблонов\ntemplates.dir=template\n\n; кэш шаблонов\ntemplates.cache=var\u002Fcache\u002Ftemplate\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003Econfig\u002Fapp.local.ini\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003E; В этом файле мы только переопределим некоторые параметры. Остальные значения подставятся из основного конфига\n; В локальном окружении полезно видеть подробности ошибок\nslim.debug=On\n\n; кэш шаблонов для разработки не нужен\ntemplates.cache=\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EАх да, ещё неплохо исключить конфиги окружения из репозитория. Ведь там могут быть явки\u002Fпароли. Кэш тоже исключим.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003E.gitignore\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003E\u002F.idea\u002F*\n\u002Fconfig\u002F*\n\u002Fvendor\u002F*\n\u002Fvar\u002Fcache\u002F*\n!\u002Fconfig\u002Fapp.ini\n!\u002Fvar\u002Fcache\u002F.gitkeep\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003Eapp\u002FSupport\u002FCommandMap.php\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cpre\u003E\u003Ccode class=\"php\"\u003E&lt;?php\n\u002F\u002F app\u002FSupport\u002FCommandMap.php\n\nnamespace App\\Support;\n\nclass CommandMap\n{\n\n    \u002F**\n     * Маппинг команд. Имя команды =\u003E Ключ в контейнере\n     * @var string[]\n     *\u002F\n    private  $map = [];\n\n    public function set(string $name, string $value)\n    {\n        $this-\u003Emap[$name] = $value;\n    }\n\n    \u002F**\n     * @return string[]\n     *\u002F\n    public function getMap()\n    {\n        return $this-\u003Emap;\n    }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003Eapp\u002FSupport\u002FConfig.php\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cpre\u003E\u003Ccode class=\"php\"\u003E&lt;?php\n\u002F\u002F app\u002FSupport\u002FConfig.php\n\nnamespace App\\Support;\n\nclass Config\n{\n\n    \u002F**\n     * @var string[]\n     *\u002F\n    private $config = [];\n\n    public function __construct(string $dir, string $env, string $root)\n    {\n        if (!is_dir($dir)) return;\n\n        \u002F*\n         * Парсим основной конфиг\n         *\u002F\n        $config = (array)parse_ini_file($dir . DIRECTORY_SEPARATOR . 'app.ini', false);\n\n        \u002F*\n         * Переопределяем параметры из конфига окружения\n         *\u002F\n        $environmentConfigFile = $dir . DIRECTORY_SEPARATOR . 'app.' . $env . '.ini';\n        if (is_readable($environmentConfigFile)) {\n            $config = array_replace_recursive($config, (array)parse_ini_file($environmentConfigFile, false));\n        }\n\n        \u002F*\n         * Указываем, какие параметры конфига являются путями\n         *\u002F\n        $dirs = ['templates.dir', 'templates.cache'];\n\n        foreach ($config as $name=\u003E$value) {\n            $this-\u003Econfig[$name] = $value;\n        }\n\n        \u002F*\n         * Устанавливаем абсолютные пути в конфигурации\n         *\u002F\n        foreach ($dirs as $parameter) {\n            $value = $config[$parameter];\n            if (mb_strpos($value, '\u002F') === 0) {\n                continue;\n            }\n            if (empty($value)) {\n                $this-\u003Econfig[$parameter] = null;\n                continue;\n            }\n            $this-\u003Econfig[$parameter] = $root . DIRECTORY_SEPARATOR . $value;\n        }\n    }\n\n    public function get(string $name)\n    {\n        return array_key_exists($name, $this-\u003Econfig) ? $this-\u003Econfig[$name] : null;\n    }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003Eapp\u002FSupport\u002FNotFoundHandler.php\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cpre\u003E\u003Ccode class=\"php\"\u003E&lt;?php\n\u002F\u002F app\u002FSupport\u002FNotFoundHandler.php\n\nnamespace App\\Support;\n\nuse Psr\\Http\\Message\\ResponseFactoryInterface;\nuse Psr\\Http\\Message\\ResponseInterface;\nuse Psr\\Http\\Message\\ServerRequestInterface;\nuse Slim\\Interfaces\\ErrorHandlerInterface;\nuse Throwable;\n\nclass NotFoundHandler implements ErrorHandlerInterface\n{\n\n    private $factory;\n\n    public function __construct(ResponseFactoryInterface $factory)\n    {\n        $this-\u003Efactory = $factory;\n    }\n\n    \u002F**\n     * @param ServerRequestInterface $request\n     * @param Throwable $exception\n     * @param bool $displayErrorDetails\n     * @param bool $logErrors\n     * @param bool $logErrorDetails\n     * @return ResponseInterface\n     *\u002F\n    public function __invoke(ServerRequestInterface $request, Throwable $exception, bool $displayErrorDetails, bool $logErrors, bool $logErrorDetails): ResponseInterface\n    {\n        $response = $this-\u003Efactory-\u003EcreateResponse(404);\n        return $response;\n    }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EТеперь можно научить PhpStorm понимать, какие у конфига есть ключи и какого они типа\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003E.phpstorm.meta.php\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cpre\u003E\u003Ccode class=\"php\"\u003E&lt;?php\n\u002F\u002F .phpstorm.meta.php\n\nnamespace PHPSTORM_META {\n\n    override(\n        \\Psr\\Container\\ContainerInterface::get(0),\n        map([\n            '' =\u003E '@',\n        ])\n    );\n\n    override(\n        \\App\\Support\\Config::get(0),\n        map([\n            'slim.debug'      =\u003E 'bool',\n            'templates.dir'   =\u003E 'string|false',\n            'templates.cache' =\u003E 'string|false',\n        ])\n    );\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003Eapp\u002FSupport\u002FServiceProviderInterface.php\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cpre\u003E\u003Ccode class=\"php\"\u003E&lt;?php\n\u002F\u002F app\u002FSupport\u002FServiceProviderInterface.php\n\nnamespace App\\Support;\n\nuse UltraLite\\Container\\Container;\n\ninterface ServiceProviderInterface\n{\n\n    public function register(Container $container);\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003Eapp\u002FProvider\u002FAppProvider.php\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cpre\u003E\u003Ccode class=\"php\"\u003E&lt;?php\n\u002F\u002F app\u002FProvider\u002FAppProvider.php\n\nnamespace App\\Provider;\n\nuse App\\Support\\CommandMap;\nuse App\\Support\\Config;\nuse App\\Support\\NotFoundHandler;\nuse App\\Support\\ServiceProviderInterface;\nuse Psr\\Container\\ContainerInterface;\nuse Psr\\Http\\Message\\ResponseFactoryInterface;\nuse Slim\\CallableResolver;\nuse Slim\\Exception\\HttpNotFoundException;\nuse Slim\\Interfaces\\CallableResolverInterface;\nuse Slim\\Interfaces\\RouteCollectorInterface;\nuse Slim\\Interfaces\\RouteResolverInterface;\nuse Slim\\Middleware\\ErrorMiddleware;\nuse Slim\\Middleware\\RoutingMiddleware;\nuse Slim\\Psr7\\Factory\\ResponseFactory;\nuse Slim\\Routing\\RouteCollector;\nuse Slim\\Routing\\RouteResolver;\nuse UltraLite\\Container\\Container;\n\nclass AppProvider implements ServiceProviderInterface\n{\n\n    public function register(Container $container)\n    {\n\n        \u002F*\n         * Регистрируем маппинг консольных команд\n         *\u002F\n        $container-\u003Eset(CommandMap::class, function () {\n            return new CommandMap();\n        });\n\n        \u002F*\n         * Регистрируем фабрику http-запроса\n         *\u002F\n        $container-\u003Eset(ResponseFactory::class, function () {\n            return new ResponseFactory();\n        });\n\n        \u002F*\n         * Связываем интерфейс фабрики http-запроса с реализацией\n         *\u002F\n        $container-\u003Eset(ResponseFactoryInterface::class, function (ContainerInterface $container) {\n            return $container-\u003Eget(ResponseFactory::class);\n        });\n\n        \u002F*\n         * Регистрируем обработчик вызываемых методов\n         *\u002F\n        $container-\u003Eset(CallableResolver::class, function (ContainerInterface $container) {\n            return new CallableResolver($container);\n        });\n\n        \u002F*\n         * Связываем интерфейс обработчика вызываемых методов с реализацией\n         *\u002F\n        $container-\u003Eset(CallableResolverInterface::class, function (ContainerInterface $container) {\n            return $container-\u003Eget(CallableResolver::class);\n        });\n\n        \u002F*\n         * Регистрируем роутер\n         *\u002F\n        $container-\u003Eset(RouteCollector::class, function (ContainerInterface $container) {\n            $router = new RouteCollector(\n                $container-\u003Eget(ResponseFactoryInterface::class),\n                $container-\u003Eget(CallableResolverInterface::class),\n                $container\n            );\n            return $router;\n        });\n\n        \u002F*\n         * Связываем интерфес роутера с реализацией\n         *\u002F\n        $container-\u003Eset(RouteCollectorInterface::class, function (ContainerInterface $container) {\n            return $container-\u003Eget(RouteCollector::class);\n        });\n\n        \u002F*\n         * Регистрируем обработчик результатов роутера\n         *\u002F\n        $container-\u003Eset(RouteResolver::class, function (ContainerInterface $container) {\n            return new RouteResolver($container-\u003Eget(RouteCollectorInterface::class));\n        });\n\n        \u002F*\n         * Связываем интерфес обработчика результатов роутера с реализацией\n         *\u002F\n        $container-\u003Eset(RouteResolverInterface::class, function (ContainerInterface $container) {\n            return $container-\u003Eget(RouteResolver::class);\n        });\n\n        \u002F*\n         * Регистрируем обработчика ошибки 404\n         *\u002F\n        $container-\u003Eset(NotFoundHandler::class, function (ContainerInterface $container) {\n            return new NotFoundHandler($container-\u003Eget(ResponseFactoryInterface::class));\n        });\n\n        \u002F*\n         * Регистрируем middleware обработки ошибок\n         *\u002F\n        $container-\u003Eset(ErrorMiddleware::class, function (ContainerInterface $container) {\n            $middleware = new ErrorMiddleware(\n                $container-\u003Eget(CallableResolverInterface::class),\n                $container-\u003Eget(ResponseFactoryInterface::class),\n                $container-\u003Eget(Config::class)-\u003Eget('slim.debug'),\n                true,\n                true);\n            $middleware-\u003EsetErrorHandler(HttpNotFoundException::class, $container-\u003Eget(NotFoundHandler::class));\n            return $middleware;\n        });\n\n        \u002F*\n         * Регистрируем middleware роутера\n         *\u002F\n        $container-\u003Eset(RoutingMiddleware::class, function (ContainerInterface $container) {\n            return new RoutingMiddleware($container-\u003Eget(RouteResolverInterface::class));\n        });\n    }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EМы вынесли роутинг в контейнер для того, чтобы можно было с ним работать без инициализации объекта \u003Ccode\u003E\\Slim\\App\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003Ebootstrap.php\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cpre\u003E\u003Ccode class=\"php\"\u003E&lt;?php\n\u002F\u002F bootstrap.php\n\nrequire_once __DIR__ . DIRECTORY_SEPARATOR . 'vendor' . DIRECTORY_SEPARATOR . 'autoload.php';\n\nuse App\\Support\\ServiceProviderInterface;\nuse App\\Provider\\AppProvider;\nuse App\\Support\\Config;\nuse UltraLite\\Container\\Container;\n\n\u002F*\n * Определяем окружение\n *\u002F\n$env = getenv('APP_ENV');\nif (!$env) $env = 'local';\n\n\u002F*\n * Строим конфиг\n *\u002F\n$config = new Config(__DIR__ . DIRECTORY_SEPARATOR . 'config', $env, __DIR__);\n\n\u002F*\n * Определяем сервис-провайдеры\n *\u002F\n$providers = [\n    AppProvider::class,\n];\n\n\u002F*\n * Создаем экземпляр контейнера\n *\u002F\n$container = new Container([\n    Config::class =\u003E function () use ($config) { return $config;},\n]);\n\n\u002F*\n * Регистрируем сервисы\n *\u002F\nforeach ($providers as $className) {\n    if (!class_exists($className)) {\n        \u002F** @noinspection PhpUnhandledExceptionInspection *\u002F\n        throw new Exception('Provider ' . $className . ' not found');\n    }\n    $provider = new $className;\n    if (!$provider instanceof ServiceProviderInterface) {\n        \u002F** @noinspection PhpUnhandledExceptionInspection *\u002F\n        throw new Exception($className . ' has not provider');\n    }\n    $provider-\u003Eregister($container);\n}\n\n\u002F*\n * Возвращаем контейнер\n *\u002F\nreturn $container;\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003Ebin\u002Fconsole\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cpre\u003E\u003Ccode class=\"php\"\u003E#!\u002Fusr\u002Fbin\u002Fenv php\n&lt;?php\n\u002F\u002F bin\u002Fconsole\n\nuse App\\Support\\CommandMap;\nuse Psr\\Container\\ContainerInterface;\nuse Symfony\\Component\\Console\\Application;\nuse Symfony\\Component\\Console\\CommandLoader\\ContainerCommandLoader;\nuse Symfony\\Component\\Console\\Input\\ArgvInput;\nuse Symfony\\Component\\Console\\Output\\ConsoleOutput;\n\n\u002F** @var ContainerInterface $container *\u002F\n$container = require dirname(__DIR__) . DIRECTORY_SEPARATOR . 'bootstrap.php';\n\n$loader = new ContainerCommandLoader($container, $container-\u003Eget(CommandMap::class)-\u003EgetMap());\n$app = new Application();\n$app-\u003EsetCommandLoader($loader);\n\u002F** @noinspection PhpUnhandledExceptionInspection *\u002F\n$app-\u003Erun(new ArgvInput(), new ConsoleOutput());\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЖелательно дать этому файлу права на выполнение\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003Echmod +x .\u002Fbin\u002Fconsole\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003Epublic\u002Findex.php\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cpre\u003E\u003Ccode class=\"php\"\u003E&lt;?php\n\u002F\u002F public\u002Findex.php\n\nuse Psr\\Container\\ContainerInterface;\nuse Psr\\Http\\Message\\ResponseFactoryInterface;\nuse Slim\\App;\nuse Slim\\Interfaces\\CallableResolverInterface;\nuse Slim\\Interfaces\\RouteCollectorInterface;\nuse Slim\\Interfaces\\RouteResolverInterface;\nuse Slim\\Middleware\\ErrorMiddleware;\nuse Slim\\Middleware\\RoutingMiddleware;\nuse Slim\\Psr7\\Factory\\ServerRequestFactory;\n\n\u002F** @var ContainerInterface $container *\u002F\n$container = require dirname(__DIR__) . DIRECTORY_SEPARATOR . 'bootstrap.php';\n$request = ServerRequestFactory::createFromGlobals();\n\nSlim\\Factory\\AppFactory::create();\n$app = new App(\n    $container-\u003Eget(ResponseFactoryInterface::class),\n    $container,\n    $container-\u003Eget(CallableResolverInterface::class),\n    $container-\u003Eget(RouteCollectorInterface::class),\n    $container-\u003Eget(RouteResolverInterface::class)\n);\n\n$app-\u003Eadd($container-\u003Eget(RoutingMiddleware::class));\n$app-\u003Eadd($container-\u003Eget(ErrorMiddleware::class));\n$app-\u003Erun($request);\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПроверка.\u003Cbr\u002F\u003E\r\nЗапустим консольное приложение:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003E.\u002Fbin\u002Fconsole\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВ ответ должно отобразиться окно приветсвия компонета \u003Ccode\u003Esymfony\u002Fconsole\u003C\u002Fcode\u003E с двумя доступными командами — \u003Ccode\u003Ehelp\u003C\u002Fcode\u003E и \u003Ccode\u003Elist\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003EConsole Tool\n\nUsage:\n  command [options] [arguments]\n\nOptions:\n  -h, --help            Display this help message\n  -q, --quiet           Do not output any message\n  -V, --version         Display this application version\n      --ansi            Force ANSI output\n      --no-ansi         Disable ANSI output\n  -n, --no-interaction  Do not ask any interactive question\n  -v|vv|vvv, --verbose  Increase the verbosity of messages: 1 for normal output, 2 for more verbose output and 3 for debug\n\nAvailable commands:\n  help  Displays help for a command\n  list  Lists commands\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EТеперь запустим веб-сервер.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003Ephp -S localhost:8080 -t public public\u002Findex.php\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ откроем любой урл на localhost:8080.\u003Cbr\u002F\u003E\r\nВсе запросы должны возвращать ответ с кодом \u003Ccode\u003E404\u003C\u002Fcode\u003E и пустым телом.\u003Cbr\u002F\u003E\r\nЭто происходит, потому что у нас не указан ни один маршрут.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНам осталось подключить рендер, написать шаблоны, контроллеры и задать маршруты.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Ch3 id=\"shag-2-render\"\u003EШаг 2. Рендер\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EДобавим шаблон \u003Ccode\u003Etemplate\u002Flayout.twig\u003C\u002Fcode\u003E. Это базовый шаблон для всех страниц\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003Etemplate\u002Flayout.twig\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003E{# template\u002Flayout.twig #}\n&lt;!DOCTYPE html\u003E\n&lt;html lang=\"en\"\u003E\n&lt;head\u003E\n    &lt;title\u003E{% block title %}Slim demo{% endblock %}&lt;\u002Ftitle\u003E\n&lt;\u002Fhead\u003E\n&lt;body\u003E\n{% block content %}{% endblock %}\n&lt;\u002Fbody\u003E\n&lt;\u002Fhtml\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EДобавим шаблон страницы приветствия \u003Ccode\u003Etemplate\u002Fhello.twig\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003Etemplate\u002Fhello.twig\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003E{# template\u002Fhello.twig #}\n{% extends 'layout.twig' %}\n{% block title %}Slim demo::hello, {{ name }}{% endblock %}\n{% block content %}\n&lt;h1\u003EWelcome!&lt;\u002Fh1\u003E\n&lt;p\u003EHello, {{ name }}!&lt;\u002Fp\u003E\n{% endblock %}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ шаблон страницы ошибки \u003Ccode\u003Etemplate\u002Ferr404.twig\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003Etemplate\u002Ferr404.twig\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003E{# template\u002Ferr404.twig #}\n{% extends 'layout.twig' %}\n{% block title %}Slim demo::not found{% endblock %}\n{% block content %}\n&lt;h1\u003EError!&lt;\u002Fh1\u003E\n&lt;p\u003EPage not found =(&lt;\u002Fp\u003E\n{% endblock %}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EДобавим провайдер рендеринга \u003Ccode\u003Eapp\u002FProvider\u002FRenderProvider.php\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003Eapp\u002FProvider\u002FRenderProvider.php\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cpre\u003E\u003Ccode class=\"php\"\u003E&lt;?php\n\u002F\u002F app\u002FProvider\u002FRenderProvider.php\n\nnamespace App\\Provider;\n\nuse App\\Support\\Config;\nuse App\\Support\\ServiceProviderInterface;\nuse Psr\\Container\\ContainerInterface;\nuse Twig\\Environment;\nuse Twig\\Loader\\FilesystemLoader;\nuse UltraLite\\Container\\Container;\n\nclass RenderProvider implements ServiceProviderInterface\n{\n    public function register(Container $container)\n    {\n        $container-\u003Eset(Environment::class, function (ContainerInterface $container) {\n            $config = $container-\u003Eget(Config::class);\n            $loader = new FilesystemLoader($config-\u003Eget('templates.dir'));\n            $cache = $config-\u003Eget('templates.cache');\n            $options = [\n                'cache' =\u003E empty($cache) ? false : $cache,\n            ];\n            $twig = new Environment($loader, $options);\n            return $twig;\n        });\n    }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВключим провайдер в бутстрап\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003Ebootstrap.php\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cpre\u003E\u003Ccode class=\"php\"\u003E&lt;?php\n\u002F\u002F bootstrap.php\n\u002F\u002F ...\nuse App\\Provider\\RenderProvider;\n\u002F\u002F ...\n$providers = [\n\u002F\u002F ...\n    RenderProvider::class,\n\u002F\u002F ...\n];\n\u002F\u002F ...\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EДобавим рендер в обработчик 404 ошибки\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003Eapp\u002FSupport\u002FNotFoundHandler.php (DIFF)\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cpre\u003E\u003Ccode class=\"diff\"\u003E--- a\u002Fapp\u002FSupport\u002FNotFoundHandler.php\n+++ b\u002Fapp\u002FSupport\u002FNotFoundHandler.php\n@@ -8,15 +8,22 @@ use Psr\\Http\\Message\\ResponseInterface;\n use Psr\\Http\\Message\\ServerRequestInterface;\n use Slim\\Interfaces\\ErrorHandlerInterface;\n use Throwable;\n+use Twig\\Environment;\n+use Twig\\Error\\LoaderError;\n+use Twig\\Error\\RuntimeError;\n+use Twig\\Error\\SyntaxError;\n\n class NotFoundHandler implements ErrorHandlerInterface\n {\n\n     private $factory;\n\n-    public function __construct(ResponseFactoryInterface $factory)\n+    private $render;\n+\n+    public function __construct(ResponseFactoryInterface $factory, Environment $render)\n     {\n         $this-\u003Efactory = $factory;\n+        $this-\u003Erender = $render;\n     }\n\n     \u002F**\n@@ -26,10 +33,14 @@ class NotFoundHandler implements ErrorHandlerInterface\n      * @param bool $logErrors\n      * @param bool $logErrorDetails\n      * @return ResponseInterface\n+     * @throws LoaderError\n+     * @throws RuntimeError\n+     * @throws SyntaxError\n      *\u002F\n     public function __invoke(ServerRequestInterface $request, Throwable $exception, bool $displayErrorDetails, bool $logErrors, bool $logErrorDetails): ResponseInterface\n     {\n         $response = $this-\u003Efactory-\u003EcreateResponse(404);\n+        $response-\u003EgetBody()-\u003Ewrite($this-\u003Erender-\u003Erender('err404.twig'));\n         return $response;\n     }\n }\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003Eapp\u002FProvider\u002FAppProvider.php (DIFF)\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cpre\u003E\u003Ccode class=\"diff\"\u003E--- a\u002Fapp\u002FProvider\u002FAppProvider.php\n+++ b\u002Fapp\u002FProvider\u002FAppProvider.php\n@@ -19,6 +19,7 @@ use Slim\\Middleware\\RoutingMiddleware;\n use Slim\\Psr7\\Factory\\ResponseFactory;\n use Slim\\Routing\\RouteCollector;\n use Slim\\Routing\\RouteResolver;\n+use Twig\\Environment;\n use UltraLite\\Container\\Container;\n\n class AppProvider implements ServiceProviderInterface\n@@ -99,7 +100,7 @@ class AppProvider implements ServiceProviderInterface\n          * Регистрируем обработчика ошибки 404\n          *\u002F\n         $container-\u003Eset(NotFoundHandler::class, function (ContainerInterface $container) {\n-            return new NotFoundHandler($container-\u003Eget(ResponseFactoryInterface::class));\n+            return new NotFoundHandler($container-\u003Eget(ResponseFactoryInterface::class), $container-\u003Eget(Environment::class));\n         });\n\n         \u002F*\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EТеперь наша 404 ошибка приобрела тело.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Ch3 id=\"shag-3-kontrollery\"\u003EШаг 3. Контроллеры\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EТеперь можно браться за контроллеры\u003Cbr\u002F\u003E\r\nУ нас их будет 2:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003E\u003Ccode\u003Eapp\u002FController\u002FHomeController.php\u003C\u002Fcode\u003E — главная страница\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ccode\u003Eapp\u002FController\u002FHelloController.php\u003C\u002Fcode\u003E — страница приветствия\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EКонтроллеру главной страницы из зависимостей необходим роутер (для построения URL редиректа), а контроллеру страницы приветствия — рендер (для рендегинга html)\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003Eapp\u002FController\u002FHomeController.php\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cpre\u003E\u003Ccode class=\"php\"\u003E&lt;?php\n\u002F\u002F app\u002FController\u002FHomeController.php\n\nnamespace App\\Controller;\n\nuse Psr\\Http\\Message\\ResponseInterface;\nuse Psr\\Http\\Message\\ServerRequestInterface;\nuse Slim\\Interfaces\\RouteParserInterface;\n\nclass HomeController\n{\n\n    \u002F**\n     * @var RouteParserInterface\n     *\u002F\n    private $router;\n\n    public function __construct(RouteParserInterface $router)\n    {\n        $this-\u003Erouter = $router;\n    }\n\n    public function index(ServerRequestInterface $request, ResponseInterface $response)\n    {\n        $uri = $this-\u003Erouter-\u003EfullUrlFor($request-\u003EgetUri(), 'hello', ['name' =\u003E 'world']);\n        return $response\n            -\u003EwithStatus(301)\n            -\u003EwithHeader('location', $uri);\n    }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003Eapp\u002FController\u002FHelloController.php\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cpre\u003E\u003Ccode class=\"php\"\u003E&lt;?php\n\u002F\u002F app\u002FController\u002FHelloController.php\n\nnamespace App\\Controller;\n\nuse Psr\\Http\\Message\\ResponseInterface;\nuse Psr\\Http\\Message\\ServerRequestInterface;\nuse Twig\\Environment as Render;\nuse Twig\\Error\\LoaderError;\nuse Twig\\Error\\RuntimeError;\nuse Twig\\Error\\SyntaxError;\n\nclass HelloController\n{\n\n    \u002F**\n     * @var Render\n     *\u002F\n    private $render;\n\n    public function __construct(Render $render)\n    {\n        $this-\u003Erender = $render;\n    }\n\n    \u002F**\n     * @param ServerRequestInterface $request\n     * @param ResponseInterface $response\n     * @return ResponseInterface\n     * @throws LoaderError\n     * @throws RuntimeError\n     * @throws SyntaxError\n     *\u002F\n    public function show(ServerRequestInterface $request, ResponseInterface $response)\n    {\n        $response-\u003EgetBody()-\u003Ewrite($this-\u003Erender-\u003Erender('hello.twig', ['name' =\u003E $request-\u003EgetAttribute('name')]));\n        return $response;\n    }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EДобавим провайдер, регистрирующий контроллеры\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003Eapp\u002FProvider\u002FWebProvider.php\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cpre\u003E\u003Ccode class=\"php\"\u003E&lt;?php\n\u002F\u002F app\u002FProvider\u002FWebProvider.php\n\nnamespace App\\Provider;\n\nuse App\\Controller\\HelloController;\nuse App\\Controller\\HomeController;\nuse App\\Support\\ServiceProviderInterface;\nuse Psr\\Container\\ContainerInterface;\nuse Slim\\Interfaces\\RouteCollectorInterface;\nuse Slim\\Interfaces\\RouteCollectorProxyInterface;\nuse Twig\\Environment;\nuse UltraLite\\Container\\Container;\n\nclass WebProvider implements ServiceProviderInterface\n{\n    public function register(Container $container)\n    {\n        \u002F*\n         * Зарегистрируем контроллеры\n         *\u002F\n        $container-\u003Eset(HomeController::class, function (ContainerInterface $container) {\n            return new HomeController($container-\u003Eget(RouteCollectorInterface::class)-\u003EgetRouteParser());\n        });\n\n        $container-\u003Eset(HelloController::class, function (ContainerInterface $container) {\n            return new HelloController($container-\u003Eget(Environment::class));\n        });\n\n        \u002F*\n         * Зарегистрируем маршруты\n         *\u002F\n        $router = $container-\u003Eget(RouteCollectorInterface::class);\n        $router-\u003Egroup('\u002F', function(RouteCollectorProxyInterface $router) {\n            $router-\u003Eget('', HomeController::class . ':index')-\u003EsetName('index');\n            $router-\u003Eget('hello\u002F{name}', HelloController::class . ':show')-\u003EsetName('hello');\n        });\n    }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНе забудем добавить провайдер в бутстрап\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003Ebootstrap.php\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cpre\u003E\u003Ccode class=\"php\"\u003E&lt;?php\n\u002F\u002F bootstrap.php\n\u002F\u002F ...\nuse App\\Provider\\WebProvider;\n\u002F\u002F ...\n$providers = [\n\u002F\u002F ...\n    WebProvider::class,\n\u002F\u002F ...\n];\n\u002F\u002F ...\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EМы можем запустить веб-сервер (если останавливали)...\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003Ephp -S localhost:8080 -t public public\u002Findex.php\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E… открыть в браузере \u003Ca href=\"http:\u002F\u002Flocalhost:8080\" rel=\"nofollow\"\u003Ehttp:\u002F\u002Flocalhost:8080\u003C\u002Fa\u003E и увидеть, что браузер нас перенаправил на \u003Ca href=\"http:\u002F\u002Flocalhost:8080\u002Fhello\u002Fworld\" rel=\"nofollow\"\u003Ehttp:\u002F\u002Flocalhost:8080\u002Fhello\u002Fworld\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EМы видим теперь приветствие world'а.\u003Cbr\u002F\u003E\r\nМы можем открыть \u003Ca href=\"http:\u002F\u002Flocalhost:8080\u002Fhello\u002Fivan\" rel=\"nofollow\"\u003Ehttp:\u002F\u002Flocalhost:8080\u002Fhello\u002Fivan\u003C\u002Fa\u003E и бразуер поприветствует ivan'а.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНесуществующая страница, например, \u003Ca href=\"http:\u002F\u002Flocalhost:8080\u002Fhelo\u002Fworld\" rel=\"nofollow\"\u003Ehttp:\u002F\u002Flocalhost:8080\u002Fhelo\u002Fworld\u003C\u002Fa\u003E отображает наш кастомный текст и отдаёт 404 статус.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Ch3 id=\"shag-4-konsolnaya-komanda\"\u003EШаг 4. Консольная команда\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНапишем команду \u003Ccode\u003Eroute:list\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003Eapp\u002FCommand\u002FRouteListCommand.php\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cpre\u003E\u003Ccode class=\"php\"\u003E&lt;?php\n\u002F\u002F app\u002FCommand\u002FRouteListCommand.php\n\nnamespace App\\Command;\n\nuse Slim\\Interfaces\\RouteCollectorInterface;\nuse Symfony\\Component\\Console\\Command\\Command;\nuse Symfony\\Component\\Console\\Input\\InputInterface;\nuse Symfony\\Component\\Console\\Output\\OutputInterface;\nuse Symfony\\Component\\Console\\Style\\SymfonyStyle;\n\nclass RouteListCommand extends Command\n{\n\n    \u002F*\n     * Имя вынесено в константу, чтобы было меньше ошибок при маппинге команд\n     *\u002F\n    const NAME = 'route:list';\n\n    \u002F**\n     * @var RouteCollectorInterface\n     *\u002F\n    private $router;\n\n    public function __construct(RouteCollectorInterface $router)\n    {\n        $this-\u003Erouter = $router;\n        parent::__construct();\n    }\n\n    protected function configure()\n    {\n        $this-\u003EsetName(self::NAME)\n            -\u003EsetDescription('List of routes.')\n            -\u003EsetHelp('List of routes.')\n        ;\n    }\n\n    protected function execute(InputInterface $input, OutputInterface $output)\n    {\n        $io = new SymfonyStyle($input, $output);\n        $io-\u003Etitle('Routes');\n        $rows = [];\n        $routes = $this-\u003Erouter-\u003EgetRoutes();\n        if (!$routes) {\n            $io-\u003Etext('Routes list is empty');\n            return 0;\n        }\n        foreach ($routes as $route) {\n            $rows[] = [\n                'path' =\u003E $route-\u003EgetPattern(),\n                'methods' =\u003E implode(', ', $route-\u003EgetMethods()),\n                'name' =\u003E $route-\u003EgetName(),\n                'handler' =\u003E $route-\u003EgetCallable(),\n            ];\n        }\n        $io-\u003Etable(\n            ['Route', 'Methods', 'Name', 'Handler'],\n            $rows\n        );\n        return 0;\n    }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EТеперь нужен провайдер, который зарегистрирует команду в контейнере и добавит её в маппинг\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003Eapp\u002FProvider\u002FCommandProvider.php\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cpre\u003E\u003Ccode class=\"php\"\u003E&lt;?php\n\u002F\u002F app\u002FProvider\u002FCommandProvider.php\n\nnamespace App\\Provider;\n\nuse App\\Command\\RouteListCommand;\nuse App\\Support\\CommandMap;\nuse App\\Support\\ServiceProviderInterface;\nuse Psr\\Container\\ContainerInterface;\nuse Slim\\Interfaces\\RouteCollectorInterface;\nuse UltraLite\\Container\\Container;\n\nclass CommandProvider implements ServiceProviderInterface\n{\n    public function register(Container $container)\n    {\n        \u002F*\n         * Добавим команду списка маршрутов в контейнер\n         *\u002F\n        $container-\u003Eset(RouteListCommand::class, function (ContainerInterface $container) {\n            return new RouteListCommand($container-\u003Eget(RouteCollectorInterface::class));\n        });\n\n        \u002F*\n         * Добавим команду списка маршрутов в маппинг команд\n         *\u002F\n        $container-\u003Eget(CommandMap::class)-\u003Eset(RouteListCommand::NAME, RouteListCommand::class);\n    }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПомним про бутстрап\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003Ebootstrap.php\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cpre\u003E\u003Ccode class=\"php\"\u003E&lt;?php\n\u002F\u002F bootstrap.php\n\u002F\u002F ...\nuse App\\Provider\\CommandProvider;\n\u002F\u002F ...\n$providers = [\n\u002F\u002F ...\n    CommandProvider::class,\n\u002F\u002F ...\n];\n\u002F\u002F ...\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EТеперь мы можем ввести команду...\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003E.\u002Fbin\u002Fconsole route:list\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E… и увидеть список роутов:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003ERoutes\n======\n\n --------------- --------- ------- ------------------------------------- \n  Route           Methods   Name    Handler                              \n --------------- --------- ------- ------------------------------------- \n  \u002F               GET       index   App\\Controller\\HomeController:index  \n  \u002Fhello\u002F{name}   GET       hello   App\\Controller\\HelloController:show  \n --------------- --------- ------- ------------------------------------- \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВот, собственно, и всё!\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EКак видно из туториала, Slim — это не обязательно вся логика приложения в файле \u003Ccode\u003Eroutes.php\u003C\u002Fcode\u003E (как во многочисленных примерах), на нём можно писать качественные и поддерживаемые приложения. Главное — не испугаться в начале пути, когда контейнер пуст, а зависимотсти нужны.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fddrv-habrapost\u002Fslim-4-intro\" rel=\"nofollow\"\u003EСсылка на исходники проекта из статьи\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"slim framework"},{"titleHtml":"symfony console"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F452834\u002F518a79f832078a069eac95a51b8c4576\u002F","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F452834\u002F518a79f832078a069eac95a51b8c4576\u002F?format=vk","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F452834\\\u002F\"},\"headline\":\"Микрофреймворк slim\",\"datePublished\":\"2019-05-28T19:55:09+03:00\",\"dateModified\":\"2020-04-23T20:10:42+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"Ivan Dudarev\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"25 апреля 2019 года свет увидела новая мажорная alpha-версия микрофреймворка Slim, а 18 мая она выросла до beta. Предлагаю по этому поводу ознакомиться с новой в...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F452834\\\u002F#post-content-body\",\"about\":[\"h_webdev\",\"h_php\",\"f_develop\"],\"image\":[\"https:\\\u002F\\\u002Fhabr.com\\\u002Fshare\\\u002Fpublication\\\u002F452834\\\u002F518a79f832078a069eac95a51b8c4576\\\u002F\"]}","metaDescription":"25 апреля 2019 года свет увидела новая мажорная alpha-версия микрофреймворка Slim, а 18 мая она выросла до beta. Предлагаю по этому поводу ознакомиться с новой версией.\r\nПод катом:\r\n\r\nО новшествах...","mainImageUrl":null,"amp":false},"polls":[],"commentsEnabled":true,"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[{"title":"Разработчик Laravel","vacanciesCount":105,"itemUrl":"https:\u002F\u002Fcareer.habr.com\u002Fvacancies\u002Fprogrammist_laravel","itemHubs":["laravel","php"]},{"title":"PHP программист","vacanciesCount":287,"itemUrl":"https:\u002F\u002Fcareer.habr.com\u002Fvacancies\u002Fphp_programmist","itemHubs":["php"]}],"hubs":"webdev,php"},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.c0af73e7.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
