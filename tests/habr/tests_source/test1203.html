<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>5 продвинутых техник тестирования на Go / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.c0af73e7.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.85eb77f0b17c8235e7b64b9f81ea5ec2.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/company\/otus\/blog\/452772\/"},"headline":"5 продвинутых техник тестирования на Go","datePublished":"2019-05-21T13:18:52+03:00","dateModified":"2019-05-22T12:00:13+03:00","author":{"@type":"Person","name":"OTUS"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"Всем салют! До старта курса &laquo;Разработчик Golang&raquo; остается меньше недели и мы продолжаем делиться полезным материалом по теме. Поехали!    Go имеет хорошую и наде...","url":"https:\/\/habr.com\/ru\/company\/otus\/blog\/452772\/#post-content-body","about":["c_otus","h_programming","h_go","f_develop"],"image":["https:\/\/habrastorage.org\/webt\/mi\/ly\/nj\/milynjiemmrcxgeldshfcz383pa.png"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.49.0">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="5 продвинутых техник тестирования на Go" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="5 продвинутых техник тестирования на Go" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="5 продвинутых техник тестирования на Go" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="Всем салют! До старта курса «Разработчик Golang» остается меньше недели и мы продолжаем делиться полезным материалом по теме. Поехали!



Go имеет хорошую и надежную встроенную библиотеку для..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="Всем салют! До старта курса «Разработчик Golang» остается меньше недели и мы продолжаем делиться полезным материалом по теме. Поехали!



Go имеет хорошую и надежную встроенную библиотеку для..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="Всем салют! До старта курса «Разработчик Golang» остается меньше недели и мы продолжаем делиться полезным материалом по теме. Поехали!



Go имеет хорошую и надежную встроенную библиотеку для..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="Всем салют! До старта курса «Разработчик Golang» остается меньше недели и мы продолжаем делиться полезным материалом по теме. Поехали!



Go имеет хорошую и надежную встроенную библиотеку для..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="Всем салют! До старта курса «Разработчик Golang» остается меньше недели и мы продолжаем делиться полезным материалом по теме. Поехали!



Go имеет хорошую и надежную встроенную библиотеку для..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habr.com/share/publication/452772/6116ab02b954102a92f5b6e1695d74a0/" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habr.com/share/publication/452772/6116ab02b954102a92f5b6e1695d74a0/" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habr.com/share/publication/452772/6116ab02b954102a92f5b6e1695d74a0/" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habr.com/share/publication/452772/6116ab02b954102a92f5b6e1695d74a0/" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habr.com/share/publication/452772/6116ab02b954102a92f5b6e1695d74a0/" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="452772" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2019-05-21T10:18:52.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/452772/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/company/otus/blog/452772/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habr.com/share/publication/452772/6116ab02b954102a92f5b6e1695d74a0/" data-vmid="image:href">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
            Как стать автором
          </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" companyName="otus" data-async-called="true" class="tm-page"><div class="tm-page-width"><div class="tm-page__header"><!----></div> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"><div class="tm-company-card tm-company-article__company-card"><div class="tm-company-card__info"><div class="tm-company-card__header"><a href="/ru/company/otus/profile/" class="tm-company-card__avatar"><div class="tm-entity-image"><img alt="" height="48" src="//habrastorage.org/getpro/habr/company/968/422/761/968422761136a38a89fc391fd927f903.jpg" width="48" class="tm-entity-image__pic"></div></a> <!----> <div class="tm-rating tm-company-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">418.61</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div> <div class="tm-company-card__info"><a href="/ru/company/otus/profile/" class="tm-company-card__name">
        OTUS
      </a> <div class="tm-company-card__description">Цифровые навыки от ведущих экспертов</div></div></div> <div class="tm-company-card__buttons"><!----> <!----></div></div> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/MaxRokatansky/" title="MaxRokatansky" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="" height="24" loading="lazy" src="//habrastorage.org/r/w32/getpro/habr/avatars/b9f/baf/5f9/b9fbaf5f96ae52973706a0716bd9216e.jpg" width="24" class="tm-entity-image__pic"></div></a> <span class="tm-user-info__user"><a href="/ru/users/MaxRokatansky/" class="tm-user-info__username">
      MaxRokatansky
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2019-05-21T10:18:52.000Z" title="2019-05-21, 13:18">21  мая  2019 в 13:18</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>5 продвинутых техник тестирования на Go</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/company/otus/blog/" class="tm-article-snippet__hubs-item-link router-link-active"><span>Блог компании OTUS</span> <!----></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/programming/" class="tm-article-snippet__hubs-item-link"><span>Программирование</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/go/" class="tm-article-snippet__hubs-item-link"><span>Go</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <div class="tm-article-snippet__labels"><div class="tm-article-snippet__label"><span>
        Перевод
      </span></div></div> <!----> <!----></div></div> <div class="tm-article-presenter__origin"><a href="https://segment.com/blog/5-advanced-testing-techniques-in-go/" target="_blank" class="tm-article-presenter__origin-link">
                Автор оригинала:
                <span>
                  Alan Braithwaite
                </span></a></div> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-1"><div xmlns="http://www.w3.org/1999/xhtml">Всем салют! До старта курса <a href="https://otus.pw/uNfP/">«Разработчик Golang»</a> остается меньше недели и мы продолжаем делиться полезным материалом по теме. Поехали!<br/>
<br/>
<img src="/img/image-loader.svg" data-src="https://habrastorage.org/webt/mi/ly/nj/milynjiemmrcxgeldshfcz383pa.png"/><br/>
<br/>
Go имеет хорошую и надежную встроенную библиотеку для тестирования. Если вы пишете на Go, то вы уже это знаете. В этой статье мы поговорим о нескольких стратегиях, которые могут улучшить ваши навыки тестирования с помощью Go. Из опыта написания нашей внушительной кодовой базы на Go мы узнали, что эти стратегии действительно работают и тем самым помогают экономить время и усилия на работу с кодом. <a name="habracut"></a><br/>
<br/>
<b>Используйте тестовые наборы (test suites)</b><br/>
<br/>
Если вы усвоите для себя только одну полезную вещь из этой статьи, то это обязательно должно быть использование тестовых наборов. Для тех, кто не знаком с этим понятием, тестирование наборами – процесс разработки теста для проверки общего интерфейса, который может быть использован на многих реализациях этого интерфейса. Ниже вы можете посмотреть, как мы передаем несколько различных реализацией <code>Thinger</code> и запускаем их с одними и теми же тестами. <br/>
<br/>
<pre><code class="go">type Thinger interface {
    DoThing(input string) (Result, error)
}

// Suite tests all the functionality that Thingers should implement
func Suite(t *testing.T, impl Thinger) {
    res, _ := impl.DoThing("thing")
    if res != expected {
        t.Fail("unexpected result")
    }
}

// TestOne tests the first implementation of Thinger
func TestOne(t *testing.T) {
    one := one.NewOne()
    Suite(t, one)
}

// TestOne tests another implementation of Thinger
func TestTwo(t *testing.T) {
    two := two.NewTwo()
    Suite(t, two)
}
	</code></pre><br/>
 Удачливые читатели работали с базами кода, которые используют этот метод. Часто используемые в системах на основе плагинов тесты, которые написаны с целью тестирования интерфейса, могут использоваться всеми реализациями этого интерфейса для понимания того, насколько они соответствуют требованиям поведения.<br/>
<br/>
Использование такого подхода потенциально поможет сохранить часы, дни и даже время, достаточное для решения проблемы равенства <a href="https://ru.wikipedia.org/wiki/%D0%A0%D0%B0%D0%B2%D0%B5%D0%BD%D1%81%D1%82%D0%B2%D0%BE_%D0%BA%D0%BB%D0%B0%D1%81%D1%81%D0%BE%D0%B2_P_%D0%B8_NP">классов P и NP</a>. Также при замене одной базовой системы на другую пропадает необходимость написания (большого количества) дополнительных тестов, также появляется уверенность в том, что такой подход не нарушит работу вашего приложения. Неявно требуется создать интерфейс, который определяет площадь тестируемой области. С помощью инъекции зависимостей, вы можете настроить набор из пакета, передаваемого в реализацию всего пакета. <br/>
<br/>
Полный пример вы можете найти <a href="https://github.com/segmentio/testdemo">здесь</a>. Несмотря на то, что этот пример надуманный, можно представить, что одна база данных – удаленная, а вторая находится в памяти.<br/>
<br/>
Еще один классный пример этой техники располагается в стандартной библиотеке в пакете <code>golang.org/x/net/nettest</code>. Он обеспечивает средства для проверки того, что net.Conn удовлетворяет интерфейсу. <br/>
<br/>
<b>Избегайте загрязнения интерфейса </b><br/>
<br/>
Нельзя говорить о тестировании в Go, но не говорить об интерфейсах. <br/>
<br/>
Интерфейсы важны в контексте тестирования, поскольку они являются самым мощным инструментом в нашем арсенале тестирования, поэтому необходимо использовать их правильно. <br/>
<br/>
Пакеты часто экспортируют интерфейсы для разработчиков и это приводит к тому, что:<br/>
<br/>
А) Разработчики создают свой собственную заглушку(mock) для реализации пакета;<br/>
 Б) Пакет экспортирует свою собственную заглушку (mock).<br/>
<br/>
<blockquote><i>«Чем больше интерфейс, тем слабее абстракция»<br/>
 — Роб Пайк, Поговорки о Go</i></blockquote><br/>
 Интерфейсы должны быть тщательно проверены перед экспортом. Часто возникает соблазн экспортировать интерфейсы, чтобы дать пользователям возможность имитировать необходимое им поведение. Вместо этого документируйте, какие интерфейсы удовлетворяют вашим структурам, чтобы не создавать жесткой зависимости между потребительским пакетом (consumer package) и вашим собственным. Отличным примером этого является пакет <i><a href="https://godoc.org/github.com/pkg/errors">errors</a></i>.<br/>
<br/>
Когда у нас есть интерфейс, который мы не хотим экспортировать, можно использовать  <i><a href="https://golang.org/doc/go1.4#internalpackages">internal/ package subtree</a></i>, чтобы сохранить его внутри пакета. Таким образом, мы можем не бояться, что конечный пользователь может от него зависеть, и, следовательно, может быть гибкими в изменении интерфейса в соответствии с новыми требованиями. Обычно мы создаем интерфейсы с внешними зависимостями, чтобы иметь возможность запускать тесты локально.<br/>
<br/>
Такой подход позволяет пользователю реализовывать свои собственные небольшие интерфейсы, просто оборачивая какую-то часть библиотеки для проведения тестирования. Для получения более подробной информации об этой концепции, прочитайте<a href="https://rakyll.org/interface-pollution/"> статью rakyl о загрязнении интерфейса</a>.<br/>
 <br/>
 <b>Не экспортируйте примитивы параллелизма</b><br/>
<br/>
Go предлагает простые в использовании примитивы параллелизма, которые также иногда могут привести к чрезмерному их использованию в следствии той же простоты. В первую очередь нас беспокоят каналы и пакет sync. Иногда возникает соблазн экспортировать канал из вашего пакета, чтобы им могли пользоваться другие. Кроме того, распространенной ошибкой является встраивание <code>sync.Mutex</code> без установки ее в private. Это, как обычно, не всегда плохо, но создает определенные проблемы при тестировании вашей программы. <br/>
<br/>
Если вы экспортируете каналы, вы дополнительно усложняете жизнь пользователю пакета, чего делать не стоит. Как только канал экспортируется из пакета, вы создаете сложности при тестировании для того, кто этим каналом пользуется. Для проведения успешного тестирования, пользователь должен знать:<br/>
<br/>
<ul>
<li>Когда данные заканчивают пересылаться по каналу.</li>
<li>Были ли ошибки при получении данных.</li>
<li>Как пакет очищает канал после завершения, если очищает вообще?</li>
<li>Как обернуть интерфейс API пакета, так чтобы не вызывать его напрямую?</li>
</ul><br/>
Обратите внимание на пример с чтением очереди. Вот пример библиотеки, которая читает из очереди и предоставляет пользователю канал для чтения. <br/>
<br/>
<pre><code class="go">type Reader struct {...}
func (r *Reader) ReadChan() &lt;-chan Msg {...}</code></pre><br/>
 Теперь пользователь вашей библиотеки хочет реализовать тест для своего потребителя:<br/>
<br/>
<pre><code class="go">func TestConsumer(t testing.T) {
    cons := &amp;Consumer{
        r: libqueue.NewReader(),
    }
    for msg := range cons.r.ReadChan() {
        // Test thing.
    }
}</code></pre><br/>
<br/>
Затем пользователь может решить, что инъекция зависимостей – это хорошая идея, и написать свои собственные сообщения в канал:<br/>
<br/>
<pre><code class="go">func TestConsumer(t testing.T, q queueIface) {
    cons := &amp;Consumer{
        r: q,
    }
    for msg := range cons.r.ReadChan() {
        // Test thing.
    }
}</code></pre><br/>
<br/>
Подождите, а что по поводу ошибок?<br/>
<br/>
<pre><code class="go">func TestConsumer(t testing.T, q queueIface) {
    cons := &amp;Consumer{
        r: q,
    }
    for {
        select {
        case msg := &lt;-cons.r.ReadChan():
            // Test thing.
        case err := &lt;-cons.r.ErrChan():
            // What caused this again?
        }
    }
}</code></pre><br/>
<br/>
Теперь надо как-то генерировать события, чтобы фактически записывать в эту заглушку, которая реплицирует поведение используемой нами библиотеки. Если библиотека просто записала синхронный API, тогда мы могли бы добавить весь параллелизм в клиентский код, так проводить тестирование становится проще.<br/>
<br/>
<pre><code class="go">func TestConsumer(t testing.T, q queueIface) {
    cons := &amp;Consumer{
        r: q,
    }
    msg, err := cons.r.ReadMsg()
    // handle err, test thing
}
</code></pre><br/>
<br/>
Если вы в чем-то сомневаетесь, то просто вспомните, что всегда легко добавить параллелизм в потребительский пакет (consuming package), и трудно или невозможно удалить его после экспорта из библиотеки. И самое главное, не забудьте написать в документации пакета, безопасна ли структура/пакет для одновременного доступа нескольким горутинам.<br/>
Иногда все же желательно или необходимо экспортировать канал. Чтобы нивелировать некоторые из проблем, приведенных выше, вы можете предоставить каналы через аксессоры, вместо прямого доступа и оставить их открытыми только для чтения (<code>←chan</code>) или только для записи (<code>chan←</code>) при объявлении. <br/>
<br/>
<b>Используйте <code>net/http/httptest</code></b><br/>
<br/>
<code>Httptest</code> позволяет выполнять <code>http.Handler</code> код без запуска сервера или привязки к порту. Это ускоряет тестирование и позволяет выполнять тесты параллельно с меньшими затратами.<br/>
<br/>
Вот пример одного и того же теста, реализованного двумя способами. Здесь нет ничего грандиозного, но этот подход сокращает количество кода и экономит ресурсы. <br/>
<br/>
<pre><code class="go">func TestServe(t *testing.T) {
    // The method to use if you want to practice typing
    s := &amp;http.Server{
        Handler: http.HandlerFunc(ServeHTTP),
    }
    // Pick port automatically for parallel tests and to avoid conflicts
    l, err := net.Listen("tcp", ":0")
    if err != nil {
        t.Fatal(err)
    }
    defer l.Close()
    go s.Serve(l)

    res, err := http.Get("http://" + l.Addr().String() + "/?sloths=arecool")
    if err != nil {
        log.Fatal(err)
    }
    greeting, err := ioutil.ReadAll(res.Body)
    res.Body.Close()
    if err != nil {
        log.Fatal(err)
    }
    fmt.Println(string(greeting))
}

func TestServeMemory(t *testing.T) {
    // Less verbose and more flexible way
    req := httptest.NewRequest("GET", "http://example.com/?sloths=arecool", nil)
    w := httptest.NewRecorder()

    ServeHTTP(w, req)
    greeting, err := ioutil.ReadAll(w.Body)
    if err != nil {
        log.Fatal(err)
    }
    fmt.Println(string(greeting))
}</code></pre><br/>
 Возможно самая важная особенность заключается в том, что с помощью <code>httptest</code> вы можете разделить тест только на функцию, которую вы хотите протестировать. Никаких маршрутизаторов, промежуточного программного обеспечения или каких-либо других побочных эффектов, возникающих при настройке серверов, служб, фабрик обработчиков, фабрик фабрик обработчиков, или любых других вещей, которые приходят вам в голову и которые вы раньше сочли бы хорошей идеей.<br/>
<br/>
Чтобы посмотреть на этот принцип в действии, ознакомьтесь со <a href="http://markjberger.com/testing-web-apps-in-golang/">статьей Марка Бергера</a>. <br/>
<br/>
<b>Используйте отдельный пакет <code>_test</code></b> <br/>
<br/>
Большинство тестов в экосистеме создаются в файлах <code>pkg_test.go</code>, но все еще остаются в том же пакете: <code>package pkg</code>. Отдельный тестовый пакет – это пакет, который вы создаете в новом файле, <code>foo_test.go</code>, в директории модуля, который вы хотите протестировать, <code>foo/</code>, с декларацией <code>package foo_test</code>. Отсюда вы можете импортировать <code>github.com/example/foo</code> и другие зависимости. Такая функция позволяет делать многие вещи. Это рекомендуемое решение для циклических зависимостей в тестах, оно предотвращает появление «хрупких тестов» (brittle tests) и позволяет разработчику почувствовать, каково это – использовать свой собственный пакет. Если ваш пакет сложно использовать, то проводить тестирование этим методом тоже будет непросто.<br/>
 <br/>
 Такая стратегия предотвращает появление хрупких тестов путем ограничения доступа к переменным типа private. В частности, если ваши тесты «ломаются» и вы используете отдельные тестовые пакеты, то почти гарантировано, что клиент, использующий функцию, которая сломалась в тестах, также сломается при вызове.<br/>
<br/>
Наконец, это помогает избежать циклов импорта в тестах. Большинство пакетов, скорее всего, зависят от других пакетов, которые вы написали помимо тестирующихся, поэтому вы в конечном итоге столкнетесь с ситуацией, когда цикл импорта происходит естественно. Внешний пакет находится над обоими пакетами в иерархии пакетов. Возьмем пример из The Go Programming Language (Глава 11 Раздел 2.4), где <code>net/url</code> реализует парсер URL, который <code>net/http</code> импортирует для использования. Однако <code>net / url</code> необходимо протестировать с помощью реального варианта использования, импортировав <code>net / http</code>. Таким образом получается <code>net/url_test</code>.<br/>
<br/>
Теперь, когда вы используете отдельный тестовый пакет, вам может потребоваться доступ к неэкспортированным сущностям в том пакете, где раньше они были доступны. Некоторые разработчики сталкиваются с этим впервые, когда тестируют что-либо, основывающееся на времени (например, time.Now становится заглушкой с помощью функции). В этом случае, мы можем использовать дополнительный файл, чтобы предоставлять сущности исключительно во время тестирования, так как файлы <code>_test.go</code> исключаются из регулярных билдов. <br/>
<br/>
<b>Что необходимо помнить?</b> <br/>
<br/>
Важно помнить, что ни один из методов описанных выше – не панацея. Самый лучший подход в любом деле – критически анализировать ситуацию и самостоятельно выбирать лучшее решение проблемы. <br/>
<br/>
Хотите узнать больше о тестировании с Go?<br/>
 Прочитайте эти статьи:<br/>
<br/>
<a href="https://dave.cheney.net/2013/06/09/writing-table-driven-tests-in-go">Writing Table Driven Tests in Go Дейва Чени</a><br/>
<a href="http://www.gopl.io/">The Go Programming Language chapter on Testing.</a><br/>
Или посмотрите эти видео:<br/>
<a href="https://www.youtube.com/watch?v=yszygk1cpEc">Hashimoto's Advanced Testing With Go talk from Gophercon 2017</a><br/>
<a href="https://talks.golang.org/2014/testing.slide#1">Andrew Gerrand's Testing Techniques talk from 2014</a><br/>
<br/>
Надеемся данный перевод оказался полезен для вас. Ждем комментарии, а всех желающих узнать подробнее о курсе, приглашаем на <a href="https://otus.pw/bUrv/">день открытых дверей</a>, который пройдет 23 мая.</div></div> <!----> <!----></div> <div class="tm-article-presenter__meta"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bgo%5D" class="tm-tags-list__link">go</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%5D" class="tm-tags-list__link">тестирование</a></li></ul></div> <div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/company/otus/blog/" class="tm-hubs-list__link router-link-active">
    Блог компании OTUS
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/programming/" class="tm-hubs-list__link">
    Программирование
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/go/" class="tm-hubs-list__link">
    Go
  </a></li></ul></div></div></article></div> <!----></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 20: ↑16 и ↓4</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-rating"></use></svg> <span title="Всего голосов 20: ↑16 и ↓4" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_medium">+12</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">7.6K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    73
  </span></button> <!----> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> </div></div> <!----> <!----> <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"><div class="tm-article-author__company"><div class="tm-article-author__company-card"><div class="tm-company-snippet"><a href="/ru/company/otus/profile/" class="tm-company-snippet__logo-link"><div class="tm-entity-image"><img alt="" height="40" src="//habrastorage.org/getpro/habr/company/968/422/761/968422761136a38a89fc391fd927f903.jpg" width="40" class="tm-entity-image__pic"></div></a> <div class="tm-company-snippet__info"><a href="/ru/company/otus/profile/" class="tm-company-snippet__title">OTUS</a> <div class="tm-company-snippet__description">Цифровые навыки от ведущих экспертов</div></div></div> <div class="tm-article-author__buttons"><!----> <!----></div></div> <div class="tm-article-author__company-contacts"><a href="https://otus.ru" rel="noopener" target="_blank" class="tm-article-author__contact">
      Сайт
    </a><a href="https://facebook.com/otus.ru" rel="noopener" target="_blank" class="tm-article-author__contact">
      Facebook
    </a><a href="https://vk.com/club145052891" rel="noopener" target="_blank" class="tm-article-author__contact">
      ВКонтакте
    </a><a href="https://telegram.me/Otusjava" rel="noopener" target="_blank" class="tm-article-author__contact">
      Telegram
    </a></div> <div class="tm-article-author__separator"></div></div> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/MaxRokatansky/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><img alt="" src="//habrastorage.org/getpro/habr/avatars/b9f/baf/5f9/b9fbaf5f96ae52973706a0716bd9216e.jpg" class="tm-entity-image__pic"></div></a> <div class="tm-user-card__meta"><div title=" 659 голосов " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    26.7
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">-29.4</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title_variant-article"><span class="tm-user-card__name tm-user-card__name_variant-article">OTUS</span> <a href="/ru/users/MaxRokatansky/" class="tm-user-card__nickname tm-user-card__nickname_variant-article">
          @MaxRokatansky
        </a> <!----></div> <p class="tm-user-card__short-info tm-user-card__short-info_variant-article">Редактор</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-article"><!----> <!----> <!----> <!----> <!----></div></div> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----></section> <div class="tm-article-blocks__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/company/otus/blog/452772/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 1 
    </span></a> <!----></div></div></div>  <!---->  <!----> <!----></div></div></div></div></div> <div class="tm-page__sidebar"><div class="tm-layout-sidebar"><div class="tm-layout-sidebar__placeholder_initial"></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----> <section class="tm-block tm-block_spacing-bottom"><header class="tm-block__header"><h2 class="tm-block__title">Информация</h2> <!----></header> <div class="tm-block__body"><div class="tm-company-basic-info"><dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Дата основания</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap"><time datetime="2017-03-31T21:00:00.000Z" title="2017-04-01, 00:00">1  апреля  2017</time></dd></dl> <dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Местоположение</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap">
    Россия
  </dd></dl> <dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Сайт</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap"><a href="https://otus.ru" target="_blank" class="tm-company-basic-info__link">
      otus.ru
    </a></dd></dl> <dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Численность</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap">
    51–100 человек
  </dd></dl> <dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Дата регистрации</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap"><time datetime="2017-03-22T08:17:26.000Z" title="2017-03-22, 11:17">22  марта  2017</time></dd></dl> <dl class="tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap">Представитель</dt> <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap"><a href="/ru/users/MaxRokatansky/" class="tm-company-basic-info__link">
      OTUS
    </a></dd></dl></div></div> <!----></section> <div class="tm-company-widgets"></div> <!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/company/otus/blog/452772/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/company/otus/blog/452772/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"452772":{"id":"452772","timePublished":"2019-05-21T10:18:52+00:00","isCorporative":true,"lang":"ru","titleHtml":"5 продвинутых техник тестирования на Go","leadData":{"textHtml":"Всем салют! До старта курса \u003Ca href=\"https:\u002F\u002Fotus.pw\u002FuNfP\u002F\"\u003E«Разработчик Golang»\u003C\u002Fa\u003E остается меньше недели и мы продолжаем делиться полезным материалом по теме. Поехали!\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fmi\u002Fly\u002Fnj\u002Fmilynjiemmrcxgeldshfcz383pa.png\"\u003E\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nGo имеет хорошую и надежную встроенную библиотеку для тестирования. Если вы пишете на Go, то вы уже это знаете. В этой статье мы поговорим о нескольких стратегиях, которые могут улучшить ваши навыки тестирования с помощью Go. Из опыта написания нашей внушительной кодовой базы на Go мы узнали, что эти стратегии действительно работают и тем самым помогают экономить время и усилия на работу с кодом.","imageUrl":null,"buttonTextHtml":"Читать дальше →","image":null},"editorVersion":"1.0","postType":"article","postLabels":[{"type":"translation","data":{"originalAuthorName":"Alan Braithwaite","originalUrl":"https:\u002F\u002Fsegment.com\u002Fblog\u002F5-advanced-testing-techniques-in-go\u002F"}}],"author":{"scoreStats":{"score":26.7,"votesCount":659},"rating":-29.4,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"1547287","alias":"MaxRokatansky","fullname":"OTUS","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fb9f\u002Fbaf\u002F5f9\u002Fb9fbaf5f96ae52973706a0716bd9216e.jpg","speciality":"Редактор"},"statistics":{"commentsCount":1,"favoritesCount":73,"readingCount":7630,"score":12,"votesCount":20},"hubs":[{"relatedData":null,"id":"21052","alias":"otus","type":"corporative","title":"Блог компании OTUS","titleHtml":"Блог компании OTUS","isProfiled":false},{"relatedData":null,"id":"359","alias":"programming","type":"collective","title":"Программирование","titleHtml":"Программирование","isProfiled":true},{"relatedData":null,"id":"17748","alias":"go","type":"collective","title":"Go","titleHtml":"Go","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003EВсем салют! До старта курса \u003Ca href=\"https:\u002F\u002Fotus.pw\u002FuNfP\u002F\"\u003E«Разработчик Golang»\u003C\u002Fa\u003E остается меньше недели и мы продолжаем делиться полезным материалом по теме. Поехали!\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fmi\u002Fly\u002Fnj\u002Fmilynjiemmrcxgeldshfcz383pa.png\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nGo имеет хорошую и надежную встроенную библиотеку для тестирования. Если вы пишете на Go, то вы уже это знаете. В этой статье мы поговорим о нескольких стратегиях, которые могут улучшить ваши навыки тестирования с помощью Go. Из опыта написания нашей внушительной кодовой базы на Go мы узнали, что эти стратегии действительно работают и тем самым помогают экономить время и усилия на работу с кодом. \u003Ca name=\"habracut\"\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003EИспользуйте тестовые наборы (test suites)\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЕсли вы усвоите для себя только одну полезную вещь из этой статьи, то это обязательно должно быть использование тестовых наборов. Для тех, кто не знаком с этим понятием, тестирование наборами – процесс разработки теста для проверки общего интерфейса, который может быть использован на многих реализациях этого интерфейса. Ниже вы можете посмотреть, как мы передаем несколько различных реализацией \u003Ccode\u003EThinger\u003C\u002Fcode\u003E и запускаем их с одними и теми же тестами. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"go\"\u003Etype Thinger interface {\n    DoThing(input string) (Result, error)\n}\n\n\u002F\u002F Suite tests all the functionality that Thingers should implement\nfunc Suite(t *testing.T, impl Thinger) {\n    res, _ := impl.DoThing(\"thing\")\n    if res != expected {\n        t.Fail(\"unexpected result\")\n    }\n}\n\n\u002F\u002F TestOne tests the first implementation of Thinger\nfunc TestOne(t *testing.T) {\n    one := one.NewOne()\n    Suite(t, one)\n}\n\n\u002F\u002F TestOne tests another implementation of Thinger\nfunc TestTwo(t *testing.T) {\n    two := two.NewTwo()\n    Suite(t, two)\n}\n\t\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n Удачливые читатели работали с базами кода, которые используют этот метод. Часто используемые в системах на основе плагинов тесты, которые написаны с целью тестирования интерфейса, могут использоваться всеми реализациями этого интерфейса для понимания того, насколько они соответствуют требованиям поведения.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nИспользование такого подхода потенциально поможет сохранить часы, дни и даже время, достаточное для решения проблемы равенства \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002F%D0%A0%D0%B0%D0%B2%D0%B5%D0%BD%D1%81%D1%82%D0%B2%D0%BE_%D0%BA%D0%BB%D0%B0%D1%81%D1%81%D0%BE%D0%B2_P_%D0%B8_NP\"\u003Eклассов P и NP\u003C\u002Fa\u003E. Также при замене одной базовой системы на другую пропадает необходимость написания (большого количества) дополнительных тестов, также появляется уверенность в том, что такой подход не нарушит работу вашего приложения. Неявно требуется создать интерфейс, который определяет площадь тестируемой области. С помощью инъекции зависимостей, вы можете настроить набор из пакета, передаваемого в реализацию всего пакета. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПолный пример вы можете найти \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fsegmentio\u002Ftestdemo\"\u003Eздесь\u003C\u002Fa\u003E. Несмотря на то, что этот пример надуманный, можно представить, что одна база данных – удаленная, а вторая находится в памяти.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЕще один классный пример этой техники располагается в стандартной библиотеке в пакете \u003Ccode\u003Egolang.org\u002Fx\u002Fnet\u002Fnettest\u003C\u002Fcode\u003E. Он обеспечивает средства для проверки того, что net.Conn удовлетворяет интерфейсу. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003EИзбегайте загрязнения интерфейса \u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНельзя говорить о тестировании в Go, но не говорить об интерфейсах. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nИнтерфейсы важны в контексте тестирования, поскольку они являются самым мощным инструментом в нашем арсенале тестирования, поэтому необходимо использовать их правильно. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПакеты часто экспортируют интерфейсы для разработчиков и это приводит к тому, что:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nА) Разработчики создают свой собственную заглушку(mock) для реализации пакета;\u003Cbr\u002F\u003E\r\n Б) Пакет экспортирует свою собственную заглушку (mock).\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Ci\u003E«Чем больше интерфейс, тем слабее абстракция»\u003Cbr\u002F\u003E\r\n — Роб Пайк, Поговорки о Go\u003C\u002Fi\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n Интерфейсы должны быть тщательно проверены перед экспортом. Часто возникает соблазн экспортировать интерфейсы, чтобы дать пользователям возможность имитировать необходимое им поведение. Вместо этого документируйте, какие интерфейсы удовлетворяют вашим структурам, чтобы не создавать жесткой зависимости между потребительским пакетом (consumer package) и вашим собственным. Отличным примером этого является пакет \u003Ci\u003E\u003Ca href=\"https:\u002F\u002Fgodoc.org\u002Fgithub.com\u002Fpkg\u002Ferrors\"\u003Eerrors\u003C\u002Fa\u003E\u003C\u002Fi\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКогда у нас есть интерфейс, который мы не хотим экспортировать, можно использовать  \u003Ci\u003E\u003Ca href=\"https:\u002F\u002Fgolang.org\u002Fdoc\u002Fgo1.4#internalpackages\"\u003Einternal\u002F package subtree\u003C\u002Fa\u003E\u003C\u002Fi\u003E, чтобы сохранить его внутри пакета. Таким образом, мы можем не бояться, что конечный пользователь может от него зависеть, и, следовательно, может быть гибкими в изменении интерфейса в соответствии с новыми требованиями. Обычно мы создаем интерфейсы с внешними зависимостями, чтобы иметь возможность запускать тесты локально.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТакой подход позволяет пользователю реализовывать свои собственные небольшие интерфейсы, просто оборачивая какую-то часть библиотеки для проведения тестирования. Для получения более подробной информации об этой концепции, прочитайте\u003Ca href=\"https:\u002F\u002Frakyll.org\u002Finterface-pollution\u002F\"\u003E статью rakyl о загрязнении интерфейса\u003C\u002Fa\u003E.\u003Cbr\u002F\u003E\r\n \u003Cbr\u002F\u003E\r\n \u003Cb\u003EНе экспортируйте примитивы параллелизма\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nGo предлагает простые в использовании примитивы параллелизма, которые также иногда могут привести к чрезмерному их использованию в следствии той же простоты. В первую очередь нас беспокоят каналы и пакет sync. Иногда возникает соблазн экспортировать канал из вашего пакета, чтобы им могли пользоваться другие. Кроме того, распространенной ошибкой является встраивание \u003Ccode\u003Esync.Mutex\u003C\u002Fcode\u003E без установки ее в private. Это, как обычно, не всегда плохо, но создает определенные проблемы при тестировании вашей программы. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЕсли вы экспортируете каналы, вы дополнительно усложняете жизнь пользователю пакета, чего делать не стоит. Как только канал экспортируется из пакета, вы создаете сложности при тестировании для того, кто этим каналом пользуется. Для проведения успешного тестирования, пользователь должен знать:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EКогда данные заканчивают пересылаться по каналу.\u003C\u002Fli\u003E\r\n\u003Cli\u003EБыли ли ошибки при получении данных.\u003C\u002Fli\u003E\r\n\u003Cli\u003EКак пакет очищает канал после завершения, если очищает вообще?\u003C\u002Fli\u003E\r\n\u003Cli\u003EКак обернуть интерфейс API пакета, так чтобы не вызывать его напрямую?\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\nОбратите внимание на пример с чтением очереди. Вот пример библиотеки, которая читает из очереди и предоставляет пользователю канал для чтения. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"go\"\u003Etype Reader struct {...}\nfunc (r *Reader) ReadChan() &lt;-chan Msg {...}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n Теперь пользователь вашей библиотеки хочет реализовать тест для своего потребителя:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"go\"\u003Efunc TestConsumer(t testing.T) {\n    cons := &amp;Consumer{\n        r: libqueue.NewReader(),\n    }\n    for msg := range cons.r.ReadChan() {\n        \u002F\u002F Test thing.\n    }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗатем пользователь может решить, что инъекция зависимостей – это хорошая идея, и написать свои собственные сообщения в канал:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"go\"\u003Efunc TestConsumer(t testing.T, q queueIface) {\n    cons := &amp;Consumer{\n        r: q,\n    }\n    for msg := range cons.r.ReadChan() {\n        \u002F\u002F Test thing.\n    }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПодождите, а что по поводу ошибок?\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"go\"\u003Efunc TestConsumer(t testing.T, q queueIface) {\n    cons := &amp;Consumer{\n        r: q,\n    }\n    for {\n        select {\n        case msg := &lt;-cons.r.ReadChan():\n            \u002F\u002F Test thing.\n        case err := &lt;-cons.r.ErrChan():\n            \u002F\u002F What caused this again?\n        }\n    }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТеперь надо как-то генерировать события, чтобы фактически записывать в эту заглушку, которая реплицирует поведение используемой нами библиотеки. Если библиотека просто записала синхронный API, тогда мы могли бы добавить весь параллелизм в клиентский код, так проводить тестирование становится проще.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"go\"\u003Efunc TestConsumer(t testing.T, q queueIface) {\n    cons := &amp;Consumer{\n        r: q,\n    }\n    msg, err := cons.r.ReadMsg()\n    \u002F\u002F handle err, test thing\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЕсли вы в чем-то сомневаетесь, то просто вспомните, что всегда легко добавить параллелизм в потребительский пакет (consuming package), и трудно или невозможно удалить его после экспорта из библиотеки. И самое главное, не забудьте написать в документации пакета, безопасна ли структура\u002Fпакет для одновременного доступа нескольким горутинам.\u003Cbr\u002F\u003E\r\nИногда все же желательно или необходимо экспортировать канал. Чтобы нивелировать некоторые из проблем, приведенных выше, вы можете предоставить каналы через аксессоры, вместо прямого доступа и оставить их открытыми только для чтения (\u003Ccode\u003E←chan\u003C\u002Fcode\u003E) или только для записи (\u003Ccode\u003Echan←\u003C\u002Fcode\u003E) при объявлении. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003EИспользуйте \u003Ccode\u003Enet\u002Fhttp\u002Fhttptest\u003C\u002Fcode\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ccode\u003EHttptest\u003C\u002Fcode\u003E позволяет выполнять \u003Ccode\u003Ehttp.Handler\u003C\u002Fcode\u003E код без запуска сервера или привязки к порту. Это ускоряет тестирование и позволяет выполнять тесты параллельно с меньшими затратами.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВот пример одного и того же теста, реализованного двумя способами. Здесь нет ничего грандиозного, но этот подход сокращает количество кода и экономит ресурсы. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"go\"\u003Efunc TestServe(t *testing.T) {\n    \u002F\u002F The method to use if you want to practice typing\n    s := &amp;http.Server{\n        Handler: http.HandlerFunc(ServeHTTP),\n    }\n    \u002F\u002F Pick port automatically for parallel tests and to avoid conflicts\n    l, err := net.Listen(\"tcp\", \":0\")\n    if err != nil {\n        t.Fatal(err)\n    }\n    defer l.Close()\n    go s.Serve(l)\n\n    res, err := http.Get(\"http:\u002F\u002F\" + l.Addr().String() + \"\u002F?sloths=arecool\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    greeting, err := ioutil.ReadAll(res.Body)\n    res.Body.Close()\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(string(greeting))\n}\n\nfunc TestServeMemory(t *testing.T) {\n    \u002F\u002F Less verbose and more flexible way\n    req := httptest.NewRequest(\"GET\", \"http:\u002F\u002Fexample.com\u002F?sloths=arecool\", nil)\n    w := httptest.NewRecorder()\n\n    ServeHTTP(w, req)\n    greeting, err := ioutil.ReadAll(w.Body)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(string(greeting))\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n Возможно самая важная особенность заключается в том, что с помощью \u003Ccode\u003Ehttptest\u003C\u002Fcode\u003E вы можете разделить тест только на функцию, которую вы хотите протестировать. Никаких маршрутизаторов, промежуточного программного обеспечения или каких-либо других побочных эффектов, возникающих при настройке серверов, служб, фабрик обработчиков, фабрик фабрик обработчиков, или любых других вещей, которые приходят вам в голову и которые вы раньше сочли бы хорошей идеей.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЧтобы посмотреть на этот принцип в действии, ознакомьтесь со \u003Ca href=\"http:\u002F\u002Fmarkjberger.com\u002Ftesting-web-apps-in-golang\u002F\"\u003Eстатьей Марка Бергера\u003C\u002Fa\u003E. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003EИспользуйте отдельный пакет \u003Ccode\u003E_test\u003C\u002Fcode\u003E\u003C\u002Fb\u003E \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nБольшинство тестов в экосистеме создаются в файлах \u003Ccode\u003Epkg_test.go\u003C\u002Fcode\u003E, но все еще остаются в том же пакете: \u003Ccode\u003Epackage pkg\u003C\u002Fcode\u003E. Отдельный тестовый пакет – это пакет, который вы создаете в новом файле, \u003Ccode\u003Efoo_test.go\u003C\u002Fcode\u003E, в директории модуля, который вы хотите протестировать, \u003Ccode\u003Efoo\u002F\u003C\u002Fcode\u003E, с декларацией \u003Ccode\u003Epackage foo_test\u003C\u002Fcode\u003E. Отсюда вы можете импортировать \u003Ccode\u003Egithub.com\u002Fexample\u002Ffoo\u003C\u002Fcode\u003E и другие зависимости. Такая функция позволяет делать многие вещи. Это рекомендуемое решение для циклических зависимостей в тестах, оно предотвращает появление «хрупких тестов» (brittle tests) и позволяет разработчику почувствовать, каково это – использовать свой собственный пакет. Если ваш пакет сложно использовать, то проводить тестирование этим методом тоже будет непросто.\u003Cbr\u002F\u003E\r\n \u003Cbr\u002F\u003E\r\n Такая стратегия предотвращает появление хрупких тестов путем ограничения доступа к переменным типа private. В частности, если ваши тесты «ломаются» и вы используете отдельные тестовые пакеты, то почти гарантировано, что клиент, использующий функцию, которая сломалась в тестах, также сломается при вызове.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНаконец, это помогает избежать циклов импорта в тестах. Большинство пакетов, скорее всего, зависят от других пакетов, которые вы написали помимо тестирующихся, поэтому вы в конечном итоге столкнетесь с ситуацией, когда цикл импорта происходит естественно. Внешний пакет находится над обоими пакетами в иерархии пакетов. Возьмем пример из The Go Programming Language (Глава 11 Раздел 2.4), где \u003Ccode\u003Enet\u002Furl\u003C\u002Fcode\u003E реализует парсер URL, который \u003Ccode\u003Enet\u002Fhttp\u003C\u002Fcode\u003E импортирует для использования. Однако \u003Ccode\u003Enet \u002F url\u003C\u002Fcode\u003E необходимо протестировать с помощью реального варианта использования, импортировав \u003Ccode\u003Enet \u002F http\u003C\u002Fcode\u003E. Таким образом получается \u003Ccode\u003Enet\u002Furl_test\u003C\u002Fcode\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТеперь, когда вы используете отдельный тестовый пакет, вам может потребоваться доступ к неэкспортированным сущностям в том пакете, где раньше они были доступны. Некоторые разработчики сталкиваются с этим впервые, когда тестируют что-либо, основывающееся на времени (например, time.Now становится заглушкой с помощью функции). В этом случае, мы можем использовать дополнительный файл, чтобы предоставлять сущности исключительно во время тестирования, так как файлы \u003Ccode\u003E_test.go\u003C\u002Fcode\u003E исключаются из регулярных билдов. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003EЧто необходимо помнить?\u003C\u002Fb\u003E \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВажно помнить, что ни один из методов описанных выше – не панацея. Самый лучший подход в любом деле – критически анализировать ситуацию и самостоятельно выбирать лучшее решение проблемы. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nХотите узнать больше о тестировании с Go?\u003Cbr\u002F\u003E\r\n Прочитайте эти статьи:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ca href=\"https:\u002F\u002Fdave.cheney.net\u002F2013\u002F06\u002F09\u002Fwriting-table-driven-tests-in-go\"\u003EWriting Table Driven Tests in Go Дейва Чени\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003Ca href=\"http:\u002F\u002Fwww.gopl.io\u002F\"\u003EThe Go Programming Language chapter on Testing.\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\nИли посмотрите эти видео:\u003Cbr\u002F\u003E\r\n\u003Ca href=\"https:\u002F\u002Fwww.youtube.com\u002Fwatch?v=yszygk1cpEc\"\u003EHashimoto's Advanced Testing With Go talk from Gophercon 2017\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003Ca href=\"https:\u002F\u002Ftalks.golang.org\u002F2014\u002Ftesting.slide#1\"\u003EAndrew Gerrand's Testing Techniques talk from 2014\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНадеемся данный перевод оказался полезен для вас. Ждем комментарии, а всех желающих узнать подробнее о курсе, приглашаем на \u003Ca href=\"https:\u002F\u002Fotus.pw\u002FbUrv\u002F\"\u003Eдень открытых дверей\u003C\u002Fa\u003E, который пройдет 23 мая.\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"go"},{"titleHtml":"тестирование"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F452772\u002F6116ab02b954102a92f5b6e1695d74a0\u002F","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F452772\u002F6116ab02b954102a92f5b6e1695d74a0\u002F?format=vk","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fcompany\\\u002Fotus\\\u002Fblog\\\u002F452772\\\u002F\"},\"headline\":\"5 продвинутых техник тестирования на Go\",\"datePublished\":\"2019-05-21T13:18:52+03:00\",\"dateModified\":\"2019-05-22T12:00:13+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"OTUS\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"Всем салют! До старта курса &laquo;Разработчик Golang&raquo; остается меньше недели и мы продолжаем делиться полезным материалом по теме. Поехали!    Go имеет хорошую и наде...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fcompany\\\u002Fotus\\\u002Fblog\\\u002F452772\\\u002F#post-content-body\",\"about\":[\"c_otus\",\"h_programming\",\"h_go\",\"f_develop\"],\"image\":[\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fmi\\\u002Fly\\\u002Fnj\\\u002Fmilynjiemmrcxgeldshfcz383pa.png\"]}","metaDescription":"Всем салют! До старта курса «Разработчик Golang» остается меньше недели и мы продолжаем делиться полезным материалом по теме. Поехали!\r\n\r\n\r\n\r\nGo имеет хорошую и надежную встроенную библиотеку для...","mainImageUrl":null,"amp":false},"polls":[],"commentsEnabled":true,"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[],"hubs":""},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{"otus":{"alias":"otus","imageUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fcompany\u002F968\u002F422\u002F761\u002F968422761136a38a89fc391fd927f903.jpg","titleHtml":"OTUS","descriptionHtml":"Цифровые навыки от ведущих экспертов","relatedData":null,"statistics":{"postsCount":1478,"newsCount":2,"vacanciesCount":1,"employeesCount":46,"careerRating":null,"subscribersCount":66497,"rating":418.61,"invest":null},"foundationDate":{"year":"2017","month":"04","day":"01"},"location":{"city":{"id":"447159","title":"Москва"},"region":{"id":"1885","title":"Москва и Московская обл."},"country":{"id":"168","title":"Россия"}},"siteUrl":"https:\u002F\u002Fotus.ru","staffNumber":"51–100 человек","registrationDate":"2017-03-22T08:17:26+00:00","representativeUser":{"alias":"MaxRokatansky","fullname":"OTUS"},"contacts":[{"title":"Сайт","url":"https:\u002F\u002Fotus.ru"},{"title":"Facebook","url":"https:\u002F\u002Ffacebook.com\u002Fotus.ru"},{"title":"ВКонтакте","url":"https:\u002F\u002Fvk.com\u002Fclub145052891"},{"title":"Telegram","url":"https:\u002F\u002Ftelegram.me\u002FOtusjava"}],"settings":{"analyticsSettings":[],"branding":null,"status":"active"},"metadata":{"titleHtml":"OTUS, Москва - Цифровые навыки от ведущих экспертов с 1 апреля 2017 г.","title":"OTUS, Москва - Цифровые навыки от ведущих экспертов с 1 апреля 2017 г.","keywords":["Программирование","Python","Java","Информационная безопасность","JavaScript"],"descriptionHtml":"1 478 статей от авторов компании OTUS","description":"1 478 статей от авторов компании OTUS"},"aDeskSettings":null,"careerAlias":"otus","maxCustomTrackerLinks":0}},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.c0af73e7.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
