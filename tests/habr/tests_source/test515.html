<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Julia: функции и структуры-как-функции / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.c0af73e7.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.85eb77f0b17c8235e7b64b9f81ea5ec2.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/post\/451172\/"},"headline":"Julia: функции и структуры-как-функции","datePublished":"2019-05-11T03:58:08+03:00","dateModified":"2019-05-11T11:23:22+03:00","author":{"@type":"Person","name":"Василий Писарев"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"Несмотря на то, что в языке Julia по замыслу отсутствует &laquo;классическое&raquo; объектно-ориентированное программирование с классами и методами, язык предоставляет средс...","url":"https:\/\/habr.com\/ru\/post\/451172\/#post-content-body","about":["h_programming","h_julia","f_develop"],"image":["https:\/\/habr.com\/share\/publication\/451172\/4235095bfdd3cf0eb0620a47bf7bdaba\/"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.49.0">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="Julia: функции и структуры-как-функции" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Julia: функции и структуры-как-функции" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Julia: функции и структуры-как-функции" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="Несмотря на то, что в языке Julia по замыслу отсутствует «классическое» объектно-ориентированное программирование с классами и методами, язык предоставляет средства абстрагирования, ключевую роль в..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="Несмотря на то, что в языке Julia по замыслу отсутствует «классическое» объектно-ориентированное программирование с классами и методами, язык предоставляет средства абстрагирования, ключевую роль в..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="Несмотря на то, что в языке Julia по замыслу отсутствует «классическое» объектно-ориентированное программирование с классами и методами, язык предоставляет средства абстрагирования, ключевую роль в..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="Несмотря на то, что в языке Julia по замыслу отсутствует «классическое» объектно-ориентированное программирование с классами и методами, язык предоставляет средства абстрагирования, ключевую роль в..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="Несмотря на то, что в языке Julia по замыслу отсутствует «классическое» объектно-ориентированное программирование с классами и методами, язык предоставляет средства абстрагирования, ключевую роль в..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habr.com/share/publication/451172/4235095bfdd3cf0eb0620a47bf7bdaba/" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habr.com/share/publication/451172/4235095bfdd3cf0eb0620a47bf7bdaba/" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habr.com/share/publication/451172/4235095bfdd3cf0eb0620a47bf7bdaba/" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habr.com/share/publication/451172/4235095bfdd3cf0eb0620a47bf7bdaba/" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habr.com/share/publication/451172/4235095bfdd3cf0eb0620a47bf7bdaba/" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="451172" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2019-05-11T00:58:08.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/451172/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/post/451172/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habr.com/share/publication/451172/4235095bfdd3cf0eb0620a47bf7bdaba/" data-vmid="image:href">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
            Как стать автором
          </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" data-async-called="true" class="tm-page"><div class="tm-page-width"><!----> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/Pand5461/" title="Pand5461" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="" height="24" loading="lazy" src="//habrastorage.org/r/w32/getpro/habr/avatars/0bd/d11/fe5/0bdd11fe540cb045ed967b6fc85cded8.jpg" width="24" class="tm-entity-image__pic"></div></a> <span class="tm-user-info__user"><a href="/ru/users/Pand5461/" class="tm-user-info__username">
      Pand5461
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2019-05-11T00:58:08.000Z" title="2019-05-11, 03:58">11  мая  2019 в 03:58</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>Julia: функции и структуры-как-функции</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/programming/" class="tm-article-snippet__hubs-item-link"><span>Программирование</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/julia/" class="tm-article-snippet__hubs-item-link"><span>Julia</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <div class="tm-article-snippet__labels"><div class="tm-article-snippet__label"><span>
        Tutorial
      </span></div></div> <!----> <!----></div></div> <!----> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-1"><div xmlns="http://www.w3.org/1999/xhtml">Несмотря на то, что в языке Julia по замыслу отсутствует «классическое» объектно-ориентированное программирование с классами и методами, язык предоставляет средства абстрагирования, ключевую роль в которых играет система типов и элементы функционального программирования. Рассмотрим подробнее второй пункт.<br/>
<a name="habracut"></a><br/>
Концепция функций в Julia, вероятно, наиболее похожа на языки из семейства Lisp (если быть точнее, то ветки Lisp-1), и функции можно рассматривать на трёх уровнях: как подпрограммы, как абстракции к некоторой последовательности действий и как данные, представляющие эту абстракцию.<br/>
<br/>
<h3>Уровень 1. Функции как подпрограммы</h3><br/>
Выделение подпрограмм и присваивание им собственных имён идёт ещё с доисторических времён, когда Фортран считался языком высокого уровня, а Си ещё не было.<br/>
<br/>
В этом понимании средства Julia стандартны. «Особенностью» можно назвать то, что синтаксически нет деления на процедуры и функции. Вне зависимости от того, вызывается подпрограмма для получения некоторого значения или только для выполнения каких-то действий над данными — она называется функцией.<br/>
<br/>
Определение функции начинается с ключевого слова <code>function</code>, за которым в скобках следует список аргументов, последовательность команд, и заканчивает определение слово <code>end</code>:<br/>
<br/>
<pre><code class="julia">"""
    sum_all(collection)

Sum all elements of a collection and return the result
"""
function sum_all(collection)
    sum = 0
    for item in collection
        sum += collection
    end
    sum
end
</code></pre><br/>
Отличительностью синтаксиса является унаследованное от Лиспа поведение: для «нормального» возврата значения из функции слово <code>return</code> не обязательно: возвращается значение последнего вычисленного перед <code>end</code> выражения. В примере выше будет возвращено значение переменной <code>sum</code>. Таким образом, <code>return</code> может использоваться в качестве маркера особого поведения функции:<br/>
<br/>
<pre><code class="julia">function safe_division(number, divisor)
    if divisor == 0
        return 0
    end
    number / divisor
end

# то же самое
function safe_division1(number, divisor)
    if divisor == 0
        0 # при попадании в эту ветку до выхода из функции нет других инструкций
    else
        number / divisor
    end
end
</code></pre><br/>
Для функций с коротким определением есть укороченный синтаксис, похожий на математическую запись. Так, вычисление длины гипотенузы по длине катетов можно определить так:<br/>
<br/>
<pre><code class="julia">hypotenuse(a, b) = sqrt(a^2 + b^2)
</code></pre><br/>
«Безопасное» деление с помощью тернарного оператора можно записать так:<br/>
<br/>
<pre><code class="julia">safe_division(number, divisor) = divisor == 0 ? 0 : number / divisor
</code></pre><br/>
Как можно заметить, для аргументов функции не обязательно указывать типы. С учётом того, как работает JIT-компилятор Julia, «утиная типизация» даже не всегда будет приводить к падению производительности.<br/>
<br/>
Как я постарался продемонстрировать в <a href="https://habr.com/ru/post/450628/">предыдущей статье</a>, компилятор Julia может выводить тип возвращаемого результата по типам входных аргументов. Поэтому, например, функция <code>safe_division</code> для быстрой работы требует минимальной модификации:<br/>
<br/>
<pre><code class="julia">function safe_division(number, divisor)
    if divisor == 0
        return zero(number / divisor)
    end
    number / divisor
end
</code></pre><br/>
Теперь, если типы обоих аргументов известны на этапе компиляции, тип возвращаемого результата также однозначно выводится, т.к. функция <code>zero(x)</code> возвращает нулевое значение того же типа, что её аргумент (а деление на ноль, согласно <a href="https://en.wikipedia.org/wiki/IEEE_754-1985#Representation_of_non-numbers">IEEE 754</a>, имеет вполне представимое значение в формате чисел с плавающей точкой).<br/>
<br/>
Функции могут иметь фиксированное число позиционных аргументов, позиционные аргументы со значениями по умолчанию, именованные аргументы и переменное число аргументов. Синтаксис:<br/>
<br/>
<pre><code class="julia"># фиксированный список аргументов
function hello(name)
    println("Hello, ", name)
end

# аргумент со значением по умолчанию
# аргументы со значением по умолчанию должны идти после обязательных аргументов
function greeting_d(name, greeting = "Hello")
    println(greeting, ", ", name)
end

# именованный аргумент со значением по умолчанию
# именованные аргументы отделяются точкой с запятой и идут после
# обязательных аргументов и опциональных позиционных аргументов
function greeting_kw(name; greeting = "Hello")
    println(greeting, ", ", name)
end

# аргумент greeting хоть и именованный, но должен обязательно быть предоставлен при вызове
function greeting_oblkw(name; greeting)
    println(greeting, ", ", name)
end

# функция с неопределённым числом аргументов
# все аргументы, начиная со второго, в теле интерпретируются как кортеж names
function greeting_nary(greeting, names...)
    print(greeting)
    for name in names
        print(", ", name)
    end
    print('\n')
end

julia> hello("world")
Hello, world

julia> greeting_d("world")
Hello, world

julia> greeting_d("Mr. Smith", "How do you do")
How do you do, Mr. Smith

julia> greeting_kw("Mr. Smith")
Hello, Mr. Smith

julia> greeting_kw("mom", greeting = "Hi")
Hi, mom

julia> greeting_oblkw("world")
ERROR: UndefKeywordError: keyword argument greeting not assigned
Stacktrace:
 [1] greeting_oblkw(::String) at ./REPL[23]:3
 [2] top-level scope at none:0

julia> greeting_oblkw("mom", greeting = "Hi")
Hi, mom

julia> greeting_nary("Hi", "mom", "dad", "everyone")
Hi, mom, dad, everyone
</code></pre><br/>
<h3>Уровень 2. Функции как данные</h3><br/>
Имя функции может использоваться не только в непосредственных вызовах, но и как идентификатор, с которым связана процедура получения значения. Например:<br/>
<br/>
<pre><code class="julia">function f_x_x(fn, x)
    fn(x, x)
end

julia> f_x_x(+, 3)
6 # +(3, 3) = 3+3 = 6
julia> f_x_x(*, 3)
9 # *(3, 3) = 9
julia> f_x_x(^, 3)
27 # ^(3, 3) = 3^3 = 27
julia> f_x_x(log, 3)
1.0 # log(3, 3) = 1
</code></pre><br/>
«Классические» функции, которые принимают функциональный аргумент, — это <code>map</code>, <code>reduce</code> и <code>filter</code>.<br/>
<br/>
<code>map(f, x...)</code> применяет функцию <code>f</code> к значениям всех элементов из <code>x</code>(или кортежам из i-х элементов) и возвращает результаты как новую коллекцию:<br/>
<br/>
<pre><code class="julia">julia> map(cos, [0, π/3, π/2, 2*π/3, π])
5-element Array{Float64,1}:
  1.0                  
  0.5000000000000001   
  6.123233995736766e-17
 -0.4999999999999998   
 -1.0

julia> map(+, (2, 3), (1, 1))
(3, 4)
</code></pre><br/>
<code>reduce(f, x; init_val)</code> «сводит» коллекцию к одному значению, «разворачивая» цепочку <code>f(f(...f(f(init_val, x[1]), x[2])...), x[end])</code>:<br/>
<br/>
<pre><code class="julia">function myreduce(fn, values, init_val)
    accum = init_val
    for x in values
        accum = fn(accum, x)
    end
    accum
end
</code></pre><br/>
Поскольку на самом деле не определено, в каком порядке будет проход массива при редукции, а также то, будет вызываться <code>fn(accum, x)</code> или <code>fn(x, accum)</code>, редукция будет давать предсказуемый результат только с коммутативными или ассоциативными операторами, типа сложения или умножения.<br/>
<br/>
<code>filter(predicate, x)</code> возвращает массив из элементов <code>x</code>, которые удовлетворяют предикату <code>predicate</code>:<br/>
<br/>
<pre><code class="julia">julia> filter(isodd, 1:10)
5-element Array{Int64,1}:
 1
 3
 5
 7
 9
julia> filter(iszero, [[0], 1, 0.0, 1:-1, 0im])
4-element Array{Any,1}:
    [0] 
   0.0  
    1:0 
 0 + 0im
</code></pre><br/>
Применение функций высшего порядка для операций над массивами вместо написания цикла имеет несколько преимуществ:<br/>
<br/>
<ol>
<li> код становится короче </li>
<li> <code>map()</code> или <code>reduce()</code> показывают <i>семантику</i> выполняемой операции, тогда в семантике происходящего в цикле нужно ещё разбираться </li>
<li> <code>map()</code> даёт компилятору понять, что операции над элементами массива независимы по данным, что позволяет применить дополнительные оптимизации </li>
</ol><br/>
<h3>Уровень 3. Функции как абстракции</h3><br/>
Нередко в <code>map()</code> или <code>filter()</code> нужно использовать функцию, которой не было присвоено собственное имя. Julia в этом случае позволяет выразить <i>абстракцию</i> выполнения операций над аргументом, не вводя для этой последовательности собственное имя. Такая абстракция называется <i>анонимной функцией</i>, или <i>лямбда-функцией</i> (т.к. в математической традиции такие функции обозначаются буквой лямбда). Синтаксис этого представления такой:<br/>
<br/>
<pre><code class="julia"># именованная функция
square(x) = x^2
# анонимный аналог
x -> x^2

# именованная функция
hypot(a, b) = sqrt(x^2 + y^2)
# анонимный аналог - если аргументов больше одного, вокруг них ставятся скобки,
# чтобы не спутать с кортежем из переменной и анонимной функции от одной переменной
(x, y) -> sqrt(x^2 + y^2)

# именованная функция
fortytwo() = 42
# анонимная функция
() -> 42

julia> map(i -> map(x -> x^i, 1:5), 1:5)
5-element Array{Array{Int64,1},1}:
 [1, 2, 3, 4, 5]         
 [1, 4, 9, 16, 25]       
 [1, 8, 27, 64, 125]     
 [1, 16, 81, 256, 625]   
 [1, 32, 243, 1024, 3125]
</code></pre><br/>
Как именованные, так и анонимные функции можно присваивать переменным и возвращать в качестве значений:<br/>
<br/>
<pre><code class="julia">julia> double_squared = x -> (2 * x)^2
#17 (generic function with 1 method)

julia> double_squared(5)
100
</code></pre><br/>
<h3>Область видимости переменных и лексические замыкания</h3><br/>
В норме функции стараются писать таким образом, чтобы все необходимые для вычисления данные были получены через формальные аргументы, т.е. любые имена переменных, которые встречаются в теле — это либо имена формальных аргументов, либо имена переменных, вводимых внутри тела функции.<br/>
<br/>
<pre><code class="julia">function normal(x, y)
    z = x + y
    x + y * z
end

function strange(x, y)
    x + y * z
end
</code></pre><br/>
Про функцию <code>normal()</code> можно сказать, что в её теле все имена переменных <i>связанные</i>, т.е. если мы везде (включая список аргументов) заменим «x» на «m» (или любой другой идентификатор), «y» на «n», а «z» на «sum_of_m_and_n» — смысл выражения не поменяется. В функции <code>strange()</code> имя z является <i>несвязанным</i>, т.е. а) смысл может поменяться, если это имя будет заменено на другое и б) корректность функции зависит от того, была ли на момент вызова функции определена переменная с именем «z».<br/>
<br/>
Вообще говоря, с функцией <code>normal()</code> тоже не всё так чисто:<br/>
<br/>
<ol>
<li> Что будет, если вне функции определена переменная с именем z?</li>
<li> Символы + и *, вообще-то, тоже являются несвязанными идентификаторами.</li>
</ol><br/>
С пунктом 2 ничего нельзя поделать, кроме как согласиться — логично, что определения всех используемых функций в системе должны существовать, и будем надеяться, что их реальный смысл соответствует нашим ожиданиям.<br/>
<br/>
Пункт 1 менее очевиден, чем кажется. Дело в том, что ответ зависит от того, где определена функция. Если она определена глобально, то <code>z</code> внутри <code>normal()</code> будет локальной переменной, т.е. даже при наличии глобальной переменной <code>z</code> её значение не перезапишется. Если же определение функции находится внутри блока кода, то при наличии в этом блоке более раннего определения <code>z</code> будет изменено именно значение внешней переменной.<br/>
<br/>
Если тело функции содержит имя внешней переменной, то это имя связывается с тем значением, которое существовало в окружении, где создана функция. Если сама функция экспортируется из этого окружения (например, если она возвращается из другой функции в качестве значения), то она «захватывает» переменную из внутреннего окружения, к которой в новом окружении доступа уже нет. Это называется лексическим замыканием.<br/>
<br/>
Замыкания в основном полезны в двух ситуациях: когда нужно создать функцию по заданным параметрам и когда нужна функция, которая имеет некоторое внутреннее состояние.<br/>
<br/>
Рассмотрим ситуацию с функцией, инкапсулирующей внутреннее состояние:<br/>
<br/>
<pre><code class="julia">function f_with_counter(fn)
    call_count = 0
    ncalls() = call_count
    # invoke() будет подсчитывать, сколько раз она вызвана
    # получить это значение можно, вызвав ncalls()
    function invoke(args...)
        call_count += 1
        fn(args...)
    end
    # возвращаем обе функции как кортеж с именованными полями
    # call_count теперь будет извне недоступна напрямую,
    # но экспортированные invoke() и call_count() имеют к нему доступ и могут менять
    (call = invoke, call_count = ncalls)
end

julia> abscount = f_with_counter(abs)
(call = getfield(Main, Symbol("#invoke#22")){typeof(abs)}(abs, Core.Box(0)), call_count = getfield(Main, Symbol("#ncalls#21"))(Core.Box(0)))
julia> abscount.call_count()
0
julia> abscount.call(-20)
20
julia> abscount.call_count()
1
julia> abscount.call(im)
1.0
julia> abscount.call_count()
2
</code></pre><br/>
<h4>Case study: всё те же полиномы</h4><br/>
В <a href="https://habr.com/ru/post/450628/">прошлой статье</a> рассмотрено представление полиномов как структур. В частности, одна из структур хранения — это список коэффициентов, начиная с младшего. Для вычисления полинома <code>p</code> в точке <code>x</code> предлагалось вызвать функцию <code>evpoly(p, x)</code>, которая вычисляет полином по схеме Горнера.<br/>
<br/>
<div class="spoiler"><b class="spoiler_title">Полный код определений</b><div class="spoiler_text"><pre><code class="julia">abstract type AbstractPolynomial end

"""
    Polynomial &lt;: AbstractPolynomial

Polynomials written in the canonical form

---

    Polynomial(v::T) where T&lt;:Union{Vector{&lt;:Real}, NTuple{&lt;:Any, &lt;:Real}})

Construct a `Polynomial` from the list of the coefficients. The coefficients are assumed to go from power 0 in the ascending order. If an empty collection is provided, the constructor returns a zero polynomial.
"""
struct Polynomial&lt;:AbstractPolynomial
    degree::Int
    coeff::NTuple{N, Float64} where N
    function Polynomial(v::T where T&lt;:Union{Vector{&lt;:Real},
                                            NTuple{&lt;:Any, &lt;:Real}})
        coeff = isempty(v) ? (0.0,) : tuple([Float64(x) for x in v]...)
        return new(length(coeff)-1, coeff)
    end
end

"""
    InterpPolynomial &lt;: AbstractPolynomial

Interpolation polynomials in Newton's form

---

    InterpPolynomial(xsample::Vector{&lt;:Real}, fsample::Vector{&lt;:Real})

Construct an `InterpPolynomial` from a vector of points `xsample` and corresponding function values `fsample`. All values in `xsample` must be distinct.
"""
struct InterpPolynomial&lt;:AbstractPolynomial
    degree::Int
    xval::NTuple{N, Float64} where N
    coeff::NTuple{N, Float64} where N
    function InterpPolynomial(xsample::X,
                              fsample::F) where {X&lt;:Union{Vector{&lt;:Real},
                                                          NTuple{&lt;:Any, &lt;:Real}},
                                                 F&lt;:Union{Vector{&lt;:Real},
                                                          NTuple{&lt;:Any, &lt;:Real}}}
        if !allunique(xsample)
            throw(DomainError("Cannot interpolate with duplicate X points"))
        end
        N = length(xsample)
        if length(fsample) != N
            throw(DomainError("Lengths of X and F are not the same"))
        end

        coeff = [Float64(f) for f in fsample]

        for i = 2:N
            for j = 1:(i-1)
                coeff[i] = (coeff[j] - coeff[i]) / (xsample[j] - xsample[i])
            end
        end
        new(N-1, ntuple(i -> Float64(xsample[i]), N), tuple(coeff...))
    end
end

function InterpPolynomial(fn, xsample::T) where {T&lt;:Union{Vector{&lt;:Real},
                                                          NTuple{&lt;:Any, &lt;:Real}}}
    InterpPolynomial(xsample, map(fn, xsample))
end

function evpoly(p::Polynomial, z::Real)
    ans = p.coeff[end]
    for idx = p.degree:-1:1
        ans = p.coeff[idx] + z * ans
    end
    return ans
end

function evpoly(p::InterpPolynomial, z::Real)
    ans = p.coeff[p.degree+1]
    for idx = p.degree:-1:1
        ans = ans * (z - p.xval[idx]) + p.coeff[idx]
    end
    return ans
end

function Base.:+(p1::Polynomial, p2::Polynomial)
    # при сложении нужно учесть, какой должна быть наивысшая степень
    deg = max(p1.degree, p2.degree)
    coeff = zeros(deg+1)

    coeff[1:p1.degree+1] .+= p1.coeff
    coeff[1:p2.degree+1] .+= p2.coeff

    Polynomial(coeff)
end

function Base.:+(p1::InterpPolynomial, p2::InterpPolynomial)
    xmax = max(p1.xval..., p2.xval...)
    xmin = min(p1.xval..., p2.xval...)
    deg = max(p1.degree, p2.degree)
    # для построения суммы строим чебышёвскую сетку между минимальным
    # и максимальным из узлов обоих полиномов
    xmid = 0.5 * xmax + 0.5 * xmin
    dx = 0.5 * (xmax - xmin) / cos(0.5 * π / (deg + 1))
    chebgrid = [xmid + dx * cos((k - 0.5) * π / (deg + 1)) for k = 1:deg+1]
    fsample = [evpoly(p1, x) + evpoly(p2, x) for x in chebgrid]
    InterpPolynomial(chebgrid, fsample)
end

function Base.:+(p1::InterpPolynomial, p2::Polynomial)
    xmax = max(p1.xval...)
    xmin = min(p1.xval...)
    deg = max(p1.degree, p2.degree)
    xmid = 0.5 * xmax + 0.5 * xmin
    dx = 0.5 * (xmax - xmin) / cos(0.5 * π / (deg + 1))
    chebgrid = [xmid + dx * cos((k - 0.5) * π / (deg + 1)) for k = 1:deg+1]
    fsample = [evpoly(p1, x) + evpoly(p2, x) for x in chebgrid]
    InterpPolynomial(chebgrid, fsample)
end

function Base.:+(p1::Polynomial, p2::InterpPolynomial)
    p2 + p1
end
</code></pre><br/>
</div></div><br/>
Представление полинома в виде структуры не вполне соответствует его интуитивному пониманию как математической функции. Но с помощью возврата функционального значения можно задавать полиномы и напрямую как функции. Итак, было:<br/>
<br/>
<pre><code class="julia">struct Polynomial
    degree::Int
    coeff::NTuple{N, Float64} where N
    function Polynomial(v::T where T&lt;:Union{Vector{&lt;:Real},
                                            NTuple{&lt;:Any, &lt;:Real}})
        # в случае пустого массива / кортежа в аргументе возвращаем P(x) ≡ 0
        coeff = isempty(v) ? (0.0,) : tuple([Float64(x) for x in v]...)
        # возврат значения - специальным оператором new
        # аргументы - перечисление значений полей
        return new(length(coeff)-1, coeff)
    end
end

"""
    evpoly(p::Polynomial, z::Real)

Evaluate polynomial `p` at `z` using the Horner's rule
"""
function evpoly(p::Polynomial, z::Real)
    ans = p.coeff[end]
    for idx = p.degree:-1:1
        ans = p.coeff[idx] + z * ans
    end
    return ans
end
</code></pre><br/>
Переделаем это определение в функцию, которая принимает массив / кортеж коэффициентов и возвращает собственно функцию, вычисляющую полином:<br/>
<pre><code class="julia">function Polynomial_as_closure(v::T where T&lt;:Union{Vector{&lt;:Real},
                                        NTuple{&lt;:Any, &lt;:Real}})
    # в случае пустого массива / кортежа в аргументе возвращаем P(x) ≡ 0
    if isempty(v)
        return x::Real -> 0.0
    end
    
    coeff = tuple(map(float, v)...)
    degree = length(coeff) - 1
    
    function evpoly(z::Real)
        ans = coeff[end]
        for idx = degree:-1:1
            ans = coeff[idx] + z * ans
        end
        return ans
    end

    evpoly
end

julia> p = Polynomial_as_closure((0, 1, 1)) # x² + x
(::getfield(Main, Symbol("#evpoly#28")){Tuple{Float64,Float64,Float64},Int64}) (generic function with 1 method)

julia> p(1) # ура, можно обойтись без evpoly()!
2.0
julia> p(11)
132.0
</code></pre><br/>
Аналогично можно написать функцию и для интерполяционного полинома.<br/>
<br/>
Важный вопрос: а было ли в предыдущем определении что-то, что в новом потерялось? К сожалению, да — задание полинома как структуры давало подсказки для компилятора, а для нас — возможность перегрузить для этой структуры арифметические операторы. Для функций такой мощной системы типов Julia, увы, не предоставляет.<br/>
<br/>
К счастью, в этом случае мы можем взять лучшее из двух миров, поскольку Julia позволяет создавать так называемые callable structs. Т.е. можно задать полином как структуру, но иметь возможность его вызова как функции! К определениям структур из предыдущей статьи нужно лишь добавить:<br/>
<br/>
<pre><code class="julia">function (p::Polynomial)(z::Real)
    evpoly(p, z)
end

function (p::InterpPolynomial)(z::Real)
    evpoly(p, z)
end
</code></pre><br/>
С помощью функциональных аргументов можно также добавить внешний конструктор интерполяционного полинома для некоторой функции, построенный по набору точек:<br/>
<br/>
<pre><code class="julia">function InterpPolynomial(fn, xsample::T) where {T&lt;:Union{Vector{&lt;:Real},
                                                          NTuple{&lt;:Any, &lt;:Real}}}
    InterpPolynomial(xsample, map(fn, xsample))
end
</code></pre><br/>
<div class="spoiler"><b class="spoiler_title">Проверим определение</b><div class="spoiler_text"><pre><code class="julia">julia> psin = InterpPolynomial(sin, [0, π/6, π/2, 5*π/6, π]) # интерполяция синуса
InterpPolynomial(4, (0.0, 0.5235987755982988, 1.5707963267948966, 2.6179938779914944, 3.141592653589793), (0.0, 0.954929658551372, -0.30396355092701327, -0.05805276197975913, 0.036957536116863636))
julia> pcos = InterpPolynomial(cos, [0, π/6, π/2, 5*π/6, π]) # интерполяция косинуса
InterpPolynomial(4, (0.0, 0.5235987755982988, 1.5707963267948966, 2.6179938779914944, 3.141592653589793), (1.0, -0.2558726308373678, -0.36358673785585766, 0.1388799037738005, 5.300924469105863e-17))
julia> psum = pcos + psin 
InterpPolynomial(4, (3.141592653589793, 2.5416018461576297, 1.5707963267948966, 0.5999908074321635, 0.0), (-1.0, -1.2354929267138448, 0.03888175053443867, 0.1969326657535598, 0.03695753611686364))
julia> for x = range(0, π, length = 20)
           println("Error at x = ", x, ": ", abs(psum(x) - (sin(x) + cos(x))))
       end
Error at x = 0.0: 0.0
Error at x = 0.3490658503988659: 0.002748366490382681
Error at x = 0.6981317007977318: 0.0031870524474437723
Error at x = 1.0471975511965976: 0.006538414090220712
Error at x = 1.3962634015954636: 0.0033647273630357244
Error at x = 1.7453292519943295: 0.003570894863996865
Error at x = 2.0943951023931953: 0.007820939854677023
Error at x = 2.443460952792061: 0.004305934583281101
Error at x = 2.792526803190927: 0.00420977797025246
Error at x = 3.141592653589793: 1.1102230246251565e-16
</code></pre><br/>
</div></div><br/>
<h4>Заключение</h4><br/>
Возможности, позаимствованные в Julia из функционального программирования, дают бóльшую выразительность языка по сравнению с чисто императивным стилем. Представление структур в виде функций — способ более удобной и естественной записи математических понятий.</div></div> <!----> <!----></div> <div class="tm-article-presenter__meta"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bjulia%5D" class="tm-tags-list__link">julia</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D0%B8%5D" class="tm-tags-list__link">функции</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%B7%D0%B0%D0%BC%D1%8B%D0%BA%D0%B0%D0%BD%D0%B8%D1%8F%5D" class="tm-tags-list__link">замыкания</a></li></ul></div> <div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/hub/programming/" class="tm-hubs-list__link">
    Программирование
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/julia/" class="tm-hubs-list__link">
    Julia
  </a></li></ul></div></div></article></div> <!----></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 5: ↑5 и ↓0</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-rating"></use></svg> <span title="Всего голосов 5: ↑5 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_medium">+5</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">2.5K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    22
  </span></button> <!----> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> </div></div> <!----> <!----> <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/Pand5461/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><img alt="" src="//habrastorage.org/getpro/habr/avatars/0bd/d11/fe5/0bdd11fe540cb045ed967b6fc85cded8.jpg" class="tm-entity-image__pic"></div></a> <div class="tm-user-card__meta"><div title=" 82 голоса " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    57.7
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">0</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title_variant-article"><span class="tm-user-card__name tm-user-card__name_variant-article">Василий Писарев</span> <a href="/ru/users/Pand5461/" class="tm-user-card__nickname tm-user-card__nickname_variant-article">
          @Pand5461
        </a> <!----></div> <p class="tm-user-card__short-info tm-user-card__short-info_variant-article">Пользователь</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-article"><!----> <!----> <!----> <!----> <!----></div></div> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----></section> <div class="tm-article-blocks__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/post/451172/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментировать 
    </span></a> <!----></div></div></div> <div class="tm-ad-banner__container tm-page-article__banner"><!----> <div id="articleBottomBanner" class="tm-ad-banner"></div></div> <!----> <!----> <!----> <!----> </div></div></div></div></div> <div class="tm-page__sidebar"><div class="tm-layout-sidebar"><div class="tm-layout-sidebar__ads tm-layout-sidebar__ads_initial"><div class="tm-ad-banner__container tm-layout-sidebar__banner"><!----> <div id="sidebarBanner" class="tm-ad-banner"></div></div></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----> <!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/post/451172/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/post/451172/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"451172":{"id":"451172","timePublished":"2019-05-11T00:58:08+00:00","isCorporative":false,"lang":"ru","titleHtml":"Julia: функции и структуры-как-функции","leadData":{"textHtml":"Несмотря на то, что в языке Julia по замыслу отсутствует «классическое» объектно-ориентированное программирование с классами и методами, язык предоставляет средства абстрагирования, ключевую роль в которых играет система типов и элементы функционального программирования. Рассмотрим подробнее второй пункт.\u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше →","image":null},"editorVersion":"1.0","postType":"article","postLabels":[{"type":"tutorial","data":null}],"author":{"scoreStats":{"score":57.7,"votesCount":82},"rating":0,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"65525","alias":"Pand5461","fullname":"Василий Писарев","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F0bd\u002Fd11\u002Ffe5\u002F0bdd11fe540cb045ed967b6fc85cded8.jpg","speciality":null},"statistics":{"commentsCount":0,"favoritesCount":22,"readingCount":2549,"score":5,"votesCount":5},"hubs":[{"relatedData":null,"id":"359","alias":"programming","type":"collective","title":"Программирование","titleHtml":"Программирование","isProfiled":true},{"relatedData":null,"id":"18840","alias":"julia","type":"collective","title":"Julia","titleHtml":"Julia","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003EНесмотря на то, что в языке Julia по замыслу отсутствует «классическое» объектно-ориентированное программирование с классами и методами, язык предоставляет средства абстрагирования, ключевую роль в которых играет система типов и элементы функционального программирования. Рассмотрим подробнее второй пункт.\u003Cbr\u002F\u003E\r\n\u003Ca name=\"habracut\"\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\nКонцепция функций в Julia, вероятно, наиболее похожа на языки из семейства Lisp (если быть точнее, то ветки Lisp-1), и функции можно рассматривать на трёх уровнях: как подпрограммы, как абстракции к некоторой последовательности действий и как данные, представляющие эту абстракцию.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003EУровень 1. Функции как подпрограммы\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\nВыделение подпрограмм и присваивание им собственных имён идёт ещё с доисторических времён, когда Фортран считался языком высокого уровня, а Си ещё не было.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВ этом понимании средства Julia стандартны. «Особенностью» можно назвать то, что синтаксически нет деления на процедуры и функции. Вне зависимости от того, вызывается подпрограмма для получения некоторого значения или только для выполнения каких-то действий над данными — она называется функцией.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nОпределение функции начинается с ключевого слова \u003Ccode\u003Efunction\u003C\u002Fcode\u003E, за которым в скобках следует список аргументов, последовательность команд, и заканчивает определение слово \u003Ccode\u003Eend\u003C\u002Fcode\u003E:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"julia\"\u003E\"\"\"\n    sum_all(collection)\n\nSum all elements of a collection and return the result\n\"\"\"\nfunction sum_all(collection)\n    sum = 0\n    for item in collection\n        sum += collection\n    end\n    sum\nend\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nОтличительностью синтаксиса является унаследованное от Лиспа поведение: для «нормального» возврата значения из функции слово \u003Ccode\u003Ereturn\u003C\u002Fcode\u003E не обязательно: возвращается значение последнего вычисленного перед \u003Ccode\u003Eend\u003C\u002Fcode\u003E выражения. В примере выше будет возвращено значение переменной \u003Ccode\u003Esum\u003C\u002Fcode\u003E. Таким образом, \u003Ccode\u003Ereturn\u003C\u002Fcode\u003E может использоваться в качестве маркера особого поведения функции:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"julia\"\u003Efunction safe_division(number, divisor)\n    if divisor == 0\n        return 0\n    end\n    number \u002F divisor\nend\n\n# то же самое\nfunction safe_division1(number, divisor)\n    if divisor == 0\n        0 # при попадании в эту ветку до выхода из функции нет других инструкций\n    else\n        number \u002F divisor\n    end\nend\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nДля функций с коротким определением есть укороченный синтаксис, похожий на математическую запись. Так, вычисление длины гипотенузы по длине катетов можно определить так:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"julia\"\u003Ehypotenuse(a, b) = sqrt(a^2 + b^2)\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n«Безопасное» деление с помощью тернарного оператора можно записать так:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"julia\"\u003Esafe_division(number, divisor) = divisor == 0 ? 0 : number \u002F divisor\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nКак можно заметить, для аргументов функции не обязательно указывать типы. С учётом того, как работает JIT-компилятор Julia, «утиная типизация» даже не всегда будет приводить к падению производительности.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКак я постарался продемонстрировать в \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F450628\u002F\"\u003Eпредыдущей статье\u003C\u002Fa\u003E, компилятор Julia может выводить тип возвращаемого результата по типам входных аргументов. Поэтому, например, функция \u003Ccode\u003Esafe_division\u003C\u002Fcode\u003E для быстрой работы требует минимальной модификации:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"julia\"\u003Efunction safe_division(number, divisor)\n    if divisor == 0\n        return zero(number \u002F divisor)\n    end\n    number \u002F divisor\nend\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nТеперь, если типы обоих аргументов известны на этапе компиляции, тип возвращаемого результата также однозначно выводится, т.к. функция \u003Ccode\u003Ezero(x)\u003C\u002Fcode\u003E возвращает нулевое значение того же типа, что её аргумент (а деление на ноль, согласно \u003Ca href=\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FIEEE_754-1985#Representation_of_non-numbers\"\u003EIEEE 754\u003C\u002Fa\u003E, имеет вполне представимое значение в формате чисел с плавающей точкой).\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nФункции могут иметь фиксированное число позиционных аргументов, позиционные аргументы со значениями по умолчанию, именованные аргументы и переменное число аргументов. Синтаксис:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"julia\"\u003E# фиксированный список аргументов\nfunction hello(name)\n    println(\"Hello, \", name)\nend\n\n# аргумент со значением по умолчанию\n# аргументы со значением по умолчанию должны идти после обязательных аргументов\nfunction greeting_d(name, greeting = \"Hello\")\n    println(greeting, \", \", name)\nend\n\n# именованный аргумент со значением по умолчанию\n# именованные аргументы отделяются точкой с запятой и идут после\n# обязательных аргументов и опциональных позиционных аргументов\nfunction greeting_kw(name; greeting = \"Hello\")\n    println(greeting, \", \", name)\nend\n\n# аргумент greeting хоть и именованный, но должен обязательно быть предоставлен при вызове\nfunction greeting_oblkw(name; greeting)\n    println(greeting, \", \", name)\nend\n\n# функция с неопределённым числом аргументов\n# все аргументы, начиная со второго, в теле интерпретируются как кортеж names\nfunction greeting_nary(greeting, names...)\n    print(greeting)\n    for name in names\n        print(\", \", name)\n    end\n    print('\\n')\nend\n\njulia\u003E hello(\"world\")\nHello, world\n\njulia\u003E greeting_d(\"world\")\nHello, world\n\njulia\u003E greeting_d(\"Mr. Smith\", \"How do you do\")\nHow do you do, Mr. Smith\n\njulia\u003E greeting_kw(\"Mr. Smith\")\nHello, Mr. Smith\n\njulia\u003E greeting_kw(\"mom\", greeting = \"Hi\")\nHi, mom\n\njulia\u003E greeting_oblkw(\"world\")\nERROR: UndefKeywordError: keyword argument greeting not assigned\nStacktrace:\n [1] greeting_oblkw(::String) at .\u002FREPL[23]:3\n [2] top-level scope at none:0\n\njulia\u003E greeting_oblkw(\"mom\", greeting = \"Hi\")\nHi, mom\n\njulia\u003E greeting_nary(\"Hi\", \"mom\", \"dad\", \"everyone\")\nHi, mom, dad, everyone\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Ch3\u003EУровень 2. Функции как данные\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\nИмя функции может использоваться не только в непосредственных вызовах, но и как идентификатор, с которым связана процедура получения значения. Например:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"julia\"\u003Efunction f_x_x(fn, x)\n    fn(x, x)\nend\n\njulia\u003E f_x_x(+, 3)\n6 # +(3, 3) = 3+3 = 6\njulia\u003E f_x_x(*, 3)\n9 # *(3, 3) = 9\njulia\u003E f_x_x(^, 3)\n27 # ^(3, 3) = 3^3 = 27\njulia\u003E f_x_x(log, 3)\n1.0 # log(3, 3) = 1\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n«Классические» функции, которые принимают функциональный аргумент, — это \u003Ccode\u003Emap\u003C\u002Fcode\u003E, \u003Ccode\u003Ereduce\u003C\u002Fcode\u003E и \u003Ccode\u003Efilter\u003C\u002Fcode\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Emap(f, x...)\u003C\u002Fcode\u003E применяет функцию \u003Ccode\u003Ef\u003C\u002Fcode\u003E к значениям всех элементов из \u003Ccode\u003Ex\u003C\u002Fcode\u003E(или кортежам из i-х элементов) и возвращает результаты как новую коллекцию:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"julia\"\u003Ejulia\u003E map(cos, [0, π\u002F3, π\u002F2, 2*π\u002F3, π])\n5-element Array{Float64,1}:\n  1.0                  \n  0.5000000000000001   \n  6.123233995736766e-17\n -0.4999999999999998   \n -1.0\n\njulia\u003E map(+, (2, 3), (1, 1))\n(3, 4)\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Ereduce(f, x; init_val)\u003C\u002Fcode\u003E «сводит» коллекцию к одному значению, «разворачивая» цепочку \u003Ccode\u003Ef(f(...f(f(init_val, x[1]), x[2])...), x[end])\u003C\u002Fcode\u003E:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"julia\"\u003Efunction myreduce(fn, values, init_val)\n    accum = init_val\n    for x in values\n        accum = fn(accum, x)\n    end\n    accum\nend\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nПоскольку на самом деле не определено, в каком порядке будет проход массива при редукции, а также то, будет вызываться \u003Ccode\u003Efn(accum, x)\u003C\u002Fcode\u003E или \u003Ccode\u003Efn(x, accum)\u003C\u002Fcode\u003E, редукция будет давать предсказуемый результат только с коммутативными или ассоциативными операторами, типа сложения или умножения.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Efilter(predicate, x)\u003C\u002Fcode\u003E возвращает массив из элементов \u003Ccode\u003Ex\u003C\u002Fcode\u003E, которые удовлетворяют предикату \u003Ccode\u003Epredicate\u003C\u002Fcode\u003E:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"julia\"\u003Ejulia\u003E filter(isodd, 1:10)\n5-element Array{Int64,1}:\n 1\n 3\n 5\n 7\n 9\njulia\u003E filter(iszero, [[0], 1, 0.0, 1:-1, 0im])\n4-element Array{Any,1}:\n    [0] \n   0.0  \n    1:0 \n 0 + 0im\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nПрименение функций высшего порядка для операций над массивами вместо написания цикла имеет несколько преимуществ:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Col\u003E\r\n\u003Cli\u003E код становится короче \u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003Ccode\u003Emap()\u003C\u002Fcode\u003E или \u003Ccode\u003Ereduce()\u003C\u002Fcode\u003E показывают \u003Ci\u003Eсемантику\u003C\u002Fi\u003E выполняемой операции, тогда в семантике происходящего в цикле нужно ещё разбираться \u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003Ccode\u003Emap()\u003C\u002Fcode\u003E даёт компилятору понять, что операции над элементами массива независимы по данным, что позволяет применить дополнительные оптимизации \u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\r\n\u003Ch3\u003EУровень 3. Функции как абстракции\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\nНередко в \u003Ccode\u003Emap()\u003C\u002Fcode\u003E или \u003Ccode\u003Efilter()\u003C\u002Fcode\u003E нужно использовать функцию, которой не было присвоено собственное имя. Julia в этом случае позволяет выразить \u003Ci\u003Eабстракцию\u003C\u002Fi\u003E выполнения операций над аргументом, не вводя для этой последовательности собственное имя. Такая абстракция называется \u003Ci\u003Eанонимной функцией\u003C\u002Fi\u003E, или \u003Ci\u003Eлямбда-функцией\u003C\u002Fi\u003E (т.к. в математической традиции такие функции обозначаются буквой лямбда). Синтаксис этого представления такой:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"julia\"\u003E# именованная функция\nsquare(x) = x^2\n# анонимный аналог\nx -\u003E x^2\n\n# именованная функция\nhypot(a, b) = sqrt(x^2 + y^2)\n# анонимный аналог - если аргументов больше одного, вокруг них ставятся скобки,\n# чтобы не спутать с кортежем из переменной и анонимной функции от одной переменной\n(x, y) -\u003E sqrt(x^2 + y^2)\n\n# именованная функция\nfortytwo() = 42\n# анонимная функция\n() -\u003E 42\n\njulia\u003E map(i -\u003E map(x -\u003E x^i, 1:5), 1:5)\n5-element Array{Array{Int64,1},1}:\n [1, 2, 3, 4, 5]         \n [1, 4, 9, 16, 25]       \n [1, 8, 27, 64, 125]     \n [1, 16, 81, 256, 625]   \n [1, 32, 243, 1024, 3125]\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nКак именованные, так и анонимные функции можно присваивать переменным и возвращать в качестве значений:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"julia\"\u003Ejulia\u003E double_squared = x -\u003E (2 * x)^2\n#17 (generic function with 1 method)\n\njulia\u003E double_squared(5)\n100\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Ch3\u003EОбласть видимости переменных и лексические замыкания\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\nВ норме функции стараются писать таким образом, чтобы все необходимые для вычисления данные были получены через формальные аргументы, т.е. любые имена переменных, которые встречаются в теле — это либо имена формальных аргументов, либо имена переменных, вводимых внутри тела функции.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"julia\"\u003Efunction normal(x, y)\n    z = x + y\n    x + y * z\nend\n\nfunction strange(x, y)\n    x + y * z\nend\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nПро функцию \u003Ccode\u003Enormal()\u003C\u002Fcode\u003E можно сказать, что в её теле все имена переменных \u003Ci\u003Eсвязанные\u003C\u002Fi\u003E, т.е. если мы везде (включая список аргументов) заменим «x» на «m» (или любой другой идентификатор), «y» на «n», а «z» на «sum_of_m_and_n» — смысл выражения не поменяется. В функции \u003Ccode\u003Estrange()\u003C\u002Fcode\u003E имя z является \u003Ci\u003Eнесвязанным\u003C\u002Fi\u003E, т.е. а) смысл может поменяться, если это имя будет заменено на другое и б) корректность функции зависит от того, была ли на момент вызова функции определена переменная с именем «z».\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВообще говоря, с функцией \u003Ccode\u003Enormal()\u003C\u002Fcode\u003E тоже не всё так чисто:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Col\u003E\r\n\u003Cli\u003E Что будет, если вне функции определена переменная с именем z?\u003C\u002Fli\u003E\r\n\u003Cli\u003E Символы + и *, вообще-то, тоже являются несвязанными идентификаторами.\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\r\nС пунктом 2 ничего нельзя поделать, кроме как согласиться — логично, что определения всех используемых функций в системе должны существовать, и будем надеяться, что их реальный смысл соответствует нашим ожиданиям.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПункт 1 менее очевиден, чем кажется. Дело в том, что ответ зависит от того, где определена функция. Если она определена глобально, то \u003Ccode\u003Ez\u003C\u002Fcode\u003E внутри \u003Ccode\u003Enormal()\u003C\u002Fcode\u003E будет локальной переменной, т.е. даже при наличии глобальной переменной \u003Ccode\u003Ez\u003C\u002Fcode\u003E её значение не перезапишется. Если же определение функции находится внутри блока кода, то при наличии в этом блоке более раннего определения \u003Ccode\u003Ez\u003C\u002Fcode\u003E будет изменено именно значение внешней переменной.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЕсли тело функции содержит имя внешней переменной, то это имя связывается с тем значением, которое существовало в окружении, где создана функция. Если сама функция экспортируется из этого окружения (например, если она возвращается из другой функции в качестве значения), то она «захватывает» переменную из внутреннего окружения, к которой в новом окружении доступа уже нет. Это называется лексическим замыканием.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗамыкания в основном полезны в двух ситуациях: когда нужно создать функцию по заданным параметрам и когда нужна функция, которая имеет некоторое внутреннее состояние.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nРассмотрим ситуацию с функцией, инкапсулирующей внутреннее состояние:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"julia\"\u003Efunction f_with_counter(fn)\n    call_count = 0\n    ncalls() = call_count\n    # invoke() будет подсчитывать, сколько раз она вызвана\n    # получить это значение можно, вызвав ncalls()\n    function invoke(args...)\n        call_count += 1\n        fn(args...)\n    end\n    # возвращаем обе функции как кортеж с именованными полями\n    # call_count теперь будет извне недоступна напрямую,\n    # но экспортированные invoke() и call_count() имеют к нему доступ и могут менять\n    (call = invoke, call_count = ncalls)\nend\n\njulia\u003E abscount = f_with_counter(abs)\n(call = getfield(Main, Symbol(\"#invoke#22\")){typeof(abs)}(abs, Core.Box(0)), call_count = getfield(Main, Symbol(\"#ncalls#21\"))(Core.Box(0)))\njulia\u003E abscount.call_count()\n0\njulia\u003E abscount.call(-20)\n20\njulia\u003E abscount.call_count()\n1\njulia\u003E abscount.call(im)\n1.0\njulia\u003E abscount.call_count()\n2\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Ch4\u003ECase study: всё те же полиномы\u003C\u002Fh4\u003E\u003Cbr\u002F\u003E\r\nВ \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F450628\u002F\"\u003Eпрошлой статье\u003C\u002Fa\u003E рассмотрено представление полиномов как структур. В частности, одна из структур хранения — это список коэффициентов, начиная с младшего. Для вычисления полинома \u003Ccode\u003Ep\u003C\u002Fcode\u003E в точке \u003Ccode\u003Ex\u003C\u002Fcode\u003E предлагалось вызвать функцию \u003Ccode\u003Eevpoly(p, x)\u003C\u002Fcode\u003E, которая вычисляет полином по схеме Горнера.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\"\u003E\u003Cb class=\"spoiler_title\"\u003EПолный код определений\u003C\u002Fb\u003E\u003Cdiv class=\"spoiler_text\"\u003E\u003Cpre\u003E\u003Ccode class=\"julia\"\u003Eabstract type AbstractPolynomial end\n\n\"\"\"\n    Polynomial &lt;: AbstractPolynomial\n\nPolynomials written in the canonical form\n\n---\n\n    Polynomial(v::T) where T&lt;:Union{Vector{&lt;:Real}, NTuple{&lt;:Any, &lt;:Real}})\n\nConstruct a `Polynomial` from the list of the coefficients. The coefficients are assumed to go from power 0 in the ascending order. If an empty collection is provided, the constructor returns a zero polynomial.\n\"\"\"\nstruct Polynomial&lt;:AbstractPolynomial\n    degree::Int\n    coeff::NTuple{N, Float64} where N\n    function Polynomial(v::T where T&lt;:Union{Vector{&lt;:Real},\n                                            NTuple{&lt;:Any, &lt;:Real}})\n        coeff = isempty(v) ? (0.0,) : tuple([Float64(x) for x in v]...)\n        return new(length(coeff)-1, coeff)\n    end\nend\n\n\"\"\"\n    InterpPolynomial &lt;: AbstractPolynomial\n\nInterpolation polynomials in Newton's form\n\n---\n\n    InterpPolynomial(xsample::Vector{&lt;:Real}, fsample::Vector{&lt;:Real})\n\nConstruct an `InterpPolynomial` from a vector of points `xsample` and corresponding function values `fsample`. All values in `xsample` must be distinct.\n\"\"\"\nstruct InterpPolynomial&lt;:AbstractPolynomial\n    degree::Int\n    xval::NTuple{N, Float64} where N\n    coeff::NTuple{N, Float64} where N\n    function InterpPolynomial(xsample::X,\n                              fsample::F) where {X&lt;:Union{Vector{&lt;:Real},\n                                                          NTuple{&lt;:Any, &lt;:Real}},\n                                                 F&lt;:Union{Vector{&lt;:Real},\n                                                          NTuple{&lt;:Any, &lt;:Real}}}\n        if !allunique(xsample)\n            throw(DomainError(\"Cannot interpolate with duplicate X points\"))\n        end\n        N = length(xsample)\n        if length(fsample) != N\n            throw(DomainError(\"Lengths of X and F are not the same\"))\n        end\n\n        coeff = [Float64(f) for f in fsample]\n\n        for i = 2:N\n            for j = 1:(i-1)\n                coeff[i] = (coeff[j] - coeff[i]) \u002F (xsample[j] - xsample[i])\n            end\n        end\n        new(N-1, ntuple(i -\u003E Float64(xsample[i]), N), tuple(coeff...))\n    end\nend\n\nfunction InterpPolynomial(fn, xsample::T) where {T&lt;:Union{Vector{&lt;:Real},\n                                                          NTuple{&lt;:Any, &lt;:Real}}}\n    InterpPolynomial(xsample, map(fn, xsample))\nend\n\nfunction evpoly(p::Polynomial, z::Real)\n    ans = p.coeff[end]\n    for idx = p.degree:-1:1\n        ans = p.coeff[idx] + z * ans\n    end\n    return ans\nend\n\nfunction evpoly(p::InterpPolynomial, z::Real)\n    ans = p.coeff[p.degree+1]\n    for idx = p.degree:-1:1\n        ans = ans * (z - p.xval[idx]) + p.coeff[idx]\n    end\n    return ans\nend\n\nfunction Base.:+(p1::Polynomial, p2::Polynomial)\n    # при сложении нужно учесть, какой должна быть наивысшая степень\n    deg = max(p1.degree, p2.degree)\n    coeff = zeros(deg+1)\n\n    coeff[1:p1.degree+1] .+= p1.coeff\n    coeff[1:p2.degree+1] .+= p2.coeff\n\n    Polynomial(coeff)\nend\n\nfunction Base.:+(p1::InterpPolynomial, p2::InterpPolynomial)\n    xmax = max(p1.xval..., p2.xval...)\n    xmin = min(p1.xval..., p2.xval...)\n    deg = max(p1.degree, p2.degree)\n    # для построения суммы строим чебышёвскую сетку между минимальным\n    # и максимальным из узлов обоих полиномов\n    xmid = 0.5 * xmax + 0.5 * xmin\n    dx = 0.5 * (xmax - xmin) \u002F cos(0.5 * π \u002F (deg + 1))\n    chebgrid = [xmid + dx * cos((k - 0.5) * π \u002F (deg + 1)) for k = 1:deg+1]\n    fsample = [evpoly(p1, x) + evpoly(p2, x) for x in chebgrid]\n    InterpPolynomial(chebgrid, fsample)\nend\n\nfunction Base.:+(p1::InterpPolynomial, p2::Polynomial)\n    xmax = max(p1.xval...)\n    xmin = min(p1.xval...)\n    deg = max(p1.degree, p2.degree)\n    xmid = 0.5 * xmax + 0.5 * xmin\n    dx = 0.5 * (xmax - xmin) \u002F cos(0.5 * π \u002F (deg + 1))\n    chebgrid = [xmid + dx * cos((k - 0.5) * π \u002F (deg + 1)) for k = 1:deg+1]\n    fsample = [evpoly(p1, x) + evpoly(p2, x) for x in chebgrid]\n    InterpPolynomial(chebgrid, fsample)\nend\n\nfunction Base.:+(p1::Polynomial, p2::InterpPolynomial)\n    p2 + p1\nend\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nПредставление полинома в виде структуры не вполне соответствует его интуитивному пониманию как математической функции. Но с помощью возврата функционального значения можно задавать полиномы и напрямую как функции. Итак, было:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"julia\"\u003Estruct Polynomial\n    degree::Int\n    coeff::NTuple{N, Float64} where N\n    function Polynomial(v::T where T&lt;:Union{Vector{&lt;:Real},\n                                            NTuple{&lt;:Any, &lt;:Real}})\n        # в случае пустого массива \u002F кортежа в аргументе возвращаем P(x) ≡ 0\n        coeff = isempty(v) ? (0.0,) : tuple([Float64(x) for x in v]...)\n        # возврат значения - специальным оператором new\n        # аргументы - перечисление значений полей\n        return new(length(coeff)-1, coeff)\n    end\nend\n\n\"\"\"\n    evpoly(p::Polynomial, z::Real)\n\nEvaluate polynomial `p` at `z` using the Horner's rule\n\"\"\"\nfunction evpoly(p::Polynomial, z::Real)\n    ans = p.coeff[end]\n    for idx = p.degree:-1:1\n        ans = p.coeff[idx] + z * ans\n    end\n    return ans\nend\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nПеределаем это определение в функцию, которая принимает массив \u002F кортеж коэффициентов и возвращает собственно функцию, вычисляющую полином:\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"julia\"\u003Efunction Polynomial_as_closure(v::T where T&lt;:Union{Vector{&lt;:Real},\n                                        NTuple{&lt;:Any, &lt;:Real}})\n    # в случае пустого массива \u002F кортежа в аргументе возвращаем P(x) ≡ 0\n    if isempty(v)\n        return x::Real -\u003E 0.0\n    end\n    \n    coeff = tuple(map(float, v)...)\n    degree = length(coeff) - 1\n    \n    function evpoly(z::Real)\n        ans = coeff[end]\n        for idx = degree:-1:1\n            ans = coeff[idx] + z * ans\n        end\n        return ans\n    end\n\n    evpoly\nend\n\njulia\u003E p = Polynomial_as_closure((0, 1, 1)) # x² + x\n(::getfield(Main, Symbol(\"#evpoly#28\")){Tuple{Float64,Float64,Float64},Int64}) (generic function with 1 method)\n\njulia\u003E p(1) # ура, можно обойтись без evpoly()!\n2.0\njulia\u003E p(11)\n132.0\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nАналогично можно написать функцию и для интерполяционного полинома.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВажный вопрос: а было ли в предыдущем определении что-то, что в новом потерялось? К сожалению, да — задание полинома как структуры давало подсказки для компилятора, а для нас — возможность перегрузить для этой структуры арифметические операторы. Для функций такой мощной системы типов Julia, увы, не предоставляет.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nК счастью, в этом случае мы можем взять лучшее из двух миров, поскольку Julia позволяет создавать так называемые callable structs. Т.е. можно задать полином как структуру, но иметь возможность его вызова как функции! К определениям структур из предыдущей статьи нужно лишь добавить:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"julia\"\u003Efunction (p::Polynomial)(z::Real)\n    evpoly(p, z)\nend\n\nfunction (p::InterpPolynomial)(z::Real)\n    evpoly(p, z)\nend\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nС помощью функциональных аргументов можно также добавить внешний конструктор интерполяционного полинома для некоторой функции, построенный по набору точек:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"julia\"\u003Efunction InterpPolynomial(fn, xsample::T) where {T&lt;:Union{Vector{&lt;:Real},\n                                                          NTuple{&lt;:Any, &lt;:Real}}}\n    InterpPolynomial(xsample, map(fn, xsample))\nend\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\"\u003E\u003Cb class=\"spoiler_title\"\u003EПроверим определение\u003C\u002Fb\u003E\u003Cdiv class=\"spoiler_text\"\u003E\u003Cpre\u003E\u003Ccode class=\"julia\"\u003Ejulia\u003E psin = InterpPolynomial(sin, [0, π\u002F6, π\u002F2, 5*π\u002F6, π]) # интерполяция синуса\nInterpPolynomial(4, (0.0, 0.5235987755982988, 1.5707963267948966, 2.6179938779914944, 3.141592653589793), (0.0, 0.954929658551372, -0.30396355092701327, -0.05805276197975913, 0.036957536116863636))\njulia\u003E pcos = InterpPolynomial(cos, [0, π\u002F6, π\u002F2, 5*π\u002F6, π]) # интерполяция косинуса\nInterpPolynomial(4, (0.0, 0.5235987755982988, 1.5707963267948966, 2.6179938779914944, 3.141592653589793), (1.0, -0.2558726308373678, -0.36358673785585766, 0.1388799037738005, 5.300924469105863e-17))\njulia\u003E psum = pcos + psin \nInterpPolynomial(4, (3.141592653589793, 2.5416018461576297, 1.5707963267948966, 0.5999908074321635, 0.0), (-1.0, -1.2354929267138448, 0.03888175053443867, 0.1969326657535598, 0.03695753611686364))\njulia\u003E for x = range(0, π, length = 20)\n           println(\"Error at x = \", x, \": \", abs(psum(x) - (sin(x) + cos(x))))\n       end\nError at x = 0.0: 0.0\nError at x = 0.3490658503988659: 0.002748366490382681\nError at x = 0.6981317007977318: 0.0031870524474437723\nError at x = 1.0471975511965976: 0.006538414090220712\nError at x = 1.3962634015954636: 0.0033647273630357244\nError at x = 1.7453292519943295: 0.003570894863996865\nError at x = 2.0943951023931953: 0.007820939854677023\nError at x = 2.443460952792061: 0.004305934583281101\nError at x = 2.792526803190927: 0.00420977797025246\nError at x = 3.141592653589793: 1.1102230246251565e-16\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Ch4\u003EЗаключение\u003C\u002Fh4\u003E\u003Cbr\u002F\u003E\r\nВозможности, позаимствованные в Julia из функционального программирования, дают бóльшую выразительность языка по сравнению с чисто императивным стилем. Представление структур в виде функций — способ более удобной и естественной записи математических понятий.\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"julia"},{"titleHtml":"функции"},{"titleHtml":"замыкания"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F451172\u002F4235095bfdd3cf0eb0620a47bf7bdaba\u002F","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F451172\u002F4235095bfdd3cf0eb0620a47bf7bdaba\u002F?format=vk","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F451172\\\u002F\"},\"headline\":\"Julia: функции и структуры-как-функции\",\"datePublished\":\"2019-05-11T03:58:08+03:00\",\"dateModified\":\"2019-05-11T11:23:22+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"Василий Писарев\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"Несмотря на то, что в языке Julia по замыслу отсутствует &laquo;классическое&raquo; объектно-ориентированное программирование с классами и методами, язык предоставляет средс...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F451172\\\u002F#post-content-body\",\"about\":[\"h_programming\",\"h_julia\",\"f_develop\"],\"image\":[\"https:\\\u002F\\\u002Fhabr.com\\\u002Fshare\\\u002Fpublication\\\u002F451172\\\u002F4235095bfdd3cf0eb0620a47bf7bdaba\\\u002F\"]}","metaDescription":"Несмотря на то, что в языке Julia по замыслу отсутствует «классическое» объектно-ориентированное программирование с классами и методами, язык предоставляет средства абстрагирования, ключевую роль в...","mainImageUrl":null,"amp":false},"polls":[],"commentsEnabled":true,"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[],"hubs":"programming,julia"},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.c0af73e7.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
