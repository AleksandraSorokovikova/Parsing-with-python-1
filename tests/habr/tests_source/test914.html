<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Создание процедурного генератора головоломок / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.c0af73e7.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.85eb77f0b17c8235e7b64b9f81ea5ec2.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/post\/452090\/"},"headline":"Создание процедурного генератора головоломок","datePublished":"2019-05-20T12:20:08+03:00","dateModified":"2019-05-20T12:23:03+03:00","author":{"@type":"Person","name":"PatientZero"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"В этом посте описывается генератор уровней для моей игры-головоломки Linjat. Пост можно читать и без подготовки, но он легче усвоится, если сыграть в несколько у...","url":"https:\/\/habr.com\/ru\/post\/452090\/#post-content-body","about":["h_gamedev","h_algorithms","h_game_design","f_develop","f_design"],"image":["https:\/\/habrastorage.org\/getpro\/habr\/post_images\/641\/0d0\/547\/6410d0547bc14faae51beb3942867cb0.png","https:\/\/habrastorage.org\/getpro\/habr\/post_images\/7e1\/3ce\/91c\/7e13ce91c2da2e2d64bd98f523010671.png","https:\/\/habrastorage.org\/getpro\/habr\/post_images\/76d\/1d4\/e3e\/76d1d4e3e87a0cc9efdebbd586420c84.png","https:\/\/habrastorage.org\/getpro\/habr\/post_images\/a15\/db3\/05f\/a15db305fa78a149ee614de0b4b8ed54.png","https:\/\/habrastorage.org\/getpro\/habr\/post_images\/5ef\/048\/99f\/5ef04899f1c9da5a5b8492e1316ddcbf.png","https:\/\/habrastorage.org\/getpro\/habr\/post_images\/02c\/bfa\/021\/02cbfa02113362bc6e3c5217baee3ff3.png","https:\/\/habrastorage.org\/getpro\/habr\/post_images\/2af\/1de\/cfb\/2af1decfbc170ec8965ae8b1cce2cbea.png","https:\/\/habrastorage.org\/getpro\/habr\/post_images\/9c4\/c18\/772\/9c4c187726bf50f03bbffa748137cf44.png","https:\/\/habrastorage.org\/getpro\/habr\/post_images\/8cf\/164\/3c5\/8cf1643c568477bc2c774d33a0994f96.png","https:\/\/habrastorage.org\/getpro\/habr\/post_images\/64f\/9b4\/a5c\/64f9b4a5c022b2560c1a26746a0c3539.png","https:\/\/habrastorage.org\/getpro\/habr\/post_images\/1b4\/397\/23f\/1b439723f7d229887c8392ebc07053f3.png","https:\/\/habrastorage.org\/getpro\/habr\/post_images\/6b2\/3a0\/48d\/6b23a048dc66700a3eadf94206705c7c.png","https:\/\/habrastorage.org\/getpro\/habr\/post_images\/b8e\/b9a\/77a\/b8eb9a77a027a741ce259a1b95fe9c89.png","https:\/\/habrastorage.org\/getpro\/habr\/post_images\/504\/e61\/40c\/504e6140c20049ca3424456de0985aaf.png","https:\/\/habrastorage.org\/getpro\/habr\/post_images\/af9\/ecf\/34f\/af9ecf34f96e0d74ae1f514207940020.png","https:\/\/habrastorage.org\/getpro\/habr\/post_images\/d7d\/d45\/ebd\/d7dd45ebd5d0a7aebbc78e7da61e1cd9.png","https:\/\/habrastorage.org\/getpro\/habr\/post_images\/252\/fc8\/13e\/252fc813e342f503a2c189645590e7f1.png"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.49.0">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="Создание процедурного генератора головоломок" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Создание процедурного генератора головоломок" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Создание процедурного генератора головоломок" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="В этом посте описывается генератор уровней для моей игры-головоломки Linjat. Пост можно читать и без подготовки, но он легче усвоится, если сыграть в несколько уровней. Исходный код я выложил на..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="В этом посте описывается генератор уровней для моей игры-головоломки Linjat. Пост можно читать и без подготовки, но он легче усвоится, если сыграть в несколько уровней. Исходный код я выложил на..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="В этом посте описывается генератор уровней для моей игры-головоломки Linjat. Пост можно читать и без подготовки, но он легче усвоится, если сыграть в несколько уровней. Исходный код я выложил на..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="В этом посте описывается генератор уровней для моей игры-головоломки Linjat. Пост можно читать и без подготовки, но он легче усвоится, если сыграть в несколько уровней. Исходный код я выложил на..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="В этом посте описывается генератор уровней для моей игры-головоломки Linjat. Пост можно читать и без подготовки, но он легче усвоится, если сыграть в несколько уровней. Исходный код я выложил на..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habr.com/share/publication/452090/29b0f226fa5814c2a17e01dbe90424b0/" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habr.com/share/publication/452090/29b0f226fa5814c2a17e01dbe90424b0/" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habr.com/share/publication/452090/29b0f226fa5814c2a17e01dbe90424b0/" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habr.com/share/publication/452090/29b0f226fa5814c2a17e01dbe90424b0/" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habr.com/share/publication/452090/29b0f226fa5814c2a17e01dbe90424b0/" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="452090" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2019-05-20T09:20:08.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/452090/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/post/452090/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habr.com/share/publication/452090/29b0f226fa5814c2a17e01dbe90424b0/" data-vmid="image:href">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
            Как стать автором
          </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" data-async-called="true" class="tm-page"><div class="tm-page-width"><!----> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/PatientZero/" title="PatientZero" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="" height="24" loading="lazy" src="//habrastorage.org/r/w32/getpro/habr/avatars/8de/9c5/34a/8de9c534a18a6cb8693270a2b528d4c0.png" width="24" class="tm-entity-image__pic"></div></a> <span class="tm-user-info__user"><a href="/ru/users/PatientZero/" class="tm-user-info__username">
      PatientZero
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2019-05-20T09:20:08.000Z" title="2019-05-20, 12:20">20  мая  2019 в 12:20</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>Создание процедурного генератора головоломок</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/gamedev/" class="tm-article-snippet__hubs-item-link"><span>Разработка игр</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/algorithms/" class="tm-article-snippet__hubs-item-link"><span>Алгоритмы</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/game_design/" class="tm-article-snippet__hubs-item-link"><span>Дизайн игр</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <div class="tm-article-snippet__labels"><div class="tm-article-snippet__label"><span>
        Перевод
      </span></div></div> <!----> <!----></div></div> <div class="tm-article-presenter__origin"><a href="https://www.snellman.net/blog/archive/2019-05-14-procedural-puzzle-generator/" target="_blank" class="tm-article-presenter__origin-link">
                Автор оригинала:
                <span>
                  Juho Snellman
                </span></a></div> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-1"><div xmlns="http://www.w3.org/1999/xhtml">В этом посте описывается генератор уровней для моей игры-головоломки <a href="https://linjat.snellman.net">Linjat</a>. Пост можно читать и без подготовки, но он легче усвоится, если сыграть в несколько уровней. Исходный код я <a href="https://github.com/jsnell/linjat/">выложил на github</a>; всё обсуждаемое в статье находится в файле <code>src/main.cc</code>.<br/>
<br/>
Примерный план поста:<br/>
<br/>
<ul>
<li>Linjat — это логическая игра, в которой нужно закрыть все числа и точки в сетке линиями.</li>
<li>Головоломки процедурно генерируются при помощи комбинации из солвера, генератора и оптимизатора.</li>
<li>Солвер пытается решить головоломки так, как это делал бы человек, и присваивает каждой головоломке оценку интересности.</li>
<li>Генератор головоломок создан таким образом, чтобы можно было с лёгкостью менять одну часть головоломки (числа) и при этом все остальные части (точки) менялись таким образом, чтобы головоломка оставалась решаемой.</li>
<li>Оптимизатор головоломок многократно решает уровни и генерирует новые вариации из наиболее интересных, найденных на текущий момент.</li>
</ul><br/>
<h3>Правила</h3><br/>
Чтобы понять, как работает генератор уровней, нужно, к сожалению, разобраться с правилами игры. К счастью, они очень просты. Головоломка состоит из сетки, содержащей пустые квадраты, числа и точки. Пример:<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" data-src="https://habrastorage.org/getpro/habr/post_images/641/0d0/547/6410d0547bc14faae51beb3942867cb0.png"/></div><br/>
Цель игрока — прочертить вертикальную или горизонтальную линию через каждое из чисел при соблюдении трёх условий:<br/>
<br/>
<ul>
<li>Линия, идущая через число, должна иметь ту же длину, что и число.</li>
<li>Линии не могут пересекаться.</li>
<li>Все точки необходимо закрыть линиями.</li>
</ul><br/>
Пример решения:<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" data-src="https://habrastorage.org/getpro/habr/post_images/7e1/3ce/91c/7e13ce91c2da2e2d64bd98f523010671.png"/></div><br/>
Ура! Дизайн игры готов, UI реализован, и теперь единственное, что осталось — найти несколько сотен хороших головоломок. А для подобных игр обычно не имеет смысла пытаться создавать такие головоломки вручную. Это работа для компьютера.<br/>
<a name="habracut"></a><br/>
<h3>Требования</h3><br/>
Что делает головоломку для этой игры хорошей? Я склонен считать, что игры-головоломки можно разбить на две категории. Есть игры, в которых ты исследуешь сложное пространство состояний от начала до конца (например, <a href="https://en.wikipedia.org/wiki/Sokoban">Sokoban</a> или <a href="https://en.wikipedia.org/wiki/Rush_Hour_(puzzle)">Rush Hour</a>), и в которых может быть и не очевидно, какие состояния существуют в игре. И есть игры, в которых все состояния известны с самого начала, и мы постепенно вылепливаем пространство состояний с помощью процесса устранения лишних (например, <a href="https://en.wikipedia.org/wiki/Sudoku">Sudoku</a> или <a href="https://en.wikipedia.org/wiki/Nonogram">Picross</a>). Моя игра определённо относится ко второй категории.<br/>
<br/>
Игроки предъявляют очень отличающиеся требования к этим разным видам головоломок. Во втором случае они ожидают, что головоломку можно решить только дедукцией, и что им никогда не понадобится возврат назад/угадывание/процесс проб и ошибок<sup>[0]</sup><sup>[1]</sup>.<br/>
<br/>
Недостаточно знать, можно ли решить головоломку только с помощью логики. Кроме того, нам нужно как-то понять, насколько хороши создаваемые головоломки. В противном случае большинство уровней будет просто тривиальным шлаком. В идеальной ситуации этот принцип можно было использовать также для создания плавной кривой прогресса, чтобы при прохождении игроком игры уровни постепенно становились сложнее.<br/>
<br/>
<h3>Солвер</h3><br/>
Первый шаг к удовлетворению этих требований — создание солвера игры, оптимизированного для этой цели. Солвер грубого перебора с возвратом назад (backtracking) позволит быстро и точно определить, решаема ли головоломка; кроме того, его можно модифицировать, чтобы он определял, является ли решение уникальным. Но он не может дать представления о том, насколько сложна на самом деле головоломка, потому что люди решают их по-другому. Солвер должен имитировать поведение человека.<br/>
<br/>
Как же человек решает эту головоломку? Вот пара очевидных ходов, которым учит внутриигровой туториал:<br/>
<br/>
<ul>
<li>Если точки можно достичь только из одного числа, то для закрытия точки нужно протянуть линию из этого числа. В этом примере точку можно достичь только из тройки, но не из четвёрки:<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" data-src="https://habrastorage.org/getpro/habr/post_images/76d/1d4/e3e/76d1d4e3e87a0cc9efdebbd586420c84.png"/></div><br/>
И это приводит к такой ситуации:<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" data-src="https://habrastorage.org/getpro/habr/post_images/a15/db3/05f/a15db305fa78a149ee614de0b4b8ed54.png"/></div></li>
<li>Если линия не помещается в одном направлении, то её нужно расположить в другом. В показанном выше примере четвёрку больше нельзя расположить вертикально, поэтому мы знаем, что она будет горизонтальной:<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" data-src="https://habrastorage.org/getpro/habr/post_images/5ef/048/99f/5ef04899f1c9da5a5b8492e1316ddcbf.png"/></div></li>
<li>Если известно, что линия длины X должна находиться в определённом положении (вертикаль/горизонталь) и недостаточно пустого пространства, чтобы разместить линию из X пустых клеток по обеим сторонам, то нужно покрыть несколько квадратов посередине. Если бы в показанном выше примере четвёрка была тройкой, то мы бы не знали, растягивается ли она до упора вправо или влево. Но мы бы знали, что линия должна закрывать два средних квадрата:<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" data-src="https://habrastorage.org/getpro/habr/post_images/02c/bfa/021/02cbfa02113362bc6e3c5217baee3ff3.png"/></div></li>
</ul><br/>
Подобные рассуждения — самая основа игры. Игрок ищет способы растянуть немного одну линию, а затем снова изучает поле, потому что оно может дать ему информацию, чтобы сделать ещё один логический вывод. Создания солвера, следующего этим правилам, будет достаточно, чтобы определить, <i>сможет ли</i> человек решить головоломку без возврата назад.<br/>
<br/>
Однако это ничего не говорит нам о сложности или интересности уровня. Кроме решаемости, нам каким-то образом нужно численно оценить сложность.<br/>
<br/>
Очевидная первая идея для функции оценки: чем больше ходов требуется для решения головоломки, тем она сложнее. Вероятно, в других играх это хорошая метрика, но моей, скорее всего, важнее количество допустимых ходов, которые есть у игрока. Если игрок может сделать 10 логических выводов, то он, скорее всего, найдёт один из них очень быстро. Если верный ход только один, то это потребует больше времени.<br/>
<br/>
То есть в качестве первой аппроксимации нам нужно, чтобы дерево решений было глубоким и узким: есть длинная зависимость ходов от начала до конца, и в каждый момент времени есть только малое количество способов продвинуться вверх по цепочке<sup>[2]</sup>.<br/>
<br/>
Как нам определить ширину и глубину дерева? Однократное решение головоломки и оценка созданного дерева не дадут точного ответа. Точный порядок делаемых ходов влияет на форму дерева. Нам нужно рассмотреть все возможные решения и сделать с ними что-то вроде оптимизации по лучшим и худшим случаям. Мне знакома техника <a href="https://www.snellman.net/blog/archive/2018-07-23-optimizing-breadth-first-search/">грубого перебора графов поиска в играх-головоломках</a>, но для этого проекта я хотел создать однопроходной солвер, а не какой-то исчерпывающий поиск. Из-за фазы оптимизации я стремился к тому, чтобы время выполнения солвера измерялось не в секундах, а в миллисекундах.<br/>
<br/>
Я решил этого не делать. Вместо этого мой солвер на самом деле не делает один ход за раз, а решает головоломку по слоям: взяв состояние, он находит все допустимые ходы, которые можно сделать. Затем применяет все эти ходы одновременно и начинает заново в новом состоянии. Количество слоёв и максимальное число ходов, найденное на одном слое, затем используются как приближенные значения глубины и ширины дерева поиска в целом.<br/>
<br/>
Вот как при этой модели выглядит решение одной из сложных головоломок. Пунктирные линии — это линии, растянутые на этом слое солвера, сплошные — те, которые не менялись. Зелёные линии имеют правильную длину, красные ещё не завершены.<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" data-src="https://habrastorage.org/getpro/habr/post_images/2af/1de/cfb/2af1decfbc170ec8965ae8b1cce2cbea.png"/></div><br/>
Следующая проблема заключается в том, что все делаемые игроком ходы создаются равными. То, что мы перечислили в начале этого раздела — просто здравый смысл. Вот пример более сложного правила дедукции, на поиск которого потребуется немного больше размышлений. Рассмотрим такое поле:<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" data-src="https://habrastorage.org/getpro/habr/post_images/9c4/c18/772/9c4c187726bf50f03bbffa748137cf44.png"/></div><br/>
Точки в C и D можно покрыть только пятёркой и средней четвёркой (и ни одно число не может покрыть обе точки одновременно). Это значит, что четвёрка посередине должна покрыть одну точку из двух, а значит не может быть использовала для покрытия A. Следовательно, точку A должна закрыть четвёрка в левом нижнем углу.<br/>
<br/>
Очевидно, что было бы глупо считать эту цепочку рассуждений равной простому выводу «этой точки можно достичь только из этого числа». Можно ли в функции оценки придавать этим более сложным правилам больший вес? К сожалению, в солвере на основе слоёв это невозможно, потому что в нём не гарантировано нахождение решения с наименьшими затратами. Это не только теоретическая проблема — на практике довольно часто бывает так, что часть поля решаема или единственным сложным рассуждением, или цепочкой гораздо более простых ходов. По сути, солвер на основе слоёв находит кратчайший, а не самый малозатратный путь, и это нельзя отразить в функции оценки.<br/>
<br/>
В результате я пришёл к такому решению: я изменил солвер таким образом, чтобы каждый слой состоял только из одного типа рассуждений. Алгоритм обходит правила рассуждений в приблизительном порядке сложности. Если правило находит какие-то ходы, то они применяются, и на этом итерация завершается, а следующая итерация начинает список с самого начала.<br/>
<br/>
Затем решению присваивается оценка: каждому слою назначаются затраты на основании одного правила, которое в нём использовалось. Это всё равно не гарантирует, что решение будет самым малозатратным, но при правильном подборе весов алгоритм хотя бы не будет находить затратное решение, если существует дешёвое.<br/>
<br/>
Кроме того, это очень походит на то, как головоломки решают люди. Они сначала пытаются найти лёгкие решения, и начинают активно шевелить мозгами, только если простых ходов нет.<br/>
<br/>
<h3>Генератор</h3><br/>
Предыдущий раздел определял, хорош или плох конкретный уровень. Но только этого недостаточно, нам нужно ещё как-то сгенерировать уровни, чтобы солвер мог их оценить. Очень маловероятно, что случайно сгенерированный мир будет решаемым, не говоря уже об интересности.<br/>
<br/>
Основная идея (она ни в коем случае не нова) заключается в попеременном использовании солвера и генератора. Давайте начнём с головоломки, которая, вероятно, нерешаема: просто расположим в случайных квадратах ячейки числа от двух до пяти:<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" data-src="https://habrastorage.org/getpro/habr/post_images/8cf/164/3c5/8cf1643c568477bc2c774d33a0994f96.png"/></div><br/>
Солвер работает до тех пор, пока не сможет дальше развиваться:<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" data-src="https://habrastorage.org/getpro/habr/post_images/64f/9b4/a5c/64f9b4a5c022b2560c1a26746a0c3539.png"/></div><br/>
Затем генератор добавляет в головоломку ещё информации в виде точки, после чего продолжается выполнение солвера.<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" data-src="https://habrastorage.org/getpro/habr/post_images/1b4/397/23f/1b439723f7d229887c8392ebc07053f3.png"/></div><br/>
В этом случае добавленной точки солверу недостаточно для дальнейшего развития. Потом генератор будет продолжать добавлять новые точки, пока это не удовлетворит солвер:<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" data-src="https://habrastorage.org/getpro/habr/post_images/6b2/3a0/48d/6b23a048dc66700a3eadf94206705c7c.png"/></div><br/>
А затем солвер продолжает свою обычную работу:<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" data-src="https://habrastorage.org/getpro/habr/post_images/b8e/b9a/77a/b8eb9a77a027a741ce259a1b95fe9c89.png"/></div><br/>
Этот процесс продолжается или пока головоломка не будет решена, или пока не останется больше информации для добавления (например, когда каждая клетка, которую можно достичь из числа, уже содержит точку).<br/>
<br/>
Этот метод работает только в том случае, если добавляемая новая информация не может сделать неверными любые из ранее сделанных выводов. Это было бы сложно сделать при добавлении в сетку чисел<sup>[3]</sup>. Но добавление на поле новых точек обладает таким свойством; по крайней мере, для правил рассуждения, которые я использую в этой программе.<br/>
<br/>
Куда алгоритм должен добавлять точки? В конце концов я решил добавлять их в пустое пространство, которое можно закрыть в начальном состоянии наибольшим количеством линий, чтобы каждая точка стремилась выдавать как можно меньше информации. Я не пытался специально разместить точку в том месте, где она была бы полезна для продвижения в решении головоломки на момент, когда солвер застрянет. Это создаёт очень удобный эффект: большинство точек кажется в начале головоломки совершенно бесполезными, из-за чего головоломка кажется сложнее, чем есть на самом деле. Если всё это множество очевидных ходов, которые может сделать игрок, но почему-то не один из них не срабатывает в должной мере. В результате получилось, что генератор головоломок ведёт себя немного по-свински.<br/>
<br/>
Этот процесс не всегда создаёт решение, но он довольно быстр (порядка 50-100 миллисекунд), поэтому для генерации уровня можно просто повторить его несколько раз. К сожалению, обычно он создаёт посредственные головоломки. С самого начала есть слишком много очевидных ходов, поле заполняется очень быстро и дерево решений оказывается довольно неглубоким.<br/>
<br/>
<h3>Оптимизатор</h3><br/>
Описанный выше процесс создавал посредственные головоломки. На последнем этапе я использую эти уровни как основу для процесса оптимизации. Он работает следующим образом.<br/>
<br/>
Оптимизатор создаёт пул, в котором содержится до 10 вариантов головоломки. Пул инициализируется новой сгенерированной случайной головоломкой. На каждой итерации оптимизатор выбирает из пула одну головоломку и выполняет её мутацию.<br/>
<br/>
Мутация удаляет все точки, а затем немного изменяет числа (т.е. уменьшает/увеличивает значение случайно выбранного числа или перемещает число в другую клетку сетки). Можно применить к полю одновременно несколько мутаций. Затем мы запускаем солвер в специальном режиме генерации уровней, описанном в предыдущем разделе. Он добавляет в головоломку достаточное количество точек, чтобы она снова стала решаемой.<br/>
<br/>
После этого мы снова запускаем солвер, на этот раз в обычном режиме. Во время этого прогона солвер отслеживает a) глубину дерева решений, b) частоту необходимости разных видов правил, c) ширину дерева решений в разные моменты времени. Головоломка оценивается на основании описанных выше критериев. Функция оценки предпочитает глубокие и узкие решения, а уровни повышенной сложности также придают больший вес головоломкам, в которых требуется использовать более сложные правила рассуждений.<br/>
<br/>
Затем в пул добавляется новая головоломка. Если в пуле содержится больше 10 головоломок, то наихудшая отбрасывается.<br/>
<br/>
Этот процесс повторяется несколько раз (меня устроило примерно 10000-50000 итераций). После этого версия головоломки с наибольшей оценкой сохраняется в базу данных уровней головоломки. Вот как выглядит прогресс наилучшей головоломки на протяжении одного прогона оптимизации:<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" data-src="https://habrastorage.org/getpro/habr/post_images/504/e61/40c/504e6140c20049ca3424456de0985aaf.png"/></div><br/>
Я пробовал использовать и другие способы структурирования оптимизации. В одной версии использовалась имитация отжига, другие были генетическими алгоритмами с различными операциями кроссинговера. Ни одно из решений не проявило себя так же хорошо, как наивный алгоритм с пулом восходящих к вершине вариантов.<br/>
<br/>
<h3>Уникальное единственное решение</h3><br/>
Когда головоломка имеет уникальное единственное решение, то возникает интересное затруднение. Можно ли допускать, чтобы игрок предполагал, что решение одно, и делал выводы исходя из этого? Будет ли честно, если генератор головоломок предположит, что игрок так и сделает?<br/>
<br/>
В посте на HackerNews я говорил, что существует четыре варианта подхода к такой ситуации:<br/>
<br/>
<ul>
<li>Заявить о единственности решения с самого начала и заставить генератор, чтобы он создавал уровни, требующие такого вида рассуждений. Это плохое решение, потому что оно усложняет понимание правил. И обычно именно такие подробности люди забывают.</li>
<li>Не гарантировать единственности решения: потенциально иметь множество решений и принимать их все. На самом деле это не решает проблему, а отодвигает её.</li>
<li>Просто допустить, что это очень редкое событие, которое на практике не важно. (Именно такое решение использовалось в первоначальной реализации.)</li>
<li>Изменить генератор головоломок таким образом, чтобы он не генерировал головоломки, в котором знание об уникальности решения помогало бы. (Вероятно, правильное решение, но требующее дополнительной работы.)</li>
</ul><br/>
Изначально я выбрал последний вариант, и это было ужасной ошибкой. Оказалось, что я учёл только один способ, которым уникальность решения приводила к утечке информации, и он на самом деле довольно редок. Но есть и другие; один из них по сути присутствовал в каждом генерируемом мной уровне и часто приводил к тому, что решение становилось тривиальным. Поэтому в мае 2019 года я изменил режимы Hard и Expert, использовав третий вариант.<br/>
<br/>
Самый раздражающий случай — это двойка с пунктирной линией на таком поле:<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" data-src="https://habrastorage.org/getpro/habr/post_images/af9/ecf/34f/af9ecf34f96e0d74ae1f514207940020.png"/></div><br/>
Почему хитрый игрок может сделать такой вывод? Двойка может закрывать любой из четырёх соседних квадратов. Ни в одном из них нет точек, поэтому они необязательно должны быть закрыты линией. А находящийся внизу квадрат не имеет наложений ни с какими другими числами. Если существует единственное решение, то это должен быть случай, когда другие числа закрывают остальные три квадрата, а двойка закрывает квадрат под ней.<br/>
<br/>
Решение заключается в том, чтобы при распознавании таких случаев добавлять ещё несколько точек:<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" data-src="https://habrastorage.org/getpro/habr/post_images/d7d/d45/ebd/d7dd45ebd5d0a7aebbc78e7da61e1cd9.png"/></div><br/>
Ещё один распространённый случай — двойка с пунктиром на этом поле:<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" data-src="https://habrastorage.org/getpro/habr/post_images/252/fc8/13e/252fc813e342f503a2c189645590e7f1.png"/></div><br/>
Квадраты слева и сверху от двойки ничем не отличаются. Ни в одном из них нет точки, и ни один нельзя достичь из любого другого числа. Любое решение, в котором двойка закрывает верхний квадрат, будет иметь соответствующее решение, в котором она закрывает левый квадрат, и наоборот. Если бы существовало единственное уникальное решение, то этого не могло бы быть, и двойка должна была закрывать нижний квадрат.<br/>
<br/>
Подобный тип случаев я решил способом «если болит, то не трогай». Солвер применял это правило на раннем этапе в списке приоритетов и присваивал таким ходам большой отрицательный вес. Головоломки с такой особенностью обычно отбрасываются оптимизатором, а немногие оставшиеся отбрасываются на этапе окончательного выбора уровней для опубликованной игры.<br/>
<br/>
Это не полный список, во время плейтестинга с намеренным поиском ошибок я нашёл множество других правил для уникальных решений. Но большинство из них казались редкими и их было довольно обнаружить, поэтому они не очень упрощали игру. Если кто-то решит головоломку, пользуясь подобными рассуждениями, то я не буду ставить это им в вину.<br/>
<br/>
<h3>Заключение</h3><br/>
Изначально игра разрабатывалась как эксперимент по процедурной генерации головоломок. Дизайн игры и генератор шли рука об руку, поэтому сами техники сложно применить напрямую в других играх.<br/>
<br/>
Вопрос, на который у меня нет ответа: оправдало ли себя вложение таких усилий в процедурную генерацию? Отзывы игроков о дизайне уровней были очень противоречивыми. В положительных комментариях обычно говорилось о том, что в головоломках всегда ощущается какая-то хитрая уловка. В большинстве негативных отзывов мне писали, что в игре не достаёт градиента сложности.<br/>
<br/>
У меня есть ещё пара головоломок в зачаточной стадии, и мне так понравился генератор, что скорее всего для них я использую подобный процедурный подход. Изменю я только одно: с самого начала буду проводить активный плейтестинг с поиском ошибок.<br/>
<br/>
<h3>Примечания</h3><br/>
[0] Или, по крайней мере, так мне казалось. Но когда я понаблюдал за игроками вживую, то почти половина из них просто делала догадки, а затем итеративно их прорабатывала. Ну да ладно.<br/>
<br/>
[1] Читателям моей статьи также стоит прочитать статью <a href="https://magnushoff.com/minesweeper/">Solving Minesweeper and making it better</a> Магнуса Хоффа.<br/>
<br/>
[2] Уточню, что глубина/узость дерева — это метрика, которую я посчитал значимой для своей игры, а не для всех других головоломок. Например, существует <a href="https://web.archive.org/web/20130703141244/http://www.thinkfun.com/microsite/rushhour/creating2500challenges">хороший аргумент</a> о том, что головоломка Rush Hour интересна, если в ней есть несколько путей к решению почти, но не совсем одинаковой длины. Но так получилось потому, что Rush Hour — это игра на поиск кратчайшего решения, а не просто какого-нибудь решения.<br/>
<br/>
[3] За исключением добавления единиц. В первой версии головоломки не было точек, и план заключался в том, чтобы при необходимости дополнительной информации генератор добавлял единицы. Но это казалось слишком ограничивающим.</div></div> <!----> <!----></div> <div class="tm-article-presenter__meta"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%B3%D0%BE%D0%BB%D0%BE%D0%B2%D0%BE%D0%BB%D0%BE%D0%BC%D0%BA%D0%B8%5D" class="tm-tags-list__link">головоломки</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D0%B4%D1%83%D1%80%D0%BD%D0%B0%D1%8F%20%D0%B3%D0%B5%D0%BD%D0%B5%D1%80%D0%B0%D1%86%D0%B8%D1%8F%5D" class="tm-tags-list__link">процедурная генерация</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bpuzzle%20game%5D" class="tm-tags-list__link">puzzle game</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%BB%D0%BE%D0%B3%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B5%20%D0%B8%D0%B3%D1%80%D1%8B%5D" class="tm-tags-list__link">логические игры</a></li></ul></div> <div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/hub/gamedev/" class="tm-hubs-list__link">
    Разработка игр
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/algorithms/" class="tm-hubs-list__link">
    Алгоритмы
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/game_design/" class="tm-hubs-list__link">
    Дизайн игр
  </a></li></ul></div></div></article></div> <!----></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 34: ↑34 и ↓0</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-rating"></use></svg> <span title="Всего голосов 34: ↑34 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_medium">+34</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">4.9K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    74
  </span></button> <!----> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> </div></div> <!----> <!----> <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/PatientZero/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><img alt="" src="//habrastorage.org/getpro/habr/avatars/8de/9c5/34a/8de9c534a18a6cb8693270a2b528d4c0.png" class="tm-entity-image__pic"></div></a> <div class="tm-user-card__meta"><div title=" 1325 голосов " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    1197
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">84.4</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title_variant-article"><!----> <a href="/ru/users/PatientZero/" class="tm-user-card__nickname tm-user-card__nickname_variant-article">
          @PatientZero
        </a> <!----></div> <p class="tm-user-card__short-info tm-user-card__short-info_variant-article">Переводчик-фрилансер</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-article"><!----> <!----> <button type="submit" class="tm-user-card__button btn btn_transparent btn_small">
      Задонатить
    </button> <!----> <!----></div></div> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----></section> <div class="tm-article-blocks__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/post/452090/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 11 
    </span></a> <!----></div></div></div> <div class="tm-ad-banner__container tm-page-article__banner"><!----> <div id="articleBottomBanner" class="tm-ad-banner"></div></div> <!----> <!----> <!----> <!----> </div></div></div></div></div> <div class="tm-page__sidebar"><div class="tm-layout-sidebar"><div class="tm-layout-sidebar__ads tm-layout-sidebar__ads_initial"><div class="tm-ad-banner__container tm-layout-sidebar__banner"><!----> <div id="sidebarBanner" class="tm-ad-banner"></div></div></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----> <!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/post/452090/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/post/452090/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"452090":{"id":"452090","timePublished":"2019-05-20T09:20:08+00:00","isCorporative":false,"lang":"ru","titleHtml":"Создание процедурного генератора головоломок","leadData":{"textHtml":"В этом посте описывается генератор уровней для моей игры-головоломки \u003Ca href=\"https:\u002F\u002Flinjat.snellman.net\"\u003ELinjat\u003C\u002Fa\u003E. Пост можно читать и без подготовки, но он легче усвоится, если сыграть в несколько уровней. Исходный код я \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fjsnell\u002Flinjat\u002F\"\u003Eвыложил на github\u003C\u002Fa\u003E; всё обсуждаемое в статье находится в файле \u003Ccode\u003Esrc\u002Fmain.cc\u003C\u002Fcode\u003E.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nПримерный план поста:\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003ELinjat — это логическая игра, в которой нужно закрыть все числа и точки в сетке линиями.\u003C\u002Fli\u003E\r\n\u003Cli\u003EГоловоломки процедурно генерируются при помощи комбинации из солвера, генератора и оптимизатора.\u003C\u002Fli\u003E\r\n\u003Cli\u003EСолвер пытается решить головоломки так, как это делал бы человек, и присваивает каждой головоломке оценку интересности.\u003C\u002Fli\u003E\r\n\u003Cli\u003EГенератор головоломок создан таким образом, чтобы можно было с лёгкостью менять одну часть головоломки (числа) и при этом все остальные части (точки) менялись таким образом, чтобы головоломка оставалась решаемой.\u003C\u002Fli\u003E\r\n\u003Cli\u003EОптимизатор головоломок многократно решает уровни и генерирует новые вариации из наиболее интересных, найденных на текущий момент.\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u003E\r\n\u003Ch3\u003EПравила\u003C\u002Fh3\u003E\u003Cbr\u003E\r\nЧтобы понять, как работает генератор уровней, нужно, к сожалению, разобраться с правилами игры. К счастью, они очень просты. Головоломка состоит из сетки, содержащей пустые квадраты, числа и точки. Пример:\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F641\u002F0d0\u002F547\u002F6410d0547bc14faae51beb3942867cb0.png\"\u003E\u003C\u002Fdiv\u003E\u003Cbr\u003E\r\nЦель игрока — прочертить вертикальную или горизонтальную линию через каждое из чисел при соблюдении трёх условий:\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EЛиния, идущая через число, должна иметь ту же длину, что и число.\u003C\u002Fli\u003E\r\n\u003Cli\u003EЛинии не могут пересекаться.\u003C\u002Fli\u003E\r\n\u003Cli\u003EВсе точки необходимо закрыть линиями.\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u003E\r\nПример решения:\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F7e1\u002F3ce\u002F91c\u002F7e13ce91c2da2e2d64bd98f523010671.png\"\u003E\u003C\u002Fdiv\u003E\u003Cbr\u003E\r\nУра! Дизайн игры готов, UI реализован, и теперь единственное, что осталось — найти несколько сотен хороших головоломок. А для подобных игр обычно не имеет смысла пытаться создавать такие головоломки вручную. Это работа для компьютера.\u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше →","image":null},"editorVersion":"1.0","postType":"article","postLabels":[{"type":"translation","data":{"originalAuthorName":"Juho Snellman","originalUrl":"https:\u002F\u002Fwww.snellman.net\u002Fblog\u002Farchive\u002F2019-05-14-procedural-puzzle-generator\u002F"}}],"author":{"scoreStats":{"score":1197,"votesCount":1325},"rating":84.4,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":"410013829899665","paymentPayPalMe":"vadimivshin","paymentWebmoney":null},"id":"78894","alias":"PatientZero","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F8de\u002F9c5\u002F34a\u002F8de9c534a18a6cb8693270a2b528d4c0.png","speciality":"Переводчик-фрилансер"},"statistics":{"commentsCount":11,"favoritesCount":74,"readingCount":4907,"score":34,"votesCount":34},"hubs":[{"relatedData":null,"id":"7773","alias":"gamedev","type":"collective","title":"Разработка игр","titleHtml":"Разработка игр","isProfiled":true},{"relatedData":null,"id":"8000","alias":"algorithms","type":"collective","title":"Алгоритмы","titleHtml":"Алгоритмы","isProfiled":true},{"relatedData":null,"id":"20800","alias":"game_design","type":"collective","title":"Дизайн игр","titleHtml":"Дизайн игр","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"2","alias":"design","title":"Дизайн"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003EВ этом посте описывается генератор уровней для моей игры-головоломки \u003Ca href=\"https:\u002F\u002Flinjat.snellman.net\"\u003ELinjat\u003C\u002Fa\u003E. Пост можно читать и без подготовки, но он легче усвоится, если сыграть в несколько уровней. Исходный код я \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fjsnell\u002Flinjat\u002F\"\u003Eвыложил на github\u003C\u002Fa\u003E; всё обсуждаемое в статье находится в файле \u003Ccode\u003Esrc\u002Fmain.cc\u003C\u002Fcode\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПримерный план поста:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003ELinjat — это логическая игра, в которой нужно закрыть все числа и точки в сетке линиями.\u003C\u002Fli\u003E\r\n\u003Cli\u003EГоловоломки процедурно генерируются при помощи комбинации из солвера, генератора и оптимизатора.\u003C\u002Fli\u003E\r\n\u003Cli\u003EСолвер пытается решить головоломки так, как это делал бы человек, и присваивает каждой головоломке оценку интересности.\u003C\u002Fli\u003E\r\n\u003Cli\u003EГенератор головоломок создан таким образом, чтобы можно было с лёгкостью менять одну часть головоломки (числа) и при этом все остальные части (точки) менялись таким образом, чтобы головоломка оставалась решаемой.\u003C\u002Fli\u003E\r\n\u003Cli\u003EОптимизатор головоломок многократно решает уровни и генерирует новые вариации из наиболее интересных, найденных на текущий момент.\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Ch3\u003EПравила\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\nЧтобы понять, как работает генератор уровней, нужно, к сожалению, разобраться с правилами игры. К счастью, они очень просты. Головоломка состоит из сетки, содержащей пустые квадраты, числа и точки. Пример:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F641\u002F0d0\u002F547\u002F6410d0547bc14faae51beb3942867cb0.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nЦель игрока — прочертить вертикальную или горизонтальную линию через каждое из чисел при соблюдении трёх условий:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EЛиния, идущая через число, должна иметь ту же длину, что и число.\u003C\u002Fli\u003E\r\n\u003Cli\u003EЛинии не могут пересекаться.\u003C\u002Fli\u003E\r\n\u003Cli\u003EВсе точки необходимо закрыть линиями.\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\nПример решения:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F7e1\u002F3ce\u002F91c\u002F7e13ce91c2da2e2d64bd98f523010671.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nУра! Дизайн игры готов, UI реализован, и теперь единственное, что осталось — найти несколько сотен хороших головоломок. А для подобных игр обычно не имеет смысла пытаться создавать такие головоломки вручную. Это работа для компьютера.\u003Cbr\u002F\u003E\r\n\u003Ca name=\"habracut\"\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003Ch3\u003EТребования\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\nЧто делает головоломку для этой игры хорошей? Я склонен считать, что игры-головоломки можно разбить на две категории. Есть игры, в которых ты исследуешь сложное пространство состояний от начала до конца (например, \u003Ca href=\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FSokoban\"\u003ESokoban\u003C\u002Fa\u003E или \u003Ca href=\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FRush_Hour_(puzzle)\"\u003ERush Hour\u003C\u002Fa\u003E), и в которых может быть и не очевидно, какие состояния существуют в игре. И есть игры, в которых все состояния известны с самого начала, и мы постепенно вылепливаем пространство состояний с помощью процесса устранения лишних (например, \u003Ca href=\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FSudoku\"\u003ESudoku\u003C\u002Fa\u003E или \u003Ca href=\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FNonogram\"\u003EPicross\u003C\u002Fa\u003E). Моя игра определённо относится ко второй категории.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nИгроки предъявляют очень отличающиеся требования к этим разным видам головоломок. Во втором случае они ожидают, что головоломку можно решить только дедукцией, и что им никогда не понадобится возврат назад\u002Fугадывание\u002Fпроцесс проб и ошибок\u003Csup\u003E[0]\u003C\u002Fsup\u003E\u003Csup\u003E[1]\u003C\u002Fsup\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНедостаточно знать, можно ли решить головоломку только с помощью логики. Кроме того, нам нужно как-то понять, насколько хороши создаваемые головоломки. В противном случае большинство уровней будет просто тривиальным шлаком. В идеальной ситуации этот принцип можно было использовать также для создания плавной кривой прогресса, чтобы при прохождении игроком игры уровни постепенно становились сложнее.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003EСолвер\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\nПервый шаг к удовлетворению этих требований — создание солвера игры, оптимизированного для этой цели. Солвер грубого перебора с возвратом назад (backtracking) позволит быстро и точно определить, решаема ли головоломка; кроме того, его можно модифицировать, чтобы он определял, является ли решение уникальным. Но он не может дать представления о том, насколько сложна на самом деле головоломка, потому что люди решают их по-другому. Солвер должен имитировать поведение человека.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКак же человек решает эту головоломку? Вот пара очевидных ходов, которым учит внутриигровой туториал:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EЕсли точки можно достичь только из одного числа, то для закрытия точки нужно протянуть линию из этого числа. В этом примере точку можно достичь только из тройки, но не из четвёрки:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F76d\u002F1d4\u002Fe3e\u002F76d1d4e3e87a0cc9efdebbd586420c84.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nИ это приводит к такой ситуации:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Fa15\u002Fdb3\u002F05f\u002Fa15db305fa78a149ee614de0b4b8ed54.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003EЕсли линия не помещается в одном направлении, то её нужно расположить в другом. В показанном выше примере четвёрку больше нельзя расположить вертикально, поэтому мы знаем, что она будет горизонтальной:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F5ef\u002F048\u002F99f\u002F5ef04899f1c9da5a5b8492e1316ddcbf.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003EЕсли известно, что линия длины X должна находиться в определённом положении (вертикаль\u002Fгоризонталь) и недостаточно пустого пространства, чтобы разместить линию из X пустых клеток по обеим сторонам, то нужно покрыть несколько квадратов посередине. Если бы в показанном выше примере четвёрка была тройкой, то мы бы не знали, растягивается ли она до упора вправо или влево. Но мы бы знали, что линия должна закрывать два средних квадрата:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F02c\u002Fbfa\u002F021\u002F02cbfa02113362bc6e3c5217baee3ff3.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\nПодобные рассуждения — самая основа игры. Игрок ищет способы растянуть немного одну линию, а затем снова изучает поле, потому что оно может дать ему информацию, чтобы сделать ещё один логический вывод. Создания солвера, следующего этим правилам, будет достаточно, чтобы определить, \u003Ci\u003Eсможет ли\u003C\u002Fi\u003E человек решить головоломку без возврата назад.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nОднако это ничего не говорит нам о сложности или интересности уровня. Кроме решаемости, нам каким-то образом нужно численно оценить сложность.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nОчевидная первая идея для функции оценки: чем больше ходов требуется для решения головоломки, тем она сложнее. Вероятно, в других играх это хорошая метрика, но моей, скорее всего, важнее количество допустимых ходов, которые есть у игрока. Если игрок может сделать 10 логических выводов, то он, скорее всего, найдёт один из них очень быстро. Если верный ход только один, то это потребует больше времени.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТо есть в качестве первой аппроксимации нам нужно, чтобы дерево решений было глубоким и узким: есть длинная зависимость ходов от начала до конца, и в каждый момент времени есть только малое количество способов продвинуться вверх по цепочке\u003Csup\u003E[2]\u003C\u002Fsup\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКак нам определить ширину и глубину дерева? Однократное решение головоломки и оценка созданного дерева не дадут точного ответа. Точный порядок делаемых ходов влияет на форму дерева. Нам нужно рассмотреть все возможные решения и сделать с ними что-то вроде оптимизации по лучшим и худшим случаям. Мне знакома техника \u003Ca href=\"https:\u002F\u002Fwww.snellman.net\u002Fblog\u002Farchive\u002F2018-07-23-optimizing-breadth-first-search\u002F\"\u003Eгрубого перебора графов поиска в играх-головоломках\u003C\u002Fa\u003E, но для этого проекта я хотел создать однопроходной солвер, а не какой-то исчерпывающий поиск. Из-за фазы оптимизации я стремился к тому, чтобы время выполнения солвера измерялось не в секундах, а в миллисекундах.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЯ решил этого не делать. Вместо этого мой солвер на самом деле не делает один ход за раз, а решает головоломку по слоям: взяв состояние, он находит все допустимые ходы, которые можно сделать. Затем применяет все эти ходы одновременно и начинает заново в новом состоянии. Количество слоёв и максимальное число ходов, найденное на одном слое, затем используются как приближенные значения глубины и ширины дерева поиска в целом.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВот как при этой модели выглядит решение одной из сложных головоломок. Пунктирные линии — это линии, растянутые на этом слое солвера, сплошные — те, которые не менялись. Зелёные линии имеют правильную длину, красные ещё не завершены.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F2af\u002F1de\u002Fcfb\u002F2af1decfbc170ec8965ae8b1cce2cbea.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nСледующая проблема заключается в том, что все делаемые игроком ходы создаются равными. То, что мы перечислили в начале этого раздела — просто здравый смысл. Вот пример более сложного правила дедукции, на поиск которого потребуется немного больше размышлений. Рассмотрим такое поле:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F9c4\u002Fc18\u002F772\u002F9c4c187726bf50f03bbffa748137cf44.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nТочки в C и D можно покрыть только пятёркой и средней четвёркой (и ни одно число не может покрыть обе точки одновременно). Это значит, что четвёрка посередине должна покрыть одну точку из двух, а значит не может быть использовала для покрытия A. Следовательно, точку A должна закрыть четвёрка в левом нижнем углу.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nОчевидно, что было бы глупо считать эту цепочку рассуждений равной простому выводу «этой точки можно достичь только из этого числа». Можно ли в функции оценки придавать этим более сложным правилам больший вес? К сожалению, в солвере на основе слоёв это невозможно, потому что в нём не гарантировано нахождение решения с наименьшими затратами. Это не только теоретическая проблема — на практике довольно часто бывает так, что часть поля решаема или единственным сложным рассуждением, или цепочкой гораздо более простых ходов. По сути, солвер на основе слоёв находит кратчайший, а не самый малозатратный путь, и это нельзя отразить в функции оценки.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВ результате я пришёл к такому решению: я изменил солвер таким образом, чтобы каждый слой состоял только из одного типа рассуждений. Алгоритм обходит правила рассуждений в приблизительном порядке сложности. Если правило находит какие-то ходы, то они применяются, и на этом итерация завершается, а следующая итерация начинает список с самого начала.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗатем решению присваивается оценка: каждому слою назначаются затраты на основании одного правила, которое в нём использовалось. Это всё равно не гарантирует, что решение будет самым малозатратным, но при правильном подборе весов алгоритм хотя бы не будет находить затратное решение, если существует дешёвое.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКроме того, это очень походит на то, как головоломки решают люди. Они сначала пытаются найти лёгкие решения, и начинают активно шевелить мозгами, только если простых ходов нет.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003EГенератор\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\nПредыдущий раздел определял, хорош или плох конкретный уровень. Но только этого недостаточно, нам нужно ещё как-то сгенерировать уровни, чтобы солвер мог их оценить. Очень маловероятно, что случайно сгенерированный мир будет решаемым, не говоря уже об интересности.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nОсновная идея (она ни в коем случае не нова) заключается в попеременном использовании солвера и генератора. Давайте начнём с головоломки, которая, вероятно, нерешаема: просто расположим в случайных квадратах ячейки числа от двух до пяти:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F8cf\u002F164\u002F3c5\u002F8cf1643c568477bc2c774d33a0994f96.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nСолвер работает до тех пор, пока не сможет дальше развиваться:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F64f\u002F9b4\u002Fa5c\u002F64f9b4a5c022b2560c1a26746a0c3539.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nЗатем генератор добавляет в головоломку ещё информации в виде точки, после чего продолжается выполнение солвера.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F1b4\u002F397\u002F23f\u002F1b439723f7d229887c8392ebc07053f3.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nВ этом случае добавленной точки солверу недостаточно для дальнейшего развития. Потом генератор будет продолжать добавлять новые точки, пока это не удовлетворит солвер:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F6b2\u002F3a0\u002F48d\u002F6b23a048dc66700a3eadf94206705c7c.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nА затем солвер продолжает свою обычную работу:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Fb8e\u002Fb9a\u002F77a\u002Fb8eb9a77a027a741ce259a1b95fe9c89.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nЭтот процесс продолжается или пока головоломка не будет решена, или пока не останется больше информации для добавления (например, когда каждая клетка, которую можно достичь из числа, уже содержит точку).\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЭтот метод работает только в том случае, если добавляемая новая информация не может сделать неверными любые из ранее сделанных выводов. Это было бы сложно сделать при добавлении в сетку чисел\u003Csup\u003E[3]\u003C\u002Fsup\u003E. Но добавление на поле новых точек обладает таким свойством; по крайней мере, для правил рассуждения, которые я использую в этой программе.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКуда алгоритм должен добавлять точки? В конце концов я решил добавлять их в пустое пространство, которое можно закрыть в начальном состоянии наибольшим количеством линий, чтобы каждая точка стремилась выдавать как можно меньше информации. Я не пытался специально разместить точку в том месте, где она была бы полезна для продвижения в решении головоломки на момент, когда солвер застрянет. Это создаёт очень удобный эффект: большинство точек кажется в начале головоломки совершенно бесполезными, из-за чего головоломка кажется сложнее, чем есть на самом деле. Если всё это множество очевидных ходов, которые может сделать игрок, но почему-то не один из них не срабатывает в должной мере. В результате получилось, что генератор головоломок ведёт себя немного по-свински.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЭтот процесс не всегда создаёт решение, но он довольно быстр (порядка 50-100 миллисекунд), поэтому для генерации уровня можно просто повторить его несколько раз. К сожалению, обычно он создаёт посредственные головоломки. С самого начала есть слишком много очевидных ходов, поле заполняется очень быстро и дерево решений оказывается довольно неглубоким.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003EОптимизатор\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\nОписанный выше процесс создавал посредственные головоломки. На последнем этапе я использую эти уровни как основу для процесса оптимизации. Он работает следующим образом.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nОптимизатор создаёт пул, в котором содержится до 10 вариантов головоломки. Пул инициализируется новой сгенерированной случайной головоломкой. На каждой итерации оптимизатор выбирает из пула одну головоломку и выполняет её мутацию.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nМутация удаляет все точки, а затем немного изменяет числа (т.е. уменьшает\u002Fувеличивает значение случайно выбранного числа или перемещает число в другую клетку сетки). Можно применить к полю одновременно несколько мутаций. Затем мы запускаем солвер в специальном режиме генерации уровней, описанном в предыдущем разделе. Он добавляет в головоломку достаточное количество точек, чтобы она снова стала решаемой.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПосле этого мы снова запускаем солвер, на этот раз в обычном режиме. Во время этого прогона солвер отслеживает a) глубину дерева решений, b) частоту необходимости разных видов правил, c) ширину дерева решений в разные моменты времени. Головоломка оценивается на основании описанных выше критериев. Функция оценки предпочитает глубокие и узкие решения, а уровни повышенной сложности также придают больший вес головоломкам, в которых требуется использовать более сложные правила рассуждений.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗатем в пул добавляется новая головоломка. Если в пуле содержится больше 10 головоломок, то наихудшая отбрасывается.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЭтот процесс повторяется несколько раз (меня устроило примерно 10000-50000 итераций). После этого версия головоломки с наибольшей оценкой сохраняется в базу данных уровней головоломки. Вот как выглядит прогресс наилучшей головоломки на протяжении одного прогона оптимизации:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F504\u002Fe61\u002F40c\u002F504e6140c20049ca3424456de0985aaf.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nЯ пробовал использовать и другие способы структурирования оптимизации. В одной версии использовалась имитация отжига, другие были генетическими алгоритмами с различными операциями кроссинговера. Ни одно из решений не проявило себя так же хорошо, как наивный алгоритм с пулом восходящих к вершине вариантов.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003EУникальное единственное решение\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\nКогда головоломка имеет уникальное единственное решение, то возникает интересное затруднение. Можно ли допускать, чтобы игрок предполагал, что решение одно, и делал выводы исходя из этого? Будет ли честно, если генератор головоломок предположит, что игрок так и сделает?\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВ посте на HackerNews я говорил, что существует четыре варианта подхода к такой ситуации:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EЗаявить о единственности решения с самого начала и заставить генератор, чтобы он создавал уровни, требующие такого вида рассуждений. Это плохое решение, потому что оно усложняет понимание правил. И обычно именно такие подробности люди забывают.\u003C\u002Fli\u003E\r\n\u003Cli\u003EНе гарантировать единственности решения: потенциально иметь множество решений и принимать их все. На самом деле это не решает проблему, а отодвигает её.\u003C\u002Fli\u003E\r\n\u003Cli\u003EПросто допустить, что это очень редкое событие, которое на практике не важно. (Именно такое решение использовалось в первоначальной реализации.)\u003C\u002Fli\u003E\r\n\u003Cli\u003EИзменить генератор головоломок таким образом, чтобы он не генерировал головоломки, в котором знание об уникальности решения помогало бы. (Вероятно, правильное решение, но требующее дополнительной работы.)\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\nИзначально я выбрал последний вариант, и это было ужасной ошибкой. Оказалось, что я учёл только один способ, которым уникальность решения приводила к утечке информации, и он на самом деле довольно редок. Но есть и другие; один из них по сути присутствовал в каждом генерируемом мной уровне и часто приводил к тому, что решение становилось тривиальным. Поэтому в мае 2019 года я изменил режимы Hard и Expert, использовав третий вариант.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСамый раздражающий случай — это двойка с пунктирной линией на таком поле:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Faf9\u002Fecf\u002F34f\u002Faf9ecf34f96e0d74ae1f514207940020.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nПочему хитрый игрок может сделать такой вывод? Двойка может закрывать любой из четырёх соседних квадратов. Ни в одном из них нет точек, поэтому они необязательно должны быть закрыты линией. А находящийся внизу квадрат не имеет наложений ни с какими другими числами. Если существует единственное решение, то это должен быть случай, когда другие числа закрывают остальные три квадрата, а двойка закрывает квадрат под ней.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nРешение заключается в том, чтобы при распознавании таких случаев добавлять ещё несколько точек:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Fd7d\u002Fd45\u002Febd\u002Fd7dd45ebd5d0a7aebbc78e7da61e1cd9.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nЕщё один распространённый случай — двойка с пунктиром на этом поле:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F252\u002Ffc8\u002F13e\u002F252fc813e342f503a2c189645590e7f1.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nКвадраты слева и сверху от двойки ничем не отличаются. Ни в одном из них нет точки, и ни один нельзя достичь из любого другого числа. Любое решение, в котором двойка закрывает верхний квадрат, будет иметь соответствующее решение, в котором она закрывает левый квадрат, и наоборот. Если бы существовало единственное уникальное решение, то этого не могло бы быть, и двойка должна была закрывать нижний квадрат.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПодобный тип случаев я решил способом «если болит, то не трогай». Солвер применял это правило на раннем этапе в списке приоритетов и присваивал таким ходам большой отрицательный вес. Головоломки с такой особенностью обычно отбрасываются оптимизатором, а немногие оставшиеся отбрасываются на этапе окончательного выбора уровней для опубликованной игры.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЭто не полный список, во время плейтестинга с намеренным поиском ошибок я нашёл множество других правил для уникальных решений. Но большинство из них казались редкими и их было довольно обнаружить, поэтому они не очень упрощали игру. Если кто-то решит головоломку, пользуясь подобными рассуждениями, то я не буду ставить это им в вину.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003EЗаключение\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\nИзначально игра разрабатывалась как эксперимент по процедурной генерации головоломок. Дизайн игры и генератор шли рука об руку, поэтому сами техники сложно применить напрямую в других играх.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВопрос, на который у меня нет ответа: оправдало ли себя вложение таких усилий в процедурную генерацию? Отзывы игроков о дизайне уровней были очень противоречивыми. В положительных комментариях обычно говорилось о том, что в головоломках всегда ощущается какая-то хитрая уловка. В большинстве негативных отзывов мне писали, что в игре не достаёт градиента сложности.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nУ меня есть ещё пара головоломок в зачаточной стадии, и мне так понравился генератор, что скорее всего для них я использую подобный процедурный подход. Изменю я только одно: с самого начала буду проводить активный плейтестинг с поиском ошибок.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003EПримечания\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n[0] Или, по крайней мере, так мне казалось. Но когда я понаблюдал за игроками вживую, то почти половина из них просто делала догадки, а затем итеративно их прорабатывала. Ну да ладно.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n[1] Читателям моей статьи также стоит прочитать статью \u003Ca href=\"https:\u002F\u002Fmagnushoff.com\u002Fminesweeper\u002F\"\u003ESolving Minesweeper and making it better\u003C\u002Fa\u003E Магнуса Хоффа.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n[2] Уточню, что глубина\u002Fузость дерева — это метрика, которую я посчитал значимой для своей игры, а не для всех других головоломок. Например, существует \u003Ca href=\"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20130703141244\u002Fhttp:\u002F\u002Fwww.thinkfun.com\u002Fmicrosite\u002Frushhour\u002Fcreating2500challenges\"\u003Eхороший аргумент\u003C\u002Fa\u003E о том, что головоломка Rush Hour интересна, если в ней есть несколько путей к решению почти, но не совсем одинаковой длины. Но так получилось потому, что Rush Hour — это игра на поиск кратчайшего решения, а не просто какого-нибудь решения.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n[3] За исключением добавления единиц. В первой версии головоломки не было точек, и план заключался в том, чтобы при необходимости дополнительной информации генератор добавлял единицы. Но это казалось слишком ограничивающим.\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"головоломки"},{"titleHtml":"процедурная генерация"},{"titleHtml":"puzzle game"},{"titleHtml":"логические игры"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F452090\u002F29b0f226fa5814c2a17e01dbe90424b0\u002F","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F452090\u002F29b0f226fa5814c2a17e01dbe90424b0\u002F?format=vk","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F452090\\\u002F\"},\"headline\":\"Создание процедурного генератора головоломок\",\"datePublished\":\"2019-05-20T12:20:08+03:00\",\"dateModified\":\"2019-05-20T12:23:03+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"PatientZero\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"В этом посте описывается генератор уровней для моей игры-головоломки Linjat. Пост можно читать и без подготовки, но он легче усвоится, если сыграть в несколько у...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F452090\\\u002F#post-content-body\",\"about\":[\"h_gamedev\",\"h_algorithms\",\"h_game_design\",\"f_develop\",\"f_design\"],\"image\":[\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002F641\\\u002F0d0\\\u002F547\\\u002F6410d0547bc14faae51beb3942867cb0.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002F7e1\\\u002F3ce\\\u002F91c\\\u002F7e13ce91c2da2e2d64bd98f523010671.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002F76d\\\u002F1d4\\\u002Fe3e\\\u002F76d1d4e3e87a0cc9efdebbd586420c84.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002Fa15\\\u002Fdb3\\\u002F05f\\\u002Fa15db305fa78a149ee614de0b4b8ed54.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002F5ef\\\u002F048\\\u002F99f\\\u002F5ef04899f1c9da5a5b8492e1316ddcbf.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002F02c\\\u002Fbfa\\\u002F021\\\u002F02cbfa02113362bc6e3c5217baee3ff3.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002F2af\\\u002F1de\\\u002Fcfb\\\u002F2af1decfbc170ec8965ae8b1cce2cbea.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002F9c4\\\u002Fc18\\\u002F772\\\u002F9c4c187726bf50f03bbffa748137cf44.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002F8cf\\\u002F164\\\u002F3c5\\\u002F8cf1643c568477bc2c774d33a0994f96.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002F64f\\\u002F9b4\\\u002Fa5c\\\u002F64f9b4a5c022b2560c1a26746a0c3539.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002F1b4\\\u002F397\\\u002F23f\\\u002F1b439723f7d229887c8392ebc07053f3.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002F6b2\\\u002F3a0\\\u002F48d\\\u002F6b23a048dc66700a3eadf94206705c7c.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002Fb8e\\\u002Fb9a\\\u002F77a\\\u002Fb8eb9a77a027a741ce259a1b95fe9c89.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002F504\\\u002Fe61\\\u002F40c\\\u002F504e6140c20049ca3424456de0985aaf.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002Faf9\\\u002Fecf\\\u002F34f\\\u002Faf9ecf34f96e0d74ae1f514207940020.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002Fd7d\\\u002Fd45\\\u002Febd\\\u002Fd7dd45ebd5d0a7aebbc78e7da61e1cd9.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002F252\\\u002Ffc8\\\u002F13e\\\u002F252fc813e342f503a2c189645590e7f1.png\"]}","metaDescription":"В этом посте описывается генератор уровней для моей игры-головоломки Linjat. Пост можно читать и без подготовки, но он легче усвоится, если сыграть в несколько уровней. Исходный код я выложил на...","mainImageUrl":null,"amp":false},"polls":[],"commentsEnabled":true,"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":true}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[],"hubs":"gamedev,algorithms,game_design"},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.c0af73e7.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
