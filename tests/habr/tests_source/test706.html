<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Автоматическая авторизация на карте Strava Heatmap / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.c0af73e7.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.85eb77f0b17c8235e7b64b9f81ea5ec2.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/post\/451620\/"},"headline":"Автоматическая авторизация на карте Strava Heatmap","datePublished":"2019-05-13T17:52:50+03:00","dateModified":"2020-01-08T22:23:40+03:00","author":{"@type":"Person","name":"Макс Кожин"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"Данный пост является ответом на недавнюю аналогичную статью. Попробую рассказать, как можно автоматизировать описанные в ней действия. И как подключить эту теп...","url":"https:\/\/habr.com\/ru\/post\/451620\/#post-content-body","about":["h_nodejs","h_openstreetmap","f_develop"],"image":["https:\/\/habr.com\/share\/publication\/451620\/96f29e3bf785e9cefeee0bb92e4199e6\/","https:\/\/habrastorage.org\/webt\/gz\/wx\/rp\/gzwxrp6vtom8fjvn4uncz1bw8qs.png","https:\/\/habrastorage.org\/webt\/t7\/k3\/iz\/t7k3izx0pzrbkg7py5w57mbek9e.png","https:\/\/habrastorage.org\/webt\/-9\/ld\/3w\/-9ld3wwy506lflbbufmyvtqqzui.png","https:\/\/habrastorage.org\/webt\/qz\/nd\/br\/qzndbr2lkua60yinbdywhgqmdag.png","https:\/\/habrastorage.org\/webt\/xg\/ew\/ss\/xgewssgar-nqxgmqy0qoncozcog.jpeg"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.49.0">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="Автоматическая авторизация на карте Strava Heatmap" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Автоматическая авторизация на карте Strava Heatmap" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Автоматическая авторизация на карте Strava Heatmap" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="Данный пост является ответом на недавнюю аналогичную статью. Попробую рассказать, как можно автоматизировать описанные в ней действия. И как подключить эту тепловую карту к навигатору..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="Данный пост является ответом на недавнюю аналогичную статью. Попробую рассказать, как можно автоматизировать описанные в ней действия. И как подключить эту тепловую карту к навигатору..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="Данный пост является ответом на недавнюю аналогичную статью. Попробую рассказать, как можно автоматизировать описанные в ней действия. И как подключить эту тепловую карту к навигатору..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="Данный пост является ответом на недавнюю аналогичную статью. Попробую рассказать, как можно автоматизировать описанные в ней действия. И как подключить эту тепловую карту к навигатору..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="Данный пост является ответом на недавнюю аналогичную статью. Попробую рассказать, как можно автоматизировать описанные в ней действия. И как подключить эту тепловую карту к навигатору..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habrastorage.org/webt/gz/wx/rp/gzwxrp6vtom8fjvn4uncz1bw8qs.png" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habrastorage.org/webt/gz/wx/rp/gzwxrp6vtom8fjvn4uncz1bw8qs.png" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habrastorage.org/webt/gz/wx/rp/gzwxrp6vtom8fjvn4uncz1bw8qs.png" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habrastorage.org/webt/gz/wx/rp/gzwxrp6vtom8fjvn4uncz1bw8qs.png" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habrastorage.org/webt/gz/wx/rp/gzwxrp6vtom8fjvn4uncz1bw8qs.png" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="451620" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2019-05-13T14:52:50.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/451620/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/post/451620/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habrastorage.org/webt/gz/wx/rp/gzwxrp6vtom8fjvn4uncz1bw8qs.png" data-vmid="image:href">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
            Как стать автором
          </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" data-async-called="true" class="tm-page"><div class="tm-page-width"><!----> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/nnngrach/" title="nnngrach" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="" height="24" loading="lazy" src="//habrastorage.org/r/w32/getpro/habr/avatars/2bd/c33/60e/2bdc3360e57e711820504a0caa8d9386.jpg" width="24" class="tm-entity-image__pic"></div></a> <span class="tm-user-info__user"><a href="/ru/users/nnngrach/" class="tm-user-info__username">
      nnngrach
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2019-05-13T14:52:50.000Z" title="2019-05-13, 17:52">13  мая  2019 в 17:52</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>Автоматическая авторизация на карте Strava Heatmap</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/nodejs/" class="tm-article-snippet__hubs-item-link"><span>Node.JS</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/openstreetmap/" class="tm-article-snippet__hubs-item-link"><span>OpenStreetMap</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <div class="tm-article-snippet__labels"><div class="tm-article-snippet__label"><span>
        Из песочницы
      </span></div><div class="tm-article-snippet__label"><span>
        Tutorial
      </span></div></div> <!----> <!----></div></div> <!----> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-1"><div xmlns="http://www.w3.org/1999/xhtml"><img src="/img/image-loader.svg" data-src="https://habrastorage.org/webt/gz/wx/rp/gzwxrp6vtom8fjvn4uncz1bw8qs.png"/><br/>
<br/>
Данный пост является ответом на недавнюю <a href="https://habr.com/ru/post/450124/">аналогичную статью</a>. Попробую рассказать, как можно автоматизировать описанные в ней действия. И как подключить эту тепловую карту к навигатору смартфона.<br/>
<a name="habracut"></a><br/>
В статье рассматривалось, чем полезны карты Strava Heatmap для туристов и велосипедистов и о том, как подключить к ним навигационное приложение на смартфоне на примере Osmand. Дело в том, что для загрузки каждого кусочка карты нужно указывать параметры с авторизационными данными. Примерно так:<br/>
<br/>
<pre><code class="plaintext">GET https://heatmap-external-{abc}.strava.com/tiles-auth/all/hot/{z}/{x}/{y}.png?px=256&amp;Signature={CloudFront-Signature}&amp;Key-Pair-Id={CloudFront-Key-Pair-Id}&amp;Policy={CloudFront-Policy}</code></pre><br/>
Чтобы получить эти данные, предлагалось авторизироваться на сайте Strava с десктопного браузера. Как результат, в браузере должны появиться cookie файлы. Нужно найти в них требуемые строки и скопировать их в адрес запроса. А затем, вручную ввести запрос в Osmand, чтобы он смог скачивать с его помощью карту.<br/>
<br/>
Однако этот способ он не очень удобен, ведь авторизационные данные быстро устаревают и приходится раз в несколько дней повторять вышеописанные действия. В этой статье я расскажу, как можно автоматизировать вышеописанный метод. <br/>
<br/>
<h3>Добавляем промежуточное звено</h3><br/>
Чтобы пользователю не приходилось заменять в смартфоне URL запроса каждый раз, когда cookie-данные устаревают, нужно указать какой-нибудь неизменный URL. Я указал ссылку на свое серверное приложение. Это приложение будет редиректить пользователя на различные адреса в зависимости от указанных параметров. <br/>
<br/>
<pre><code class="plaintext">https://anygis.herokuapp.com/Tracks_Strava_All/{x}/{y}/{z}</code></pre><br/>
Чтобы быстрее перейти к сути, я не буду подробно останавливаться на описании этого серверного приложения. Расскажу лишь об основных его действиях.<br/>
<br/>
Если запрашивается тайл с зумом до 12 (такие Stava отдает без авторизации), то пользователь сразу перенаправляется на публичный URL.<br/>
<br/>
<pre><code class="plaintext">https://heatmap-external-a.strava.com/tiles/all/hot/10/619/318.png</code></pre><br/>
Если же нет, то выполняется проверка. Для быстрого доступа приложение хранит в своей базе данных последнюю рабочую версию файла cookie. Когда оно получает запрос, оно парсит этот файл и создает URL со всеми подставленными параметрами. <br/>
<br/>
<div class="spoiler"><b class="spoiler_title">Получается что-то вроде этого</b><div class="spoiler_text"><pre><code class="plaintext">https://heatmap-external-a.strava.com/tiles-auth/all/hot/10/619/318.png?px=256&lt;b>&amp;Signature&lt;/b>=Q47FWl1RX-5tLNK9fGfa7hdoxqwwjCLfrxwb~L3eke8h~glz5IBHmkLmu8ofh6eNWUM3usHTz4Z3rypbQGByC2jRhdzL2iJndIOu2TY9ZU34YUJV9QgMEf0L5cDHGjEsksYSVdkCqNRvOMnnzUc96wR9sktK2a0pcsI~E5eNvqjfsGbSWi6KCdfc1-~2D8t9YjbKftokhvMY20pM~PD6Y-fGYmpoTO5LOyMfIYboXnKGm29VnA9kA8LIxD-LzpADWO81i4pOMBvkVkJuLBGtO96a79P5D4tRP05DpI7y457LuKcuqRZaVQRB1L2AXgKvQgnx6nqr9T2jRAZNoy06ng__
&lt;b>&amp;Key-Pair-Id&lt;/b>=APKAIDPUN4QMG7VUQPSA
&lt;b>&amp;Policy&lt;/b>=eyJTdGF0ZW1lbnQiOiBbeyJSZXNvdXJjZSI6Imh0dHBzOi8vaGVhdG1hcC1leHRlcm5hbC0qLnN0cmF2YS5jb20vKiIsIkNvbmRpdGlvbiI6eyJEYXRlTGVzc1RoYW4iOnsiQVdTOkVwb2NoVGltZSI6MTU1ODUwODc2Mn0sIkRhdGVHcmVhdGVyVGhhbiI6eyJBV1M6RXBvY2hUaW1lIjoxNTU3Mjg0NzYyfX19XX0_</code></pre><br/>
</div></div><br/>
После этого оно отправляет HEAD запрос на этот адрес, чтобы проверить, доступен он или нет. Если в ответ приходит статус код “200 Success”, значит cookie все еще рабочие. Приложение просто редиректит пользователя на этот адрес и у него прекрасно загружается карта.<br/>
<br/>
А вот если приходит код “401 Unauthorized”, то значит cookie устарели и нужно заново их получить. В этом случае приложение запускает скрипт для получение авторизационных данных.<br/>
<br/>
<h3>Автоматическая авторизация</h3><br/>
Первая мысль, которая приходит в голову, это пройти авторизацию с помощью Strava API. Увы, но мне так и не удалось вытянуть оттуда нужные параметры. Так что я решил пойти обходным путем.<br/>
<br/>
Для этого я воспользовался браузером с дистанционным управлением Headless Chrome и написал для него скрипт, чтобы он “физически” загрузил странницу авторизации, ввел туда логин и пароль, а затем кликнул на кнопку.<br/>
<br/>
Для этого существует библиотека Puppeteer, которая умеет управлять браузером с помощью Node.js скриптов. Синтаксис отлично описан в <a href="https://habr.com/ru/company/ruvds/blog/341348/">этой статье</a>. Предлагаю ознакомиться с ней самостоятельно.<br/>
<br/>
После ее прочтения остается лишь вопрос, на чем запускать наши скрипты. Если вы уже опытный Node.js разработчик, то можете пропустить этот раздел. Для остальных могу предложить воспользоваться готовым сервисом от <a href="https://apify.com/" rel="nofollow">Apify.com</a>. Это избавит нас от необходимости создавать и настраивать свой сервер. Для наших задач вполне хватит бесплатного аккаунта.<br/>
<br/>
<div class="spoiler"><b class="spoiler_title">Настройки аккаунта Apify для запуска скрипта</b><div class="spoiler_text">Для начала вам потребуется зарегистрироваться на этом сервисе. После этого откройте радел со своим аккаунтом, перейдите в раздел Actors и создайте новый скрипт.<br/>
<br/>
<img src="/img/image-loader.svg" data-src="https://habrastorage.org/webt/t7/k3/iz/t7k3izx0pzrbkg7py5w57mbek9e.png"/><br/>
<br/>
В поле Name укажите название, которое будет использоваться при запуске скрипта через Api. Нажмите Save и перейдите на страницу Source. <br/>
<br/>
<img src="/img/image-loader.svg" data-src="https://habrastorage.org/webt/-9/ld/3w/-9ld3wwy506lflbbufmyvtqqzui.png"/><br/>
<br/>
Для запуска Headless Chrome выберите образ сервера “Node.js 10 + Chrome on Debian” и нажмите Save.<br/>
<br/>
<img src="/img/image-loader.svg" data-src="https://habrastorage.org/webt/qz/nd/br/qzndbr2lkua60yinbdywhgqmdag.png"/><br/>
<br/>
Теперь перейдем в раздел Api и скопируем URL POST-запроса, с помощью которого мы будем запускать наш скрипт.<br/>
<br/>
<img src="https://habrastorage.org/r/w780q1/webt/xg/ew/ss/xgewssgar-nqxgmqy0qoncozcog.jpeg" data-src="https://habrastorage.org/webt/xg/ew/ss/xgewssgar-nqxgmqy0qoncozcog.jpeg" data-blurred="true"/><br/>
<br/>
В тело этого запроса можно прикреплять JSON с данными для нашего скрипта. Я буду отправлять туда свой логин и пароль для авторизации на Strava. <br/>
<br/>
<pre><code class="plaintext">{ "email": "your_nick@gmail.com" , "password": "Your_Password" }</code></pre><br/>
</div></div><br/>
<div class="spoiler"><b class="spoiler_title">Скрипт для автоматического получения cookie данных со Strava</b><div class="spoiler_text">Теперь вернемся в раздел Source и перейдем в окошко с редактором кода. Наш скрипт будет выглядеть так:<br/>
<br/>
<pre><code class="javascript">const Apify = require('apify');

Apify.main(async () => {

  // ПОДГОТОВКА

    // Извлечь параметры из принятого JSON
    const input = await Apify.getInput();
    if (!input || !input.email || !input.password) throw new Error('Invalid input, must be a JSON object with the "email" and "password" field!');

    // Запустить среду управления браузером
    const browser = await Apify.launchPuppeteer();



  // СТРАНИЦА 1 - Получаем базовую часть cookie

    // Открыть новую вкладку
    const page1 = await browser.newPage();
    await page1.setViewport({width: 1280, height: 1024});

    // Перейти на страницу авторизации  
    await page1.goto('https://www.strava.com/login', {waitUntil: 'networkidle2'});

    // Найти на html-странице поля логин/пароль и заполнить их  
    await page1.waitForSelector('form');
    await page1.type('input#email', input.email);
    await page1.type('input#password', input.password);

    // Немного подождать, чтобы выглядеть, 
    // как настоящий человек, которому требуется время на ввод данных
    await page1.waitFor(200);

    // Найти кнопку Войти и кликнуть на нее
    await page1.evaluate(()=>document
      .querySelector('button#login-button')
      .click()
    );

    // Дождаться результатов и загрузить базовый cookie файл
    await page1.waitForNavigation();
    const sessionFourCookie = await page1.cookies();



  // СТРАНИЦА 2 - получаем дополненный cookie с ключами для просмотра карты

    // Открыть новую вкладку 
    const page2 = await browser.newPage();

    // Перейти на страницу с просомотром карты, как залогиненный пользователь.
    // То есть, указав при этом полученные в предыдущем шаге cookie
    await page2.setCookie(...sessionFourCookie);
    await page2.goto('https://heatmap-external-a.strava.com/auth');

    // Получить новый дополненный файл cookie
    const cloudfontCookie = await page2.cookies();



  // ЗАВЕРШЕНИЕ 
    
    // Закрыть среду исполнения
    await browser.close();

    // Вернуть дополненный файл cookie в теле ответа
    return cloudfontCookie;
});</code></pre><br/>
<br/>
Или же вот <a href="https://github.com/nnngrach/strava_auto_auth" rel="nofollow">ссылка</a> на GitHub с этим скриптом.<br/>
<br/>
</div></div><br/>
<h3>Финальный этап</h3><br/>
Когда скрипт отработает, он вернет файл cookie с авторизационными данными. Серверное приложение сохранит его в свою базу данных и будет использовать для всех последующих запросов карты Strava. До тех пор, пока cookie не устареют и не потребуется еще раз повторить эту процедуру. Благо, теперь все происходит автоматически. Без лишних действий со стороны пользователя.<br/>
<br/>
Увы, но не все так гладко. У этого метода есть слабое место – это скорость работы. Дело в том, что на запуск сервера, загрузку удаленного браузера, загрузку двух веб страниц и на авторизацию на каждой из них требуется некоторое время. По моим прикидкам, выходит более минуты. <br/>
<br/>
За это время навигационное приложение попросту оборвет загрузку из-за превышения тайм-аута. Поэтому лучше сразу вернуть пользователь код ошибки 401, чтобы лишний раз не высаживать ему батарею. <br/>
<br/>
Для этого серверное приложение будет устанавливать флаг, когда поймет, что cookie данные устарели. После этого этого оно отправит запрос на запуск скрипта, а пользователям будет сразу возвращать код ошибки. Иными словами, на протяжении минуты сервер будет недоступен.<br/>
<br/>
И вот когда от нашего скрипта придет ответ с новыми cookie, приложение сохранит их в свою базу данных и снимет флаг. После этого сервер снова начнет работать в штатном режиме и моментально перенаправлять пользователя на страницы для скачивания карты.<br/>
<br/>
<h3>Результат</h3><br/>
Результатом наших трудов стали неизменяющиеся URL-адреса, с помощью которых пользователи могут подключать свой навигатор к картам Strava.<br/>
<br/>
<pre><code class="plaintext">https://anygis.ru/api/v1/Tracks_Strava_All/{x}/{y}/{z}
https://anygis.ru/api/v1/Tracks_Strava_Ride/{x}/{y}/{z}
https://anygis.ru/api/v1/Tracks_Strava_Run/{x}/{y}/{z}
https://anygis.ru/api/v1/Tracks_Strava_Water/{x}/{y}/{z}
https://anygis.ru/api/v1/Tracks_Strava_Winter/{x}/{y}/{z}

https://anygis.ru/api/v1/Tracks_Strava_All_Bluered/{x}/{y}/{z}
https://anygis.ru/api/v1/Tracks_Strava_Ride_Bluered/{x}/{y}/{z}
https://anygis.ru/api/v1/Tracks_Strava_Run_Bluered/{x}/{y}/{z}
https://anygis.ru/api/v1/Tracks_Strava_Water_Bluered/{x}/{y}/{z}
https://anygis.ru/api/v1/Tracks_Strava_Winter_Bluered/{x}/{y}/{z}
</code></pre><br/>
Как вариант, можно сделать готовые пресеты с этими адресами для своего навигатора. Например, <a href="https://nnngrach.github.io/AnyGIS_maps/Web/Html/DownloadPage_ru" rel="nofollow">на этой станице</a> я выложил такие пресеты в форматах для Osmand, Locus, GuruMaps и Orux. Ссылки на скачивание карты Strava находятся в разделе “Полный набор” в подразделах “Overlay” или “Глобальные — OSM – Ways”.<br/>
<br/>
UDP: За время прошедшее с момента публикации статьи я добавил вариант этого скрипта, работающий через Docker контейнер. Инструкцию можно найти на моей страничке на <a href="https://github.com/nnngrach/strava_auto_auth" rel="nofollow">GitHub</a>.</div></div> <!----> <!----></div> <div class="tm-article-presenter__meta"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bopenstreetmap%5D" class="tm-tags-list__link">openstreetmap</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bstrava%20heatmap%5D" class="tm-tags-list__link">strava heatmap</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bpuppeteer%5D" class="tm-tags-list__link">puppeteer</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bheadless%20chrome%5D" class="tm-tags-list__link">headless chrome</a></li></ul></div> <div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/hub/nodejs/" class="tm-hubs-list__link">
    Node.JS
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/openstreetmap/" class="tm-hubs-list__link">
    OpenStreetMap
  </a></li></ul></div></div></article></div> <!----></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 14: ↑14 и ↓0</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-rating"></use></svg> <span title="Всего голосов 14: ↑14 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_medium">+14</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">3.6K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    16
  </span></button> <!----> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> </div></div> <!----> <!----> <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/nnngrach/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><img alt="" src="//habrastorage.org/getpro/habr/avatars/2bd/c33/60e/2bdc3360e57e711820504a0caa8d9386.jpg" class="tm-entity-image__pic"></div></a> <div class="tm-user-card__meta"><div title=" 11 голосов " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    11
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">0</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title_variant-article"><span class="tm-user-card__name tm-user-card__name_variant-article">Макс Кожин</span> <a href="/ru/users/nnngrach/" class="tm-user-card__nickname tm-user-card__nickname_variant-article">
          @nnngrach
        </a> <!----></div> <p class="tm-user-card__short-info tm-user-card__short-info_variant-article">IOS разработчик</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-article"><!----> <!----> <!----> <!----> <!----></div></div> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----></section> <div class="tm-article-blocks__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/post/451620/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 3 
    </span></a> <!----></div></div></div> <div class="tm-ad-banner__container tm-page-article__banner"><!----> <div id="articleBottomBanner" class="tm-ad-banner"></div></div> <!----> <!----> <!----> <!----> </div></div></div></div></div> <div class="tm-page__sidebar"><div class="tm-layout-sidebar"><div class="tm-layout-sidebar__ads tm-layout-sidebar__ads_initial"><div class="tm-ad-banner__container tm-layout-sidebar__banner"><!----> <div id="sidebarBanner" class="tm-ad-banner"></div></div></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----> <!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/post/451620/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/post/451620/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"451620":{"id":"451620","timePublished":"2019-05-13T14:52:50+00:00","isCorporative":false,"lang":"ru","titleHtml":"Автоматическая авторизация на карте Strava Heatmap","leadData":{"textHtml":"\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fgz\u002Fwx\u002Frp\u002Fgzwxrp6vtom8fjvn4uncz1bw8qs.png\"\u003E\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nДанный пост является ответом на недавнюю \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F450124\u002F\"\u003Eаналогичную статью\u003C\u002Fa\u003E. Попробую рассказать, как можно автоматизировать описанные в ней действия. И как подключить эту тепловую карту к навигатору смартфона.\u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше →","image":null},"editorVersion":"1.0","postType":"article","postLabels":[{"type":"sandbox","data":null},{"type":"tutorial","data":null}],"author":{"scoreStats":{"score":11,"votesCount":11},"rating":0,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"2050987","alias":"nnngrach","fullname":"Макс Кожин","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F2bd\u002Fc33\u002F60e\u002F2bdc3360e57e711820504a0caa8d9386.jpg","speciality":"IOS разработчик"},"statistics":{"commentsCount":3,"favoritesCount":16,"readingCount":3601,"score":14,"votesCount":14},"hubs":[{"relatedData":null,"id":"17110","alias":"nodejs","type":"collective","title":"Node.JS","titleHtml":"Node.JS","isProfiled":true},{"relatedData":null,"id":"17153","alias":"openstreetmap","type":"collective","title":"OpenStreetMap","titleHtml":"OpenStreetMap","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fgz\u002Fwx\u002Frp\u002Fgzwxrp6vtom8fjvn4uncz1bw8qs.png\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДанный пост является ответом на недавнюю \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F450124\u002F\"\u003Eаналогичную статью\u003C\u002Fa\u003E. Попробую рассказать, как можно автоматизировать описанные в ней действия. И как подключить эту тепловую карту к навигатору смартфона.\u003Cbr\u002F\u003E\r\n\u003Ca name=\"habracut\"\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\nВ статье рассматривалось, чем полезны карты Strava Heatmap для туристов и велосипедистов и о том, как подключить к ним навигационное приложение на смартфоне на примере Osmand. Дело в том, что для загрузки каждого кусочка карты нужно указывать параметры с авторизационными данными. Примерно так:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003EGET https:\u002F\u002Fheatmap-external-{abc}.strava.com\u002Ftiles-auth\u002Fall\u002Fhot\u002F{z}\u002F{x}\u002F{y}.png?px=256&amp;Signature={CloudFront-Signature}&amp;Key-Pair-Id={CloudFront-Key-Pair-Id}&amp;Policy={CloudFront-Policy}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nЧтобы получить эти данные, предлагалось авторизироваться на сайте Strava с десктопного браузера. Как результат, в браузере должны появиться cookie файлы. Нужно найти в них требуемые строки и скопировать их в адрес запроса. А затем, вручную ввести запрос в Osmand, чтобы он смог скачивать с его помощью карту.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nОднако этот способ он не очень удобен, ведь авторизационные данные быстро устаревают и приходится раз в несколько дней повторять вышеописанные действия. В этой статье я расскажу, как можно автоматизировать вышеописанный метод. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003EДобавляем промежуточное звено\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\nЧтобы пользователю не приходилось заменять в смартфоне URL запроса каждый раз, когда cookie-данные устаревают, нужно указать какой-нибудь неизменный URL. Я указал ссылку на свое серверное приложение. Это приложение будет редиректить пользователя на различные адреса в зависимости от указанных параметров. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003Ehttps:\u002F\u002Fanygis.herokuapp.com\u002FTracks_Strava_All\u002F{x}\u002F{y}\u002F{z}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nЧтобы быстрее перейти к сути, я не буду подробно останавливаться на описании этого серверного приложения. Расскажу лишь об основных его действиях.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЕсли запрашивается тайл с зумом до 12 (такие Stava отдает без авторизации), то пользователь сразу перенаправляется на публичный URL.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003Ehttps:\u002F\u002Fheatmap-external-a.strava.com\u002Ftiles\u002Fall\u002Fhot\u002F10\u002F619\u002F318.png\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nЕсли же нет, то выполняется проверка. Для быстрого доступа приложение хранит в своей базе данных последнюю рабочую версию файла cookie. Когда оно получает запрос, оно парсит этот файл и создает URL со всеми подставленными параметрами. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\"\u003E\u003Cb class=\"spoiler_title\"\u003EПолучается что-то вроде этого\u003C\u002Fb\u003E\u003Cdiv class=\"spoiler_text\"\u003E\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003Ehttps:\u002F\u002Fheatmap-external-a.strava.com\u002Ftiles-auth\u002Fall\u002Fhot\u002F10\u002F619\u002F318.png?px=256&lt;b\u003E&amp;Signature&lt;\u002Fb\u003E=Q47FWl1RX-5tLNK9fGfa7hdoxqwwjCLfrxwb~L3eke8h~glz5IBHmkLmu8ofh6eNWUM3usHTz4Z3rypbQGByC2jRhdzL2iJndIOu2TY9ZU34YUJV9QgMEf0L5cDHGjEsksYSVdkCqNRvOMnnzUc96wR9sktK2a0pcsI~E5eNvqjfsGbSWi6KCdfc1-~2D8t9YjbKftokhvMY20pM~PD6Y-fGYmpoTO5LOyMfIYboXnKGm29VnA9kA8LIxD-LzpADWO81i4pOMBvkVkJuLBGtO96a79P5D4tRP05DpI7y457LuKcuqRZaVQRB1L2AXgKvQgnx6nqr9T2jRAZNoy06ng__\n&lt;b\u003E&amp;Key-Pair-Id&lt;\u002Fb\u003E=APKAIDPUN4QMG7VUQPSA\n&lt;b\u003E&amp;Policy&lt;\u002Fb\u003E=eyJTdGF0ZW1lbnQiOiBbeyJSZXNvdXJjZSI6Imh0dHBzOi8vaGVhdG1hcC1leHRlcm5hbC0qLnN0cmF2YS5jb20vKiIsIkNvbmRpdGlvbiI6eyJEYXRlTGVzc1RoYW4iOnsiQVdTOkVwb2NoVGltZSI6MTU1ODUwODc2Mn0sIkRhdGVHcmVhdGVyVGhhbiI6eyJBV1M6RXBvY2hUaW1lIjoxNTU3Mjg0NzYyfX19XX0_\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nПосле этого оно отправляет HEAD запрос на этот адрес, чтобы проверить, доступен он или нет. Если в ответ приходит статус код “200 Success”, значит cookie все еще рабочие. Приложение просто редиректит пользователя на этот адрес и у него прекрасно загружается карта.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nА вот если приходит код “401 Unauthorized”, то значит cookie устарели и нужно заново их получить. В этом случае приложение запускает скрипт для получение авторизационных данных.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003EАвтоматическая авторизация\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\nПервая мысль, которая приходит в голову, это пройти авторизацию с помощью Strava API. Увы, но мне так и не удалось вытянуть оттуда нужные параметры. Так что я решил пойти обходным путем.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДля этого я воспользовался браузером с дистанционным управлением Headless Chrome и написал для него скрипт, чтобы он “физически” загрузил странницу авторизации, ввел туда логин и пароль, а затем кликнул на кнопку.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДля этого существует библиотека Puppeteer, которая умеет управлять браузером с помощью Node.js скриптов. Синтаксис отлично описан в \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fruvds\u002Fblog\u002F341348\u002F\"\u003Eэтой статье\u003C\u002Fa\u003E. Предлагаю ознакомиться с ней самостоятельно.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПосле ее прочтения остается лишь вопрос, на чем запускать наши скрипты. Если вы уже опытный Node.js разработчик, то можете пропустить этот раздел. Для остальных могу предложить воспользоваться готовым сервисом от \u003Ca href=\"https:\u002F\u002Fapify.com\u002F\" rel=\"nofollow\"\u003EApify.com\u003C\u002Fa\u003E. Это избавит нас от необходимости создавать и настраивать свой сервер. Для наших задач вполне хватит бесплатного аккаунта.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\"\u003E\u003Cb class=\"spoiler_title\"\u003EНастройки аккаунта Apify для запуска скрипта\u003C\u002Fb\u003E\u003Cdiv class=\"spoiler_text\"\u003EДля начала вам потребуется зарегистрироваться на этом сервисе. После этого откройте радел со своим аккаунтом, перейдите в раздел Actors и создайте новый скрипт.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Ft7\u002Fk3\u002Fiz\u002Ft7k3izx0pzrbkg7py5w57mbek9e.png\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВ поле Name укажите название, которое будет использоваться при запуске скрипта через Api. Нажмите Save и перейдите на страницу Source. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F-9\u002Fld\u002F3w\u002F-9ld3wwy506lflbbufmyvtqqzui.png\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДля запуска Headless Chrome выберите образ сервера “Node.js 10 + Chrome on Debian” и нажмите Save.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fqz\u002Fnd\u002Fbr\u002Fqzndbr2lkua60yinbdywhgqmdag.png\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТеперь перейдем в раздел Api и скопируем URL POST-запроса, с помощью которого мы будем запускать наш скрипт.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Fxg\u002Few\u002Fss\u002Fxgewssgar-nqxgmqy0qoncozcog.jpeg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fxg\u002Few\u002Fss\u002Fxgewssgar-nqxgmqy0qoncozcog.jpeg\" data-blurred=\"true\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВ тело этого запроса можно прикреплять JSON с данными для нашего скрипта. Я буду отправлять туда свой логин и пароль для авторизации на Strava. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003E{ \"email\": \"your_nick@gmail.com\" , \"password\": \"Your_Password\" }\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\"\u003E\u003Cb class=\"spoiler_title\"\u003EСкрипт для автоматического получения cookie данных со Strava\u003C\u002Fb\u003E\u003Cdiv class=\"spoiler_text\"\u003EТеперь вернемся в раздел Source и перейдем в окошко с редактором кода. Наш скрипт будет выглядеть так:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Econst Apify = require('apify');\n\nApify.main(async () =\u003E {\n\n  \u002F\u002F ПОДГОТОВКА\n\n    \u002F\u002F Извлечь параметры из принятого JSON\n    const input = await Apify.getInput();\n    if (!input || !input.email || !input.password) throw new Error('Invalid input, must be a JSON object with the \"email\" and \"password\" field!');\n\n    \u002F\u002F Запустить среду управления браузером\n    const browser = await Apify.launchPuppeteer();\n\n\n\n  \u002F\u002F СТРАНИЦА 1 - Получаем базовую часть cookie\n\n    \u002F\u002F Открыть новую вкладку\n    const page1 = await browser.newPage();\n    await page1.setViewport({width: 1280, height: 1024});\n\n    \u002F\u002F Перейти на страницу авторизации  \n    await page1.goto('https:\u002F\u002Fwww.strava.com\u002Flogin', {waitUntil: 'networkidle2'});\n\n    \u002F\u002F Найти на html-странице поля логин\u002Fпароль и заполнить их  \n    await page1.waitForSelector('form');\n    await page1.type('input#email', input.email);\n    await page1.type('input#password', input.password);\n\n    \u002F\u002F Немного подождать, чтобы выглядеть, \n    \u002F\u002F как настоящий человек, которому требуется время на ввод данных\n    await page1.waitFor(200);\n\n    \u002F\u002F Найти кнопку Войти и кликнуть на нее\n    await page1.evaluate(()=\u003Edocument\n      .querySelector('button#login-button')\n      .click()\n    );\n\n    \u002F\u002F Дождаться результатов и загрузить базовый cookie файл\n    await page1.waitForNavigation();\n    const sessionFourCookie = await page1.cookies();\n\n\n\n  \u002F\u002F СТРАНИЦА 2 - получаем дополненный cookie с ключами для просмотра карты\n\n    \u002F\u002F Открыть новую вкладку \n    const page2 = await browser.newPage();\n\n    \u002F\u002F Перейти на страницу с просомотром карты, как залогиненный пользователь.\n    \u002F\u002F То есть, указав при этом полученные в предыдущем шаге cookie\n    await page2.setCookie(...sessionFourCookie);\n    await page2.goto('https:\u002F\u002Fheatmap-external-a.strava.com\u002Fauth');\n\n    \u002F\u002F Получить новый дополненный файл cookie\n    const cloudfontCookie = await page2.cookies();\n\n\n\n  \u002F\u002F ЗАВЕРШЕНИЕ \n    \n    \u002F\u002F Закрыть среду исполнения\n    await browser.close();\n\n    \u002F\u002F Вернуть дополненный файл cookie в теле ответа\n    return cloudfontCookie;\n});\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nИли же вот \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fnnngrach\u002Fstrava_auto_auth\" rel=\"nofollow\"\u003Eссылка\u003C\u002Fa\u003E на GitHub с этим скриптом.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Ch3\u003EФинальный этап\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\nКогда скрипт отработает, он вернет файл cookie с авторизационными данными. Серверное приложение сохранит его в свою базу данных и будет использовать для всех последующих запросов карты Strava. До тех пор, пока cookie не устареют и не потребуется еще раз повторить эту процедуру. Благо, теперь все происходит автоматически. Без лишних действий со стороны пользователя.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nУвы, но не все так гладко. У этого метода есть слабое место – это скорость работы. Дело в том, что на запуск сервера, загрузку удаленного браузера, загрузку двух веб страниц и на авторизацию на каждой из них требуется некоторое время. По моим прикидкам, выходит более минуты. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗа это время навигационное приложение попросту оборвет загрузку из-за превышения тайм-аута. Поэтому лучше сразу вернуть пользователь код ошибки 401, чтобы лишний раз не высаживать ему батарею. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДля этого серверное приложение будет устанавливать флаг, когда поймет, что cookie данные устарели. После этого этого оно отправит запрос на запуск скрипта, а пользователям будет сразу возвращать код ошибки. Иными словами, на протяжении минуты сервер будет недоступен.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nИ вот когда от нашего скрипта придет ответ с новыми cookie, приложение сохранит их в свою базу данных и снимет флаг. После этого сервер снова начнет работать в штатном режиме и моментально перенаправлять пользователя на страницы для скачивания карты.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003EРезультат\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\nРезультатом наших трудов стали неизменяющиеся URL-адреса, с помощью которых пользователи могут подключать свой навигатор к картам Strava.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003Ehttps:\u002F\u002Fanygis.ru\u002Fapi\u002Fv1\u002FTracks_Strava_All\u002F{x}\u002F{y}\u002F{z}\nhttps:\u002F\u002Fanygis.ru\u002Fapi\u002Fv1\u002FTracks_Strava_Ride\u002F{x}\u002F{y}\u002F{z}\nhttps:\u002F\u002Fanygis.ru\u002Fapi\u002Fv1\u002FTracks_Strava_Run\u002F{x}\u002F{y}\u002F{z}\nhttps:\u002F\u002Fanygis.ru\u002Fapi\u002Fv1\u002FTracks_Strava_Water\u002F{x}\u002F{y}\u002F{z}\nhttps:\u002F\u002Fanygis.ru\u002Fapi\u002Fv1\u002FTracks_Strava_Winter\u002F{x}\u002F{y}\u002F{z}\n\nhttps:\u002F\u002Fanygis.ru\u002Fapi\u002Fv1\u002FTracks_Strava_All_Bluered\u002F{x}\u002F{y}\u002F{z}\nhttps:\u002F\u002Fanygis.ru\u002Fapi\u002Fv1\u002FTracks_Strava_Ride_Bluered\u002F{x}\u002F{y}\u002F{z}\nhttps:\u002F\u002Fanygis.ru\u002Fapi\u002Fv1\u002FTracks_Strava_Run_Bluered\u002F{x}\u002F{y}\u002F{z}\nhttps:\u002F\u002Fanygis.ru\u002Fapi\u002Fv1\u002FTracks_Strava_Water_Bluered\u002F{x}\u002F{y}\u002F{z}\nhttps:\u002F\u002Fanygis.ru\u002Fapi\u002Fv1\u002FTracks_Strava_Winter_Bluered\u002F{x}\u002F{y}\u002F{z}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nКак вариант, можно сделать готовые пресеты с этими адресами для своего навигатора. Например, \u003Ca href=\"https:\u002F\u002Fnnngrach.github.io\u002FAnyGIS_maps\u002FWeb\u002FHtml\u002FDownloadPage_ru\" rel=\"nofollow\"\u003Eна этой станице\u003C\u002Fa\u003E я выложил такие пресеты в форматах для Osmand, Locus, GuruMaps и Orux. Ссылки на скачивание карты Strava находятся в разделе “Полный набор” в подразделах “Overlay” или “Глобальные — OSM – Ways”.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nUDP: За время прошедшее с момента публикации статьи я добавил вариант этого скрипта, работающий через Docker контейнер. Инструкцию можно найти на моей страничке на \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fnnngrach\u002Fstrava_auto_auth\" rel=\"nofollow\"\u003EGitHub\u003C\u002Fa\u003E.\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"openstreetmap"},{"titleHtml":"strava heatmap"},{"titleHtml":"puppeteer"},{"titleHtml":"headless chrome"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fgz\u002Fwx\u002Frp\u002Fgzwxrp6vtom8fjvn4uncz1bw8qs.png","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fgz\u002Fwx\u002Frp\u002Fgzwxrp6vtom8fjvn4uncz1bw8qs.png","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F451620\\\u002F\"},\"headline\":\"Автоматическая авторизация на карте Strava Heatmap\",\"datePublished\":\"2019-05-13T17:52:50+03:00\",\"dateModified\":\"2020-01-08T22:23:40+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"Макс Кожин\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"Данный пост является ответом на недавнюю аналогичную статью. Попробую рассказать, как можно автоматизировать описанные в ней действия. И как подключить эту теп...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F451620\\\u002F#post-content-body\",\"about\":[\"h_nodejs\",\"h_openstreetmap\",\"f_develop\"],\"image\":[\"https:\\\u002F\\\u002Fhabr.com\\\u002Fshare\\\u002Fpublication\\\u002F451620\\\u002F96f29e3bf785e9cefeee0bb92e4199e6\\\u002F\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fgz\\\u002Fwx\\\u002Frp\\\u002Fgzwxrp6vtom8fjvn4uncz1bw8qs.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Ft7\\\u002Fk3\\\u002Fiz\\\u002Ft7k3izx0pzrbkg7py5w57mbek9e.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F-9\\\u002Fld\\\u002F3w\\\u002F-9ld3wwy506lflbbufmyvtqqzui.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fqz\\\u002Fnd\\\u002Fbr\\\u002Fqzndbr2lkua60yinbdywhgqmdag.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fxg\\\u002Few\\\u002Fss\\\u002Fxgewssgar-nqxgmqy0qoncozcog.jpeg\"]}","metaDescription":"Данный пост является ответом на недавнюю аналогичную статью. Попробую рассказать, как можно автоматизировать описанные в ней действия. И как подключить эту тепловую карту к навигатору...","mainImageUrl":null,"amp":false},"polls":[],"commentsEnabled":true,"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[],"hubs":"nodejs,openstreetmap"},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.c0af73e7.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
