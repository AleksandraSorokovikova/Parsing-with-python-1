<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Решаем задачу Best Reverser с PHDays 9 / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.c0af73e7.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.85eb77f0b17c8235e7b64b9f81ea5ec2.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/post\/453194\/"},"headline":"Решаем задачу Best Reverser с PHDays 9","datePublished":"2019-05-23T19:58:11+03:00","dateModified":"2019-05-23T19:58:11+03:00","author":{"@type":"Person","name":"Марат Гаянов"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"Здравствуйте!  Меня зовут Марат Гаянов, я хочу поделиться с вами моим решением задачи с конкурса Best Reverser, показать, как сделать кейген для этого кейса.   О...","url":"https:\/\/habr.com\/ru\/post\/453194\/#post-content-body","about":["h_reverse-engineering","f_develop"],"image":["https:\/\/habrastorage.org\/webt\/rp\/ja\/bo\/rpjabo27x0oemehl_380bdoiyto.png","https:\/\/hsto.org\/webt\/-b\/ru\/fb\/-brufb6jqqrejxctfwwvrp8l0xu.png","https:\/\/hsto.org\/webt\/6y\/6m\/jb\/6y6mjbg8kod7ys087rlbngrshky.png","https:\/\/habrastorage.org\/webt\/jq\/h5\/mf\/jqh5mfieh1st-s6fktdghtomemy.png","https:\/\/hsto.org\/webt\/w4\/sa\/1p\/w4sa1p9_t4czdofd4jjj-tdtg4q.png","https:\/\/hsto.org\/webt\/1d\/bp\/xy\/1dbpxyojlaks20xlmgivzm0rpdw.png","https:\/\/hsto.org\/webt\/bo\/c1\/tc\/boc1tck7dpjuq46sppgq93wghfu.png","https:\/\/hsto.org\/webt\/qs\/l9\/k4\/qsl9k4apyhz2orh5lz9vphf-gdo.png","https:\/\/hsto.org\/webt\/on\/kw\/c8\/onkwc8dvpch6ckyjbcl0a-9zx4q.png","https:\/\/hsto.org\/webt\/at\/_t\/_j\/at_t_jhxaruncxgntbn-i5t396o.png","https:\/\/hsto.org\/webt\/g4\/oy\/w6\/g4oyw6inctcnokzxmo1r5kbfl9c.png","https:\/\/hsto.org\/webt\/x-\/tu\/mv\/x-tumvz-5akeokp44a-wlclamuu.png","https:\/\/hsto.org\/webt\/ft\/gy\/ke\/ftgykerggzjdpvpseel8vm7vaji.png","https:\/\/hsto.org\/webt\/fa\/6l\/a0\/fa6la0nx5iia9ldl24wgxibdwhy.png","https:\/\/hsto.org\/webt\/wr\/ya\/gj\/wryagjtwp8fvk35qfeyukg9meae.png","https:\/\/hsto.org\/webt\/m6\/8g\/ym\/m68gymzx3mold0wdl1g0xnab-sw.png","https:\/\/hsto.org\/webt\/id\/rr\/k_\/idrrk_tmum_fu409yn21tqygisk.png","https:\/\/hsto.org\/webt\/e0\/nl\/z_\/e0nlz_whuvgznlt-efdiuecujqa.png","https:\/\/hsto.org\/webt\/i8\/tn\/kv\/i8tnkvhk6mc5nirtlb9hlwj-bui.png","https:\/\/hsto.org\/webt\/1d\/bp\/xy\/1dbpxyojlaks20xlmgivzm0rpdw.png","https:\/\/habrastorage.org\/webt\/p7\/0l\/ry\/p70lrykx4qd6lof_e5kcnmcjbbk.png","https:\/\/habrastorage.org\/webt\/_4\/u0\/tv\/_4u0tvhvply85bhmwhjki65l0vu.png","https:\/\/hsto.org\/webt\/pc\/um\/u1\/pcumu10pkuhgdcfehysc-hzlbk4.png","https:\/\/habrastorage.org\/webt\/8p\/mt\/uh\/8pmtuh7u7gigntcmbx7wugc6q5e.png","https:\/\/hsto.org\/webt\/lg\/_-\/2k\/lg_-2kw8yl2_klsq5azj1mebnzs.png","https:\/\/habrastorage.org\/webt\/8p\/mt\/uh\/8pmtuh7u7gigntcmbx7wugc6q5e.png","https:\/\/habrastorage.org\/webt\/xt\/p9\/ac\/xtp9acx13gq3qrtvnisseyt8lfw.png","https:\/\/hsto.org\/webt\/fd\/uv\/xk\/fduvxkbfaxne_7eratvlhuqdt8w.png","https:\/\/hsto.org\/webt\/pc\/um\/u1\/pcumu10pkuhgdcfehysc-hzlbk4.png","https:\/\/hsto.org\/webt\/rq\/qu\/4d\/rqqu4dswxqemcgszszulcrrc8mc.png","https:\/\/hsto.org\/webt\/lg\/_-\/2k\/lg_-2kw8yl2_klsq5azj1mebnzs.png","https:\/\/habrastorage.org\/webt\/lb\/zp\/bo\/lbzpbohzrioqfs-3h_jj7q5v4sy.png","https:\/\/hsto.org\/webt\/wl\/ln\/5i\/wlln5if5bzqcukbxnvpc_osl5lw.png","https:\/\/hsto.org\/webt\/rp\/ja\/bo\/rpjabo27x0oemehl_380bdoiyto.png"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.49.0">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="Решаем задачу Best Reverser с PHDays 9" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Решаем задачу Best Reverser с PHDays 9" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Решаем задачу Best Reverser с PHDays 9" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="Здравствуйте!

Меня зовут Марат Гаянов, я хочу поделиться с вами моим решением задачи с конкурса Best Reverser, показать, как сделать кейген для этого кейса.


Описание
В этом конкурсе..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="Здравствуйте!

Меня зовут Марат Гаянов, я хочу поделиться с вами моим решением задачи с конкурса Best Reverser, показать, как сделать кейген для этого кейса.


Описание
В этом конкурсе..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="Здравствуйте!

Меня зовут Марат Гаянов, я хочу поделиться с вами моим решением задачи с конкурса Best Reverser, показать, как сделать кейген для этого кейса.


Описание
В этом конкурсе..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="Здравствуйте!

Меня зовут Марат Гаянов, я хочу поделиться с вами моим решением задачи с конкурса Best Reverser, показать, как сделать кейген для этого кейса.


Описание
В этом конкурсе..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="Здравствуйте!

Меня зовут Марат Гаянов, я хочу поделиться с вами моим решением задачи с конкурса Best Reverser, показать, как сделать кейген для этого кейса.


Описание
В этом конкурсе..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habr.com/share/publication/453194/210ed7955b578e5c2412a469218da990/" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habr.com/share/publication/453194/210ed7955b578e5c2412a469218da990/" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habr.com/share/publication/453194/210ed7955b578e5c2412a469218da990/" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habr.com/share/publication/453194/210ed7955b578e5c2412a469218da990/" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habr.com/share/publication/453194/210ed7955b578e5c2412a469218da990/" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="453194" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2019-05-23T16:58:11.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/453194/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/post/453194/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habr.com/share/publication/453194/210ed7955b578e5c2412a469218da990/" data-vmid="image:href">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
            Как стать автором
          </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" data-async-called="true" class="tm-page"><div class="tm-page-width"><!----> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/xoo/" title="xoo" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="" height="24" loading="lazy" src="//habrastorage.org/r/w32/getpro/habr/avatars/cd4/b9d/b52/cd4b9db521867a394b28b9ab81140989.png" width="24" class="tm-entity-image__pic"></div></a> <span class="tm-user-info__user"><a href="/ru/users/xoo/" class="tm-user-info__username">
      xoo
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2019-05-23T16:58:11.000Z" title="2019-05-23, 19:58">23  мая  2019 в 19:58</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>Решаем задачу Best Reverser с PHDays 9</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/reverse-engineering/" class="tm-article-snippet__hubs-item-link"><span>Реверс-инжиниринг</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <div class="tm-article-snippet__labels"><div class="tm-article-snippet__label"><span>
        Из песочницы
      </span></div></div> <!----> <!----></div></div> <!----> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-1"><div xmlns="http://www.w3.org/1999/xhtml">Здравствуйте!<br/>
<br/>
Меня зовут Марат Гаянов, я хочу поделиться с вами моим решением задачи с конкурса <a href="https://www.phdays.com/ru/program/contests/best-reverser/">Best Reverser</a>, показать, как сделать кейген для этого кейса.<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" alt="image" data-src="https://habrastorage.org/webt/rp/ja/bo/rpjabo27x0oemehl_380bdoiyto.png"/></div><br/>
<h2>Описание</h2><br/>
В этом конкурсе участникам предоставляется ROM игры для Sega Mega Drive (<a href="https://www.phdays.com/upload/ru/program/contests/best_reverser_phd9_rom_v4.bin">best_reverser_phd9_rom_v4.bin</a>).<br/>
<br/>
Задача: подобрать такой ключ, который в паре с email-адресом участника будет признан валидным.<br/>
<br/>
Итак, решение…<br/>
<a name="habracut"></a><br/>
<h2>Инструменты</h2><br/>
<ul>
<li>IDA Pro 6.8 </li>
<li><a href="https://github.com/lab313ru/smd_ida_tools">Плагин smd_ida_tools</a></li>
</ul><br/>
<h2>Проверка длины ключа</h2><br/>
Программа принимает не всякий ключ: нужно заполнить поле целиком, это 16 символов. Если ключ короче, то вы увидите сообщение: «Wrong length! Try again…».<br/>
<br/>
Попробуем найти эту строчку в программе, для чего воспользуемся бинарным поиском(Alt-B). Что мы найдем?<br/>
<br/>
Найдем не только эту, но и рядом остальные служебные строки: «Wrong key! Try again…» и «YOU ARE THE BEST REVERSER!».<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" alt="image" data-src="https://hsto.org/webt/-b/ru/fb/-brufb6jqqrejxctfwwvrp8l0xu.png"/></div><br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" alt="image" data-src="https://hsto.org/webt/6y/6m/jb/6y6mjbg8kod7ys087rlbngrshky.png"/></div><br/>
Ярлыки <code>WRONG_LENGTH_MSG</code>, <code>YOU_ARE_THE_BEST_MSG</code> и <code>WRONG_KEY_MSG</code> поставил я, чтобы было удобно.<br/>
<br/>
Поставим брейк на чтение адреса <code>0x0000FDFA</code> — выясним, кто работает с сообщением «Wrong length! Try again…». И запустим отладчик(он несколько раз остановится еще до того как можно будет вводить ключ, просто жмем F9 на каждой остановке). Вводим свой email, ключ <code>ABCD</code>.<br/>
<br/>
Отладчик приводит на <code>0x00006FF0 tst.b (a1)+</code>:<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" alt="image" data-src="https://habrastorage.org/webt/jq/h5/mf/jqh5mfieh1st-s6fktdghtomemy.png"/></div><br/>
Ничего интересного в самом блоке нет. Гораздо интереснее, кто передает управление сюда. Смотрим колл стэк:<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" alt="image" data-src="https://hsto.org/webt/w4/sa/1p/w4sa1p9_t4czdofd4jjj-tdtg4q.png"/></div><br/>
Жмем и попадем сюда — на инструкцию <code>0x00001D2A jsr (sub_6FC0).l</code>:<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" alt="image" data-src="https://hsto.org/webt/1d/bp/xy/1dbpxyojlaks20xlmgivzm0rpdw.png"/></div><br/>
Видим, что все возможные сообщения нашлись в одном месте. Но давайте узнаем, откуда передается управление в блок <code>WRONG_KEY_LEN_CASE_1D1C</code>. Не будем ставить брейки, просто наведем курсор на стрелку, идущую к блоку. Вызывающий расположился на адресе <code>0x000017DE loc_17DE</code>(который я переименую в <code>CHECK_KEY_LEN</code>):<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" alt="image" data-src="https://hsto.org/webt/bo/c1/tc/boc1tck7dpjuq46sppgq93wghfu.png"/></div><br/>
Поставим брейк на адрес <code>0x000017EC cmpi.b 0x20 (a0, d0.l)</code>(инструкция в этом контексте смотрит, нет ли пустого символа в конце массива символов ключа), перезапустимся, снова введем почту и ключ <code>ABCD</code>. Отладчик останавливается и показывает, что по адресу <code>0x00FF01C7</code>(хранящемуся в этот момент в регистре <code>a0</code>) находится введенный ключ:<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" alt="image" data-src="https://hsto.org/webt/qs/l9/k4/qsl9k4apyhz2orh5lz9vphf-gdo.png"/></div><br/>
Это хорошая находка, через нее мы выцепим вообще все. Но сначала разметим байты ключа для удобства:<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" alt="image" data-src="https://hsto.org/webt/on/kw/c8/onkwc8dvpch6ckyjbcl0a-9zx4q.png"/></div><br/>
Прокрутив вверх с этого места, увидим что почта хранится рядом с ключом:<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" alt="image" data-src="https://hsto.org/webt/at/_t/_j/at_t_jhxaruncxgntbn-i5t396o.png"/></div><br/>
Мы погружаемся все глубже и глубже, и пришло время найти критерий правильности ключа. Вернее, первой половины ключа.<br/>
<br/>
<h2>Критерий правильности первой половины ключа</h2><br/>
<h3>Предварительные вычисления</h3><br/>
Логично предположить, что сразу после проверки длины последуют другие операции с ключом. Рассмотрим блок сразу за проверкой:<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" alt="image" data-src="https://hsto.org/webt/g4/oy/w6/g4oyw6inctcnokzxmo1r5kbfl9c.png"/></div><br/>
В этом блоке идет предварительная работа. Функция <code>get_hash_2b</code>(в оригинале было <code>sub_1526</code>) вызывается дважды. Сначала ей передается адрес первого байта ключа(регистр <code>a0</code> содержит адрес <code>KEY_BYTE_0</code>), во второй раз — пятого(<code>KEY_BYTE_4</code>).<br/>
<br/>
Я назвал функцию так, потому что она считает что-то типа хэша размером 2 байта. Это самое понятное название, которое я подобрал.<br/>
<br/>
Саму функцию рассматривать я не буду, а сразу напишу ее на питоне. Она делает простые вещи, но ее описание со скринами займет много места.<br/>
<br/>
Самое важное, что о ней нужно сказать: на вход подается начальный адрес, а работа идет над 4-мя байтами от этого адреса. То есть подали на вход первый байт ключа, а функция будет работать с 1,2,3,4-ым. Подали пятый, функция работает с 5,6,7,8-ым. Иными словами, в этом блоке идут вычисления над первой половиной ключа. Результат пишется в регистр <code>d0</code>.<br/>
<br/>
Итак, функция <code>get_hash_2b</code>:<br/>
<br/>
<pre><code class="python"># key_4s - четыре символа ключа
def get_hash_2b(key_4s):
	# Правило преобразования байта
	def transform(b):

		# numbers -.
		if b &lt;= 0x39:
			r = b - 0x30
		# Letter case and @
		else:
			# @ABCDEF
			if b &lt;= 0x46:
				r = b - 0x37
			else:
				# WXYZ
				if b >= 0x57:
					r = b - 0x57
				# GHIJKLMNOPQRSTUV
				else:
					r = 0xff - (0x57 - b) + 1  # a9+b

		return r

	# Перевод в байты
	key_4b = bytearray(key_4s, encoding="ascii")

	# Каждый байт аргумента трансформируется
	codes = [transform(b) for b in key_4b]

	# А здесь они просто склеиваются
	part0 = (codes[0] &amp; 0xff) &lt;&lt; 0xc
	part1 = (codes[1] &lt;&lt; 0x8) &amp; 0xf00
	part2 = (codes[2] &lt;&lt; 0x4) &amp; 0xf0
	hash_2b = (part0 | part1) &amp; 0xffff
	hash_2b = (hash_2b | part2) &amp; 0xffff
	hash_2b = (hash_2b | (codes[3] &amp; 0xf))

	return hash_2b</code></pre><br/>
Сразу напишем функцию декодирования хэша:<br/>
<br/>
<pre><code class="python"># Возвращает строку из 4-х символов
def decode_hash_4s(hash_2b):

	# Правило преобразования байта
	def transform(b):
		if b &lt;= 0x9:
			return b + 0x30
		if b &lt;= 0xF:
			return b + 0x37
		if b >= 0x0:
			return b + 0x57
		return b - 0xa9

	# Нарезаем отдельные байты из переданного хэша и переводи
	b0 = transform(hash_2b >> 12)
	b1 = transform((hash_2b &amp; 0xfff) >> 8)
	b2 = transform((hash_2b &amp; 0xff) >> 4)
	b3 = transform(hash_2b &amp; 0xf)

	# Склеиваем
	key_4s = [chr(b0), chr(b1), chr(b2), chr(b3)]
	key_4s = "".join(key_4s)

	return key_4s</code></pre><br/>
Лучше функцию декодирования я не придумал, и она не совсем правильная. Поэтому я буду ее проверять так(не прямо сейчас, а значительно позже):<br/>
<br/>
<pre><code class="python">key_4s == decode_hash_4s(get_hash_2b(key_4s))</code></pre><br/>
Проверим работу <code>get_hash_2b</code>. Нас интересует состояние регистра <code>d0</code> после выполнения функции. Ставим брейки на <code>0x000017FE</code>, <code>0x00001808</code>, ключ вводим <code>ABCDEFGHIJKLMNOP</code>.<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" alt="image" data-src="https://hsto.org/webt/x-/tu/mv/x-tumvz-5akeokp44a-wlclamuu.png"/></div><br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" alt="image" data-src="https://hsto.org/webt/ft/gy/ke/ftgykerggzjdpvpseel8vm7vaji.png"/></div><br/>
В регистр <code>d0</code> заносятся значения <code>0xABCD</code>, <code>0xEF01</code>. А что выдаст <code>get_hash_2b</code>?<br/>
<br/>
<pre><code class="python">>>> first_hash = get_hash_2b("ABCD")
>>> hex(first_hash)
0xabcd

>>> second_hash = get_hash_2b("EFGH")
>>> hex(second_hash)
0xef01</code></pre><br/>
Проверка пройдена.<br/>
<br/>
Далее производится <code>xor eor.w d0, d5</code>, результат заносится в <code>d5</code>:<br/>
<br/>
<pre><code class="python">>>> hex(0xabcd ^ 0xef01)
0x44cc</code></pre><br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" alt="image" data-src="https://hsto.org/webt/fa/6l/a0/fa6la0nx5iia9ldl24wgxibdwhy.png"/></div><br/>
В получении такого хэша <code>0x44CC</code> и состоят предварительные вычисления. Далее все только усложняется.<br/>
<br/>
<h3>Куда уплывает хэш</h3><br/>
Нам никак не пройти дальше, если мы не узнаем как программа работает с хэшем. Наверняка он перемещается из <code>d5</code> в память, т.к. регистр пригодится где-нибудь еще. Отыскать такое событие мы можем через трассировку(наблюдая за <code>d5</code>), но не ручную, а автоматическую. Поможет такой скрипт:<br/>
<br/>
<pre><code class="cpp">#include &lt;idc.idc>

static main()
{
	auto d5_val;
	auto i;
	for(;;)
	{
		StepOver();
		GetDebuggerEvent(WFNE_SUSP, -1);
		d5_val = GetRegValue("d5");
		// Ловим факт изменения d5
		if (d5_val != 0xFFFF44CC){
			break;
		}
	}
}</code></pre><br/>
Напомню, что мы сейчас находимся на последнем брейке <code>0x00001808 eor.w d0, d5</code>. Вставляем скрипт(<code>Shift-F2</code>), жмем <code>Run</code><br/>
<br/>
Скрипт остановится на инструкции <code>0x00001C94 move.b (a0, a1.l), d5</code>, но к этому моменту <code>d5</code> уже очищен. Однако мы видим, что значение из <code>d5</code> перемещается инструкцией <code>0x00001C56 move.w d5,a6</code>: оно пишется в память по адресу <code>0x00FF0D46</code>(2 байта).<br/>
<br/>
<b>Запомним: хэш хранится по адресу <code>0x00FF0D46</code>.</b><br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" alt="image" data-src="https://hsto.org/webt/wr/ya/gj/wryagjtwp8fvk35qfeyukg9meae.png"/></div><br/>
Отловим инструкции, которые читают из <code>0x00FF0D46-0x00FF0D47</code>(ставим брейк на чтение). Попались 4 блока:<br/>
<br/>
<img src="/img/image-loader.svg" alt="image" data-src="https://hsto.org/webt/m6/8g/ym/m68gymzx3mold0wdl1g0xnab-sw.png"/><img src="/img/image-loader.svg" alt="image" data-src="https://hsto.org/webt/id/rr/k_/idrrk_tmum_fu409yn21tqygisk.png"/><img src="/img/image-loader.svg" alt="image" data-src="https://hsto.org/webt/e0/nl/z_/e0nlz_whuvgznlt-efdiuecujqa.png"/><img src="/img/image-loader.svg" alt="image" data-src="https://hsto.org/webt/i8/tn/kv/i8tnkvhk6mc5nirtlb9hlwj-bui.png"/><br/>
<br/>
Как выбрать из них правильный/правильные?<br/>
<br/>
Возвращаемся в начало:<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" alt="image" data-src="https://hsto.org/webt/1d/bp/xy/1dbpxyojlaks20xlmgivzm0rpdw.png"/></div><br/>
Этот блок определяет, пойдет ли программа в <code>LOSER_CASE</code> или в <code>WINNER_CASE</code>:<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" alt="image" data-src="https://habrastorage.org/webt/p7/0l/ry/p70lrykx4qd6lof_e5kcnmcjbbk.png"/></div><br/>
Видим, что в регистре <code>d1</code> должен быть ноль для победы.<br/>
<br/>
Где ставится ноль? Просто прокрутим наверх:<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" alt="image" data-src="https://habrastorage.org/webt/_4/u0/tv/_4u0tvhvply85bhmwhjki65l0vu.png"/></div><br/>
Если в блоке <code>loc_1EEC</code> выполняется условие:<br/>
<br/>
<pre><code class="cpp">*(a6 + 0x24) == *(a6 + 0x22)</code></pre><br/>
то мы получим ноль в <code>d5</code>.<br/>
<br/>
Если мы поставим брейк на инструкцию <code>0x00001F16 beq.w loc_20EA</code>, то увидим, что <code>a6 + 0x24 = 0x00FF0D6A</code> и там хранится значение <code>0x4840</code>. А в <code>a6 + 0x22 = 0x00FF0D68</code> хранится <code>0xCB4C</code>.<br/>
<br/>
Если мы будем вводить разные ключи, почты, то увидим, что <code>0xCB4C - константа</code>. <b>Первая половина ключа будет принята, только если в <code>0x00FF0D6A</code> будет тоже <code>0xCB4C</code>. Это критерий правильности первой половины ключа.</b><br/>
<br/>
Узнаем, какие блоки пишут в <code>0x00FF0D6A</code> — ставим брейк на запись, снова вводим почту и ключ.<br/>
<br/>
И вот этот блок <code>loc_EAC</code> мы обнаружим(на самом деле их 3, но первые два просто обнуляют <code>0x00FF0D6A</code>):<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" alt="image" data-src="https://hsto.org/webt/pc/um/u1/pcumu10pkuhgdcfehysc-hzlbk4.png"/></div><br/>
Этот блок принадлежит функции <code>sub_E3E</code>.<br/>
<br/>
Через колл стэк выясняем, что функция <code>sub_E3E</code> вызывается в блоках <code>loc_1F94</code>, <code>loc_203E</code>:<br/>
<br/>
<img src="/img/image-loader.svg" alt="image" data-src="https://habrastorage.org/webt/8p/mt/uh/8pmtuh7u7gigntcmbx7wugc6q5e.png"/><img src="/img/image-loader.svg" alt="image" data-src="https://hsto.org/webt/lg/_-/2k/lg_-2kw8yl2_klsq5azj1mebnzs.png"/><br/>
<br/>
Помните, мы нашли 4 блока ранее? <code>loc_1F94</code> мы там видели — это начало главного алгоритма обработки ключа.<br/>
<br/>
<h2>Первый важный цикл loc_1F94</h2><br/>
То, что <code>loc_1F94</code> является циклом видно из кода: он выполняется <code>d4</code> раз (см. инструкцию <code>0x00001FBA d4,loc_1F94</code>):<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" alt="image" data-src="https://habrastorage.org/webt/8p/mt/uh/8pmtuh7u7gigntcmbx7wugc6q5e.png"/></div><br/>
На что обратить внимание:<br/>
<br/>
<ol>
<li>Есть функция <code>sub_5EC</code>.</li>
<li>Инструкция 0x00001FB4 jsr (a0) вызывает функцию sub_E3E(это можно увидеть простой трассировкой).</li>
</ol><br/>
Что здесь происходит:<br/>
<br/>
<ol>
<li>Функция <code>sub_5EC</code> пишет результат своего выполнения в регистр <code>d0</code>(этому посвящена отдельный раздел ниже).</li>
<li>В регистр <code>d1</code> сохраняется байт по адресу <code>sp+0x33</code>(<code>0x00FFFF79</code>, говорит нам отладчик), он равен второму байту из адреса хэша ключа(<code>0x00FF0D47</code>). Это легко доказать, если поставить брейк на запись по адресу <code>0x00FFFF79</code>: он сработает на инструкции <code>0x00001F94 move.b 1(a2), 0x2F(sp)</code>. В регистре <code>a2</code> в этот момент хранится адрес <code>0x00FF0D46</code> — адрес хэша, то есть <code>0x1(a2) = 0x00FF0D46 + 1</code> — адрес второго байта хэша.</li>
<li>В регистр <code>d0</code> пишется <code>d0^d1</code>.<br/>
</li>
<li>Получившийся результат xor'a отдается в функцию <code>sub_E3E</code>, поведение которой зависит от своих прежних вычислений(показано ниже).</li>
<li>Повторить.</li>
</ol><br/>
Сколько же раз этот цикл выполняется?<br/>
<br/>
Выясним это. Запустим такой скрипт:<br/>
<br/>
<pre><code class="cpp">#include &lt;idc.idc>

static main()
{
	auto pc_val, d4_val, counter=0;
	while(pc_val != 0x00001F16)
	{
		StepOver();
		GetDebuggerEvent(WFNE_SUSP, -1);
		pc_val = GetRegValue("pc");
		if (pc_val == 0x00001F92){
			counter++;
			d4_val = GetRegValue("d4");
			print(d4_val);
		}
	}
	print(counter);
}</code></pre><br/>
<code>0x00001F92 subq.l 0x1,d4</code> — здесь определяется, что будет в <code>d4</code> непосредственно перед циклом:<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" alt="image" data-src="https://habrastorage.org/webt/xt/p9/ac/xtp9acx13gq3qrtvnisseyt8lfw.png"/></div><br/>
Разбираемся с функцией sub_5EC.<br/>
<br/>
<h3>sub_5EC</h3><br/>
Значимый кусок кода:<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" alt="image" data-src="https://hsto.org/webt/fd/uv/xk/fduvxkbfaxne_7eratvlhuqdt8w.png"/></div><br/>
где <code>0x2c(a2)</code> всегда <code>0x00FF1D74</code>.<br/>
Этот кусок можно переписать так на псевдокоде:<br/>
<br/>
<pre><code class="cpp">d0 = a2 + 0x2C
*(a2+0x2C) = *(a2+0x2C) + 1 #*(0x00FF1D74) = *(0x00FF1D74) + 1
result = *(d0) &amp; 0xFF</code></pre><br/>
То есть 4 байта из <code>0x00FF1D74</code> являются адресом, т.к. с ними обращаются как с указателем.<br/>
<br/>
Как переписать функцию <code>sub_5EC</code> на питоне?<br/>
<br/>
<ol>
<li>Либо сделать дамп памяти и работать с ним.</li>
<li>Либо просто записать все выдаваемые значения.</li>
</ol><br/>
Второй способ мне нравится больше, но что, если при разных данных авторизации выдаваемые значения разные? Проверим это.<br/>
<br/>
Поможет в этом скрипт:<br/>
<br/>
<pre><code class="cpp">#include &lt;idc.idc>

static main()
{
    auto pc_val=0, d0_val;
    while(pc_val != 0x00001F16){
        
        pc_val = GetRegValue("pc");
        
        if (pc_val == 0x00001F9C)
            StepInto();
        else
            StepOver();
            
        GetDebuggerEvent(WFNE_SUSP, -1);
    
        if (pc_val == 0x00000674){
            d0_val = GetRegValue("d0") &amp; 0xFF;
            print(d0_val);
        }
    }
}</code></pre><br/>
Я просто сравнивал выводы в консоль при разных ключах, почтах.<br/>
<br/>
Запустив скрипт несколько раз при разных ключах, мы увидим, что функция <code>sub_5EC</code> всегда возвращает очередное значение из массива:<br/>
<br/>
<pre><code class="python">def sub_5EC_gen():
	dump = [0x92, 0x8A, 0xDC, 0xDC, 0x94, 0x3B, 0xE4, 0xE4,
	        0xFC, 0xB3, 0xDC, 0xEE, 0xF4, 0xB4, 0xDC, 0xDE,
	        0xFE, 0x68, 0x4A, 0xBD, 0x91, 0xD5, 0x0A, 0x27,
	        0xED, 0xFF, 0xC2, 0xA5, 0xD6, 0xBF, 0xDE, 0xFA,
	        0xA6, 0x72, 0xBF, 0x1A, 0xF6, 0xFA, 0xE4, 0xE7,
	        0xFA, 0xF7, 0xF6, 0xD6, 0x91, 0xB4, 0xB4, 0xB5,
	        0xB4, 0xF4, 0xA4, 0xF4, 0xF4, 0xB7, 0xF6, 0x09,
	        0x20, 0xB7, 0x86, 0xF6, 0xE6, 0xF4, 0xE4, 0xC6,
	        0xFE, 0xF6, 0x9D, 0x11, 0xD4, 0xFF, 0xB5, 0x68,
	        0x4A, 0xB8, 0xD4, 0xF7, 0xAE, 0xFF, 0x1C, 0xB7,
	        0x4C, 0xBF, 0xAD, 0x72, 0x4B, 0xBF, 0xAA, 0x3D,
	        0xB5, 0x7D, 0xB5, 0x3D, 0xB9, 0x7D, 0xD9, 0x7D,
	        0xB1, 0x13, 0xE1, 0xE1, 0x02, 0x15, 0xB3, 0xA3,
	        0xB3, 0x88, 0x9E, 0x2C, 0xB0, 0x8F]

	l = len(dump)
	offset = 0

	while offset &lt; l:
		yield dump[offset]
		offset += 1</code></pre><br/>
Итак, функция <code>sub_5EC</code> готова.<br/>
<br/>
На очереди <code>sub_E3E</code>.<br/>
<br/>
<h3>sub_E3E</h3><br/>
Значимый кусок кода:<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" alt="image" data-src="https://hsto.org/webt/pc/um/u1/pcumu10pkuhgdcfehysc-hzlbk4.png"/></div><br/>
Расшифруем:<br/>
<br/>
<pre><code class="cpp">Эта конструкция выдает адрес, куда сохранять d2, который сейчас содержит входной аргумент.

Регистр a2 хранит значение 0xFF0D46, a2 + 0x34 = 0xFF0D7A
d0 = *(a2 + 0x34)
*(a2 + 0x34) = *(a2 + 0x34) + 1

Входной аргумент сохраняется, в регистре a0 адрес этого сохранения
a0 = d0
*(a0) = d2

Здесь вычисляется некий offset, который сохраняется в регистре d2.

Регистр a2 хранит значение 0xFF0D46, a2 + 0x24 = 0xFF0D6A - это место, где хранится
предыдущий результат функции(см. конец) либо 0x00000000, если функция вызывается впервые
d0 = *(a2 + 0x24)
d2 = d0 ^ d2
d2 = d2 &amp; 0xFF
d2 = d2 + d2

Вытаскиваются какие-то 2 байта по адресу 0x00011FC0 + d2, это область ROM, поэтому
содержимое 0x00011FC0 + d2 постоянно
a0 = 0x00011FC0
d2 = *(a0 + d2)

Предыдущий результат этой функции сдвигается на 8 бит
d0 = d0 >> 8

Результат
d2 = d0 ^ d2

Записывается текущий результат функции
*(a2 + 0x24) = d2</code></pre><br/>
Функция <code>sub_E3E</code> сводится к таким шагам:<br/>
<br/>
<ol>
<li>Сохранить входной аргумент в массив.</li>
<li>Рассчитать смещение offset.</li>
<li>Вытащить 2 байта по адресу <code>0x00011FC0 + offset</code>(ROM).</li>
<li>Результат = <code>(предыдущий результат >> 8) ^ (2 байта 0x00011FC0 + offset)</code>.</li>
</ol><br/>
Представим функцию <code>sub_E3E</code> в таком виде:<br/>
<br/>
<pre><code class="python">def sub_E3E(prev_sub_E3E_result, d2, d2_storage):

	def calc_offset():
		return 2 * ((prev_sub_E3E_result ^ d2) &amp; 0xff)

	d2_storage.append(d2)

	offset = calc_offset()

	with open("dump_00011FC0", 'rb') as f:
		dump_00011FC0_4096b = f.read()

	some = dump_00011FC0_4096b[offset:offset + 2]
	some = int.from_bytes(some, byteorder="big")

	prev_sub_E3E_result = prev_sub_E3E_result >> 8

	return prev_sub_E3E_result ^ some</code></pre><br/>
<code>dump_00011FC0</code> — это просто файл, куда я сохранил 4096 байт из <code>[0x00011FC0:00011FC0+4096]</code>.<br/>
<br/>
<h2>Активность около 1FC4</h2><br/>
Адрес <code>0x00001FC4</code> мы еще не видели, но его легко найти, потому что блок идет почти сразу за первым циклом.<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" alt="image" data-src="https://hsto.org/webt/rq/qu/4d/rqqu4dswxqemcgszszulcrrc8mc.png"/></div><br/>
Этот блок меняет содержимое по адресу <code>0x00FF0D46</code> (регистр <code>a2</code>), а именно там хранится хэш ключа, поэтому мы сейчас и изучаем этот блок. Посмотрим, что здесь происходит.<br/>
<br/>
<ol>
<li>Условие, которое определяет, будет выбрана левая или правая ветка, такое: <code>(хэш первой половины ключа) &amp; 0b1 != 0</code>. То есть проверяется первый бит хэша.</li>
<li>Если присмотреться к обоим веткам, станет видно:<ul>
<li>В обоих случаях происходит сдвиг вправо на 1 бит.</li>
<li>В левой ветке над хэшем производится операция <code>ИЛИ 0x8000</code>.</li>
<li>В обоих случаях по адресу <code>0x00FF0D46</code> записывается обработанное значение хэша, то есть хэш заменяется на новое значение.</li>
<li>Дальнейшие вычисления некритичны, потому что, грубо говоря, нет операций записи в <code>(a2)</code> (нет инструкции, где вторым операндом был бы<code> (a2)</code>).<br/>
</li>
</ul></li>
</ol><br/>
Представим блок так:<br/>
<br/>
<pre><code class="python">def transform(hash_2b):
	new = hash_2b >> 1

	if hash_2b &amp; 0b1 != 0:
		new = new | 0x8000

	return new</code></pre><br/>
<h2>Второй важный цикл loc_203E</h2><br/>
<code>loc_203E</code> — цикл, т.к. <code>0x0000206C bne.s loc_203E</code>.<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" alt="image" data-src="https://hsto.org/webt/lg/_-/2k/lg_-2kw8yl2_klsq5azj1mebnzs.png"/></div><br/>
Этот цикл досчитывает хэш и вот его главная особенность: <code>jsr (a0)</code> — это вызов функции <code>sub_E3E</code>, которую мы уже рассмотрели — она опирается на предыдущий результат своей же работы и на некий входной аргумент(выше он передавался через регистр <code>d2</code>, а здесь через <code>d0</code>).<br/>
<br/>
Давайте выясним, что передается ей через регистр <code>d0</code>.<br/>
<br/>
Мы уже встречались с конструкцией <code>0x34(a2) </code> — туда функция <code>sub_E3E</code> сохраняет переданный аргумент. Значит, в этом цикле используются ранее переданные аргументы. Но не все.<br/>
<br/>
Расшифруем часть кода:<br/>
<br/>
<pre><code class="cpp">Здесь берется 2 байта из адреса a2+0x1C
move.w 0x1C(a2), d0

Инвертируется
neg.l d0

В регистр a0 пишется адрес последнего сохраненного аргумента функции sub_E3E
movea.l 0x34(a2), a0

Наконец, в d0 пишутся 2 байта по адресу a0-d0(вычитание потому что d0 инвертирован)
move.b (a0, d0.l), d0
</code></pre><br/>
Суть сводится к простому действию: на каждой итерации взять <code>d0</code> сохраненный аргумент с конца массива. То есть если в <code>d0</code> хранится 4, то берем четвертый с конца элемент.<br/>
<br/>
Раз так, то какие конкретно принимает значения <code>d0</code>? Здесь я обошелся без скриптов, а просто выписал их, поставив брейк на начало этого блока. Вот они: <code>0x04, 0x04, 0x04, 0x1C, 0x1A, 0x1A, 0x06, 0x42, 0x02</code>.<br/>
<br/>
Теперь у нас есть все, чтобы написать полную функцию вычисления хэша ключа.<br/>
<br/>
<h2>Полная функция вычисления хэша</h2><br/>
<pre><code class="python">def finish_hash(hash_2b):

	# Правило преобразования хэша
	def transform(hash_2b):
		new = hash_2b >> 1

		if hash_2b &amp; 0b1 != 0:
			new = new | 0x8000

		return new

	main_cycle_counter = [17, 2, 2, 3, 4, 38, 10, 30, 4]
	second_cycle_counter = [2, 2, 2, 2, 2, 4, 2, 4, 28]
	counters = list(zip(main_cycle_counter, second_cycle_counter))

	d2_storage = []
	storage_offsets = [0x04, 0x04, 0x04, 0x1C, 0x1A, 0x1A, 0x06, 0x42, 0x02]

	prev_sub_E3E_result = 0x0000

	sub_5EC = sub_5EC_gen()

	for i in range(9):

		c = counters[i]

		for _ in range(c[0]):
			d0 = next(sub_5EC)

			d1 = hash_2b &amp; 0xff
			d2 = d0 ^ d1

			curr_sub_E3E_result = sub_E3E(prev_sub_E3E_result, d2, d2_storage)
			prev_sub_E3E_result = curr_sub_E3E_result

		storage_offset = storage_offsets.pop(0)

		for _ in range(c[1]):

			d2 = d2_storage[-storage_offset]

			curr_sub_E3E_result = sub_E3E(prev_sub_E3E_result, d2, d2_storage)
			prev_sub_E3E_result = curr_sub_E3E_result

		hash_2b = transform(hash_2b)

	return curr_sub_E3E_result</code></pre><br/>
<h3>Проверка работоспособности</h3><br/>
<ol>
<li>В отладчике ставим брейк на адрес <code>0x0000180A move.l 0x1000,(sp)</code> (сразу после вычисления хэша).</li>
<li>Брейк на адрес <code>0x00001F16 beq.w loc_20EA</code>(сравнение окончательного хэша с константой <code>0xCB4C</code>).</li>
<li>В программе вводим ключ <code>ABCDEFGHIJKLMNOP</code>, жмем <code>Enter</code>.</li>
<li>Отладчик останавливается на <code>0x0000180A</code>, и мы видим, что в регистр <code>d5</code> записалось значение <code>0xFFFF44CC</code>, <code>0x44CC</code> — первый хэш.</li>
<li>Запускаем отладчик дальше.</li>
<li>Останавливаемся на <code>0x00001F16</code> и видим, что по адресу <code>0x00FF0D6A</code> лежит <code>0x4840</code> — окончательный хэш<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" alt="image" data-src="https://habrastorage.org/webt/lb/zp/bo/lbzpbohzrioqfs-3h_jj7q5v4sy.png"/></div></li>
<li>Теперь проверям нашу функцию finish_hash(hash_2b):<br/>
<pre><code class="python">>>> r = finish_hash(0x44CC)
>>> print(hex(r))
0x4840</code></pre></li>
</ol><br/>
<h2>Ищем правильный ключ 1</h2><br/>
Правильный ключ — этот ключ, у которого окончательный хэш равен <code>0xCB4C</code>(выясняли выше). Отсюда вопрос: каким должен быть первый хэш, чтобы окончательный стал <code>0xCB4C</code>?<br/>
<br/>
Теперь это просто выяснить:<br/>
<br/>
<pre><code class="python">def find_CB4C():

	result = []

	for hash_2b in range(0xFFFF+1):
		final_hash = finish_hash(hash_2b)
		if final_hash == 0xCB4C:
			result.append(hash_2b)

	return result
	
>>> r = find_CB4C()
>>> print(r)</code></pre><br/>
Вывод программы говорит о том, что вариант один: первый хэш должен быть <code>0xFEDC</code>.<br/>
<br/>
Какие символы нам нужны, чтобы их первый хэш был <code>0xFEDC</code>?<br/>
<br/>
Так как <code>0xFEDC = хэш_первых_4_символов ^ хэш_вторых_4_символов</code>, то найти нужно только <code>хэш_первых_4_символов</code>, потому что <code>хэш_вторых_4_символов = хэш_первых_4_символов ^ 0xFEDC</code>. А затем декодировать оба хэша.<br/>
<br/>
Алгоритм такой:<br/>
<br/>
<pre><code class="python">def get_first_half():

	from collections import deque
	from random import randint

	def get_pairs():

		pairs = []

		for i in range(0xFFFF + 1):
			pair = (i, i ^ 0xFEDC)
			pairs.append(pair)

		pairs = deque(pairs)
		pairs.rotate(randint(0, 0xFFFF))

		return list(pairs)

	pairs = get_pairs()

	for pair in pairs:

		key_4s_0 = decode_hash_4s(pair[0])
		key_4s_1 = decode_hash_4s(pair[1])

		hash_2b_0 = get_hash_2b(key_4s_0)
		hash_2b_1 = get_hash_2b(key_4s_1)

		if hash_2b_0 == pair[0] and hash_2b_1 == pair[1]:
			return key_4s_0, key_4s_1</code></pre><br/>
Вариантов куча, выбирайте любой.<br/>
<br/>
<h2>Ищем правильный ключ 2</h2><br/>
Первая половина ключа готова, что со второй?<br/>
<br/>
Эта самая легкая часть.<br/>
<br/>
Ответственный кусок кода располагается на <code>0x00FF2012</code>, до него я добрался ручной трассировкой, начав с адреса <code>0x00001F16 beg.w loc_20EA</code>(валидация первой половины ключа). В регистре <code>a0</code> находится адрес почты, <code>loc_FF2012</code> является циклом, т.к. <code>bne.s loc_FF2012</code>. Он выполняется до тех пор, пока есть <code>*(a0+d0)</code>(очередной байт почты).<br/>
<br/>
А инструкция <code>jsr (a3)</code> вызывает уже знакомую функцию <code>get_hash_2b</code>, которая теперь работает со второй половиной ключа.<br/>
<br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" alt="image" data-src="https://hsto.org/webt/wl/ln/5i/wlln5if5bzqcukbxnvpc_osl5lw.png"/></div><br/>
Сделаем код понятнее:<br/>
<br/>
<pre><code class="cpp">while(d1 != 0x20){
	Подсчитывается длина почты
	d2++
	d1 = d1 &amp; 0xFF
	
	Подсчитывается сумма байтов почты
	d3 = d3 + d1
	d0 = 0
	d0 = d2
	
	Очередной байт почты
	d1 = *(a0+d0)
}

d0 = get_hash_2b(key_byte_8)
d3 = d0^d3

d0 = get_hash_2b(key_byte_12)
d2 = d2 - 1
d2 = d2 &lt;&lt; 8
d2 = d0^d2

if (d2 == d3)
	success_branch</code></pre><br/>
В регистре <code>d2</code> — <code>(длина почты-1) &lt;&lt; 8</code>. В <code>d3</code> — сумма байтов символов почты.<br/>
<br/>
Критерий корректности получается таким: <code>третья_четверть_ключа ^ d2 == последняя_четверть_ключа_2 ^ d3</code>.<br/>
<br/>
Напишем функцию подбора второй половины ключа:<br/>
<br/>
<pre><code class="python">def get_second_half(email):

	from collections import deque
	from random import randint

	def get_koeff():
		k1 = sum([ord(c) for c in email])
		k2 = (len(email) - 1) &lt;&lt; 8

		return k1, k2

	def get_pairs(k1, k2):
		pairs = []

		for a in range(0xFFFF + 1):
			pair = (a, (a ^ k1) ^ k2)
			pairs.append(pair)

		pairs = deque(pairs)
		pairs.rotate(randint(0, 0xFFFF))

		return list(pairs)

	k1, k2 = get_koeff()

	pairs = get_pairs(k1, k2)

	for pair in pairs:

		key_4s_0 = decode_hash_4s(pair[0])
		key_4s_1 = decode_hash_4s(pair[1])

		hash_2b_0 = get_hash_2b(key_4s_0)
		hash_2b_1 = get_hash_2b(key_4s_1)

		if hash_2b_0 == pair[0] and hash_2b_1 == pair[1]:
			return key_4s_0, key_4s_1</code></pre><br/>
<br/>
<h2>Кейген</h2><br/>
Почта обязательно капсом.<br/>
<br/>
<pre><code class="python">def keygen(email):

	first_half = get_first_half()
	second_half = get_second_half(email)

	return "".join(first_half) + "".join(second_half)

	
>>> email = "M.GAYANOV@GMAIL.COM"
>>> print(keygen(email))
2A4FD493BA32AD75</code></pre><br/>
<div style="text-align:center;"><img src="/img/image-loader.svg" alt="image" data-src="https://hsto.org/webt/rp/ja/bo/rpjabo27x0oemehl_380bdoiyto.png"/></div><br/>
Спасибо за внимание! Весь код доступен <a href="https://github.com/mgayanov/PHDays9_Best_Reverser">здесь</a>.</div></div> <!----> <!----></div> <div class="tm-article-presenter__meta"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D1%80%D0%B5%D0%B2%D0%B5%D1%80%D1%81-%D0%B8%D0%BD%D0%B6%D0%B8%D0%BD%D0%B8%D1%80%D0%B8%D0%BD%D0%B3%5D" class="tm-tags-list__link">реверс-инжиниринг</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bida%20pro%5D" class="tm-tags-list__link">ida pro</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bsega%20megadrive%5D" class="tm-tags-list__link">sega megadrive</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bsega%20mega%20drive%5D" class="tm-tags-list__link">sega mega drive</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bphdays%5D" class="tm-tags-list__link">phdays</a></li></ul></div> <div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/hub/reverse-engineering/" class="tm-hubs-list__link">
    Реверс-инжиниринг
  </a></li></ul></div></div></article></div> <!----></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 24: ↑23 и ↓1</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-rating"></use></svg> <span title="Всего голосов 24: ↑23 и ↓1" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_medium">+22</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">3.2K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    28
  </span></button> <!----> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> </div></div> <!----> <!----> <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/xoo/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><img alt="" src="//habrastorage.org/getpro/habr/avatars/cd4/b9d/b52/cd4b9db521867a394b28b9ab81140989.png" class="tm-entity-image__pic"></div></a> <div class="tm-user-card__meta"><div title=" 31 голос " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    28.2
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">0</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title_variant-article"><span class="tm-user-card__name tm-user-card__name_variant-article">Марат Гаянов</span> <a href="/ru/users/xoo/" class="tm-user-card__nickname tm-user-card__nickname_variant-article">
          @xoo
        </a> <!----></div> <p class="tm-user-card__short-info tm-user-card__short-info_variant-article">Пользователь</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-article"><!----> <!----> <!----> <!----> <!----></div></div> <div class="tm-article-author__user-contacts"><a href="https://qna.habr.com/user/xoo" rel="noopener" target="_blank" class="tm-article-author__contact">
      Хабр Q&amp;A
    </a><a href="https://vk.com/ho_lee_fuk" rel="noopener" target="_blank" class="tm-article-author__contact">
      ВКонтакте
    </a></div></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----></section> <div class="tm-article-blocks__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/post/453194/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 13 
    </span></a> <!----></div></div></div> <div class="tm-ad-banner__container tm-page-article__banner"><!----> <div id="articleBottomBanner" class="tm-ad-banner"></div></div> <!----> <!----> <!----> <!----> </div></div></div></div></div> <div class="tm-page__sidebar"><div class="tm-layout-sidebar"><div class="tm-layout-sidebar__ads tm-layout-sidebar__ads_initial"><div class="tm-ad-banner__container tm-layout-sidebar__banner"><!----> <div id="sidebarBanner" class="tm-ad-banner"></div></div></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----> <!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/post/453194/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/post/453194/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"453194":{"id":"453194","timePublished":"2019-05-23T16:58:11+00:00","isCorporative":false,"lang":"ru","titleHtml":"Решаем задачу Best Reverser с PHDays 9","leadData":{"textHtml":"Здравствуйте!\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nМеня зовут Марат Гаянов, я хочу поделиться с вами моим решением задачи с конкурса \u003Ca href=\"https:\u002F\u002Fwww.phdays.com\u002Fru\u002Fprogram\u002Fcontests\u002Fbest-reverser\u002F\"\u003EBest Reverser\u003C\u002Fa\u003E, показать, как сделать кейген для этого кейса.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Frp\u002Fja\u002Fbo\u002Frpjabo27x0oemehl_380bdoiyto.png\" alt=\"image\" \u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EОписание\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\nВ этом конкурсе участникам предоставляется ROM игры для Sega Mega Drive (\u003Ca href=\"https:\u002F\u002Fwww.phdays.com\u002Fupload\u002Fru\u002Fprogram\u002Fcontests\u002Fbest_reverser_phd9_rom_v4.bin\"\u003Ebest_reverser_phd9_rom_v4.bin\u003C\u002Fa\u003E).\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗадача: подобрать такой ключ, который в паре с email-адресом участника будет признан валидным.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nИтак, решение…\u003Cbr\u002F\u003E\r\n","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"editorVersion":"1.0","postType":"article","postLabels":[{"type":"sandbox","data":null}],"author":{"scoreStats":{"score":28.2,"votesCount":31},"rating":0,"relatedData":null,"contacts":[{"title":"Хабр Q&A","url":"https:\u002F\u002Fqna.habr.com\u002Fuser\u002Fxoo","value":"xoo"},{"title":"ВКонтакте","url":"https:\u002F\u002Fvk.com\u002Fho_lee_fuk","value":"ho_lee_fuk"}],"authorContacts":[{"title":"Хабр Q&A","url":"https:\u002F\u002Fqna.habr.com\u002Fuser\u002Fxoo","value":"xoo"},{"title":"ВКонтакте","url":"https:\u002F\u002Fvk.com\u002Fho_lee_fuk","value":"ho_lee_fuk"}],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"1819281","alias":"xoo","fullname":"Марат Гаянов","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fcd4\u002Fb9d\u002Fb52\u002Fcd4b9db521867a394b28b9ab81140989.png","speciality":"Пользователь"},"statistics":{"commentsCount":13,"favoritesCount":28,"readingCount":3160,"score":22,"votesCount":24},"hubs":[{"relatedData":null,"id":"19011","alias":"reverse-engineering","type":"collective","title":"Реверс-инжиниринг","titleHtml":"Реверс-инжиниринг","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003EЗдравствуйте!\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nМеня зовут Марат Гаянов, я хочу поделиться с вами моим решением задачи с конкурса \u003Ca href=\"https:\u002F\u002Fwww.phdays.com\u002Fru\u002Fprogram\u002Fcontests\u002Fbest-reverser\u002F\"\u003EBest Reverser\u003C\u002Fa\u003E, показать, как сделать кейген для этого кейса.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Frp\u002Fja\u002Fbo\u002Frpjabo27x0oemehl_380bdoiyto.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EОписание\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\nВ этом конкурсе участникам предоставляется ROM игры для Sega Mega Drive (\u003Ca href=\"https:\u002F\u002Fwww.phdays.com\u002Fupload\u002Fru\u002Fprogram\u002Fcontests\u002Fbest_reverser_phd9_rom_v4.bin\"\u003Ebest_reverser_phd9_rom_v4.bin\u003C\u002Fa\u003E).\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗадача: подобрать такой ключ, который в паре с email-адресом участника будет признан валидным.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nИтак, решение…\u003Cbr\u002F\u003E\r\n\u003Ca name=\"habracut\"\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EИнструменты\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EIDA Pro 6.8 \u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Flab313ru\u002Fsmd_ida_tools\"\u003EПлагин smd_ida_tools\u003C\u002Fa\u003E\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EПроверка длины ключа\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\nПрограмма принимает не всякий ключ: нужно заполнить поле целиком, это 16 символов. Если ключ короче, то вы увидите сообщение: «Wrong length! Try again…».\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПопробуем найти эту строчку в программе, для чего воспользуемся бинарным поиском(Alt-B). Что мы найдем?\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНайдем не только эту, но и рядом остальные служебные строки: «Wrong key! Try again…» и «YOU ARE THE BEST REVERSER!».\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"https:\u002F\u002Fhsto.org\u002Fwebt\u002F-b\u002Fru\u002Ffb\u002F-brufb6jqqrejxctfwwvrp8l0xu.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"https:\u002F\u002Fhsto.org\u002Fwebt\u002F6y\u002F6m\u002Fjb\u002F6y6mjbg8kod7ys087rlbngrshky.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nЯрлыки \u003Ccode\u003EWRONG_LENGTH_MSG\u003C\u002Fcode\u003E, \u003Ccode\u003EYOU_ARE_THE_BEST_MSG\u003C\u002Fcode\u003E и \u003Ccode\u003EWRONG_KEY_MSG\u003C\u002Fcode\u003E поставил я, чтобы было удобно.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПоставим брейк на чтение адреса \u003Ccode\u003E0x0000FDFA\u003C\u002Fcode\u003E — выясним, кто работает с сообщением «Wrong length! Try again…». И запустим отладчик(он несколько раз остановится еще до того как можно будет вводить ключ, просто жмем F9 на каждой остановке). Вводим свой email, ключ \u003Ccode\u003EABCD\u003C\u002Fcode\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nОтладчик приводит на \u003Ccode\u003E0x00006FF0 tst.b (a1)+\u003C\u002Fcode\u003E:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fjq\u002Fh5\u002Fmf\u002Fjqh5mfieh1st-s6fktdghtomemy.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nНичего интересного в самом блоке нет. Гораздо интереснее, кто передает управление сюда. Смотрим колл стэк:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"https:\u002F\u002Fhsto.org\u002Fwebt\u002Fw4\u002Fsa\u002F1p\u002Fw4sa1p9_t4czdofd4jjj-tdtg4q.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nЖмем и попадем сюда — на инструкцию \u003Ccode\u003E0x00001D2A jsr (sub_6FC0).l\u003C\u002Fcode\u003E:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"https:\u002F\u002Fhsto.org\u002Fwebt\u002F1d\u002Fbp\u002Fxy\u002F1dbpxyojlaks20xlmgivzm0rpdw.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nВидим, что все возможные сообщения нашлись в одном месте. Но давайте узнаем, откуда передается управление в блок \u003Ccode\u003EWRONG_KEY_LEN_CASE_1D1C\u003C\u002Fcode\u003E. Не будем ставить брейки, просто наведем курсор на стрелку, идущую к блоку. Вызывающий расположился на адресе \u003Ccode\u003E0x000017DE loc_17DE\u003C\u002Fcode\u003E(который я переименую в \u003Ccode\u003ECHECK_KEY_LEN\u003C\u002Fcode\u003E):\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"https:\u002F\u002Fhsto.org\u002Fwebt\u002Fbo\u002Fc1\u002Ftc\u002Fboc1tck7dpjuq46sppgq93wghfu.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nПоставим брейк на адрес \u003Ccode\u003E0x000017EC cmpi.b 0x20 (a0, d0.l)\u003C\u002Fcode\u003E(инструкция в этом контексте смотрит, нет ли пустого символа в конце массива символов ключа), перезапустимся, снова введем почту и ключ \u003Ccode\u003EABCD\u003C\u002Fcode\u003E. Отладчик останавливается и показывает, что по адресу \u003Ccode\u003E0x00FF01C7\u003C\u002Fcode\u003E(хранящемуся в этот момент в регистре \u003Ccode\u003Ea0\u003C\u002Fcode\u003E) находится введенный ключ:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"https:\u002F\u002Fhsto.org\u002Fwebt\u002Fqs\u002Fl9\u002Fk4\u002Fqsl9k4apyhz2orh5lz9vphf-gdo.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nЭто хорошая находка, через нее мы выцепим вообще все. Но сначала разметим байты ключа для удобства:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"https:\u002F\u002Fhsto.org\u002Fwebt\u002Fon\u002Fkw\u002Fc8\u002Fonkwc8dvpch6ckyjbcl0a-9zx4q.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nПрокрутив вверх с этого места, увидим что почта хранится рядом с ключом:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"https:\u002F\u002Fhsto.org\u002Fwebt\u002Fat\u002F_t\u002F_j\u002Fat_t_jhxaruncxgntbn-i5t396o.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nМы погружаемся все глубже и глубже, и пришло время найти критерий правильности ключа. Вернее, первой половины ключа.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EКритерий правильности первой половины ключа\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Ch3\u003EПредварительные вычисления\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\nЛогично предположить, что сразу после проверки длины последуют другие операции с ключом. Рассмотрим блок сразу за проверкой:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"https:\u002F\u002Fhsto.org\u002Fwebt\u002Fg4\u002Foy\u002Fw6\u002Fg4oyw6inctcnokzxmo1r5kbfl9c.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nВ этом блоке идет предварительная работа. Функция \u003Ccode\u003Eget_hash_2b\u003C\u002Fcode\u003E(в оригинале было \u003Ccode\u003Esub_1526\u003C\u002Fcode\u003E) вызывается дважды. Сначала ей передается адрес первого байта ключа(регистр \u003Ccode\u003Ea0\u003C\u002Fcode\u003E содержит адрес \u003Ccode\u003EKEY_BYTE_0\u003C\u002Fcode\u003E), во второй раз — пятого(\u003Ccode\u003EKEY_BYTE_4\u003C\u002Fcode\u003E).\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЯ назвал функцию так, потому что она считает что-то типа хэша размером 2 байта. Это самое понятное название, которое я подобрал.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСаму функцию рассматривать я не буду, а сразу напишу ее на питоне. Она делает простые вещи, но ее описание со скринами займет много места.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСамое важное, что о ней нужно сказать: на вход подается начальный адрес, а работа идет над 4-мя байтами от этого адреса. То есть подали на вход первый байт ключа, а функция будет работать с 1,2,3,4-ым. Подали пятый, функция работает с 5,6,7,8-ым. Иными словами, в этом блоке идут вычисления над первой половиной ключа. Результат пишется в регистр \u003Ccode\u003Ed0\u003C\u002Fcode\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nИтак, функция \u003Ccode\u003Eget_hash_2b\u003C\u002Fcode\u003E:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"python\"\u003E# key_4s - четыре символа ключа\ndef get_hash_2b(key_4s):\n\t# Правило преобразования байта\n\tdef transform(b):\n\n\t\t# numbers -.\n\t\tif b &lt;= 0x39:\n\t\t\tr = b - 0x30\n\t\t# Letter case and @\n\t\telse:\n\t\t\t# @ABCDEF\n\t\t\tif b &lt;= 0x46:\n\t\t\t\tr = b - 0x37\n\t\t\telse:\n\t\t\t\t# WXYZ\n\t\t\t\tif b \u003E= 0x57:\n\t\t\t\t\tr = b - 0x57\n\t\t\t\t# GHIJKLMNOPQRSTUV\n\t\t\t\telse:\n\t\t\t\t\tr = 0xff - (0x57 - b) + 1  # a9+b\n\n\t\treturn r\n\n\t# Перевод в байты\n\tkey_4b = bytearray(key_4s, encoding=\"ascii\")\n\n\t# Каждый байт аргумента трансформируется\n\tcodes = [transform(b) for b in key_4b]\n\n\t# А здесь они просто склеиваются\n\tpart0 = (codes[0] &amp; 0xff) &lt;&lt; 0xc\n\tpart1 = (codes[1] &lt;&lt; 0x8) &amp; 0xf00\n\tpart2 = (codes[2] &lt;&lt; 0x4) &amp; 0xf0\n\thash_2b = (part0 | part1) &amp; 0xffff\n\thash_2b = (hash_2b | part2) &amp; 0xffff\n\thash_2b = (hash_2b | (codes[3] &amp; 0xf))\n\n\treturn hash_2b\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nСразу напишем функцию декодирования хэша:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"python\"\u003E# Возвращает строку из 4-х символов\ndef decode_hash_4s(hash_2b):\n\n\t# Правило преобразования байта\n\tdef transform(b):\n\t\tif b &lt;= 0x9:\n\t\t\treturn b + 0x30\n\t\tif b &lt;= 0xF:\n\t\t\treturn b + 0x37\n\t\tif b \u003E= 0x0:\n\t\t\treturn b + 0x57\n\t\treturn b - 0xa9\n\n\t# Нарезаем отдельные байты из переданного хэша и переводи\n\tb0 = transform(hash_2b \u003E\u003E 12)\n\tb1 = transform((hash_2b &amp; 0xfff) \u003E\u003E 8)\n\tb2 = transform((hash_2b &amp; 0xff) \u003E\u003E 4)\n\tb3 = transform(hash_2b &amp; 0xf)\n\n\t# Склеиваем\n\tkey_4s = [chr(b0), chr(b1), chr(b2), chr(b3)]\n\tkey_4s = \"\".join(key_4s)\n\n\treturn key_4s\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nЛучше функцию декодирования я не придумал, и она не совсем правильная. Поэтому я буду ее проверять так(не прямо сейчас, а значительно позже):\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"python\"\u003Ekey_4s == decode_hash_4s(get_hash_2b(key_4s))\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nПроверим работу \u003Ccode\u003Eget_hash_2b\u003C\u002Fcode\u003E. Нас интересует состояние регистра \u003Ccode\u003Ed0\u003C\u002Fcode\u003E после выполнения функции. Ставим брейки на \u003Ccode\u003E0x000017FE\u003C\u002Fcode\u003E, \u003Ccode\u003E0x00001808\u003C\u002Fcode\u003E, ключ вводим \u003Ccode\u003EABCDEFGHIJKLMNOP\u003C\u002Fcode\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"https:\u002F\u002Fhsto.org\u002Fwebt\u002Fx-\u002Ftu\u002Fmv\u002Fx-tumvz-5akeokp44a-wlclamuu.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"https:\u002F\u002Fhsto.org\u002Fwebt\u002Fft\u002Fgy\u002Fke\u002Fftgykerggzjdpvpseel8vm7vaji.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nВ регистр \u003Ccode\u003Ed0\u003C\u002Fcode\u003E заносятся значения \u003Ccode\u003E0xABCD\u003C\u002Fcode\u003E, \u003Ccode\u003E0xEF01\u003C\u002Fcode\u003E. А что выдаст \u003Ccode\u003Eget_hash_2b\u003C\u002Fcode\u003E?\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"python\"\u003E\u003E\u003E\u003E first_hash = get_hash_2b(\"ABCD\")\n\u003E\u003E\u003E hex(first_hash)\n0xabcd\n\n\u003E\u003E\u003E second_hash = get_hash_2b(\"EFGH\")\n\u003E\u003E\u003E hex(second_hash)\n0xef01\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nПроверка пройдена.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДалее производится \u003Ccode\u003Exor eor.w d0, d5\u003C\u002Fcode\u003E, результат заносится в \u003Ccode\u003Ed5\u003C\u002Fcode\u003E:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"python\"\u003E\u003E\u003E\u003E hex(0xabcd ^ 0xef01)\n0x44cc\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"https:\u002F\u002Fhsto.org\u002Fwebt\u002Ffa\u002F6l\u002Fa0\u002Ffa6la0nx5iia9ldl24wgxibdwhy.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nВ получении такого хэша \u003Ccode\u003E0x44CC\u003C\u002Fcode\u003E и состоят предварительные вычисления. Далее все только усложняется.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003EКуда уплывает хэш\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\nНам никак не пройти дальше, если мы не узнаем как программа работает с хэшем. Наверняка он перемещается из \u003Ccode\u003Ed5\u003C\u002Fcode\u003E в память, т.к. регистр пригодится где-нибудь еще. Отыскать такое событие мы можем через трассировку(наблюдая за \u003Ccode\u003Ed5\u003C\u002Fcode\u003E), но не ручную, а автоматическую. Поможет такой скрипт:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003E#include &lt;idc.idc\u003E\n\nstatic main()\n{\n\tauto d5_val;\n\tauto i;\n\tfor(;;)\n\t{\n\t\tStepOver();\n\t\tGetDebuggerEvent(WFNE_SUSP, -1);\n\t\td5_val = GetRegValue(\"d5\");\n\t\t\u002F\u002F Ловим факт изменения d5\n\t\tif (d5_val != 0xFFFF44CC){\n\t\t\tbreak;\n\t\t}\n\t}\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nНапомню, что мы сейчас находимся на последнем брейке \u003Ccode\u003E0x00001808 eor.w d0, d5\u003C\u002Fcode\u003E. Вставляем скрипт(\u003Ccode\u003EShift-F2\u003C\u002Fcode\u003E), жмем \u003Ccode\u003ERun\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСкрипт остановится на инструкции \u003Ccode\u003E0x00001C94 move.b (a0, a1.l), d5\u003C\u002Fcode\u003E, но к этому моменту \u003Ccode\u003Ed5\u003C\u002Fcode\u003E уже очищен. Однако мы видим, что значение из \u003Ccode\u003Ed5\u003C\u002Fcode\u003E перемещается инструкцией \u003Ccode\u003E0x00001C56 move.w d5,a6\u003C\u002Fcode\u003E: оно пишется в память по адресу \u003Ccode\u003E0x00FF0D46\u003C\u002Fcode\u003E(2 байта).\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003EЗапомним: хэш хранится по адресу \u003Ccode\u003E0x00FF0D46\u003C\u002Fcode\u003E.\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"https:\u002F\u002Fhsto.org\u002Fwebt\u002Fwr\u002Fya\u002Fgj\u002Fwryagjtwp8fvk35qfeyukg9meae.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nОтловим инструкции, которые читают из \u003Ccode\u003E0x00FF0D46-0x00FF0D47\u003C\u002Fcode\u003E(ставим брейк на чтение). Попались 4 блока:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"https:\u002F\u002Fhsto.org\u002Fwebt\u002Fm6\u002F8g\u002Fym\u002Fm68gymzx3mold0wdl1g0xnab-sw.png\"\u002F\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"https:\u002F\u002Fhsto.org\u002Fwebt\u002Fid\u002Frr\u002Fk_\u002Fidrrk_tmum_fu409yn21tqygisk.png\"\u002F\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"https:\u002F\u002Fhsto.org\u002Fwebt\u002Fe0\u002Fnl\u002Fz_\u002Fe0nlz_whuvgznlt-efdiuecujqa.png\"\u002F\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"https:\u002F\u002Fhsto.org\u002Fwebt\u002Fi8\u002Ftn\u002Fkv\u002Fi8tnkvhk6mc5nirtlb9hlwj-bui.png\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКак выбрать из них правильный\u002Fправильные?\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВозвращаемся в начало:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"https:\u002F\u002Fhsto.org\u002Fwebt\u002F1d\u002Fbp\u002Fxy\u002F1dbpxyojlaks20xlmgivzm0rpdw.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nЭтот блок определяет, пойдет ли программа в \u003Ccode\u003ELOSER_CASE\u003C\u002Fcode\u003E или в \u003Ccode\u003EWINNER_CASE\u003C\u002Fcode\u003E:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fp7\u002F0l\u002Fry\u002Fp70lrykx4qd6lof_e5kcnmcjbbk.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nВидим, что в регистре \u003Ccode\u003Ed1\u003C\u002Fcode\u003E должен быть ноль для победы.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nГде ставится ноль? Просто прокрутим наверх:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F_4\u002Fu0\u002Ftv\u002F_4u0tvhvply85bhmwhjki65l0vu.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nЕсли в блоке \u003Ccode\u003Eloc_1EEC\u003C\u002Fcode\u003E выполняется условие:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003E*(a6 + 0x24) == *(a6 + 0x22)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nто мы получим ноль в \u003Ccode\u003Ed5\u003C\u002Fcode\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЕсли мы поставим брейк на инструкцию \u003Ccode\u003E0x00001F16 beq.w loc_20EA\u003C\u002Fcode\u003E, то увидим, что \u003Ccode\u003Ea6 + 0x24 = 0x00FF0D6A\u003C\u002Fcode\u003E и там хранится значение \u003Ccode\u003E0x4840\u003C\u002Fcode\u003E. А в \u003Ccode\u003Ea6 + 0x22 = 0x00FF0D68\u003C\u002Fcode\u003E хранится \u003Ccode\u003E0xCB4C\u003C\u002Fcode\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЕсли мы будем вводить разные ключи, почты, то увидим, что \u003Ccode\u003E0xCB4C - константа\u003C\u002Fcode\u003E. \u003Cb\u003EПервая половина ключа будет принята, только если в \u003Ccode\u003E0x00FF0D6A\u003C\u002Fcode\u003E будет тоже \u003Ccode\u003E0xCB4C\u003C\u002Fcode\u003E. Это критерий правильности первой половины ключа.\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nУзнаем, какие блоки пишут в \u003Ccode\u003E0x00FF0D6A\u003C\u002Fcode\u003E — ставим брейк на запись, снова вводим почту и ключ.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nИ вот этот блок \u003Ccode\u003Eloc_EAC\u003C\u002Fcode\u003E мы обнаружим(на самом деле их 3, но первые два просто обнуляют \u003Ccode\u003E0x00FF0D6A\u003C\u002Fcode\u003E):\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"https:\u002F\u002Fhsto.org\u002Fwebt\u002Fpc\u002Fum\u002Fu1\u002Fpcumu10pkuhgdcfehysc-hzlbk4.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nЭтот блок принадлежит функции \u003Ccode\u003Esub_E3E\u003C\u002Fcode\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЧерез колл стэк выясняем, что функция \u003Ccode\u003Esub_E3E\u003C\u002Fcode\u003E вызывается в блоках \u003Ccode\u003Eloc_1F94\u003C\u002Fcode\u003E, \u003Ccode\u003Eloc_203E\u003C\u002Fcode\u003E:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F8p\u002Fmt\u002Fuh\u002F8pmtuh7u7gigntcmbx7wugc6q5e.png\"\u002F\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"https:\u002F\u002Fhsto.org\u002Fwebt\u002Flg\u002F_-\u002F2k\u002Flg_-2kw8yl2_klsq5azj1mebnzs.png\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПомните, мы нашли 4 блока ранее? \u003Ccode\u003Eloc_1F94\u003C\u002Fcode\u003E мы там видели — это начало главного алгоритма обработки ключа.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EПервый важный цикл loc_1F94\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\nТо, что \u003Ccode\u003Eloc_1F94\u003C\u002Fcode\u003E является циклом видно из кода: он выполняется \u003Ccode\u003Ed4\u003C\u002Fcode\u003E раз (см. инструкцию \u003Ccode\u003E0x00001FBA d4,loc_1F94\u003C\u002Fcode\u003E):\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F8p\u002Fmt\u002Fuh\u002F8pmtuh7u7gigntcmbx7wugc6q5e.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nНа что обратить внимание:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Col\u003E\r\n\u003Cli\u003EЕсть функция \u003Ccode\u003Esub_5EC\u003C\u002Fcode\u003E.\u003C\u002Fli\u003E\r\n\u003Cli\u003EИнструкция 0x00001FB4 jsr (a0) вызывает функцию sub_E3E(это можно увидеть простой трассировкой).\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\r\nЧто здесь происходит:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Col\u003E\r\n\u003Cli\u003EФункция \u003Ccode\u003Esub_5EC\u003C\u002Fcode\u003E пишет результат своего выполнения в регистр \u003Ccode\u003Ed0\u003C\u002Fcode\u003E(этому посвящена отдельный раздел ниже).\u003C\u002Fli\u003E\r\n\u003Cli\u003EВ регистр \u003Ccode\u003Ed1\u003C\u002Fcode\u003E сохраняется байт по адресу \u003Ccode\u003Esp+0x33\u003C\u002Fcode\u003E(\u003Ccode\u003E0x00FFFF79\u003C\u002Fcode\u003E, говорит нам отладчик), он равен второму байту из адреса хэша ключа(\u003Ccode\u003E0x00FF0D47\u003C\u002Fcode\u003E). Это легко доказать, если поставить брейк на запись по адресу \u003Ccode\u003E0x00FFFF79\u003C\u002Fcode\u003E: он сработает на инструкции \u003Ccode\u003E0x00001F94 move.b 1(a2), 0x2F(sp)\u003C\u002Fcode\u003E. В регистре \u003Ccode\u003Ea2\u003C\u002Fcode\u003E в этот момент хранится адрес \u003Ccode\u003E0x00FF0D46\u003C\u002Fcode\u003E — адрес хэша, то есть \u003Ccode\u003E0x1(a2) = 0x00FF0D46 + 1\u003C\u002Fcode\u003E — адрес второго байта хэша.\u003C\u002Fli\u003E\r\n\u003Cli\u003EВ регистр \u003Ccode\u003Ed0\u003C\u002Fcode\u003E пишется \u003Ccode\u003Ed0^d1\u003C\u002Fcode\u003E.\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003EПолучившийся результат xor'a отдается в функцию \u003Ccode\u003Esub_E3E\u003C\u002Fcode\u003E, поведение которой зависит от своих прежних вычислений(показано ниже).\u003C\u002Fli\u003E\r\n\u003Cli\u003EПовторить.\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\r\nСколько же раз этот цикл выполняется?\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВыясним это. Запустим такой скрипт:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003E#include &lt;idc.idc\u003E\n\nstatic main()\n{\n\tauto pc_val, d4_val, counter=0;\n\twhile(pc_val != 0x00001F16)\n\t{\n\t\tStepOver();\n\t\tGetDebuggerEvent(WFNE_SUSP, -1);\n\t\tpc_val = GetRegValue(\"pc\");\n\t\tif (pc_val == 0x00001F92){\n\t\t\tcounter++;\n\t\t\td4_val = GetRegValue(\"d4\");\n\t\t\tprint(d4_val);\n\t\t}\n\t}\n\tprint(counter);\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Ccode\u003E0x00001F92 subq.l 0x1,d4\u003C\u002Fcode\u003E — здесь определяется, что будет в \u003Ccode\u003Ed4\u003C\u002Fcode\u003E непосредственно перед циклом:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fxt\u002Fp9\u002Fac\u002Fxtp9acx13gq3qrtvnisseyt8lfw.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nРазбираемся с функцией sub_5EC.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003Esub_5EC\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\nЗначимый кусок кода:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"https:\u002F\u002Fhsto.org\u002Fwebt\u002Ffd\u002Fuv\u002Fxk\u002Ffduvxkbfaxne_7eratvlhuqdt8w.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nгде \u003Ccode\u003E0x2c(a2)\u003C\u002Fcode\u003E всегда \u003Ccode\u003E0x00FF1D74\u003C\u002Fcode\u003E.\u003Cbr\u002F\u003E\r\nЭтот кусок можно переписать так на псевдокоде:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003Ed0 = a2 + 0x2C\n*(a2+0x2C) = *(a2+0x2C) + 1 #*(0x00FF1D74) = *(0x00FF1D74) + 1\nresult = *(d0) &amp; 0xFF\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nТо есть 4 байта из \u003Ccode\u003E0x00FF1D74\u003C\u002Fcode\u003E являются адресом, т.к. с ними обращаются как с указателем.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКак переписать функцию \u003Ccode\u003Esub_5EC\u003C\u002Fcode\u003E на питоне?\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Col\u003E\r\n\u003Cli\u003EЛибо сделать дамп памяти и работать с ним.\u003C\u002Fli\u003E\r\n\u003Cli\u003EЛибо просто записать все выдаваемые значения.\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\r\nВторой способ мне нравится больше, но что, если при разных данных авторизации выдаваемые значения разные? Проверим это.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПоможет в этом скрипт:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003E#include &lt;idc.idc\u003E\n\nstatic main()\n{\n    auto pc_val=0, d0_val;\n    while(pc_val != 0x00001F16){\n        \n        pc_val = GetRegValue(\"pc\");\n        \n        if (pc_val == 0x00001F9C)\n            StepInto();\n        else\n            StepOver();\n            \n        GetDebuggerEvent(WFNE_SUSP, -1);\n    \n        if (pc_val == 0x00000674){\n            d0_val = GetRegValue(\"d0\") &amp; 0xFF;\n            print(d0_val);\n        }\n    }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nЯ просто сравнивал выводы в консоль при разных ключах, почтах.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗапустив скрипт несколько раз при разных ключах, мы увидим, что функция \u003Ccode\u003Esub_5EC\u003C\u002Fcode\u003E всегда возвращает очередное значение из массива:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"python\"\u003Edef sub_5EC_gen():\n\tdump = [0x92, 0x8A, 0xDC, 0xDC, 0x94, 0x3B, 0xE4, 0xE4,\n\t        0xFC, 0xB3, 0xDC, 0xEE, 0xF4, 0xB4, 0xDC, 0xDE,\n\t        0xFE, 0x68, 0x4A, 0xBD, 0x91, 0xD5, 0x0A, 0x27,\n\t        0xED, 0xFF, 0xC2, 0xA5, 0xD6, 0xBF, 0xDE, 0xFA,\n\t        0xA6, 0x72, 0xBF, 0x1A, 0xF6, 0xFA, 0xE4, 0xE7,\n\t        0xFA, 0xF7, 0xF6, 0xD6, 0x91, 0xB4, 0xB4, 0xB5,\n\t        0xB4, 0xF4, 0xA4, 0xF4, 0xF4, 0xB7, 0xF6, 0x09,\n\t        0x20, 0xB7, 0x86, 0xF6, 0xE6, 0xF4, 0xE4, 0xC6,\n\t        0xFE, 0xF6, 0x9D, 0x11, 0xD4, 0xFF, 0xB5, 0x68,\n\t        0x4A, 0xB8, 0xD4, 0xF7, 0xAE, 0xFF, 0x1C, 0xB7,\n\t        0x4C, 0xBF, 0xAD, 0x72, 0x4B, 0xBF, 0xAA, 0x3D,\n\t        0xB5, 0x7D, 0xB5, 0x3D, 0xB9, 0x7D, 0xD9, 0x7D,\n\t        0xB1, 0x13, 0xE1, 0xE1, 0x02, 0x15, 0xB3, 0xA3,\n\t        0xB3, 0x88, 0x9E, 0x2C, 0xB0, 0x8F]\n\n\tl = len(dump)\n\toffset = 0\n\n\twhile offset &lt; l:\n\t\tyield dump[offset]\n\t\toffset += 1\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nИтак, функция \u003Ccode\u003Esub_5EC\u003C\u002Fcode\u003E готова.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНа очереди \u003Ccode\u003Esub_E3E\u003C\u002Fcode\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003Esub_E3E\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\nЗначимый кусок кода:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"https:\u002F\u002Fhsto.org\u002Fwebt\u002Fpc\u002Fum\u002Fu1\u002Fpcumu10pkuhgdcfehysc-hzlbk4.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nРасшифруем:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003EЭта конструкция выдает адрес, куда сохранять d2, который сейчас содержит входной аргумент.\n\nРегистр a2 хранит значение 0xFF0D46, a2 + 0x34 = 0xFF0D7A\nd0 = *(a2 + 0x34)\n*(a2 + 0x34) = *(a2 + 0x34) + 1\n\nВходной аргумент сохраняется, в регистре a0 адрес этого сохранения\na0 = d0\n*(a0) = d2\n\nЗдесь вычисляется некий offset, который сохраняется в регистре d2.\n\nРегистр a2 хранит значение 0xFF0D46, a2 + 0x24 = 0xFF0D6A - это место, где хранится\nпредыдущий результат функции(см. конец) либо 0x00000000, если функция вызывается впервые\nd0 = *(a2 + 0x24)\nd2 = d0 ^ d2\nd2 = d2 &amp; 0xFF\nd2 = d2 + d2\n\nВытаскиваются какие-то 2 байта по адресу 0x00011FC0 + d2, это область ROM, поэтому\nсодержимое 0x00011FC0 + d2 постоянно\na0 = 0x00011FC0\nd2 = *(a0 + d2)\n\nПредыдущий результат этой функции сдвигается на 8 бит\nd0 = d0 \u003E\u003E 8\n\nРезультат\nd2 = d0 ^ d2\n\nЗаписывается текущий результат функции\n*(a2 + 0x24) = d2\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nФункция \u003Ccode\u003Esub_E3E\u003C\u002Fcode\u003E сводится к таким шагам:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Col\u003E\r\n\u003Cli\u003EСохранить входной аргумент в массив.\u003C\u002Fli\u003E\r\n\u003Cli\u003EРассчитать смещение offset.\u003C\u002Fli\u003E\r\n\u003Cli\u003EВытащить 2 байта по адресу \u003Ccode\u003E0x00011FC0 + offset\u003C\u002Fcode\u003E(ROM).\u003C\u002Fli\u003E\r\n\u003Cli\u003EРезультат = \u003Ccode\u003E(предыдущий результат \u003E\u003E 8) ^ (2 байта 0x00011FC0 + offset)\u003C\u002Fcode\u003E.\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\r\nПредставим функцию \u003Ccode\u003Esub_E3E\u003C\u002Fcode\u003E в таком виде:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"python\"\u003Edef sub_E3E(prev_sub_E3E_result, d2, d2_storage):\n\n\tdef calc_offset():\n\t\treturn 2 * ((prev_sub_E3E_result ^ d2) &amp; 0xff)\n\n\td2_storage.append(d2)\n\n\toffset = calc_offset()\n\n\twith open(\"dump_00011FC0\", 'rb') as f:\n\t\tdump_00011FC0_4096b = f.read()\n\n\tsome = dump_00011FC0_4096b[offset:offset + 2]\n\tsome = int.from_bytes(some, byteorder=\"big\")\n\n\tprev_sub_E3E_result = prev_sub_E3E_result \u003E\u003E 8\n\n\treturn prev_sub_E3E_result ^ some\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Edump_00011FC0\u003C\u002Fcode\u003E — это просто файл, куда я сохранил 4096 байт из \u003Ccode\u003E[0x00011FC0:00011FC0+4096]\u003C\u002Fcode\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EАктивность около 1FC4\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\nАдрес \u003Ccode\u003E0x00001FC4\u003C\u002Fcode\u003E мы еще не видели, но его легко найти, потому что блок идет почти сразу за первым циклом.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"https:\u002F\u002Fhsto.org\u002Fwebt\u002Frq\u002Fqu\u002F4d\u002Frqqu4dswxqemcgszszulcrrc8mc.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nЭтот блок меняет содержимое по адресу \u003Ccode\u003E0x00FF0D46\u003C\u002Fcode\u003E (регистр \u003Ccode\u003Ea2\u003C\u002Fcode\u003E), а именно там хранится хэш ключа, поэтому мы сейчас и изучаем этот блок. Посмотрим, что здесь происходит.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Col\u003E\r\n\u003Cli\u003EУсловие, которое определяет, будет выбрана левая или правая ветка, такое: \u003Ccode\u003E(хэш первой половины ключа) &amp; 0b1 != 0\u003C\u002Fcode\u003E. То есть проверяется первый бит хэша.\u003C\u002Fli\u003E\r\n\u003Cli\u003EЕсли присмотреться к обоим веткам, станет видно:\u003Cul\u003E\r\n\u003Cli\u003EВ обоих случаях происходит сдвиг вправо на 1 бит.\u003C\u002Fli\u003E\r\n\u003Cli\u003EВ левой ветке над хэшем производится операция \u003Ccode\u003EИЛИ 0x8000\u003C\u002Fcode\u003E.\u003C\u002Fli\u003E\r\n\u003Cli\u003EВ обоих случаях по адресу \u003Ccode\u003E0x00FF0D46\u003C\u002Fcode\u003E записывается обработанное значение хэша, то есть хэш заменяется на новое значение.\u003C\u002Fli\u003E\r\n\u003Cli\u003EДальнейшие вычисления некритичны, потому что, грубо говоря, нет операций записи в \u003Ccode\u003E(a2)\u003C\u002Fcode\u003E (нет инструкции, где вторым операндом был бы\u003Ccode\u003E (a2)\u003C\u002Fcode\u003E).\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\r\nПредставим блок так:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"python\"\u003Edef transform(hash_2b):\n\tnew = hash_2b \u003E\u003E 1\n\n\tif hash_2b &amp; 0b1 != 0:\n\t\tnew = new | 0x8000\n\n\treturn new\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EВторой важный цикл loc_203E\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Eloc_203E\u003C\u002Fcode\u003E — цикл, т.к. \u003Ccode\u003E0x0000206C bne.s loc_203E\u003C\u002Fcode\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"https:\u002F\u002Fhsto.org\u002Fwebt\u002Flg\u002F_-\u002F2k\u002Flg_-2kw8yl2_klsq5azj1mebnzs.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nЭтот цикл досчитывает хэш и вот его главная особенность: \u003Ccode\u003Ejsr (a0)\u003C\u002Fcode\u003E — это вызов функции \u003Ccode\u003Esub_E3E\u003C\u002Fcode\u003E, которую мы уже рассмотрели — она опирается на предыдущий результат своей же работы и на некий входной аргумент(выше он передавался через регистр \u003Ccode\u003Ed2\u003C\u002Fcode\u003E, а здесь через \u003Ccode\u003Ed0\u003C\u002Fcode\u003E).\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДавайте выясним, что передается ей через регистр \u003Ccode\u003Ed0\u003C\u002Fcode\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nМы уже встречались с конструкцией \u003Ccode\u003E0x34(a2) \u003C\u002Fcode\u003E — туда функция \u003Ccode\u003Esub_E3E\u003C\u002Fcode\u003E сохраняет переданный аргумент. Значит, в этом цикле используются ранее переданные аргументы. Но не все.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nРасшифруем часть кода:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003EЗдесь берется 2 байта из адреса a2+0x1C\nmove.w 0x1C(a2), d0\n\nИнвертируется\nneg.l d0\n\nВ регистр a0 пишется адрес последнего сохраненного аргумента функции sub_E3E\nmovea.l 0x34(a2), a0\n\nНаконец, в d0 пишутся 2 байта по адресу a0-d0(вычитание потому что d0 инвертирован)\nmove.b (a0, d0.l), d0\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nСуть сводится к простому действию: на каждой итерации взять \u003Ccode\u003Ed0\u003C\u002Fcode\u003E сохраненный аргумент с конца массива. То есть если в \u003Ccode\u003Ed0\u003C\u002Fcode\u003E хранится 4, то берем четвертый с конца элемент.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nРаз так, то какие конкретно принимает значения \u003Ccode\u003Ed0\u003C\u002Fcode\u003E? Здесь я обошелся без скриптов, а просто выписал их, поставив брейк на начало этого блока. Вот они: \u003Ccode\u003E0x04, 0x04, 0x04, 0x1C, 0x1A, 0x1A, 0x06, 0x42, 0x02\u003C\u002Fcode\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТеперь у нас есть все, чтобы написать полную функцию вычисления хэша ключа.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EПолная функция вычисления хэша\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"python\"\u003Edef finish_hash(hash_2b):\n\n\t# Правило преобразования хэша\n\tdef transform(hash_2b):\n\t\tnew = hash_2b \u003E\u003E 1\n\n\t\tif hash_2b &amp; 0b1 != 0:\n\t\t\tnew = new | 0x8000\n\n\t\treturn new\n\n\tmain_cycle_counter = [17, 2, 2, 3, 4, 38, 10, 30, 4]\n\tsecond_cycle_counter = [2, 2, 2, 2, 2, 4, 2, 4, 28]\n\tcounters = list(zip(main_cycle_counter, second_cycle_counter))\n\n\td2_storage = []\n\tstorage_offsets = [0x04, 0x04, 0x04, 0x1C, 0x1A, 0x1A, 0x06, 0x42, 0x02]\n\n\tprev_sub_E3E_result = 0x0000\n\n\tsub_5EC = sub_5EC_gen()\n\n\tfor i in range(9):\n\n\t\tc = counters[i]\n\n\t\tfor _ in range(c[0]):\n\t\t\td0 = next(sub_5EC)\n\n\t\t\td1 = hash_2b &amp; 0xff\n\t\t\td2 = d0 ^ d1\n\n\t\t\tcurr_sub_E3E_result = sub_E3E(prev_sub_E3E_result, d2, d2_storage)\n\t\t\tprev_sub_E3E_result = curr_sub_E3E_result\n\n\t\tstorage_offset = storage_offsets.pop(0)\n\n\t\tfor _ in range(c[1]):\n\n\t\t\td2 = d2_storage[-storage_offset]\n\n\t\t\tcurr_sub_E3E_result = sub_E3E(prev_sub_E3E_result, d2, d2_storage)\n\t\t\tprev_sub_E3E_result = curr_sub_E3E_result\n\n\t\thash_2b = transform(hash_2b)\n\n\treturn curr_sub_E3E_result\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Ch3\u003EПроверка работоспособности\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n\u003Col\u003E\r\n\u003Cli\u003EВ отладчике ставим брейк на адрес \u003Ccode\u003E0x0000180A move.l 0x1000,(sp)\u003C\u002Fcode\u003E (сразу после вычисления хэша).\u003C\u002Fli\u003E\r\n\u003Cli\u003EБрейк на адрес \u003Ccode\u003E0x00001F16 beq.w loc_20EA\u003C\u002Fcode\u003E(сравнение окончательного хэша с константой \u003Ccode\u003E0xCB4C\u003C\u002Fcode\u003E).\u003C\u002Fli\u003E\r\n\u003Cli\u003EВ программе вводим ключ \u003Ccode\u003EABCDEFGHIJKLMNOP\u003C\u002Fcode\u003E, жмем \u003Ccode\u003EEnter\u003C\u002Fcode\u003E.\u003C\u002Fli\u003E\r\n\u003Cli\u003EОтладчик останавливается на \u003Ccode\u003E0x0000180A\u003C\u002Fcode\u003E, и мы видим, что в регистр \u003Ccode\u003Ed5\u003C\u002Fcode\u003E записалось значение \u003Ccode\u003E0xFFFF44CC\u003C\u002Fcode\u003E, \u003Ccode\u003E0x44CC\u003C\u002Fcode\u003E — первый хэш.\u003C\u002Fli\u003E\r\n\u003Cli\u003EЗапускаем отладчик дальше.\u003C\u002Fli\u003E\r\n\u003Cli\u003EОстанавливаемся на \u003Ccode\u003E0x00001F16\u003C\u002Fcode\u003E и видим, что по адресу \u003Ccode\u003E0x00FF0D6A\u003C\u002Fcode\u003E лежит \u003Ccode\u003E0x4840\u003C\u002Fcode\u003E — окончательный хэш\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Flb\u002Fzp\u002Fbo\u002Flbzpbohzrioqfs-3h_jj7q5v4sy.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003EТеперь проверям нашу функцию finish_hash(hash_2b):\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"python\"\u003E\u003E\u003E\u003E r = finish_hash(0x44CC)\n\u003E\u003E\u003E print(hex(r))\n0x4840\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EИщем правильный ключ 1\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\nПравильный ключ — этот ключ, у которого окончательный хэш равен \u003Ccode\u003E0xCB4C\u003C\u002Fcode\u003E(выясняли выше). Отсюда вопрос: каким должен быть первый хэш, чтобы окончательный стал \u003Ccode\u003E0xCB4C\u003C\u002Fcode\u003E?\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТеперь это просто выяснить:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"python\"\u003Edef find_CB4C():\n\n\tresult = []\n\n\tfor hash_2b in range(0xFFFF+1):\n\t\tfinal_hash = finish_hash(hash_2b)\n\t\tif final_hash == 0xCB4C:\n\t\t\tresult.append(hash_2b)\n\n\treturn result\n\t\n\u003E\u003E\u003E r = find_CB4C()\n\u003E\u003E\u003E print(r)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nВывод программы говорит о том, что вариант один: первый хэш должен быть \u003Ccode\u003E0xFEDC\u003C\u002Fcode\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКакие символы нам нужны, чтобы их первый хэш был \u003Ccode\u003E0xFEDC\u003C\u002Fcode\u003E?\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТак как \u003Ccode\u003E0xFEDC = хэш_первых_4_символов ^ хэш_вторых_4_символов\u003C\u002Fcode\u003E, то найти нужно только \u003Ccode\u003Eхэш_первых_4_символов\u003C\u002Fcode\u003E, потому что \u003Ccode\u003Eхэш_вторых_4_символов = хэш_первых_4_символов ^ 0xFEDC\u003C\u002Fcode\u003E. А затем декодировать оба хэша.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nАлгоритм такой:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"python\"\u003Edef get_first_half():\n\n\tfrom collections import deque\n\tfrom random import randint\n\n\tdef get_pairs():\n\n\t\tpairs = []\n\n\t\tfor i in range(0xFFFF + 1):\n\t\t\tpair = (i, i ^ 0xFEDC)\n\t\t\tpairs.append(pair)\n\n\t\tpairs = deque(pairs)\n\t\tpairs.rotate(randint(0, 0xFFFF))\n\n\t\treturn list(pairs)\n\n\tpairs = get_pairs()\n\n\tfor pair in pairs:\n\n\t\tkey_4s_0 = decode_hash_4s(pair[0])\n\t\tkey_4s_1 = decode_hash_4s(pair[1])\n\n\t\thash_2b_0 = get_hash_2b(key_4s_0)\n\t\thash_2b_1 = get_hash_2b(key_4s_1)\n\n\t\tif hash_2b_0 == pair[0] and hash_2b_1 == pair[1]:\n\t\t\treturn key_4s_0, key_4s_1\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nВариантов куча, выбирайте любой.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EИщем правильный ключ 2\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\nПервая половина ключа готова, что со второй?\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЭта самая легкая часть.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nОтветственный кусок кода располагается на \u003Ccode\u003E0x00FF2012\u003C\u002Fcode\u003E, до него я добрался ручной трассировкой, начав с адреса \u003Ccode\u003E0x00001F16 beg.w loc_20EA\u003C\u002Fcode\u003E(валидация первой половины ключа). В регистре \u003Ccode\u003Ea0\u003C\u002Fcode\u003E находится адрес почты, \u003Ccode\u003Eloc_FF2012\u003C\u002Fcode\u003E является циклом, т.к. \u003Ccode\u003Ebne.s loc_FF2012\u003C\u002Fcode\u003E. Он выполняется до тех пор, пока есть \u003Ccode\u003E*(a0+d0)\u003C\u002Fcode\u003E(очередной байт почты).\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nА инструкция \u003Ccode\u003Ejsr (a3)\u003C\u002Fcode\u003E вызывает уже знакомую функцию \u003Ccode\u003Eget_hash_2b\u003C\u002Fcode\u003E, которая теперь работает со второй половиной ключа.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"https:\u002F\u002Fhsto.org\u002Fwebt\u002Fwl\u002Fln\u002F5i\u002Fwlln5if5bzqcukbxnvpc_osl5lw.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nСделаем код понятнее:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003Ewhile(d1 != 0x20){\n\tПодсчитывается длина почты\n\td2++\n\td1 = d1 &amp; 0xFF\n\t\n\tПодсчитывается сумма байтов почты\n\td3 = d3 + d1\n\td0 = 0\n\td0 = d2\n\t\n\tОчередной байт почты\n\td1 = *(a0+d0)\n}\n\nd0 = get_hash_2b(key_byte_8)\nd3 = d0^d3\n\nd0 = get_hash_2b(key_byte_12)\nd2 = d2 - 1\nd2 = d2 &lt;&lt; 8\nd2 = d0^d2\n\nif (d2 == d3)\n\tsuccess_branch\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nВ регистре \u003Ccode\u003Ed2\u003C\u002Fcode\u003E — \u003Ccode\u003E(длина почты-1) &lt;&lt; 8\u003C\u002Fcode\u003E. В \u003Ccode\u003Ed3\u003C\u002Fcode\u003E — сумма байтов символов почты.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКритерий корректности получается таким: \u003Ccode\u003Eтретья_четверть_ключа ^ d2 == последняя_четверть_ключа_2 ^ d3\u003C\u002Fcode\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНапишем функцию подбора второй половины ключа:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"python\"\u003Edef get_second_half(email):\n\n\tfrom collections import deque\n\tfrom random import randint\n\n\tdef get_koeff():\n\t\tk1 = sum([ord(c) for c in email])\n\t\tk2 = (len(email) - 1) &lt;&lt; 8\n\n\t\treturn k1, k2\n\n\tdef get_pairs(k1, k2):\n\t\tpairs = []\n\n\t\tfor a in range(0xFFFF + 1):\n\t\t\tpair = (a, (a ^ k1) ^ k2)\n\t\t\tpairs.append(pair)\n\n\t\tpairs = deque(pairs)\n\t\tpairs.rotate(randint(0, 0xFFFF))\n\n\t\treturn list(pairs)\n\n\tk1, k2 = get_koeff()\n\n\tpairs = get_pairs(k1, k2)\n\n\tfor pair in pairs:\n\n\t\tkey_4s_0 = decode_hash_4s(pair[0])\n\t\tkey_4s_1 = decode_hash_4s(pair[1])\n\n\t\thash_2b_0 = get_hash_2b(key_4s_0)\n\t\thash_2b_1 = get_hash_2b(key_4s_1)\n\n\t\tif hash_2b_0 == pair[0] and hash_2b_1 == pair[1]:\n\t\t\treturn key_4s_0, key_4s_1\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EКейген\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\nПочта обязательно капсом.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"python\"\u003Edef keygen(email):\n\n\tfirst_half = get_first_half()\n\tsecond_half = get_second_half(email)\n\n\treturn \"\".join(first_half) + \"\".join(second_half)\n\n\t\n\u003E\u003E\u003E email = \"M.GAYANOV@GMAIL.COM\"\n\u003E\u003E\u003E print(keygen(email))\n2A4FD493BA32AD75\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"https:\u002F\u002Fhsto.org\u002Fwebt\u002Frp\u002Fja\u002Fbo\u002Frpjabo27x0oemehl_380bdoiyto.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nСпасибо за внимание! Весь код доступен \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fmgayanov\u002FPHDays9_Best_Reverser\"\u003Eздесь\u003C\u002Fa\u003E.\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"реверс-инжиниринг"},{"titleHtml":"ida pro"},{"titleHtml":"sega megadrive"},{"titleHtml":"sega mega drive"},{"titleHtml":"phdays"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F453194\u002F210ed7955b578e5c2412a469218da990\u002F","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F453194\u002F210ed7955b578e5c2412a469218da990\u002F?format=vk","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F453194\\\u002F\"},\"headline\":\"Решаем задачу Best Reverser с PHDays 9\",\"datePublished\":\"2019-05-23T19:58:11+03:00\",\"dateModified\":\"2019-05-23T19:58:11+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"Марат Гаянов\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"Здравствуйте!  Меня зовут Марат Гаянов, я хочу поделиться с вами моим решением задачи с конкурса Best Reverser, показать, как сделать кейген для этого кейса.   О...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F453194\\\u002F#post-content-body\",\"about\":[\"h_reverse-engineering\",\"f_develop\"],\"image\":[\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Frp\\\u002Fja\\\u002Fbo\\\u002Frpjabo27x0oemehl_380bdoiyto.png\",\"https:\\\u002F\\\u002Fhsto.org\\\u002Fwebt\\\u002F-b\\\u002Fru\\\u002Ffb\\\u002F-brufb6jqqrejxctfwwvrp8l0xu.png\",\"https:\\\u002F\\\u002Fhsto.org\\\u002Fwebt\\\u002F6y\\\u002F6m\\\u002Fjb\\\u002F6y6mjbg8kod7ys087rlbngrshky.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fjq\\\u002Fh5\\\u002Fmf\\\u002Fjqh5mfieh1st-s6fktdghtomemy.png\",\"https:\\\u002F\\\u002Fhsto.org\\\u002Fwebt\\\u002Fw4\\\u002Fsa\\\u002F1p\\\u002Fw4sa1p9_t4czdofd4jjj-tdtg4q.png\",\"https:\\\u002F\\\u002Fhsto.org\\\u002Fwebt\\\u002F1d\\\u002Fbp\\\u002Fxy\\\u002F1dbpxyojlaks20xlmgivzm0rpdw.png\",\"https:\\\u002F\\\u002Fhsto.org\\\u002Fwebt\\\u002Fbo\\\u002Fc1\\\u002Ftc\\\u002Fboc1tck7dpjuq46sppgq93wghfu.png\",\"https:\\\u002F\\\u002Fhsto.org\\\u002Fwebt\\\u002Fqs\\\u002Fl9\\\u002Fk4\\\u002Fqsl9k4apyhz2orh5lz9vphf-gdo.png\",\"https:\\\u002F\\\u002Fhsto.org\\\u002Fwebt\\\u002Fon\\\u002Fkw\\\u002Fc8\\\u002Fonkwc8dvpch6ckyjbcl0a-9zx4q.png\",\"https:\\\u002F\\\u002Fhsto.org\\\u002Fwebt\\\u002Fat\\\u002F_t\\\u002F_j\\\u002Fat_t_jhxaruncxgntbn-i5t396o.png\",\"https:\\\u002F\\\u002Fhsto.org\\\u002Fwebt\\\u002Fg4\\\u002Foy\\\u002Fw6\\\u002Fg4oyw6inctcnokzxmo1r5kbfl9c.png\",\"https:\\\u002F\\\u002Fhsto.org\\\u002Fwebt\\\u002Fx-\\\u002Ftu\\\u002Fmv\\\u002Fx-tumvz-5akeokp44a-wlclamuu.png\",\"https:\\\u002F\\\u002Fhsto.org\\\u002Fwebt\\\u002Fft\\\u002Fgy\\\u002Fke\\\u002Fftgykerggzjdpvpseel8vm7vaji.png\",\"https:\\\u002F\\\u002Fhsto.org\\\u002Fwebt\\\u002Ffa\\\u002F6l\\\u002Fa0\\\u002Ffa6la0nx5iia9ldl24wgxibdwhy.png\",\"https:\\\u002F\\\u002Fhsto.org\\\u002Fwebt\\\u002Fwr\\\u002Fya\\\u002Fgj\\\u002Fwryagjtwp8fvk35qfeyukg9meae.png\",\"https:\\\u002F\\\u002Fhsto.org\\\u002Fwebt\\\u002Fm6\\\u002F8g\\\u002Fym\\\u002Fm68gymzx3mold0wdl1g0xnab-sw.png\",\"https:\\\u002F\\\u002Fhsto.org\\\u002Fwebt\\\u002Fid\\\u002Frr\\\u002Fk_\\\u002Fidrrk_tmum_fu409yn21tqygisk.png\",\"https:\\\u002F\\\u002Fhsto.org\\\u002Fwebt\\\u002Fe0\\\u002Fnl\\\u002Fz_\\\u002Fe0nlz_whuvgznlt-efdiuecujqa.png\",\"https:\\\u002F\\\u002Fhsto.org\\\u002Fwebt\\\u002Fi8\\\u002Ftn\\\u002Fkv\\\u002Fi8tnkvhk6mc5nirtlb9hlwj-bui.png\",\"https:\\\u002F\\\u002Fhsto.org\\\u002Fwebt\\\u002F1d\\\u002Fbp\\\u002Fxy\\\u002F1dbpxyojlaks20xlmgivzm0rpdw.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fp7\\\u002F0l\\\u002Fry\\\u002Fp70lrykx4qd6lof_e5kcnmcjbbk.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F_4\\\u002Fu0\\\u002Ftv\\\u002F_4u0tvhvply85bhmwhjki65l0vu.png\",\"https:\\\u002F\\\u002Fhsto.org\\\u002Fwebt\\\u002Fpc\\\u002Fum\\\u002Fu1\\\u002Fpcumu10pkuhgdcfehysc-hzlbk4.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F8p\\\u002Fmt\\\u002Fuh\\\u002F8pmtuh7u7gigntcmbx7wugc6q5e.png\",\"https:\\\u002F\\\u002Fhsto.org\\\u002Fwebt\\\u002Flg\\\u002F_-\\\u002F2k\\\u002Flg_-2kw8yl2_klsq5azj1mebnzs.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002F8p\\\u002Fmt\\\u002Fuh\\\u002F8pmtuh7u7gigntcmbx7wugc6q5e.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fxt\\\u002Fp9\\\u002Fac\\\u002Fxtp9acx13gq3qrtvnisseyt8lfw.png\",\"https:\\\u002F\\\u002Fhsto.org\\\u002Fwebt\\\u002Ffd\\\u002Fuv\\\u002Fxk\\\u002Ffduvxkbfaxne_7eratvlhuqdt8w.png\",\"https:\\\u002F\\\u002Fhsto.org\\\u002Fwebt\\\u002Fpc\\\u002Fum\\\u002Fu1\\\u002Fpcumu10pkuhgdcfehysc-hzlbk4.png\",\"https:\\\u002F\\\u002Fhsto.org\\\u002Fwebt\\\u002Frq\\\u002Fqu\\\u002F4d\\\u002Frqqu4dswxqemcgszszulcrrc8mc.png\",\"https:\\\u002F\\\u002Fhsto.org\\\u002Fwebt\\\u002Flg\\\u002F_-\\\u002F2k\\\u002Flg_-2kw8yl2_klsq5azj1mebnzs.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Flb\\\u002Fzp\\\u002Fbo\\\u002Flbzpbohzrioqfs-3h_jj7q5v4sy.png\",\"https:\\\u002F\\\u002Fhsto.org\\\u002Fwebt\\\u002Fwl\\\u002Fln\\\u002F5i\\\u002Fwlln5if5bzqcukbxnvpc_osl5lw.png\",\"https:\\\u002F\\\u002Fhsto.org\\\u002Fwebt\\\u002Frp\\\u002Fja\\\u002Fbo\\\u002Frpjabo27x0oemehl_380bdoiyto.png\"]}","metaDescription":"Здравствуйте!\r\n\r\nМеня зовут Марат Гаянов, я хочу поделиться с вами моим решением задачи с конкурса Best Reverser, показать, как сделать кейген для этого кейса.\r\n\r\n\r\nОписание\r\nВ этом конкурсе...","mainImageUrl":null,"amp":false},"polls":[],"commentsEnabled":true,"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[],"hubs":"reverse-engineering"},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.c0af73e7.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
