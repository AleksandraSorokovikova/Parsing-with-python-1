<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Ускоряем сборку веб-приложения с webpack / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.c0af73e7.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.85eb77f0b17c8235e7b64b9f81ea5ec2.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/post\/451146\/"},"headline":"Ускоряем сборку веб-приложения с webpack","datePublished":"2019-05-09T19:22:42+03:00","dateModified":"2019-05-09T19:22:42+03:00","author":{"@type":"Person","name":"Дмитрий"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"По мере того как ваше приложение развивается и растёт, увеличивается и время его сборки &mdash; от нескольких минут при пересборке в development-режиме до десятков мин...","url":"https:\/\/habr.com\/ru\/post\/451146\/#post-content-body","about":["h_webdev","h_javascript","f_develop"],"image":["https:\/\/habr.com\/share\/publication\/451146\/d4d8992762fc35b863df211e786a75a7\/"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.49.0">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="Ускоряем сборку веб-приложения с webpack" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Ускоряем сборку веб-приложения с webpack" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Ускоряем сборку веб-приложения с webpack" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="По мере того как ваше приложение развивается и растёт, увеличивается и время его сборки — от нескольких минут при пересборке в development-режиме до десятков минут при «холодной» production-сборке...." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="По мере того как ваше приложение развивается и растёт, увеличивается и время его сборки — от нескольких минут при пересборке в development-режиме до десятков минут при «холодной» production-сборке...." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="По мере того как ваше приложение развивается и растёт, увеличивается и время его сборки — от нескольких минут при пересборке в development-режиме до десятков минут при «холодной» production-сборке...." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="По мере того как ваше приложение развивается и растёт, увеличивается и время его сборки — от нескольких минут при пересборке в development-режиме до десятков минут при «холодной» production-сборке...." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="По мере того как ваше приложение развивается и растёт, увеличивается и время его сборки — от нескольких минут при пересборке в development-режиме до десятков минут при «холодной» production-сборке...." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habr.com/share/publication/451146/d4d8992762fc35b863df211e786a75a7/" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habr.com/share/publication/451146/d4d8992762fc35b863df211e786a75a7/" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habr.com/share/publication/451146/d4d8992762fc35b863df211e786a75a7/" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habr.com/share/publication/451146/d4d8992762fc35b863df211e786a75a7/" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habr.com/share/publication/451146/d4d8992762fc35b863df211e786a75a7/" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="451146" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2019-05-09T16:22:42.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/451146/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/post/451146/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habr.com/share/publication/451146/d4d8992762fc35b863df211e786a75a7/" data-vmid="image:href">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
            Как стать автором
          </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" data-async-called="true" class="tm-page"><div class="tm-page-width"><!----> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/disappearedstar/" title="disappearedstar" class="tm-user-info__userpic"><div class="tm-entity-image"><svg height="24" width="24" class="tm-svg-img tm-image-placeholder tm-image-placeholder_blue"><!----> <use xlink:href="/img/megazord-v24.ce74655c.svg#placeholder-user"></use></svg></div></a> <span class="tm-user-info__user"><a href="/ru/users/disappearedstar/" class="tm-user-info__username">
      disappearedstar
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2019-05-09T16:22:42.000Z" title="2019-05-09, 19:22">9  мая  2019 в 19:22</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>Ускоряем сборку веб-приложения с webpack</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/webdev/" class="tm-article-snippet__hubs-item-link"><span>Разработка веб-сайтов</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/javascript/" class="tm-article-snippet__hubs-item-link"><span>JavaScript</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <div class="tm-article-snippet__labels"><div class="tm-article-snippet__label"><span>
        Из песочницы
      </span></div></div> <!----> <!----></div></div> <!----> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-1"><div xmlns="http://www.w3.org/1999/xhtml"><p>По мере того как ваше приложение развивается и растёт, увеличивается и время его сборки — от нескольких минут при пересборке в development-режиме до десятков минут при «холодной» production-сборке. Это совершенно неприемлемо. Мы, разработчики, не любим переключать контекст в ожидании готовности бандла и хотим получать фидбек от приложения как можно раньше — в идеале за то время, пока переключаемся с IDE на браузер.</p><br/>
<p>Как этого достичь? Что мы можем сделать, чтобы оптимизировать время сборки?</p><br/>
<p>Эта статья — обзор существующих в экосистеме webpack инструментов для ускорения сборки, опыт их применения и советы.</p><br/>
<p>Оптимизации размера бандла и производительности самого приложения в этой статье не рассматриваются.</p><a name="habracut"></a><br/>
<p>Проект, отсылки к которому встречаются в тексте и относительно которого выполняются замеры скорости сборки, — это сравнительно небольшое приложение, написанное на стеке JS + Flow + React + Redux с использованием webpack, Babel, PostCSS, Sass и др. и состоящее из примерно 30 тысяч строк кода и 1500 модулей. Версии зависимостей актуальны на апрель 2019 года.</p><br/>
<p>Исследования проводились на компьютере с Windows 10, Node.js 8, 4-ядерным процессором, 8 ГБ памяти и SSD.</p><br/>
<h2 id="terminologiya">Терминология</h2><br/>
<ul>
<li>Сборка — процесс преобразования исходных файлов проекта в набор связанных ассетов, в совокупности составляющих веб-приложение.</li>
<li>dev-режим — сборка с опцией <code>mode: 'development'</code>, обычно с использованием webpack-dev-server и watch-режима.</li>
<li>prod-режим — сборка с опцией <code>mode: 'production'</code>, обычно с полным набором оптимизаций бандла.</li>
<li>Инкрементальная сборка — в dev-режиме: пересборка только файлов с изменениями.</li>
<li>«Холодная» сборка — сборка с нуля, без каких-либо кешей, но с установленными зависимостями.</li>
</ul><br/>
<h2 id="keshirovanie">Кеширование</h2><br/>
<p>Кеширование позволяет сохранять результаты вычислений для дальнейшего переиспользования. Первая сборка может быть немного медленнее обычной из-за накладных расходов на кеширование, однако последующие будут гораздо быстрее за счёт переиспользования результатов компиляции неизменившихся модулей.</p><br/>
<p>По умолчанию webpack в watch-режиме <a href="https://webpack.js.org/configuration/other-options/#cache">кеширует в памяти</a> промежуточные результаты сборки, чтобы не пересобирать весь проект при каждом изменении. Для обычной сборки (не в watch-режиме) эта настройка не имеет смысла. Также можно попробовать включить <a href="https://webpack.js.org/configuration/resolve#resolveunsafecache">кеш-резолвинг</a>, чтобы упростить webpack работу по поиску модулей и посмотреть, оказывает ли эта настройка заметный эффект на ваш проект.</p><br/>
<p>Персистентного (сохраняемого на диск или в другое хранилище) кеша в webpack пока нет, хотя в 5-й версии его <a href="https://github.com/webpack/changelog-v5/blob/master/README.md#persistent-caching">обещают добавить</a>. А пока мы можем использовать следующие инструменты:</p><br/>
<p><strong>— Кеширование в <a href="https://github.com/webpack-contrib/terser-webpack-plugin#cache">настройках TerserWebpackPlugin</a></strong></p><br/>
<p>По умолчанию отключено. Даже в одиночку оказывает заметный положительный эффект: 60,7 с → 39 с (-36%), отлично сочетается с другими инструментами для кеширования.</p><br/>
<p>Включить и использовать очень просто:</p><br/>
<pre><code class="javascript">optimization: {
  minimizer: [
    new TerserJsPlugin({
      terserOptions: { ... },
      cache: true
    })
  ]
}</code></pre><br/>
<p><strong>— <a href="https://github.com/webpack-contrib/cache-loader">cache-loader</a></strong></p><br/>
<p>Cache-loader можно поместить в любую цепочку лоадеров и закешировать результаты работы предшествующих лоадеров.</p><br/>
<p>По умолчанию сохраняет кеш в папку .cache-loader в корне проекта. С помощью опции <code>cacheDirectory</code> в настройках лоадера путь можно переопределить.</p><br/>
<p>Пример использования:</p><br/>
<pre><code class="javascript">{
  test: /\.js$/,
  use: [
    {
      loader: 'cache-loader',
      options: {
        cacheDirectory: path.resolve(
          __dirname,
          'node_modules/.cache/cache-loader'
        ),
      },
    },
    'babel-loader'
  ]
}</code></pre><br/>
<p>Безопасное и надёжное решение. Без проблем работает практически с любыми лоадерами: для скриптов (babel-loader, ts-loader), стилей (scss-, less-, postcss-, css-loader), изображений и шрифтов (image-webpack-loader, react-svg-loader, file-loader) и др.</p><br/>
<p>Обратите внимание:</p><br/>
<ul>
<li>При использовании cache-loader совместно со style-loader или MiniCssExtractPlugin.loader он должен быть помещён <em>после</em> них:<br/>
<code>['style-loader', 'cache-loader', 'css-loader', ...]</code>.</li>
<li>Вопреки рекомендациям документации использовать этот лоадер для кеширования результатов только трудоёмких вычислений, он вполне может дать хоть и небольшой, но измеримый прирост производительности и для более «лёгких» лоадеров — нужно пробовать и замерять.</li>
</ul><br/>
<p>Результаты:</p><br/>
<ul>
<li>dev: 35,5 с → (включаем cache-loader) → 36,2 с (+2%) → (повторная сборка) → 7,9 с (-78%)</li>
<li>prod: 60,6 с → (включаем cache-loader) → 61,5 с (+1,5%) → (повторная сборка) → 30,6 с (-49%) → (включаем кеш у Terser) → 15,4 с (-75%)</li>
</ul><br/>
<p><strong>— <a href="https://github.com/mzgoddard/hard-source-webpack-plugin">HardSourceWebpackPlugin</a></strong></p><br/>
<p>Более массивное и «умное» решение для кеширования на уровне всего сборочного процесса, а не отдельных цепочек лоадеров. В базовом варианте использования достаточно добавить плагин в конфигурацию webpack, стандартных настроек должно быть достаточно для корректной работы. Подойдёт тем, кто хочет добиться максимальной производительности и не боится столкнуться с трудностями.</p><br/>
<pre><code class="javascript">plugins: [
  ...,
  new HardSourceWebpackPlugin()
]</code></pre><br/>
<p>В <a href="https://github.com/mzgoddard/hard-source-webpack-plugin/blob/master/README.md">документации</a> есть примеры использования с расширенными настройками и советы по решению возможных проблем. Перед вводом плагина в эксплуатацию на постоянной основе стоит тщательно протестировать его работу в различных ситуациях и режимах сборки.</p><br/>
<p>Результаты:</p><br/>
<ul>
<li>dev: 35,5 с → (включаем плагин) → 36,5 с (+3%) → (повторная сборка) → 3,7 с (-90%)</li>
<li>prod: 60,6 с → (включаем плагин) → 69,5 с (+15%) → (повторная сборка) → 25 с (-59%) → (включаем кеш у Terser) → 10 с (-83%)</li>
</ul><br/>
<p>Плюсы:</p><br/>
<ul>
<li>по сравнению с cache-loader ещё больше ускоряет повторные сборки;</li>
<li>не требует дублирования объявлений в разных местах конфигурации, как у cache-loader.</li>
</ul><br/>
<p>Минусы:</p><br/>
<ul>
<li>по сравнению с cache-loader сильнее замедляет первую сборку (когда дисковый кеш отсутствует);</li>
<li>может немного увеличивать время инкрементальной пересборки;</li>
<li>может вызывать проблемы при использовании webpack-dev-server и требовать детальной настройки разделения и инвалидации кешей (см. <a href="https://github.com/mzgoddard/hard-source-webpack-plugin#troubleshooting">документацию</a>);</li>
<li>достаточно много <a href="https://github.com/mzgoddard/hard-source-webpack-plugin/issues">issues</a> с багами на GitHub.</li>
</ul><br/>
<p><strong>— Кеширование в <a href="https://github.com/babel/babel-loader#options">настройках babel-loader</a></strong>. По умолчанию отключено. Эффект на несколько процентов хуже, чем от cache-loader.</p><br/>
<p><strong>— Кеширование в <a href="https://github.com/webpack-contrib/eslint-loader#cache-default-false">настройках eslint-loader</a></strong>. По умолчанию отключено. Если вы используете этот лоадер, кеш поможет не тратить время на линтинг неизменившихся файлов при повторной сборке.</p><br/>
<hr/><br/>
<p>При использовании cache-loader или HardSourceWebpackPlugin нужно отключить встроенные механизмы кеширования в других плагинах или лоадерах (кроме TerserWebpackPlugin), так как они перестанут приносить пользу при повторных и инкрементальных сборках, а «холодные» даже замедлят. То же относится к самому cache-loader, если уже используется HardSourceWebpackPlugin.</p><br/>
<hr/><br/>
<p>При настройке кеширования могут возникнуть следующие вопросы:</p><br/>
<p><em>Куда следует сохранять результаты кеширования?</em></p><br/>
<p>Кеши обычно хранятся в каталоге <code>node_modules/.cache/&lt;название_кеша>/</code>. Большинство инструментов по умолчанию используют этот путь и позволяют его переопределить, если вы желаете хранить кеш в другом месте.</p><br/>
<p><em>Когда и как инвалидировать кеш?</em></p><br/>
<p>Очень важно сбрасывать кеш при изменениях конфигурации сборки, которые повлияют на выходной результат. Использование старого кеша в таких случаях вредно и может привести к возникновению ошибок неизвестной природы.</p><br/>
<p>Факторы, которые нужно принимать во внимание:</p><br/>
<ul>
<li>список зависимостей и их версии: package.json, package-lock.json, yarn.lock, .yarn-integrity;</li>
<li>содержимое конфигурационных файлов webpack, Babel, PostCSS, browserslist и других, которые явно или неявно используются лоадерами и плагинами.</li>
</ul><br/>
<p>Если вы не используете cache-loader или HardSourceWebpackPlugin, которые позволяют переопределять список источников для формирования отпечатка сборки, немного облегчить жизнь вам помогут npm-скрипты, очищающие кеш при добавлении, обновлении или удалении зависимостей:</p><br/>
<pre><code class="javascript">"prunecaches": "rimraf ./node_modules/.cache/",
"postinstall": "npm run prunecaches",
"postuninstall": "npm run prunecaches"</code></pre><br/>
<p>Также помогут <a href="https://github.com/remy/nodemon">nodemon</a>, настроенный на очистку кеша, и рестарт webpack-dev-server при обнаружении изменений в конфигурационных файлах:</p><br/>
<pre><code class="javascript">"start": "cross-env NODE_ENV=development nodemon --exec \"webpack-dev-server --config webpack.config.dev.js\""</code></pre><br/>
<p>nodemon.json</p><br/>
<pre><code class="javascript">{
  "watch": [
    "webpack.config.dev.js",
    "babel.config.js",
    "more configs...",
  ],
  "events": {
    "restart": "yarn prunecaches"
  }
}</code></pre><br/>
<p><em>Нужно ли сохранять кеш в репозитории проекта?</em></p><br/>
<p>Так как кеш является, по сути, артефактом сборки, в репозиторий его коммитить не нужно. Как раз с этим поможет расположение кеша внутри папки node_modules, которая, как правило, внесена в .gitignore.</p><br/>
<p>Стоит заметить, что при наличии системы кеширования, умеющей надёжно определять валидность кеша при любых условиях, включая смену ОС и версии Node.js, кеш можно было бы переиспользовать между машинами разработчиков или в CI, что позволило бы радикально сократить время даже самой первой сборки после переключения между ветками.</p><br/>
<p><em>В каких режимах сборки стоит, а в каких не стоит использовать кеш?</em></p><br/>
<p>Однозначного ответа здесь нет: всё зависит от того, как интенсивно вы пользуетесь при разработке dev- и prod-режимами и переключаетесь между ними. В целом, ничто не мешает включить кеширование везде, однако помните, что оно обычно делает медленнее первую сборку. В CI вам, вероятно, всегда нужна «чистая» сборка, и в этом случае кеширование можно отключить с помощью соответствующей переменной окружения.</p><br/>
<hr/><br/>
<p>Интересные материалы про кеширование в webpack:</p><br/>
<ul>
<li><a href="https://github.com/webpack/webpack/issues/6527">https://github.com/webpack/webpack/issues/6527</a> — черновик и обсуждение спецификации по добавлению в webpack 5 системы кеширования от автора HardSourcePlugin</li>
<li><a href="https://gist.github.com/mzgoddard/0b42ad50048f407c1f3ac434a874f8e1">https://gist.github.com/mzgoddard/0b42ad50048f407c1f3ac434a874f8e1</a> — рассуждения автора HardSourcePlugin о том, как должна быть реализована система кеширования в webpack </li>
<li><a href="https://github.com/webpack-contrib/cache-loader/issues/11">https://github.com/webpack-contrib/cache-loader/issues/11</a> — мнения об использовании cache-loader совместно с HardSourcePlugin</li>
<li><a href="https://github.com/webpack/webpack/issues/250">https://github.com/webpack/webpack/issues/250</a> — обсуждение возможностей webpack по кешированию</li>
<li><a href="https://github.com/mzgoddard/hard-source-webpack-plugin/issues/251">https://github.com/mzgoddard/hard-source-webpack-plugin/issues/251</a> — мнения об использовании HardSourcePlugin совместно с AutoDllPlugin</li>
</ul><br/>
<h2 id="parallelizaciya">Параллелизация</h2><br/>
<p>С помощью параллелизации можно получить прирост производительности, задействовав все доступные ядра процессора. Конечный эффект индивидуален для каждой машины.</p><br/>
<p>Кстати, вот простой Node.js-код для получения количества доступных процессорных ядер (может пригодиться при настройке перечисленных ниже инструментов):</p><br/>
<pre><code class="javascript">const os = require('os');
const cores = os.cpus().length;</code></pre><br/>
<p><strong>— Параллелизация в <a href="https://github.com/webpack-contrib/terser-webpack-plugin#parallel">настройках TerserWebpackPlugin</a></strong></p><br/>
<p>По умолчанию отключена. Так же, как и собственное кеширование, легко включается и заметно ускоряет сборку.</p><br/>
<pre><code class="javascript">optimization: {
  minimizer: [
    new TerserJsPlugin({
      terserOptions: { ... },
      parallel: true
    })
  ]
}</code></pre><br/>
<p><strong>— <a href="https://github.com/webpack-contrib/thread-loader">thread-loader</a></strong></p><br/>
<p>Thread-loader можно поместить в цепочку лоадеров, производящих тяжёлые вычисления, после чего предшествующие лоадеры будут использовать пул подпроцессов Node.js («воркеров»).</p><br/>
<p>Имеет набор опций, которые позволяют достаточно тонко настроить работу пула воркеров, хотя и базовые значения выглядят вполне адекватно. Отдельного внимания заслуживают <code>poolTimeout</code> и <code>workers</code> — см. <a href="https://github.com/TypeStrong/ts-loader/blob/master/examples/thread-loader/webpack.config.js">пример</a>. </p><br/>
<p>Может быть использован совместно с cache-loader следующим образом (порядок важен): <code>['cache-loader', 'thread-loader', 'babel-loader']</code>. Если для thread-loader включён «прогрев» (warmup), стоит перепроверить стабильность повторных сборок, использующих кеш — webpack может зависать и не завершать процесс после успешного окончания сборки. В этом случае достаточно отключить warmup.</p><br/>
<p>Если вы столкнётесь с зависанием сборки после добавления thread-loader в цепочку компиляции Sass-стилей, вам может помочь <a href="https://webpack.js.org/guides/build-performance/#sass">этот совет</a>.</p><br/>
<p><strong>— <a href="https://github.com/amireh/happypack">HappyPack</a></strong></p><br/>
<p>Плагин, который перехватывает вызовы лоадеров и распределяет их работу по нескольким потокам. На данный момент находится в режиме поддержки (то есть развитие не планируется), а его создатель <a href="https://github.com/amireh/happypack#is-it-necessary-for-webpack-4">рекомендует</a> thread-loader в качестве замены. Таким образом, если ваш проект идёт в ногу со временем, от использования HappyPack лучше воздержаться, хотя попробовать и сравнить результаты с thread-loader, безусловно, стоит.</p><br/>
<p>HappyPack имеет понятную <a href="https://github.com/amireh/happypack/blob/master/README.md">документацию</a> по настройке, которая, кстати, довольно необычна сама по себе: конфигурации лоадеров предлагается переместить в вызов конструктора плагина, а сами цепочки лоадеров заменить на собственный лоадер happypack. Такой нестандартный подход может стать причиной неудобств при создании кастомной конфигурации webpack «из кусочков».</p><br/>
<p>HappyPack поддерживает <a href="https://github.com/amireh/happypack/wiki/Loader-Compatibility-List">ограниченный список лоадеров</a>; основные и наиболее широко используемые в этом списке присутствуют, а вот работоспособность других не гарантируется по причине возможной несовместимости API. Больше информации можно найти в <a href="https://github.com/amireh/happypack/issues">issues</a> проекта.</p><br/>
<h2 id="otkaz-ot-vychisleniy">Отказ от вычислений</h2><br/>
<p>Любая работа занимает время. Чтобы тратить меньше времени, нужно избегать работы, которая приносит мало пользы, может быть отложена на потом или вообще не нужна в данной ситуации.</p><br/>
<p><strong>— Применять лоадеры к минимально возможному числу модулей</strong></p><br/>
<p><a href="https://webpack.js.org/configuration/module#condition">Свойства test, exclude и include</a> задают условия для включения модуля в процесс обработки лоадером. Смысл — избегать трансформации модулей, которые не нуждаются в этой трансформации.</p><br/>
<p>Популярный пример — исключение node_modules из транспиляции через Babel:</p><br/>
<pre><code class="javascript">rules: [
  {
    test: /\.jsx?$/,
    exclude: /node_modules/,
    loader: 'babel-loader'
  }
]</code></pre><br/>
<p>Другой пример — обычные CSS-файлы не требуется обрабатывать препроцессором:</p><br/>
<pre><code class="javascript">rules: [
  {
    test: /\.scss$/,
    use: ['style-loader', 'css-loader', 'sass-loader']
  },
  {
    test: /\.css$/,
    use: ['style-loader', 'css-loader']
  }
]</code></pre><br/>
<p><strong>— Не включать оптимизации размера бандла в dev-режиме</strong></p><br/>
<p>На мощной машине разработчика со стабильным интернетом развёрнутое локально приложение обычно запускается быстро, даже если весит несколько мегабайт. Оптимизация бандла при сборке может отнять гораздо больше драгоценного времени, чем сэкономить при загрузке.</p><br/>
<p>Совет касается JS (Terser, Uglify <a href="https://survivejs.com/webpack/optimizing/minifying/#other-ways-to-minify-javascript">и др.</a>), CSS (cssnano, optimize-css-assets-webpack-plugin), SVG и изображений (SVGO, Imagemin, image-webpack-loader), HTML (html-minifier, опция в html-webpack-plugin) и др.</p><br/>
<p><strong>— Не включать полифиллы и трансформации в dev-режиме</strong></p><br/>
<p>Если вы используете babel-preset-env, postcss-preset-env или Autoprefixer — добавьте <a href="https://github.com/browserslist/browserslist#environments">отдельную конфигурацию Browserslist</a> для dev-режима, включающую только те браузеры, которые используются вами при разработке. Скорее всего, это последние версии Chrome или Firefox, отлично поддерживающие современные стандарты без полифиллов и трансформаций. Это позволит избегать ненужной работы.</p><br/>
<p>Пример .browserslistrc:</p><br/>
<pre><code class="plaintext">[production]
your supported browsers go here...

[development]
last 2 Chrome versions
last 2 Firefox versions
last 1 Safari version</code></pre><br/>
<p><strong>— Пересмотреть использование source maps</strong></p><br/>
<p>Генерирование наиболее точных и полных source maps занимает значительное время (на нашем проекте — около 30% времени prod-сборки с опцией <code>devtool: 'source-map'</code>). Подумайте, нужны ли вам source maps в prod-сборке (локально и в CI). Возможно, стоит генерировать их только при необходимости — например, на основе переменной окружения или тега у коммита.</p><br/>
<p>В dev-режиме в большинстве случаев будет достаточно облегчённого варианта — <code>'cheap-eval-source-map'</code> или <code>'cheap-module-eval-source-map'</code>. Подробнее см. в <a href="https://webpack.js.org/configuration/devtool/">документации</a> webpack.</p><br/>
<p><strong>— Настроить сжатие в Terser</strong></p><br/>
<p>Согласно <a href="https://github.com/terser-js/terser#terser-fast-minify-mode">документации Terser</a> (то же самое относится и к Uglify), при минификации кода подавляющую часть времени «съедают» опции <code>mangle</code> и <code>compress</code>. Тонкой их настройкой можно добиться ускорения сборки ценой незначительного увеличения размера бандла. Есть <a href="https://github.com/vuejs/vue-cli/blob/dev/packages/%40vue/cli-service/lib/config/terserOptions.js">пример</a> в исходниках vue-cli и <a href="https://gist.github.com/rowanoulton/44ec3424ac1e86b63316d522e1b99a16#file-webpack-config-js">другой пример</a> от инженера из Slack. В нашем проекте тюнинг Terser по первому варианту сокращает время сборки примерно на 7% в обмен на 2,5-процентное увеличение размера бандла. Стоит ли игра свеч — решать вам.</p><br/>
<p><strong>— Исключать внешние зависимости из парсинга</strong></p><br/>
<p>С помощью опций <a href="https://webpack.js.org/configuration/module#modulenoparse"><code>module.noParse</code></a> и <a href="https://webpack.js.org/configuration/resolve/#resolvealias"><code>resolve.alias</code></a> можно перенаправить импортирование библиотечных модулей на уже скомпилированные версии и просто вставлять их в бандл, не тратя время на парсинг. В dev-режиме это должно значительно повысить скорость сборки, в том числе инкрементальной.</p><br/>
<p>Алгоритм примерно следующий:</p><br/>
<p>(1) Составить список модулей, которые нужно пропускать при парсинге.</p><br/>
<p>В идеале это все runtime-зависимости, попадающие в бандл (или хотя бы самые массивные из них, такие как react-dom или lodash), причём не только собственные (первого уровня), но и транзитивные (зависимости зависимостей). Поддерживать этот список в дальнейшем придётся самостоятельно.</p><br/>
<p>(2) Для выбранных модулей выписать пути к их скомпилированным версиям.</p><br/>
<p>Вместо пропускаемых зависимостей нужно предоставить сборщику альтернативу, причём эта альтернатива не должна зависеть от окружения — иметь обращений к <code>module.exports</code>, <code>require</code>, <code>process</code>, <code>import</code> и т.д. На эту роль подходят заранее скомпилированные (не обязательно минифицированные) single-file модули, которые обычно лежат в папке dist внутри исходников зависимости. Чтобы найти их, придётся отправиться в node_modules. Например, для axios путь к скомпилированному модулю выглядит так: <code>node_modules/axios/dist/axios.js</code>.</p><br/>
<p>(3) В конфигурации webpack использовать опцию <code>resolve.alias</code> для замены импортов по названиям зависимостей на прямые импорты файлов, пути к которым были выписаны на предыдущем шаге.</p><br/>
<p>Например:</p><br/>
<pre><code class="javascript">{
  resolve: {
    alias: {
      axios: path.resolve(
        __dirname,
        'node_modules/dist/axios.min.js'
      ),
      ...
    }
  }
}</code></pre><br/>
<p>Здесь кроется большой недостаток: если ваш код или код ваших зависимостей обращается не к стандартной точке входа (индексный файл, поле <code>main</code> в <code>package.json</code>), а к конкретному файлу внутри исходников зависимости, или если зависимость экспортируется как ES-модуль, или если в процесс резолвинга что-то вмешивается (например, babel-plugin-transform-imports), вся затея может провалиться. Бандл соберётся, однако приложение будет сломано.</p><br/>
<p>(4) В конфигурации webpack использовать опцию <code>module.noParse</code>, чтобы с помощью регулярных выражений пропускать парсинг предкомпилированных модулей, запрашиваемых по путям из шага 2.</p><br/>
<p>Например:</p><br/>
<pre><code class="javascript">{
  module: {
    noParse: [
      new RegExp('node_modules/dist/axios.min.js'),
      ...
    ]
  }
}</code></pre><br/>
<p>Итого: на бумаге способ выглядит многообещающе, однако нетривиальная настройка с подводными камнями как минимум повышает затраты на внедрение, а как максимум — сводит пользу на нет.</p><br/>
<p>Альтернативный вариант с похожим принципом работы — использование опции <a href="https://webpack.js.org/configuration/externals"><code>externals</code></a>. В этом случае придётся самостоятельно вставлять в HTML-файл ссылки на внешние скрипты, да ещё и с нужными версиями зависимостей, соответствующими package.json.</p><br/>
<p><strong>— Выделять редко изменяющийся код в отдельный бандл и компилировать его только один раз</strong></p><br/>
<p>Наверняка вы слышали про <a href="https://webpack.js.org/plugins/dll-plugin/">DllPlugin</a>. С его помощью можно разнести по разным сборкам активно меняющийся код (ваше приложение) и редко меняющийся код (например, зависимости). Единожды собранный бандл с зависимостями (тот самый DLL) затем просто подключается к сборке приложения — получается экономия времени.</p><br/>
<p>Выглядит это в общих чертах так:</p><br/>
<ol>
<li>Для сборки DLL создаётся отдельная конфигурация webpack, необходимые модули подключаются как точки входа.</li>
<li>Запускается сборка по этой конфигурации. DllPlugin генерирует DLL-бандл и файл-манифест с маппингами имён и путей к модулям.</li>
<li>В конфигурацию основной сборки добавляется DllReferencePlugin, в который передаётся манифест.</li>
<li>Импорты зависимостей, вынесенных в DLL, при сборке отображаются на уже скомпилированные модули с помощью манифеста.</li>
</ol><br/>
<p>Немного подробнее можно прочитать в статье по <a href="https://robertknight.me.uk/posts/webpack-dll-plugins/">ссылке</a>.</p><br/>
<p>Начав использовать этот подход, вы довольно быстро обнаружите ряд недостатков:</p><br/>
<ul>
<li>Сборка DLL обособлена от основной сборки, и ей нужно управлять отдельно: подготовить специальную конфигурацию, запускать заново каждый раз при переключении ветки или изменении в зависимостях.</li>
<li>Так как DLL-библиотека не относится к артефактам основной сборки, её нужно будет вручную скопировать в папку с остальными ассетами и подключить в HTML-файле с помощью одного из этих плагинов: <a href="https://github.com/SimenB/add-asset-html-webpack-plugin">1</a>, <a href="https://github.com/jharris4/html-webpack-include-assets-plugin">2</a>.</li>
<li>Нужно вручную поддерживать в актуальном состоянии список зависимостей, предназначенных для включения в DLL-бандл.</li>
<li>Самое грустное: к DLL-бандлу не применяется tree-shaking. По идее, для этого предназначена опция <a href="https://github.com/webpack/webpack/pull/7344"><code>entryOnly</code></a>, однако её забыли задокументировать.</li>
</ul><br/>
<p>Избавиться от бойлерплейта и решить первую проблему (а также вторую, если вы используете html-webpack-plugin v3 — с 4-й версией не работает) можно с помощью <a href="https://github.com/asfktz/autodll-webpack-plugin">AutoDllPlugin</a>. Однако в нём до сих пор не поддержана опция <code>entryOnly</code> для используемого «под капотом» DllPlugin, а сам автор плагина сомневается в целесообразности использования своего детища в свете скорого прихода webpack 5.</p><br/>
<h2 id="raznoe">Разное</h2><br/>
<p>Регулярно обновляйте ваше ПО и зависимости. Более свежие версии Node.js, npm / yarn и инструментов для сборки (webpack, Babel и др.) часто содержат улучшения производительности. Разумеется, перед началом эксплуатации новой версии стоит внимательно ознакомиться с changelog, issues, отчётами по безопасности, убедиться в стабильности и провести тестирование.</p><br/>
<p>При использовании PostCSS и <a href="https://github.com/csstools/postcss-preset-env">postcss-preset-env</a> обратите внимание на настройку stage, которая отвечает за набор поддерживаемых фич. Например, в нашем проекте был установлен stage-3, из которого использовались только Custom Properties, и переключение на stage-4 сократило время сборки на 13%.</p><br/>
<p>Если вы используете Sass (node-sass, sass-loader), попробуйте <a href="https://sass-lang.com/dart-sass">Dart Sass</a> (реализация Sass на Dart, скомпилированная в JS) и <a href="https://github.com/yibn2008/fast-sass-loader">fast-sass-loader</a>. Возможно, на вашем проекте они дадут прирост производительности сборки. Но даже если не дадут — dart-sass хотя бы устанавливается быстрее, чем node-sass, потому что является чистым JS, а не биндингом для libsass.</p><br/>
<p>Пример использования Dart Sass можно найти в <a href="https://github.com/webpack-contrib/sass-loader#examples">документации sass-loader</a>. Обратите внимание на явное указание конкретной имплементации препроцессора Sass и использование модуля fibers.</p><br/>
<p>Если вы используете CSS-модули, попробуйте отключить добавление хешей в сгенерированные имена классов в dev-режиме. Генерирование уникальных идентификаторов занимает какое-то время, которое можно сэкономить, если включения путей к файлам в имена классов достаточно, чтобы избежать коллизий.</p><br/>
<p>Пример:</p><br/>
<pre><code class="javascript">{
  loader: 'css-loader',
  options: {
    modules: true,
    localIdentName: isDev
      ? '[path][name][local]'
      : '[hash:base64:5]'
  }
}</code></pre><br/>
<p>Выгода, тем не менее, невелика: на нашем проекте это менее полсекунды.</p><br/>
<p>Возможно, вы когда-нибудь встречали в документации webpack таинственный <a href="https://webpack.js.org/plugins/prefetch-plugin/">PrefetchPlugin</a>, который вроде бы обещает ускорить сборку, но каким образом — неизвестно. Создатель webpack в <a href="https://github.com/webpack/webpack/issues/1566#issuecomment-244728689">одном из issues</a> кратко рассказал о том, какую проблему решает этот плагин. Однако как же его использовать?</p><br/>
<ol>
<li>Выгрузить в файл статистику сборки. Это делается с помощью CLI-опции <code>--json</code>, подробнее см. в <a href="https://webpack.js.org/api/stats">документации</a>. Актуально, скорее всего, только для dev-режима сборки.</li>
<li>Загрузить полученный файл в специальный <a href="https://webpack.github.io/analyse/">онлайн-анализатор</a> и перейти на вкладку Hints.</li>
<li>Найти секцию, озаглавленную “Long module build chains”. Если её нет, на этом можно закончить — PrefetchPlugin не понадобится.</li>
<li>Для найденных длинных цепочек использовать PrefetchPlugin. В качестве стартового примера см. <a href="https://stackoverflow.com/questions/32923085/how-to-optimize-webpacks-build-time-using-prefetchplugin-analyse-tool">топик на StackOverflow</a>.</li>
</ol><br/>
<p>Итого: слабо документированный способ без гарантии на заметный положительный результат.</p><br/>
<h2 id="v-kachestve-zaklyucheniya">В качестве заключения</h2><br/>
<p>Если у вас есть дополнения, особенно с примерами на других технологиях (TypeScript, Angular и др.) — пишите в комментариях!</p><br/>
<h2 id="istochniki">Источники</h2><br/>
<p>Некоторые из них частично устарели, но, тем не менее, послужили основой для написания данной статьи.</p><br/>
<ul>
<li><a href="https://webpack.js.org/guides/build-performance/">https://webpack.js.org/guides/build-performance/</a></li>
<li><a href="https://survivejs.com/webpack/optimizing/performance/">https://survivejs.com/webpack/optimizing/performance/</a></li>
<li><a href="https://github.com/webpack/docs/wiki/build-performance">https://github.com/webpack/docs/wiki/build-performance</a></li>
<li><a href="https://slack.engineering/keep-webpack-fast-a-field-guide-for-better-build-performance-f56a5995e8f1">https://slack.engineering/keep-webpack-fast-a-field-guide-for-better-build-performance-f56a5995e8f1</a></li>
<li><a href="https://medium.com/webpack/typescript-webpack-super-pursuit-mode-83cc568dea79">https://medium.com/webpack/typescript-webpack-super-pursuit-mode-83cc568dea79</a></li>
<li><a href="https://medium.com/ottofellercom/0-100-in-two-seconds-speed-up-webpack-465de691ed4a">https://medium.com/ottofellercom/0-100-in-two-seconds-speed-up-webpack-465de691ed4a</a></li>
<li><a href="https://medium.com/onfido-tech/speed-up-webpack-ff53c494b89c">https://medium.com/onfido-tech/speed-up-webpack-ff53c494b89c</a></li>
<li><a href="https://blog.box.com/blog/how-we-improved-webpack-build-performance-95">https://blog.box.com/blog/how-we-improved-webpack-build-performance-95</a></li>
<li><a href="https://engineering.bitnami.com/articles/optimizing-your-webpack-builds.html">https://engineering.bitnami.com/articles/optimizing-your-webpack-builds.html</a></li>
<li><a href="https://habr.com/ru/company/skbkontur/blog/351080/">https://habr.com/ru/company/skbkontur/blog/351080/</a></li>
<li><a href="https://habr.com/ru/company/oleg-bunin/blog/433324/">https://habr.com/ru/company/oleg-bunin/blog/433324/</a></li>
<li><a href="https://github.com/lcxfs1991/blog/issues/15">https://github.com/lcxfs1991/blog/issues/15</a></li>
<li><a href="https://github.com/FrendEr/webpack-optimize-example">https://github.com/FrendEr/webpack-optimize-example</a></li>
</ul></div></div> <!----> <!----></div> <div class="tm-article-presenter__meta"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bwebpack%5D" class="tm-tags-list__link">webpack</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bbabel%5D" class="tm-tags-list__link">babel</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%BE%D0%BF%D1%82%D0%B8%D0%BC%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F%20%D1%81%D0%B1%D0%BE%D1%80%D0%BA%D0%B8%5D" class="tm-tags-list__link">оптимизация сборки</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D1%84%D1%80%D0%BE%D0%BD%D1%82%D0%B5%D0%BD%D0%B4%5D" class="tm-tags-list__link">фронтенд</a></li></ul></div> <div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/hub/webdev/" class="tm-hubs-list__link">
    Разработка веб-сайтов
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/javascript/" class="tm-hubs-list__link">
    JavaScript
  </a></li></ul></div></div></article></div> <!----></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 29: ↑28 и ↓1</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-rating"></use></svg> <span title="Всего голосов 29: ↑28 и ↓1" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_medium">+27</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">29K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    225
  </span></button> <!----> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> </div></div> <!----> <!----> <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/disappearedstar/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><svg class="tm-svg-img tm-image-placeholder tm-image-placeholder_blue"><!----> <use xlink:href="/img/megazord-v24.ce74655c.svg#placeholder-user"></use></svg></div></a> <div class="tm-user-card__meta"><div title=" 13 голосов " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    12.2
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">0</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title_variant-article"><span class="tm-user-card__name tm-user-card__name_variant-article">Дмитрий</span> <a href="/ru/users/disappearedstar/" class="tm-user-card__nickname tm-user-card__nickname_variant-article">
          @disappearedstar
        </a> <!----></div> <p class="tm-user-card__short-info tm-user-card__short-info_variant-article">Фронтенд-разработчик</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-article"><!----> <!----> <!----> <!----> <!----></div></div> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----></section> <div class="tm-article-blocks__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/post/451146/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 10 
    </span></a> <!----></div></div></div> <div class="tm-ad-banner__container tm-page-article__banner"><!----> <div id="articleBottomBanner" class="tm-ad-banner"></div></div> <!----> <!----> <!----> <!----> </div></div></div></div></div> <div class="tm-page__sidebar"><div class="tm-layout-sidebar"><div class="tm-layout-sidebar__ads tm-layout-sidebar__ads_initial"><div class="tm-ad-banner__container tm-layout-sidebar__banner"><!----> <div id="sidebarBanner" class="tm-ad-banner"></div></div></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----> <!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/post/451146/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/post/451146/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"451146":{"id":"451146","timePublished":"2019-05-09T16:22:42+00:00","isCorporative":false,"lang":"ru","titleHtml":"Ускоряем сборку веб-приложения с webpack","leadData":{"textHtml":"\u003Cp\u003EПо мере того как ваше приложение развивается и растёт, увеличивается и время его сборки — от нескольких минут при пересборке в development-режиме до десятков минут при «холодной» production-сборке. Это совершенно неприемлемо. Мы, разработчики, не любим переключать контекст в ожидании готовности бандла и хотим получать фидбек от приложения как можно раньше — в идеале за то время, пока переключаемся с IDE на браузер.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EКак этого достичь? Что мы можем сделать, чтобы оптимизировать время сборки?\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЭта статья — обзор существующих в экосистеме webpack инструментов для ускорения сборки, опыт их применения и советы.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EОптимизации размера бандла и производительности самого приложения в этой статье не рассматриваются.\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"editorVersion":"1.0","postType":"article","postLabels":[{"type":"sandbox","data":null}],"author":{"scoreStats":{"score":12.2,"votesCount":13},"rating":0,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"2046905","alias":"disappearedstar","fullname":"Дмитрий","avatarUrl":null,"speciality":"Фронтенд-разработчик"},"statistics":{"commentsCount":10,"favoritesCount":225,"readingCount":28887,"score":27,"votesCount":29},"hubs":[{"relatedData":null,"id":"91","alias":"webdev","type":"collective","title":"Разработка веб-сайтов","titleHtml":"Разработка веб-сайтов","isProfiled":true},{"relatedData":null,"id":"357","alias":"javascript","type":"collective","title":"JavaScript","titleHtml":"JavaScript","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EПо мере того как ваше приложение развивается и растёт, увеличивается и время его сборки — от нескольких минут при пересборке в development-режиме до десятков минут при «холодной» production-сборке. Это совершенно неприемлемо. Мы, разработчики, не любим переключать контекст в ожидании готовности бандла и хотим получать фидбек от приложения как можно раньше — в идеале за то время, пока переключаемся с IDE на браузер.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EКак этого достичь? Что мы можем сделать, чтобы оптимизировать время сборки?\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЭта статья — обзор существующих в экосистеме webpack инструментов для ускорения сборки, опыт их применения и советы.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EОптимизации размера бандла и производительности самого приложения в этой статье не рассматриваются.\u003C\u002Fp\u003E\u003Ca name=\"habracut\"\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПроект, отсылки к которому встречаются в тексте и относительно которого выполняются замеры скорости сборки, — это сравнительно небольшое приложение, написанное на стеке JS + Flow + React + Redux с использованием webpack, Babel, PostCSS, Sass и др. и состоящее из примерно 30 тысяч строк кода и 1500 модулей. Версии зависимостей актуальны на апрель 2019 года.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИсследования проводились на компьютере с Windows 10, Node.js 8, 4-ядерным процессором, 8 ГБ памяти и SSD.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2 id=\"terminologiya\"\u003EТерминология\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EСборка — процесс преобразования исходных файлов проекта в набор связанных ассетов, в совокупности составляющих веб-приложение.\u003C\u002Fli\u003E\r\n\u003Cli\u003Edev-режим — сборка с опцией \u003Ccode\u003Emode: 'development'\u003C\u002Fcode\u003E, обычно с использованием webpack-dev-server и watch-режима.\u003C\u002Fli\u003E\r\n\u003Cli\u003Eprod-режим — сборка с опцией \u003Ccode\u003Emode: 'production'\u003C\u002Fcode\u003E, обычно с полным набором оптимизаций бандла.\u003C\u002Fli\u003E\r\n\u003Cli\u003EИнкрементальная сборка — в dev-режиме: пересборка только файлов с изменениями.\u003C\u002Fli\u003E\r\n\u003Cli\u003E«Холодная» сборка — сборка с нуля, без каких-либо кешей, но с установленными зависимостями.\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2 id=\"keshirovanie\"\u003EКеширование\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EКеширование позволяет сохранять результаты вычислений для дальнейшего переиспользования. Первая сборка может быть немного медленнее обычной из-за накладных расходов на кеширование, однако последующие будут гораздо быстрее за счёт переиспользования результатов компиляции неизменившихся модулей.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПо умолчанию webpack в watch-режиме \u003Ca href=\"https:\u002F\u002Fwebpack.js.org\u002Fconfiguration\u002Fother-options\u002F#cache\"\u003Eкеширует в памяти\u003C\u002Fa\u003E промежуточные результаты сборки, чтобы не пересобирать весь проект при каждом изменении. Для обычной сборки (не в watch-режиме) эта настройка не имеет смысла. Также можно попробовать включить \u003Ca href=\"https:\u002F\u002Fwebpack.js.org\u002Fconfiguration\u002Fresolve#resolveunsafecache\"\u003Eкеш-резолвинг\u003C\u002Fa\u003E, чтобы упростить webpack работу по поиску модулей и посмотреть, оказывает ли эта настройка заметный эффект на ваш проект.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПерсистентного (сохраняемого на диск или в другое хранилище) кеша в webpack пока нет, хотя в 5-й версии его \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fwebpack\u002Fchangelog-v5\u002Fblob\u002Fmaster\u002FREADME.md#persistent-caching\"\u003Eобещают добавить\u003C\u002Fa\u003E. А пока мы можем использовать следующие инструменты:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cstrong\u003E— Кеширование в \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fwebpack-contrib\u002Fterser-webpack-plugin#cache\"\u003Eнастройках TerserWebpackPlugin\u003C\u002Fa\u003E\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПо умолчанию отключено. Даже в одиночку оказывает заметный положительный эффект: 60,7 с → 39 с (-36%), отлично сочетается с другими инструментами для кеширования.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВключить и использовать очень просто:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Eoptimization: {\n  minimizer: [\n    new TerserJsPlugin({\n      terserOptions: { ... },\n      cache: true\n    })\n  ]\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cstrong\u003E— \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fwebpack-contrib\u002Fcache-loader\"\u003Ecache-loader\u003C\u002Fa\u003E\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003ECache-loader можно поместить в любую цепочку лоадеров и закешировать результаты работы предшествующих лоадеров.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПо умолчанию сохраняет кеш в папку .cache-loader в корне проекта. С помощью опции \u003Ccode\u003EcacheDirectory\u003C\u002Fcode\u003E в настройках лоадера путь можно переопределить.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПример использования:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003E{\n  test: \u002F\\.js$\u002F,\n  use: [\n    {\n      loader: 'cache-loader',\n      options: {\n        cacheDirectory: path.resolve(\n          __dirname,\n          'node_modules\u002F.cache\u002Fcache-loader'\n        ),\n      },\n    },\n    'babel-loader'\n  ]\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EБезопасное и надёжное решение. Без проблем работает практически с любыми лоадерами: для скриптов (babel-loader, ts-loader), стилей (scss-, less-, postcss-, css-loader), изображений и шрифтов (image-webpack-loader, react-svg-loader, file-loader) и др.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EОбратите внимание:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EПри использовании cache-loader совместно со style-loader или MiniCssExtractPlugin.loader он должен быть помещён \u003Cem\u003Eпосле\u003C\u002Fem\u003E них:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003E['style-loader', 'cache-loader', 'css-loader', ...]\u003C\u002Fcode\u003E.\u003C\u002Fli\u003E\r\n\u003Cli\u003EВопреки рекомендациям документации использовать этот лоадер для кеширования результатов только трудоёмких вычислений, он вполне может дать хоть и небольшой, но измеримый прирост производительности и для более «лёгких» лоадеров — нужно пробовать и замерять.\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EРезультаты:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003Edev: 35,5 с → (включаем cache-loader) → 36,2 с (+2%) → (повторная сборка) → 7,9 с (-78%)\u003C\u002Fli\u003E\r\n\u003Cli\u003Eprod: 60,6 с → (включаем cache-loader) → 61,5 с (+1,5%) → (повторная сборка) → 30,6 с (-49%) → (включаем кеш у Terser) → 15,4 с (-75%)\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cstrong\u003E— \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fmzgoddard\u002Fhard-source-webpack-plugin\"\u003EHardSourceWebpackPlugin\u003C\u002Fa\u003E\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EБолее массивное и «умное» решение для кеширования на уровне всего сборочного процесса, а не отдельных цепочек лоадеров. В базовом варианте использования достаточно добавить плагин в конфигурацию webpack, стандартных настроек должно быть достаточно для корректной работы. Подойдёт тем, кто хочет добиться максимальной производительности и не боится столкнуться с трудностями.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Eplugins: [\n  ...,\n  new HardSourceWebpackPlugin()\n]\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВ \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fmzgoddard\u002Fhard-source-webpack-plugin\u002Fblob\u002Fmaster\u002FREADME.md\"\u003Eдокументации\u003C\u002Fa\u003E есть примеры использования с расширенными настройками и советы по решению возможных проблем. Перед вводом плагина в эксплуатацию на постоянной основе стоит тщательно протестировать его работу в различных ситуациях и режимах сборки.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EРезультаты:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003Edev: 35,5 с → (включаем плагин) → 36,5 с (+3%) → (повторная сборка) → 3,7 с (-90%)\u003C\u002Fli\u003E\r\n\u003Cli\u003Eprod: 60,6 с → (включаем плагин) → 69,5 с (+15%) → (повторная сборка) → 25 с (-59%) → (включаем кеш у Terser) → 10 с (-83%)\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПлюсы:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003Eпо сравнению с cache-loader ещё больше ускоряет повторные сборки;\u003C\u002Fli\u003E\r\n\u003Cli\u003Eне требует дублирования объявлений в разных местах конфигурации, как у cache-loader.\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EМинусы:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003Eпо сравнению с cache-loader сильнее замедляет первую сборку (когда дисковый кеш отсутствует);\u003C\u002Fli\u003E\r\n\u003Cli\u003Eможет немного увеличивать время инкрементальной пересборки;\u003C\u002Fli\u003E\r\n\u003Cli\u003Eможет вызывать проблемы при использовании webpack-dev-server и требовать детальной настройки разделения и инвалидации кешей (см. \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fmzgoddard\u002Fhard-source-webpack-plugin#troubleshooting\"\u003Eдокументацию\u003C\u002Fa\u003E);\u003C\u002Fli\u003E\r\n\u003Cli\u003Eдостаточно много \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fmzgoddard\u002Fhard-source-webpack-plugin\u002Fissues\"\u003Eissues\u003C\u002Fa\u003E с багами на GitHub.\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cstrong\u003E— Кеширование в \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fbabel\u002Fbabel-loader#options\"\u003Eнастройках babel-loader\u003C\u002Fa\u003E\u003C\u002Fstrong\u003E. По умолчанию отключено. Эффект на несколько процентов хуже, чем от cache-loader.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cstrong\u003E— Кеширование в \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fwebpack-contrib\u002Feslint-loader#cache-default-false\"\u003Eнастройках eslint-loader\u003C\u002Fa\u003E\u003C\u002Fstrong\u003E. По умолчанию отключено. Если вы используете этот лоадер, кеш поможет не тратить время на линтинг неизменившихся файлов при повторной сборке.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Chr\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПри использовании cache-loader или HardSourceWebpackPlugin нужно отключить встроенные механизмы кеширования в других плагинах или лоадерах (кроме TerserWebpackPlugin), так как они перестанут приносить пользу при повторных и инкрементальных сборках, а «холодные» даже замедлят. То же относится к самому cache-loader, если уже используется HardSourceWebpackPlugin.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Chr\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПри настройке кеширования могут возникнуть следующие вопросы:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cem\u003EКуда следует сохранять результаты кеширования?\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EКеши обычно хранятся в каталоге \u003Ccode\u003Enode_modules\u002F.cache\u002F&lt;название_кеша\u003E\u002F\u003C\u002Fcode\u003E. Большинство инструментов по умолчанию используют этот путь и позволяют его переопределить, если вы желаете хранить кеш в другом месте.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cem\u003EКогда и как инвалидировать кеш?\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EОчень важно сбрасывать кеш при изменениях конфигурации сборки, которые повлияют на выходной результат. Использование старого кеша в таких случаях вредно и может привести к возникновению ошибок неизвестной природы.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EФакторы, которые нужно принимать во внимание:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003Eсписок зависимостей и их версии: package.json, package-lock.json, yarn.lock, .yarn-integrity;\u003C\u002Fli\u003E\r\n\u003Cli\u003Eсодержимое конфигурационных файлов webpack, Babel, PostCSS, browserslist и других, которые явно или неявно используются лоадерами и плагинами.\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли вы не используете cache-loader или HardSourceWebpackPlugin, которые позволяют переопределять список источников для формирования отпечатка сборки, немного облегчить жизнь вам помогут npm-скрипты, очищающие кеш при добавлении, обновлении или удалении зависимостей:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003E\"prunecaches\": \"rimraf .\u002Fnode_modules\u002F.cache\u002F\",\n\"postinstall\": \"npm run prunecaches\",\n\"postuninstall\": \"npm run prunecaches\"\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EТакже помогут \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fremy\u002Fnodemon\"\u003Enodemon\u003C\u002Fa\u003E, настроенный на очистку кеша, и рестарт webpack-dev-server при обнаружении изменений в конфигурационных файлах:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003E\"start\": \"cross-env NODE_ENV=development nodemon --exec \\\"webpack-dev-server --config webpack.config.dev.js\\\"\"\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003Enodemon.json\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003E{\n  \"watch\": [\n    \"webpack.config.dev.js\",\n    \"babel.config.js\",\n    \"more configs...\",\n  ],\n  \"events\": {\n    \"restart\": \"yarn prunecaches\"\n  }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cem\u003EНужно ли сохранять кеш в репозитории проекта?\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EТак как кеш является, по сути, артефактом сборки, в репозиторий его коммитить не нужно. Как раз с этим поможет расположение кеша внутри папки node_modules, которая, как правило, внесена в .gitignore.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EСтоит заметить, что при наличии системы кеширования, умеющей надёжно определять валидность кеша при любых условиях, включая смену ОС и версии Node.js, кеш можно было бы переиспользовать между машинами разработчиков или в CI, что позволило бы радикально сократить время даже самой первой сборки после переключения между ветками.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cem\u003EВ каких режимах сборки стоит, а в каких не стоит использовать кеш?\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EОднозначного ответа здесь нет: всё зависит от того, как интенсивно вы пользуетесь при разработке dev- и prod-режимами и переключаетесь между ними. В целом, ничто не мешает включить кеширование везде, однако помните, что оно обычно делает медленнее первую сборку. В CI вам, вероятно, всегда нужна «чистая» сборка, и в этом случае кеширование можно отключить с помощью соответствующей переменной окружения.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Chr\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИнтересные материалы про кеширование в webpack:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fwebpack\u002Fwebpack\u002Fissues\u002F6527\"\u003Ehttps:\u002F\u002Fgithub.com\u002Fwebpack\u002Fwebpack\u002Fissues\u002F6527\u003C\u002Fa\u003E — черновик и обсуждение спецификации по добавлению в webpack 5 системы кеширования от автора HardSourcePlugin\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fgist.github.com\u002Fmzgoddard\u002F0b42ad50048f407c1f3ac434a874f8e1\"\u003Ehttps:\u002F\u002Fgist.github.com\u002Fmzgoddard\u002F0b42ad50048f407c1f3ac434a874f8e1\u003C\u002Fa\u003E — рассуждения автора HardSourcePlugin о том, как должна быть реализована система кеширования в webpack \u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fwebpack-contrib\u002Fcache-loader\u002Fissues\u002F11\"\u003Ehttps:\u002F\u002Fgithub.com\u002Fwebpack-contrib\u002Fcache-loader\u002Fissues\u002F11\u003C\u002Fa\u003E — мнения об использовании cache-loader совместно с HardSourcePlugin\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fwebpack\u002Fwebpack\u002Fissues\u002F250\"\u003Ehttps:\u002F\u002Fgithub.com\u002Fwebpack\u002Fwebpack\u002Fissues\u002F250\u003C\u002Fa\u003E — обсуждение возможностей webpack по кешированию\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fmzgoddard\u002Fhard-source-webpack-plugin\u002Fissues\u002F251\"\u003Ehttps:\u002F\u002Fgithub.com\u002Fmzgoddard\u002Fhard-source-webpack-plugin\u002Fissues\u002F251\u003C\u002Fa\u003E — мнения об использовании HardSourcePlugin совместно с AutoDllPlugin\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2 id=\"parallelizaciya\"\u003EПараллелизация\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EС помощью параллелизации можно получить прирост производительности, задействовав все доступные ядра процессора. Конечный эффект индивидуален для каждой машины.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EКстати, вот простой Node.js-код для получения количества доступных процессорных ядер (может пригодиться при настройке перечисленных ниже инструментов):\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Econst os = require('os');\nconst cores = os.cpus().length;\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cstrong\u003E— Параллелизация в \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fwebpack-contrib\u002Fterser-webpack-plugin#parallel\"\u003Eнастройках TerserWebpackPlugin\u003C\u002Fa\u003E\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПо умолчанию отключена. Так же, как и собственное кеширование, легко включается и заметно ускоряет сборку.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Eoptimization: {\n  minimizer: [\n    new TerserJsPlugin({\n      terserOptions: { ... },\n      parallel: true\n    })\n  ]\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cstrong\u003E— \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fwebpack-contrib\u002Fthread-loader\"\u003Ethread-loader\u003C\u002Fa\u003E\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EThread-loader можно поместить в цепочку лоадеров, производящих тяжёлые вычисления, после чего предшествующие лоадеры будут использовать пул подпроцессов Node.js («воркеров»).\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИмеет набор опций, которые позволяют достаточно тонко настроить работу пула воркеров, хотя и базовые значения выглядят вполне адекватно. Отдельного внимания заслуживают \u003Ccode\u003EpoolTimeout\u003C\u002Fcode\u003E и \u003Ccode\u003Eworkers\u003C\u002Fcode\u003E — см. \u003Ca href=\"https:\u002F\u002Fgithub.com\u002FTypeStrong\u002Fts-loader\u002Fblob\u002Fmaster\u002Fexamples\u002Fthread-loader\u002Fwebpack.config.js\"\u003Eпример\u003C\u002Fa\u003E. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EМожет быть использован совместно с cache-loader следующим образом (порядок важен): \u003Ccode\u003E['cache-loader', 'thread-loader', 'babel-loader']\u003C\u002Fcode\u003E. Если для thread-loader включён «прогрев» (warmup), стоит перепроверить стабильность повторных сборок, использующих кеш — webpack может зависать и не завершать процесс после успешного окончания сборки. В этом случае достаточно отключить warmup.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли вы столкнётесь с зависанием сборки после добавления thread-loader в цепочку компиляции Sass-стилей, вам может помочь \u003Ca href=\"https:\u002F\u002Fwebpack.js.org\u002Fguides\u002Fbuild-performance\u002F#sass\"\u003Eэтот совет\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cstrong\u003E— \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Famireh\u002Fhappypack\"\u003EHappyPack\u003C\u002Fa\u003E\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПлагин, который перехватывает вызовы лоадеров и распределяет их работу по нескольким потокам. На данный момент находится в режиме поддержки (то есть развитие не планируется), а его создатель \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Famireh\u002Fhappypack#is-it-necessary-for-webpack-4\"\u003Eрекомендует\u003C\u002Fa\u003E thread-loader в качестве замены. Таким образом, если ваш проект идёт в ногу со временем, от использования HappyPack лучше воздержаться, хотя попробовать и сравнить результаты с thread-loader, безусловно, стоит.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EHappyPack имеет понятную \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Famireh\u002Fhappypack\u002Fblob\u002Fmaster\u002FREADME.md\"\u003Eдокументацию\u003C\u002Fa\u003E по настройке, которая, кстати, довольно необычна сама по себе: конфигурации лоадеров предлагается переместить в вызов конструктора плагина, а сами цепочки лоадеров заменить на собственный лоадер happypack. Такой нестандартный подход может стать причиной неудобств при создании кастомной конфигурации webpack «из кусочков».\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EHappyPack поддерживает \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Famireh\u002Fhappypack\u002Fwiki\u002FLoader-Compatibility-List\"\u003Eограниченный список лоадеров\u003C\u002Fa\u003E; основные и наиболее широко используемые в этом списке присутствуют, а вот работоспособность других не гарантируется по причине возможной несовместимости API. Больше информации можно найти в \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Famireh\u002Fhappypack\u002Fissues\"\u003Eissues\u003C\u002Fa\u003E проекта.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2 id=\"otkaz-ot-vychisleniy\"\u003EОтказ от вычислений\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЛюбая работа занимает время. Чтобы тратить меньше времени, нужно избегать работы, которая приносит мало пользы, может быть отложена на потом или вообще не нужна в данной ситуации.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cstrong\u003E— Применять лоадеры к минимально возможному числу модулей\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fwebpack.js.org\u002Fconfiguration\u002Fmodule#condition\"\u003EСвойства test, exclude и include\u003C\u002Fa\u003E задают условия для включения модуля в процесс обработки лоадером. Смысл — избегать трансформации модулей, которые не нуждаются в этой трансформации.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПопулярный пример — исключение node_modules из транспиляции через Babel:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Erules: [\n  {\n    test: \u002F\\.jsx?$\u002F,\n    exclude: \u002Fnode_modules\u002F,\n    loader: 'babel-loader'\n  }\n]\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EДругой пример — обычные CSS-файлы не требуется обрабатывать препроцессором:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Erules: [\n  {\n    test: \u002F\\.scss$\u002F,\n    use: ['style-loader', 'css-loader', 'sass-loader']\n  },\n  {\n    test: \u002F\\.css$\u002F,\n    use: ['style-loader', 'css-loader']\n  }\n]\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cstrong\u003E— Не включать оптимизации размера бандла в dev-режиме\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНа мощной машине разработчика со стабильным интернетом развёрнутое локально приложение обычно запускается быстро, даже если весит несколько мегабайт. Оптимизация бандла при сборке может отнять гораздо больше драгоценного времени, чем сэкономить при загрузке.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EСовет касается JS (Terser, Uglify \u003Ca href=\"https:\u002F\u002Fsurvivejs.com\u002Fwebpack\u002Foptimizing\u002Fminifying\u002F#other-ways-to-minify-javascript\"\u003Eи др.\u003C\u002Fa\u003E), CSS (cssnano, optimize-css-assets-webpack-plugin), SVG и изображений (SVGO, Imagemin, image-webpack-loader), HTML (html-minifier, опция в html-webpack-plugin) и др.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cstrong\u003E— Не включать полифиллы и трансформации в dev-режиме\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли вы используете babel-preset-env, postcss-preset-env или Autoprefixer — добавьте \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fbrowserslist\u002Fbrowserslist#environments\"\u003Eотдельную конфигурацию Browserslist\u003C\u002Fa\u003E для dev-режима, включающую только те браузеры, которые используются вами при разработке. Скорее всего, это последние версии Chrome или Firefox, отлично поддерживающие современные стандарты без полифиллов и трансформаций. Это позволит избегать ненужной работы.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПример .browserslistrc:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003E[production]\nyour supported browsers go here...\n\n[development]\nlast 2 Chrome versions\nlast 2 Firefox versions\nlast 1 Safari version\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cstrong\u003E— Пересмотреть использование source maps\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EГенерирование наиболее точных и полных source maps занимает значительное время (на нашем проекте — около 30% времени prod-сборки с опцией \u003Ccode\u003Edevtool: 'source-map'\u003C\u002Fcode\u003E). Подумайте, нужны ли вам source maps в prod-сборке (локально и в CI). Возможно, стоит генерировать их только при необходимости — например, на основе переменной окружения или тега у коммита.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВ dev-режиме в большинстве случаев будет достаточно облегчённого варианта — \u003Ccode\u003E'cheap-eval-source-map'\u003C\u002Fcode\u003E или \u003Ccode\u003E'cheap-module-eval-source-map'\u003C\u002Fcode\u003E. Подробнее см. в \u003Ca href=\"https:\u002F\u002Fwebpack.js.org\u002Fconfiguration\u002Fdevtool\u002F\"\u003Eдокументации\u003C\u002Fa\u003E webpack.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cstrong\u003E— Настроить сжатие в Terser\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EСогласно \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fterser-js\u002Fterser#terser-fast-minify-mode\"\u003Eдокументации Terser\u003C\u002Fa\u003E (то же самое относится и к Uglify), при минификации кода подавляющую часть времени «съедают» опции \u003Ccode\u003Emangle\u003C\u002Fcode\u003E и \u003Ccode\u003Ecompress\u003C\u002Fcode\u003E. Тонкой их настройкой можно добиться ускорения сборки ценой незначительного увеличения размера бандла. Есть \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fvuejs\u002Fvue-cli\u002Fblob\u002Fdev\u002Fpackages\u002F%40vue\u002Fcli-service\u002Flib\u002Fconfig\u002FterserOptions.js\"\u003Eпример\u003C\u002Fa\u003E в исходниках vue-cli и \u003Ca href=\"https:\u002F\u002Fgist.github.com\u002Frowanoulton\u002F44ec3424ac1e86b63316d522e1b99a16#file-webpack-config-js\"\u003Eдругой пример\u003C\u002Fa\u003E от инженера из Slack. В нашем проекте тюнинг Terser по первому варианту сокращает время сборки примерно на 7% в обмен на 2,5-процентное увеличение размера бандла. Стоит ли игра свеч — решать вам.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cstrong\u003E— Исключать внешние зависимости из парсинга\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EС помощью опций \u003Ca href=\"https:\u002F\u002Fwebpack.js.org\u002Fconfiguration\u002Fmodule#modulenoparse\"\u003E\u003Ccode\u003Emodule.noParse\u003C\u002Fcode\u003E\u003C\u002Fa\u003E и \u003Ca href=\"https:\u002F\u002Fwebpack.js.org\u002Fconfiguration\u002Fresolve\u002F#resolvealias\"\u003E\u003Ccode\u003Eresolve.alias\u003C\u002Fcode\u003E\u003C\u002Fa\u003E можно перенаправить импортирование библиотечных модулей на уже скомпилированные версии и просто вставлять их в бандл, не тратя время на парсинг. В dev-режиме это должно значительно повысить скорость сборки, в том числе инкрементальной.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EАлгоритм примерно следующий:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E(1) Составить список модулей, которые нужно пропускать при парсинге.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВ идеале это все runtime-зависимости, попадающие в бандл (или хотя бы самые массивные из них, такие как react-dom или lodash), причём не только собственные (первого уровня), но и транзитивные (зависимости зависимостей). Поддерживать этот список в дальнейшем придётся самостоятельно.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E(2) Для выбранных модулей выписать пути к их скомпилированным версиям.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВместо пропускаемых зависимостей нужно предоставить сборщику альтернативу, причём эта альтернатива не должна зависеть от окружения — иметь обращений к \u003Ccode\u003Emodule.exports\u003C\u002Fcode\u003E, \u003Ccode\u003Erequire\u003C\u002Fcode\u003E, \u003Ccode\u003Eprocess\u003C\u002Fcode\u003E, \u003Ccode\u003Eimport\u003C\u002Fcode\u003E и т.д. На эту роль подходят заранее скомпилированные (не обязательно минифицированные) single-file модули, которые обычно лежат в папке dist внутри исходников зависимости. Чтобы найти их, придётся отправиться в node_modules. Например, для axios путь к скомпилированному модулю выглядит так: \u003Ccode\u003Enode_modules\u002Faxios\u002Fdist\u002Faxios.js\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E(3) В конфигурации webpack использовать опцию \u003Ccode\u003Eresolve.alias\u003C\u002Fcode\u003E для замены импортов по названиям зависимостей на прямые импорты файлов, пути к которым были выписаны на предыдущем шаге.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНапример:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003E{\n  resolve: {\n    alias: {\n      axios: path.resolve(\n        __dirname,\n        'node_modules\u002Fdist\u002Faxios.min.js'\n      ),\n      ...\n    }\n  }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЗдесь кроется большой недостаток: если ваш код или код ваших зависимостей обращается не к стандартной точке входа (индексный файл, поле \u003Ccode\u003Emain\u003C\u002Fcode\u003E в \u003Ccode\u003Epackage.json\u003C\u002Fcode\u003E), а к конкретному файлу внутри исходников зависимости, или если зависимость экспортируется как ES-модуль, или если в процесс резолвинга что-то вмешивается (например, babel-plugin-transform-imports), вся затея может провалиться. Бандл соберётся, однако приложение будет сломано.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E(4) В конфигурации webpack использовать опцию \u003Ccode\u003Emodule.noParse\u003C\u002Fcode\u003E, чтобы с помощью регулярных выражений пропускать парсинг предкомпилированных модулей, запрашиваемых по путям из шага 2.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНапример:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003E{\n  module: {\n    noParse: [\n      new RegExp('node_modules\u002Fdist\u002Faxios.min.js'),\n      ...\n    ]\n  }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИтого: на бумаге способ выглядит многообещающе, однако нетривиальная настройка с подводными камнями как минимум повышает затраты на внедрение, а как максимум — сводит пользу на нет.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EАльтернативный вариант с похожим принципом работы — использование опции \u003Ca href=\"https:\u002F\u002Fwebpack.js.org\u002Fconfiguration\u002Fexternals\"\u003E\u003Ccode\u003Eexternals\u003C\u002Fcode\u003E\u003C\u002Fa\u003E. В этом случае придётся самостоятельно вставлять в HTML-файл ссылки на внешние скрипты, да ещё и с нужными версиями зависимостей, соответствующими package.json.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cstrong\u003E— Выделять редко изменяющийся код в отдельный бандл и компилировать его только один раз\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНаверняка вы слышали про \u003Ca href=\"https:\u002F\u002Fwebpack.js.org\u002Fplugins\u002Fdll-plugin\u002F\"\u003EDllPlugin\u003C\u002Fa\u003E. С его помощью можно разнести по разным сборкам активно меняющийся код (ваше приложение) и редко меняющийся код (например, зависимости). Единожды собранный бандл с зависимостями (тот самый DLL) затем просто подключается к сборке приложения — получается экономия времени.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВыглядит это в общих чертах так:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Col\u003E\r\n\u003Cli\u003EДля сборки DLL создаётся отдельная конфигурация webpack, необходимые модули подключаются как точки входа.\u003C\u002Fli\u003E\r\n\u003Cli\u003EЗапускается сборка по этой конфигурации. DllPlugin генерирует DLL-бандл и файл-манифест с маппингами имён и путей к модулям.\u003C\u002Fli\u003E\r\n\u003Cli\u003EВ конфигурацию основной сборки добавляется DllReferencePlugin, в который передаётся манифест.\u003C\u002Fli\u003E\r\n\u003Cli\u003EИмпорты зависимостей, вынесенных в DLL, при сборке отображаются на уже скомпилированные модули с помощью манифеста.\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНемного подробнее можно прочитать в статье по \u003Ca href=\"https:\u002F\u002Frobertknight.me.uk\u002Fposts\u002Fwebpack-dll-plugins\u002F\"\u003Eссылке\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНачав использовать этот подход, вы довольно быстро обнаружите ряд недостатков:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EСборка DLL обособлена от основной сборки, и ей нужно управлять отдельно: подготовить специальную конфигурацию, запускать заново каждый раз при переключении ветки или изменении в зависимостях.\u003C\u002Fli\u003E\r\n\u003Cli\u003EТак как DLL-библиотека не относится к артефактам основной сборки, её нужно будет вручную скопировать в папку с остальными ассетами и подключить в HTML-файле с помощью одного из этих плагинов: \u003Ca href=\"https:\u002F\u002Fgithub.com\u002FSimenB\u002Fadd-asset-html-webpack-plugin\"\u003E1\u003C\u002Fa\u003E, \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fjharris4\u002Fhtml-webpack-include-assets-plugin\"\u003E2\u003C\u002Fa\u003E.\u003C\u002Fli\u003E\r\n\u003Cli\u003EНужно вручную поддерживать в актуальном состоянии список зависимостей, предназначенных для включения в DLL-бандл.\u003C\u002Fli\u003E\r\n\u003Cli\u003EСамое грустное: к DLL-бандлу не применяется tree-shaking. По идее, для этого предназначена опция \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fwebpack\u002Fwebpack\u002Fpull\u002F7344\"\u003E\u003Ccode\u003EentryOnly\u003C\u002Fcode\u003E\u003C\u002Fa\u003E, однако её забыли задокументировать.\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИзбавиться от бойлерплейта и решить первую проблему (а также вторую, если вы используете html-webpack-plugin v3 — с 4-й версией не работает) можно с помощью \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fasfktz\u002Fautodll-webpack-plugin\"\u003EAutoDllPlugin\u003C\u002Fa\u003E. Однако в нём до сих пор не поддержана опция \u003Ccode\u003EentryOnly\u003C\u002Fcode\u003E для используемого «под капотом» DllPlugin, а сам автор плагина сомневается в целесообразности использования своего детища в свете скорого прихода webpack 5.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2 id=\"raznoe\"\u003EРазное\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EРегулярно обновляйте ваше ПО и зависимости. Более свежие версии Node.js, npm \u002F yarn и инструментов для сборки (webpack, Babel и др.) часто содержат улучшения производительности. Разумеется, перед началом эксплуатации новой версии стоит внимательно ознакомиться с changelog, issues, отчётами по безопасности, убедиться в стабильности и провести тестирование.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПри использовании PostCSS и \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fcsstools\u002Fpostcss-preset-env\"\u003Epostcss-preset-env\u003C\u002Fa\u003E обратите внимание на настройку stage, которая отвечает за набор поддерживаемых фич. Например, в нашем проекте был установлен stage-3, из которого использовались только Custom Properties, и переключение на stage-4 сократило время сборки на 13%.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли вы используете Sass (node-sass, sass-loader), попробуйте \u003Ca href=\"https:\u002F\u002Fsass-lang.com\u002Fdart-sass\"\u003EDart Sass\u003C\u002Fa\u003E (реализация Sass на Dart, скомпилированная в JS) и \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fyibn2008\u002Ffast-sass-loader\"\u003Efast-sass-loader\u003C\u002Fa\u003E. Возможно, на вашем проекте они дадут прирост производительности сборки. Но даже если не дадут — dart-sass хотя бы устанавливается быстрее, чем node-sass, потому что является чистым JS, а не биндингом для libsass.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПример использования Dart Sass можно найти в \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fwebpack-contrib\u002Fsass-loader#examples\"\u003Eдокументации sass-loader\u003C\u002Fa\u003E. Обратите внимание на явное указание конкретной имплементации препроцессора Sass и использование модуля fibers.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли вы используете CSS-модули, попробуйте отключить добавление хешей в сгенерированные имена классов в dev-режиме. Генерирование уникальных идентификаторов занимает какое-то время, которое можно сэкономить, если включения путей к файлам в имена классов достаточно, чтобы избежать коллизий.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПример:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003E{\n  loader: 'css-loader',\n  options: {\n    modules: true,\n    localIdentName: isDev\n      ? '[path][name][local]'\n      : '[hash:base64:5]'\n  }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВыгода, тем не менее, невелика: на нашем проекте это менее полсекунды.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВозможно, вы когда-нибудь встречали в документации webpack таинственный \u003Ca href=\"https:\u002F\u002Fwebpack.js.org\u002Fplugins\u002Fprefetch-plugin\u002F\"\u003EPrefetchPlugin\u003C\u002Fa\u003E, который вроде бы обещает ускорить сборку, но каким образом — неизвестно. Создатель webpack в \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fwebpack\u002Fwebpack\u002Fissues\u002F1566#issuecomment-244728689\"\u003Eодном из issues\u003C\u002Fa\u003E кратко рассказал о том, какую проблему решает этот плагин. Однако как же его использовать?\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Col\u003E\r\n\u003Cli\u003EВыгрузить в файл статистику сборки. Это делается с помощью CLI-опции \u003Ccode\u003E--json\u003C\u002Fcode\u003E, подробнее см. в \u003Ca href=\"https:\u002F\u002Fwebpack.js.org\u002Fapi\u002Fstats\"\u003Eдокументации\u003C\u002Fa\u003E. Актуально, скорее всего, только для dev-режима сборки.\u003C\u002Fli\u003E\r\n\u003Cli\u003EЗагрузить полученный файл в специальный \u003Ca href=\"https:\u002F\u002Fwebpack.github.io\u002Fanalyse\u002F\"\u003Eонлайн-анализатор\u003C\u002Fa\u003E и перейти на вкладку Hints.\u003C\u002Fli\u003E\r\n\u003Cli\u003EНайти секцию, озаглавленную “Long module build chains”. Если её нет, на этом можно закончить — PrefetchPlugin не понадобится.\u003C\u002Fli\u003E\r\n\u003Cli\u003EДля найденных длинных цепочек использовать PrefetchPlugin. В качестве стартового примера см. \u003Ca href=\"https:\u002F\u002Fstackoverflow.com\u002Fquestions\u002F32923085\u002Fhow-to-optimize-webpacks-build-time-using-prefetchplugin-analyse-tool\"\u003Eтопик на StackOverflow\u003C\u002Fa\u003E.\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИтого: слабо документированный способ без гарантии на заметный положительный результат.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2 id=\"v-kachestve-zaklyucheniya\"\u003EВ качестве заключения\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли у вас есть дополнения, особенно с примерами на других технологиях (TypeScript, Angular и др.) — пишите в комментариях!\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2 id=\"istochniki\"\u003EИсточники\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНекоторые из них частично устарели, но, тем не менее, послужили основой для написания данной статьи.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fwebpack.js.org\u002Fguides\u002Fbuild-performance\u002F\"\u003Ehttps:\u002F\u002Fwebpack.js.org\u002Fguides\u002Fbuild-performance\u002F\u003C\u002Fa\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fsurvivejs.com\u002Fwebpack\u002Foptimizing\u002Fperformance\u002F\"\u003Ehttps:\u002F\u002Fsurvivejs.com\u002Fwebpack\u002Foptimizing\u002Fperformance\u002F\u003C\u002Fa\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fwebpack\u002Fdocs\u002Fwiki\u002Fbuild-performance\"\u003Ehttps:\u002F\u002Fgithub.com\u002Fwebpack\u002Fdocs\u002Fwiki\u002Fbuild-performance\u003C\u002Fa\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fslack.engineering\u002Fkeep-webpack-fast-a-field-guide-for-better-build-performance-f56a5995e8f1\"\u003Ehttps:\u002F\u002Fslack.engineering\u002Fkeep-webpack-fast-a-field-guide-for-better-build-performance-f56a5995e8f1\u003C\u002Fa\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fmedium.com\u002Fwebpack\u002Ftypescript-webpack-super-pursuit-mode-83cc568dea79\"\u003Ehttps:\u002F\u002Fmedium.com\u002Fwebpack\u002Ftypescript-webpack-super-pursuit-mode-83cc568dea79\u003C\u002Fa\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fmedium.com\u002Fottofellercom\u002F0-100-in-two-seconds-speed-up-webpack-465de691ed4a\"\u003Ehttps:\u002F\u002Fmedium.com\u002Fottofellercom\u002F0-100-in-two-seconds-speed-up-webpack-465de691ed4a\u003C\u002Fa\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fmedium.com\u002Fonfido-tech\u002Fspeed-up-webpack-ff53c494b89c\"\u003Ehttps:\u002F\u002Fmedium.com\u002Fonfido-tech\u002Fspeed-up-webpack-ff53c494b89c\u003C\u002Fa\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fblog.box.com\u002Fblog\u002Fhow-we-improved-webpack-build-performance-95\"\u003Ehttps:\u002F\u002Fblog.box.com\u002Fblog\u002Fhow-we-improved-webpack-build-performance-95\u003C\u002Fa\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fengineering.bitnami.com\u002Farticles\u002Foptimizing-your-webpack-builds.html\"\u003Ehttps:\u002F\u002Fengineering.bitnami.com\u002Farticles\u002Foptimizing-your-webpack-builds.html\u003C\u002Fa\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fskbkontur\u002Fblog\u002F351080\u002F\"\u003Ehttps:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fskbkontur\u002Fblog\u002F351080\u002F\u003C\u002Fa\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Foleg-bunin\u002Fblog\u002F433324\u002F\"\u003Ehttps:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Foleg-bunin\u002Fblog\u002F433324\u002F\u003C\u002Fa\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Flcxfs1991\u002Fblog\u002Fissues\u002F15\"\u003Ehttps:\u002F\u002Fgithub.com\u002Flcxfs1991\u002Fblog\u002Fissues\u002F15\u003C\u002Fa\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002FFrendEr\u002Fwebpack-optimize-example\"\u003Ehttps:\u002F\u002Fgithub.com\u002FFrendEr\u002Fwebpack-optimize-example\u003C\u002Fa\u003E\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"webpack"},{"titleHtml":"babel"},{"titleHtml":"оптимизация сборки"},{"titleHtml":"фронтенд"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F451146\u002Fd4d8992762fc35b863df211e786a75a7\u002F","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F451146\u002Fd4d8992762fc35b863df211e786a75a7\u002F?format=vk","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F451146\\\u002F\"},\"headline\":\"Ускоряем сборку веб-приложения с webpack\",\"datePublished\":\"2019-05-09T19:22:42+03:00\",\"dateModified\":\"2019-05-09T19:22:42+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"Дмитрий\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"По мере того как ваше приложение развивается и растёт, увеличивается и время его сборки &mdash; от нескольких минут при пересборке в development-режиме до десятков мин...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F451146\\\u002F#post-content-body\",\"about\":[\"h_webdev\",\"h_javascript\",\"f_develop\"],\"image\":[\"https:\\\u002F\\\u002Fhabr.com\\\u002Fshare\\\u002Fpublication\\\u002F451146\\\u002Fd4d8992762fc35b863df211e786a75a7\\\u002F\"]}","metaDescription":"По мере того как ваше приложение развивается и растёт, увеличивается и время его сборки — от нескольких минут при пересборке в development-режиме до десятков минут при «холодной» production-сборке....","mainImageUrl":null,"amp":false},"polls":[],"commentsEnabled":true,"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[],"hubs":"webdev,javascript"},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.c0af73e7.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
